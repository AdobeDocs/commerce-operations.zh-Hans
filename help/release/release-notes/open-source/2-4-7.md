---
title: Magento Open Source2.4.7-beta2发行说明
description: 了解2.4.7-beta2Magento Open Source版本中的新增功能、增强功能、错误修复和已知问题。
badgeCoreBeta: label="2.4.7（测试版）" type="informative"
exl-id: 0145380a-8b4b-4757-a5fe-d98713f0df62
source-git-commit: ceb986d155c6ed4d620f473fd8152a7484ff791e
workflow-type: tm+mt
source-wordcount: '10673'
ht-degree: 0%

---


# Magento Open Source2.4.7-beta2发行说明

>[!IMPORTANT]
>
>Beta版可能包含缺陷，并“按原样”提供，不提供任何形式的担保。 Adobe没有义务维护、更正、更新、更改、修改或以其他方式支持(通过Adobe支持服务或其他方式)测试版。 建议客户谨慎使用，并且不要以任何方式依赖测试版和/或任何随附的文档或材料的正确功能或性能。 因此，使用测试版完全由客户自行承担风险。

Magento Open Source2.4.7-beta2包括200多项质量修复和增强功能。 核心编辑器依赖项和第三方库已升级到最新可用版本。

此版本增加了GraphQL对自定义属性和GraphQL解析器缓存的覆盖范围。 它还引入了对最近更新的FedEx和UPS服务的支持。

{{bics}}

## 其他发行信息

虽然这些功能的代码与Magento Open Source核心代码的发行版本捆绑在一起，但其中几个项目也单独发布。 每个项目的文档中都提供了特定于项目的单独发行信息，其中记录了这些项目的错误修复。

## Magento Open Source2.4.7-beta2

Magento Open Source2.4.7-beta2已针对以下组件版本进行了测试：

* Apache 2.4
* Composer 2.5
* Elasticsearch8.7
* MariaDB 10.6
* MySQL 8.0
* OpenSearch 2.5
* PHP 8.2和8.1
* PHPUnit 9.x
* RabbitMQ 3.11
* Redis 7.0
* 清漆7.3

我们的技术栈栈是基于PHP和MySQL构建的。 请参阅 [系统要求](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/system-requirements.html).

## Magento Open Source2.4.7（测试版2）亮点

在此版本中查找以下要点。

### 安全性增强

此发行版本引入了十个安全修复和平台安全改进。 Adobe Commerce 2.4.7之前的测试版引入了13项安全修复和平台安全改进。

到目前为止，尚未发生与这些问题相关的已确认攻击。 但是，可能会利用某些漏洞访问客户信息或接管管理员会话。 这些问题中的大多数要求攻击者首先获得对管理员的访问权限。 因此，我们提醒您采取一切必要步骤保护您的管理员，包括但不限于以下工作：

* IP 列入允许列表
* [双重身份验证](https://devdocs.magento.com/guides/v2.4/security/two-factor-authentication.html)
* 使用VPN
* 使用唯一位置，而不是 `/admin`
* 良好的密码卫生

请参阅 [Adobe安全公告](https://helpx.adobe.com/security/products/magento/apsb23-35.html) 以获取有关这些已修复问题的最新讨论。

#### 其他安全增强功能

此版本的安全改进改进了与最新安全最佳实践的合规性，

**2.4.7-beta2的新安全增强功能**

此版本引入了新的全页缓存配置设置，可帮助降低与相关的风险。 `{BASE-URL}/page_cache/block/esi HTTP` 端点。 此端点支持来自Commerce布局句柄和块结构的无限制、动态加载的内容片段。 新 **[!UICONTROL Handles Param]** 配置设置设置此端点的值 `handles` 参数，用于确定每个API允许的最大句柄数。 此属性的默认值为100。 商家可以从管理员( **[!UICONTROL Stores]** > **[!UICONTROL Settings:Configuration]** > **[!UICONTROL System]** > **[!UICONTROL Full Page Cache]** > **[!UICONTROL Handles Param]** )。 请参阅 [配置Commerce应用程序以使用Varnish](https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cache/configure-varnish-commerce.html). <!-- AC-9113 -->

**2.4.7-beta1中引入的安全功能亮点**

Magento Open Source2.4.7-beta1引入了以下增强功能，其中更改了现有REST端点的默认行为：

**通过REST和GraphQL API传输的支付信息的本机速率限制**. 商家现在可以为使用REST和GraphQL传输的支付信息配置速率限制。 此新增的保护层支持对分拣攻击的防范，并可能会减少一次测试多个信用卡号码的分拣攻击的数量。 请参阅 [限速](https://developer.adobe.com/commerce/webapi/get-started/rate-limiting/). <!-- AC-1271 -->

的默认行为 [`isEmailAvailable`](https://developer.adobe.com/commerce/webapi/graphql/schema/customer/queries/is-email-available/) GraphQL查询和([`V1/customers/isEmailAvailable`](https://adobe-commerce.redoc.ly/2.4.6-admin/tag/customersisEmailAvailable/#operation/PostV1CustomersIsEmailAvailable)) REST端点已更改。 默认情况下，API现在始终返回 `true`. 商人们可以启用原始行为，即 `true` 如果电子邮件在数据库中不存在，并且 `false` 如果它存在。 <!-- AC-6695 -->

### 平台增强功能

此版本的平台升级可改善对最新安全最佳实践的合规性。

**2.4.7-beta2的新平台增强功能**

以下平台组件已升级到其2.4.7-beta2的最新版本：

* `allure-framework/allure-phpunit`  <!-- AC-8063 -->
* `colinmollenhour/cache-backend-file`  (1.4.5)  <!-- AC-8064 -->
* `colinmollenhour/cache-backend-redis` (1.16.0) <!-- AC-8065 -->
* `colinmollenhour/php-redis-session-abstract`  (1.5.1)  <!-- AC-8066 -->
* `dealerdirect/phpcodesniffer-composer-installer` (1.0.0) <!-- AC-8067 -->
* `jquery.ui.widget.js` (v1.13.2)  <!-- AC-9173 -->
* `squizlabs/php_codesniffer` <!-- AC-8070 -->
* `strip-json-comments library` <!-- AC-2783 -->
* `grunt` 依赖关系 <!-- AC-8097 -->
* `less js` 库 <!-- AC-8098 -->
* `underscore.js` 库 <!-- AC-8099 -->
* `jquery/bootstrap` 依赖关系 <!-- AC-9154 -->

NPM包：

* `grunt` (1.6.1) <!-- AC-8072 -->
* `grunt-contrib-clean` (2.0.1) <!-- AC-8073 -->
* `grunt-contrib-less` (3.0.0) <!-- AC-8074 -->
* `grunt-eslint`  (24.0.1) <!-- AC-8075 -->

编辑器依赖项：

* `friendsofphp/php-cs-fixer` (3.22.0) <!-- AC-8087 -->
* `jquery/jstree` 依赖关系 <!-- AC-9131 -->
* `jquery` 依赖关系 <!-- AC-9132 -->
* `jquery/tinycolor` <!-- AC-9133 -->
* `laminas` 依赖关系包 <!-- AC-8088 -->
* `magento/composer-dependency-version-audit-plugin` (0.1.5) <!-- AC-8087 -->
* `moment-timezone-with-data.js` <!-- AC-9130 -->
* `pdepend/pdepend`  (2.14.0) <!-- AC-8087 -->
* `pdepend/pdepend`  (2.14.0) <!-- AC-8087 -->
* `pdepend/pdepend`  (2.14.0) <!-- AC-8087 -->
* `pdepend/pdepend`  (2.14.0) <!-- AC-8087 -->
* `php-amqplib/php-amqplib` (3.5.4) <!-- AC-8087 -->
* `phpseclib/mcrypt_compat` (2.0.4) <!-- AC-8087 -->
* `symfony` 依赖关系包  <!-- AC-8093 -->

**2.4.7-beta1中引入的平台增强功能**

* Composer 2.5.x.与Composer 2.2.x的兼容性得以保留。  <!-- AC-8129 -->

* **支持Varnish缓存7.3**. 此版本与最新版本的Varnish Cache 7.3兼容。与6.0.x和7.2.x版本的兼容性保持不变，但我们建议仅将Magento Open Source2.4.7-beta1与Varnish Cache版本7.3或版本6.0 LTS一起使用。

* **RabbitMQ 3.11支持**. 此版本与最新版本的RabbitMQ 3.11兼容。兼容性保持与RabbitMQ 3.9的兼容，该版本在2023年8月之前受支持，但我们建议仅将Magento Open Source2.4.7-beta1与RabbitMQ 3.11一起使用。

#### 其他升级和更换

Magento Open Source2.4.7-beta2引入了以下平台升级：

* Commerce UPS XML API网关已迁移到新的Commerce UPS REST API，以支持UPS对其所做的更新 [API安全模型](https://developer.ups.com/oauth-developer-guide?loc=en_US&amp;sp_rid=NTA5MzQ1OTE2NjEyS0&amp;sp_mid=72989914). (UPS正在为所有API实施OAuth 2.0安全模型（持有者令牌）。)  所有以前的Commerce UPS XML API已从Adobe Commerce 2.4.7代码库中移除。 <!-- AC-8918 -->

* Adobe Commerce与FedEx的集成已从旧版FedEx WSDL Web服务迁移到最新的FedEx RESTful API。 FedEx Web服务跟踪、地址验证和验证邮政编码WSDLS将于2024年5月停用。 <!-- AC-1470 -->

* 增加了对新的USPS Ground Advantage配送方法的支持。 这是与USPS的新配送方法USPS Ground Advantage（2023年7月发布）的开箱即用集成。

  此新集成可用于通过USPS配送服务检索配送费率并安排配送和退货。 USPS Ground Advantage发运方法取代了这些发运方法，在USPS Ground Advantage发运方法发布时，这些发运方法已停用：

   * USPS零售场
   * 一流包服务
   * 包裹选择基底 <!-- AC-9182 -->

* 已从核心Commerce代码库中移除Temando配送模块。 Adobe Commerce 2.4.4已弃用此功能。 <!-- AC-8130 -->

**2.4.7-beta1中引入的库升级**

过时的JavaScript库已升级到其最新版本，包括：

* `moment.js` 库(v2.29.4) <!-- AC-7389 -->
* `jQuery UI` 库(v1.13.2)  <!-- AC-7775 -->
* `jQuery` 验证插件库(v1.19.5) <!-- AC-8077 -->

### GraphQL

**GraphQL 2.4.7-beta2的新增强功能**

此版本引入了对解析器缓存的支持，并扩展了对自定义客户属性缓存的支持。

* 以下GraphQL查询解析器现在可以在GraphQL解析器结果缓存中缓存，这提高了使用POST请求提交查询时的性能：

   * `Magento\CustomerGraphQl\Model\Resolver\Customer::resolve`
   * `Magento\CustomerGraphQl\Model\Resolver\CustomerAddress::resolve`
   * `Magento\CustomerGraphQl\Model\Resolver\IsSubscribed::resolve` <!-- B2B-2658 -->
   * `Magento\CatalogGraphQl\Model\Resolver\Product\MediaGallery::resolve` <!-- B2B-2677 -->

* 为取消订单添加了GraphQL支持。 此 `cancelOrder` 突变允许客户取消订单，传递其标识符和取消原因。 <!-- LYNX-197 -->

* 添加了 `order_cancellation_enabled` 和 `order_cancellation_reasons.description` 的响应字段 `storeConfig`
查询以支持用户发起的订单取消请求。 请参阅 [查询商店的订单取消配置](https://developer-stage.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/#query-a-stores-order-cancellation-configuration)

* 已将以下字段添加到 `setBillingAddressOnCart` 和 `setShippingAddressesOnCart` 突变：

   * `fax`
   * `middlename`
   * `prefix`
   * `suffix`

**2.4.7-beta1中引入的GraphQL增强功能**

此版本增强了客户EAV属性的GraphQL缓存功能，并向GraphQL架构提供了支持，包括：

* **增强了对自定义属性的支持**. GraphQL通过丰富API数据而增强了自定义属性支持，因此现在它支持所有属性类型。 GraphQL EAV属性架构现在支持在管理员中扩展客户属性和客户地址对象，以及使用GraphQL检索它们。 具体的增强功能包括： <!-- LYNX-61 110-->

   * 扩展/添加了针对特定领域（如客户和客户地址）的自定义属性支持
   * 添加了自定义属性的缓存
   * 增强了对产品的现有自定义属性支持

* **增强的GraphQL缓存功能可提高页面加载速度**. 已为这些查询添加了缓存功能，提高了大多数PWA页面的页面加载时间速度：

      * [可用商店](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/available-stores/)
      * [国家](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/countries/)和[国家](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/country/)
      * [storeConfig](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/)
      * [货币](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/currency/)
      * [customAttributeMetadata](https://developer.adobe.com/commerce/webapi/graphql-api/index.html#query-customAttributeMetadata)
  
* **新的GraphQL解析器缓存类型** 包括：
   * CMS页面。 这将缓存CMS页面解析器的结果。  <!-- B2B-2451 -->
   * CMS块。 这将缓存从返回的结果 `Magento\CmsGraphQl\Model\Resolver\Blocks::resolve`. <!-- B2B-2659 -->

* GraphQL通过减少 `parse` 每个请求调用方法。 现在只调用一次。 以前，解析器至少被调用三次。 <!-- B2B-2606 -->

#### 新查询

* `attributeForms` <!-- LYNX-151 -->
* `attributesList` <!-- LYNX-150 -->
* `cancelOrder` <!-- LYNX-172 -->
* [customAttributeMetadataV2](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/custom-attribute-metadata-v2/)

#### 已弃用的查询

* [attributeMetadata](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/attributes-metadata/)
* [customAttributeMetadata](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/custom-attribute-metadata/)

### Magento Open Source扩展中继包

此版本包括Magento Open Source扩展metapackage v1.0.0-beta1，它自动捆绑 [支付服务](https://experienceleague.adobe.com/docs/commerce-merchant-services/payment-services/guide-overview.html) 扩展。 在以下情况下安装此中继包中包含的此扩展的版本： `composer update` 运行，从而简化在升级到最新核心版本时升级扩展的过程。 此扩展将维护独立的发布计划。

此扩展metapackage的未来版本将包含其他扩展。

### 页面生成器

Page Builder v.1.7.4与Adobe Commerce 2.4.7-beta2兼容。

### PWA Studio

PWA Studiov.13.2.x与Magento Open Source2.4.7-beta1兼容。 它包括多项增强功能，可改善辅助功能。 有关错误修复的信息，请参见 [PWA Studio版本](https://github.com/magento/pwa-studio/releases). 请参阅 [版本兼容性](https://developer.adobe.com/commerce/pwa-studio/integrations/adobe-commerce/version-compatibility/) 有关PWA Studio版本及其兼容的Magento Open Source核心版本的列表。

## 修复的问题

我们已在Magento Open Source2.4.7-beta1核心代码中修复了数百个问题。 此版本中包含的已修复问题的子集如下所述。

### 安装、升级、部署

<!-- ACP2E-2198 -->

* `/bin/magento setup:install` 现在在以下时间后成功完成： `app/etc/config.php` 已被删除。 以前，在安装期间不会重新生成缺少的文件，并且Commerce会引发错误。 [GitHub-37805](https://github.com/magento/magento2/issues/37805)

<!-- AC-8381 -->

* `bin/magento setup:upgrade` 已重构为在安装同时安装表和关联的新模块时成功运行 `mview` 索引器。 [GitHub-37304](https://github.com/magento/magento2/issues/37304)

<!-- ACP2E-1882 -->

* 由于出现分隔符错误，数据库还原不再失败。 以前，Commerce在以下情况下引发此错误： `bin/magento setup: rollback --db` 已执行： `Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'delimiter' at line 1, query was: delimiter ;;`.

<!-- ACP2E-1505 -->

* 此 `bin/magento setup:upgrade` 命令不再失败，出现此类型的MySQL内存限制相关错误： `PHP Fatal error:  Allowed memory size of 4294967296 bytes exhausted (tried to allocate 20480 bytes)`. 多选属性迁移已经过优化，以在 `setup:upgrade`.

<!-- ACP2E-1751 -->

* 现在，从管理员和命令行均可按预期生成数据库备份。 以前，Magento Open Source引发此错误： `Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'delimiter' at line 1, query was: delimiter ;;`.

<!-- ACP2E-1604 1605-->

* 正在运行 `setup:config:set` 而不指定 `--lock-db-prefix` 参数不再拭除当前值 `env.php` 文件。

<!-- ACP2E-1498 -->

* 清漆配置已更新，以防止来宾用户访问与其他客户组相关的缓存内容。

<!-- https://github.com/magento/magento2/pull/33092 -->

* `bin/magento setup:upgrade` 现在，在安装同时安装表和关联的新模块时成功完成 `mview` 索引器。

<!-- ENGCOM-9243 -->

* `bin/magento setup:upgrade` 现在，当消息队列主题不包含主题名称时，会显示信息更丰富的错误消息。 [GitHub-34246](https://github.com/magento/magento2/issues/34246)

<!-- https://github.com/magento/magento2/pull/36239 -->

* `bin/magento setup:upgrade` 现在，当合并的XML文件无效时，会显示信息更丰富的错误消息。 错误消息现在包含文件名。

### 捆绑产品

<!-- ACP2E-1650 -->

* 更正了在使用时出现的一个错误 `POST V1/shipment` 端点，以创建包含捆绑产品的装运。 终结点现在按预期添加项目，且不再返回此错误： `The shipment couldn't be saved`.

<!-- ACP2E-1650 -->

* 您现在可以使用 `GET V1/shipment/` 用于创建捆绑产品装运的API工艺路线(当产品具有 **[!UICONTROL together]** 装运类型集。 捆绑产品现在还可根据其装运类型属性进行验证。

<!-- ACP2E-2038 -->

* 购物者现在可以编辑店面购物车中捆绑产品的数量。 以前，Adobe Commerce不处理以下项的空值 `ItemId` 当在店面购物车中编辑产品并显示以下错误时： [GitHub-37696](https://github.com/magento/magento2/issues/37696)

<!-- ACP2E-1801 -->

* 现在，可以使用包含斜杠(`/`)字符。 以前，管理员用户无法使用此方法将产品添加到管理员订单，并且Commerce引发了JavaScript错误。

<!-- ACP2E-1799 -->

* 在以下情况下，管理员用户现在可以为新添加的捆绑包选项设置十进制默认值： **[!UICONTROL Qty Uses Decimal]** 已为相应的简单产品启用。 以前，只能为保存的选择设置小数值。

<!-- ACP2E-1347 -->

* 优化了使用大量选项保存捆绑产品的性能

<!-- ACP2E-1478 -->

* 现在，无需在产品选项中复制SKU，即可成功导入捆绑包产品。 以前，当您导入带有重复条目的捆绑产品时，Magento Open Source会在产品选项中创建多个重复的SKU。

<!-- ACP2E-1388 -->

* 现在，当捆绑包中的某个产品缺货时，可以正确计算捆绑包产品价格。 以前，如果属于捆绑销售的产品缺货，则会将其从价格计算中删除。

<!-- ACP2E-1503 -->

* 现在，在购买捆绑产品的最后一个所需子产品时，捆绑产品会显示为缺货。 以前，当简单的产品缺货时，店面中捆绑销售的产品会显示为现货。

<!-- ACP2E-1443 -->

* 使用将包含非必需选项的捆绑产品添加到购物车时出现性能问题 `addBundleProductsToCart` 变异已被解决。

<!-- ACP2E-1264 -->

* 此 `categoryList` 现在，当满足以下条件时，查询会按预期返回所有捆绑选项： **[!UICONTROL Show out-of-stock products]** 已启用配置设置。 以前，缺货的选项不包含在查询响应中。

<!-- ACP2E-1345 -->

* 捆绑产品创建方式 `POST V1/products` 现在，当目录价格范围设置为时，成功 `website`. 以前，出现完整性约束冲突。 [GitHub-35595](https://github.com/magento/magento2/issues/35595)

### 缓存

<!-- ACP2E-2070 -->

* 现在，登录后的缓存Cookie在浏览网站后是相同的。 以前，登录控制器发送错误的缓存Cookie，并且页面可能已缓存多次。

<!-- ACP2E-1840 -->

* 在包含CMS块的CMS页面上，来自GraphQLGET操作的响应现在按预期在Fastly缓存中清除。 现在，后续计划更新会显示这些页面的准确、更新内容。

<!-- ACP2E-1524 -->

* 现在，当父产品的某个子产品已从管理员中保存时，其页面缓存会按预期清除。 引入了一项插件检查，以便像其他产品类型一样，使可配置变体的缓存失效，而不管索引器状态（计划或实时）如何。 以前，在管理员更新可配置变量后，店面上的价格不会正确更新。

<!-- ACP2E-1454 -->

* 为AWS凭据添加了缓存机制。 凭据提供程序现在使用Magento缓存来缓存从AWS检索到的凭据以进行EC2配置。

<!-- AC-7639 -->

* 现在，插件可按预期工作，该插件的目的是在保存与可配置产品关联的简单产品时添加可配置缓存标记。 在通过更新简单产品时，会按预期删除所有相关的可配置缓存标记 `POST V1/products`. 以前，并非所有价格都会在店面更新，缓存必须手动清空。 [GitHub-36726](https://github.com/magento/magento2/issues/36726)

### 购物车和结账

<!-- AC-9340 -->

* 在区域ID处理期间，将订单发送到多个地址不再触发错误。

<!-- AC-8853 -->

* 现在，在购物车级别应用的固定折扣金额是正确的。[GitHub-37496](https://github.com/magento/magento2/issues/37496)

<!-- AC-2044 -->

* 现在，当购物者在选择统一费率发运方法（将发运方法设置为条件的购物车价格规则适用）后应用优惠券时，优惠券将成功应用于订单。 以前，购物车页面显示“优惠券无效”错误，且未应用优惠券。 [GitHub-34866](https://github.com/magento/magento2/issues/34866)


<!-- AC-2044 -->

* 现在，当购物者在选择统一费率发运方法（将发运方法设置为条件的购物车价格规则适用）后应用优惠券时，优惠券将成功应用于订单。 以前，购物车页面显示“优惠券无效”错误，且未应用优惠券。 [GitHub-34866](https://github.com/magento/magento2/issues/34866)

<!-- AC-8596 -->

* 此 **[!UICONTROL My billing and shipping address are the same]** 现在，当购物者使用Chrome自动完成填写其送货地址并单击时，复选框默认保持选中状态 **下一个** 在重新加载配送方式块之前。 [GitHub-33725](https://github.com/magento/magento2/issues/33725)

<!-- ACP2E-2005 -->

* 此 `applied_rule_ids` 中的值 `quote_item` 该表现在包含已应用规则ID的正确列表。 以前，此值仅包含上次应用的规则ID。

<!-- ACP2E-2025 -->

* 现在，当从服务器中删除会话时，本地存储中的迷你购物车和客户数据会重置。 以前，删除会话文件时仍会显示此数据。

<!-- ACP2E-1763 -->

* 启用永久购物车后，不再错误地从管理员合并离散购物车。

<!-- ACP2E-1580 -->

* 购物车税和配送估算器现在可以准确地反映默认目标配置。 以前，当您配置默认纳税目标计算设置并指定州/地区和ZIP时，购物车中只显示ZIP值，它位于 **[!UICONTROL Estimate Tax and Shipping]**. 这是由于在从管理员调用设置默认区域ID的条件语句之前，Magento Open Source将区域ID设置为undefined所致。

<!-- ACP2E-1547 -->

* 启用永久购物车后，Magento Open Source在签出期间不再引发此错误： `Invalid state change requested`. 以前，引发此错误时，多个订单具有相同的 `quote_id` 偶尔会出现。

<!-- ACP2E-1456 -->

* 迷你购物车现在显示反映购物车税务配置设置的捆绑产品价格。 以前，迷你购物车始终在捆绑产品的价格中包含税费。

<!-- AC-7503 -->

* 从购物车页面提供的配送估计值现在准确。 `collectShippingRates` 现在仅设置一次。 以前，运费估计数是重复的。 [GitHub-36648](https://github.com/magento/magento2/issues/36648)

<!-- ACP2E-1417 -->

* 此 `cart` 指定购物车中的产品缺货时，查询不再返回错误。 以前，使用此查询进行购买的购物者无法在商品缺货且结账页面为空白时完成购买。

<!-- ACP2E-1459 -->

* 来宾API请求到 `POST V1/guest-carts/<cartId>/shipping-information` 不再返回 `cancel` 在登录移动环境期间重新加载页面时的状态。 以前，Magento Open Source引发500错误并记录此异常： `TypeError: Argument 2 passed to Magento\CustomerCustomAttributes\Model\Plugin\ProcessCustomerShippingAddressCustomAttributes::beforeSaveAddressInformation() must be of the type string, null given`.

<!-- AC-7886 -->

* 免费配送资格现在按预期计算，当 **[!UICONTROL Subtotal (Excl. Tax)]** 应用购物车规则的条件。 [GitHub-36760](https://github.com/magento/magento2/issues/36760)

<!-- AC-6672 -->

* 此 `cart` 现在，查询返回产品的正确层定价。 [GitHub-29655](https://github.com/magento/magento2/issues/29655)

<!-- AC-1162 -->

* 已将信息性错误消息添加到结账页面，以指导购物者在配送页面上应用优惠券与所选配送方式冲突时进行购物。 以前，有一条信息告诉购物者返回上一页。

<!-- ENGCOM-8387 -->

* 现在，仅当需要身份验证弹出窗口时，才会将其初始化，而不是在启用了来宾签出时。 现在，当访客购物者尝试继续结帐，且访客结帐被禁用时，它会进行初始化。 [GitHub-30672](https://github.com/magento/magento2/issues/30672)

### 购物车价格规则

<!-- ACP2E-2029 -->

* 此 `If an item is FOUND/NOT FOUND in the cart with ALL/ANY of these conditions true` 目录价格规则条件现在可以正确与类别和SKU属性一起使用。 以前，在购物车价格优惠券逻辑中无法正确应用此条件，并且订单应用了无效优惠券。 [GitHub-37660](https://github.com/magento/magento2/issues/37660)

<!-- ACP2E-1932 -->

* 现在，您可以使用以下成功保存新的购物车价格规则 `Magento_OfflineShipping` 扩展已禁用。 以前，Adobe Commerce引发此错误： `[2023-05-09T00:49:34.666107+00:00] report.ERROR: Warning: Undefined array key "simple_free_shipping" in /Users/npuchko/www/l3/mem/magento24i3/app/code/Magento/SalesRule/Controller/Adminhtml/Promo/Quote/Save.php on line 67 [] []`. [GitHub-37580](https://github.com/magento/magento2/issues/37580)

<!-- ACP2E-1516 -->

* 现在，当为商店配置了与一种配送方式相关的购物车价格规则，并且在结帐期间此配送方式更改为另一种配送方式时，购物车价格规则可按预期应用。 以前， `applied_rule_ids` 值从未在 `sales_order_item` 表，并且购物车价格规则未应用于订单。

<!-- AC-2044 -->

* 现在，当购物者在选择统一费率发运方法（将发运方法设置为条件的购物车价格规则适用）后应用优惠券时，优惠券将成功应用于订单。 以前，购物车页面显示 `Coupon is Not valid` 错误，未应用优惠券。 [GitHub-34866](https://github.com/magento/magento2/issues/34866)


### 可配置的产品

<!-- ACP2E-2003 -->

* 计划更新禁用了一个子产品时，不再将具有两个子产品的可配置产品标记为缺货。 这是2.4.7-beta1的一个已知问题。

<!-- AC-8060 -->

* 提高了具有多个选项的可配置产品的保存操作性能。 以前，在产品保存操作期间可能会发生超时。 [GitHub-36928](https://github.com/magento/magento2/issues/36928)

<!-- ACP2E-1764 -->

* 现在，当购物者选择产品选项时，可配置产品价格的店面显示会按预期发生变化。 [GitHub-37378](https://github.com/magento/magento2/issues/37378)

### 目录

<!-- ACP2E-2043 -->

* 当产品库存状态根据库存配置（数量）自动更新为缺货时，库存状态随后将在库存数量更新时更新为有库存。 以前， `stock_status_changed_auto` 当产品的库存配置更新为库存时，设置被忽略。

<!-- AC-8904 -->

* 工具栏排序现在可以在以下情况下在搜索页面上按预期工作： **[!UICONTROL Remember Category Pagination]** 设置已启用。 [GitHub-33220](https://github.com/magento/magento2/issues/33220)

<!-- ACP2E-1640 -->

* 现在，多选属性会在以下情况下按预期保存： **[!UICONTROL Use Default Value]** 已选中store-view范围内的复选框。 以前，在编辑产品并保存默认值时，取消选中此复选框。

<!-- ACP2E-1878 -->

* 具有网站限制访问权限的管理员用户现在可以将图像添加到其范围内的产品。 如果管理员用户无产品访问权限，则Magento Open Source会显示一条信息性消息。 以前，具有网站限制访问权限的管理员用户无法将图像添加到他们有权访问的产品。

<!-- AC-6761 -->

* 现在，在管理员>中按名称对产品进行排序后，Commerce会显示正确的名称 **[!UICONTROL Category]** > **[!UICONTROL Products in category]** 在产品名称因存储而不同的多存储部署中。 [GitHub-36208](https://github.com/magento/magento2/issues/36208)

<!-- ACP2E-1975 -->

* 此 `addProductsToCart` 突变现在返回带有数据的可自定义选项。 以前，它只返回空的可自定义选项。 [GitHub-37599](https://github.com/magento/magento2/issues/37599)

<!-- ACP2E-1943 -->

* 现在，店面上正确显示了产品延交状态。 以前，可发运的产品被错误地标识为延期交货。

<!-- ACP2E-1994 -->

* 现在，导出的产品具有正确的属性 `manage_stock` 值当 `use_config_manage_stock` 值等于 `1`. 以前，此默认值不正确。

<!-- ACP2E-1948 -->

* 当管理员用户将商店视图从产品创建期间使用的视图更改为其他商店视图时，从管理员访问可下载产品不再会导致错误。 现在，当管理员用户将商店视图从所有商店视图切换到默认商店视图时，产品价格已成功转换为浮点数。 以前，Adobe Commerce会引发错误。 [GitHub-37519](https://github.com/magento/magento2/issues/37519)

<!-- ACP2E-1479 -->

* 当您保存使用自定义选项创建的产品时，在删除其图像后，Magento Open Source不再显示警告消息。

<!-- ACP2E-1419 -->

* 现在，产品缩略图图像会按预期显示在产品重新上架时发送的产品库存警报电子邮件中。 以前，此图像不显示在警报电子邮件中

<!-- AC-3003 -->

* 类别树中的产品计数（管理员） **[!UICONTROL Catalog]** > **[!UICONTROL Category]**)现在准确。 以前，无法从 `catalog_category_product_index` 表格。 已修复触发此错误的拼写错误。 [GitHub-35417](https://github.com/magento/magento2/issues/35417)

<!-- ACP2E-1239 -->

* 在下列情况下，产品详细信息页面上的主要产品图像在页面加载期间不再明显下移 `product_image_white_borders` 主题 `view.xml` 已禁用。 以前，由于Fotorama JS中的高度设置不正确，导致产品图像在页面加载期间明显向下偏移。

<!-- ACP2E-1361 -->

* 现在，当客户订阅了价格下降警报时，将会向客户发送有关产品价格下降的通知。 以前，由于应用程序级别的缓存，不能始终发送降价通知。

<!-- ACP2E-1422 -->

* 在通过Web API创建产品属性的过程中添加了服务器端验证。 您无法启用 **[!UICONTROL Use in Layered Navigation Catalog]** 字段，当 **[!UICONTROL Catalog Input Type for Store Owner]** 字段值为 `Text Field`，  `Text Area`，  `Text Editor`， `Date`，或 `Date and Time`. 以前，类别和搜索结果中会忽略产品。

<!-- ACP2E-1413 -->

* 现在，购物者打开页面、更改分页、导航到产品页面，然后返回到类别页面后，类别页面以正确的分页重新加载。  [GitHub-36563](https://github.com/magento/magento2/issues/36563)

<!-- ACP2E-1334 -->

* 作为可配置产品的选项的缺货简单产品现在在店面中显示为禁用，当 **[!UICONTROL Display Out of Stock Products]** 设置为 **是**. 以前，所有选项都显示为可用，无论其状态和实际可用性如何。

<!-- ACP2E-1384 -->

* 更新特定商店视图中的网站范围属性不再覆盖全局范围中该属性的值。 以前，当同一SKU和多行可用时导入产品价格，并且 `store_view_code` 导致默认和“所有存储”视图范围的价格不准确。

<!-- ACP2E-1632 -->

* 商家现在可以从管理员将GIF图像添加到产品的图像库。 以前，Magento Open Source显示此错误：  `imagecolorsforindex(): Argument #2 ($color) is out of range`.

<!-- ACP2E-1709 -->

* 已添加检查以处理未定义数组键导致的错误。 以前，在生成声明性架构白名单期间出错。

<!-- ACP2E-1749 -->

* Magento Open Source现在返回自定义日期的有效结果 `01/01/1970`. 以前，自定义属性返回此错误： `Invalid input datetime format of value '1/01/1970`. [GitHub-37274](https://github.com/magento/magento2/issues/37274)

<!-- AC-6507 -->

* `routes` 使用片段的查询现在会按预期返回类别信息。 以前，类别页面上发生内部服务器错误。 [GitHub-35906](https://github.com/magento/magento2/issues/35906)

<!-- ACP2E-1772 -->

* 的问题 `cataloginventory_stock` 部分重新索引过程已得到解决，索引器性能已得到改进。 以前，库存和产品类别无法准确更新。

<!-- AC-8226 -->

* 现在，当产品所属的类别已移至新父级时，Magento Open Source会为其生成301重定向。 [GitHub-37039](https://github.com/magento/magento2/issues/37039)

### 目录规则

<!-- ACP2E-1834 -->

* 现在，当通过计划更新启用目录规则时，该规则将正确地编制索引。 因此，现在可以正确生成折扣价格并编制索引。 以前，当两个目录规则可用，并且在第一个规则的目录规则索引操作完成之前在第一个规则之后激活一个规则时，不会为第二个目录规则生成目录规则折扣价格。

<!-- ACP2E-1579 -->

* 现在，目录规则可按预期方式在多网站环境中应用。

### 优惠券

<!-- ACP2E-1551 -->

* 购物者现在可以使用由同一购物车价格规则生成的两个单独的自动生成优惠券代码。 此 `Uses per Coupon` 字段现已启用，前提是优惠券类型已选择 `Auto` (与优惠券类型类似=`Specific Coupon`) 。 如果代码不同，这又使购物者可以将多个优惠券代码应用于相同的购物车价格。

<!-- ACP2E-1496 -->

* 现在，当购物者的一次性优惠券应用于的订单被取消时，该优惠券值会按预期恢复。

<!-- ACP2E-1195 -->

* 此 `GET V1/coupons/<couponId>` 现在，端点会像对自动生成的优惠券一样，返回手动创建的优惠券的完整预期响应。  以前，某些字段被忽略(例如， `usage_limit`， `usage_per_customer`、和 `created_at`)。

### cron

<!-- AC-9207 -->

* 修复了cron表达式中按零分的致命错误。 [GitHub-37804](https://github.com/magento/magento2/issues/37804)

<!-- ACP2E-1792 -->

* 此 `sales_clean_quotes` 通过在上添加复合索引，已优化cron进程以更快地运行 `store_id` 和 `updated_at columns` 在报价表中。 此更改可改进处理多个报价时的cron作业性能。


<!-- AC-7987 -->

* 管理员用户现在可以查看 `bin/magento cron:run` 当前正在执行进程。 当前正在运行的进程的标题现在列出了组和作业名称。 [GitHub-34321](https://github.com/magento/magento2/issues/34321)

### 客户

<!-- AC-6748 -->

* Magento Open Source现在显示 **[!UICONTROL Date of Birth]**， **[!UICONTROL Tax/VAT Number]**， **[!UICONTROL Gender]**， **[!UICONTROL Telephone]**， **[!UICONTROL Company]**、和 **[!UICONTROL Fax]** “编辑客户”页面上的字段。 [GitHub-36196](https://github.com/magento/magento2/issues/36196)

### 电子邮件

<!-- ACP2E-1529 -->

* 现在，当“分配公司管理员”电子邮件中包含 `CMS Block URL` 变量。

<!-- AC-2903 -->

* 客户电子邮件地址现在可以包含变音符号。 以前，前端验证禁止创建电子邮件地址中包含变音符号的用户。 [GitHub-12075](https://github.com/magento/magento2/issues/12075)

<!-- ACP2E-1682 -->

* 库存和价格警报电子邮件现在会根据为网站默认商店视图配置的语言进行翻译。 以前，不翻译这些电子邮件。

<!-- ACP2E-1571 -->

* `POST V1/order/notify-orders-are-ready-for-pickup` 现在会发送一封电子邮件，提醒客户只有在订单就绪后才能提货。 现在，仅当无一例外履行了请求时，才会触发电子邮件。

### 框架

<!-- ACP2E-1999 -->

* `bin/magento config:show` 和 `set` 使用的命令 `$_ENV` 变量现在支持使用包含驼峰形或大写字符的网站和存储代码。

<!-- AC-8923 -->

* 添加了包含的类  `!important` 在Tailwind 3中使用以支持CSS布局。 [GitHub-37568](https://github.com/magento/magento2/issues/37568)

<!-- AC-9115 -->

* 缺失 `jQuery` 依赖关系已添加到 `trim-input.js` 文件。 [GitHub-37683](https://github.com/magento/magento2/issues/37683)

<!-- AC-9387 -->

* 事件特定的详细信息现在作为第二个属性(`context`的) `log` 方法。 [GitHub-37879](https://github.com/magento/magento2/issues/37879)

<!-- AC-9109 -->

* 已将宽高比值添加到目录图像，并从UI框架中删除了不必要的脚本。 [GitHub-37691](https://github.com/magento/magento2/issues/37691)

<!-- AC-9188 -->

* 修订了由无效XML配置触发的错误消息，以提供更多信息。 [GitHub-37788](https://github.com/magento/magento2/issues/37788)

<!-- AC-9335 8817-->

* 已重构的已弃用代码，这些代码与在整个代码库中创建动态属性有关。

<!-- AC-7009 -->

* 对于产品数据库极为活跃的大型商店，索引器的性能已得到改进。 现在，索引器对每个索引的最新产品信息编制一次索引，而不是多次。 以前，产品会从网站上消失，并且网站上的产品数据可能会过期。 [GitHub-30012](https://github.com/magento/magento2/issues/30012)

<!-- ACP2E-1971 -->

* `mview_state` 现在，当从属数据库连接可用时，记录状态会根据changelog活动准确指示状态。 以前，这些记录保留在 `waiting` 云部署中的状态，即使更改日志中没有新条目也是如此。

<!-- ACP2E-2022 -->

* 添加了对 `precision` 货币格式选项，用于保留与已弃用的功能的等同性 `ZendCurrency` 类。

<!-- AC-8854 -->

* Cookie消息已转换为可观察属性，开发人员现在可以操纵状态，这可能会触发UI更改。 以前，Cookie是只读的，无法控制。 [GitHub-37308](https://github.com/magento/magento2/issues/37308)

<!-- AC-6325 -->

* 管理员用户现在可以在其Magento Open Source实例连接到S3存储时生成发票。 以前，Magento Open Source显示此错误： `Cannot create image resource. File not found`. [GitHub-35706](https://github.com/magento/magento2/issues/35706)

<!-- AC-6906 -->

* 当VIES验证服务进行的增值税编号验证失败时，Magento Open Source现在会按预期记录例外消息。 [GitHub-36065](https://github.com/magento/magento2/issues/36065)

<!-- AC-8146 -->

* 此 `Administrators` 在创建管理员角色期间，从用于获取管理员角色的查询中删除了名称。 [GitHub-36998](https://github.com/magento/magento2/issues/36998)

<!-- AC-8607 -->

* 此 `bin/magento setup:config:set` 当无效的数据库用户名包含在时，命令不再失败 `app/etc/env.php` 文件。 [GitHub-37409](https://github.com/magento/magento2/issues/37409)

<!-- AC-8595 -->

* 在默认管理UI组件中对保留字按列排序不会再导致中出现以下SQL错误 `var/log/exception.log`. [GitHub-37423](https://github.com/magento/magento2/issues/37423)

<!-- AC-8562 -->

* 已添加 `AddDataForCostaRica.php` 为哥斯达黎加提供国家资料。 [GitHub-37382](https://github.com/magento/magento2/issues/37382).

<!-- AC-8577 -->

* 改进了用户尝试从管理员访问无效URL的方案的错误消息。 [GitHub-35682](https://github.com/magento/magento2/issues/35682).

<!-- ACP2E-1841 -->

* `Param $options[`position`]` for currency symbols现在可按预期工作，并且支持自定义货币符号位置。 以前，在从Zend Framework 1迁移之后， `toCurrency` 方法忽略了 `position` 参数。 在整个管理员界面中都会出现此问题。

<!-- ACP2E-1492 -->

* 已对订单实施互斥，以防止在并发请求更新期间出现争用情况。 以前，订单取消的并发请求（争用条件）会在 `inventory_reservation` 表格。

<!-- ACP2E-1381 -->

* 此 `populateWithArray` 函数现在将对象属性正确转换为Snake大小写，使其与 `AbstractModel` Getter和Setter。 以前，当数据属性名称一行包含多个大写字母时，Snake大小写格式不正确。

<!-- ACP2E-1522 -->

* 中的自动增量值 `catalog_product_entity_varchar` 现在，表格会在保存产品后正确递增。 以前，此值会增加十。

<!-- ACP2E-1701 -->

* 当您尝试刷新JavaScript/CSS缓存时，Magento Open Source不再引发此文件系统异常：  `No such file or directory`.

<!-- ACP2E-1358 -->

* 的值 `value_id` 在 `customer_entity_int` 现已正确递增。 执行更新查询，而不是 `insert on duplicate key update` 更新包含这些属性的实体时。 因此，在EAV模型中使用的自动增量列现在以线性方式增长。 以前，对列的自动递增过程由于插入查询失败而跳过值。 [GitHub-28387](https://github.com/magento/magento2/issues/28387)

<!-- AC-8462 -->

* 删除不必要的空格 `id` 不需要它的属性。 (此错误是由Magento Open Source2.4.6代码更改引入的。)

<!-- AC-7923 -->

* 当存储处于单存储模式时，存储代码不再出现在存储URL中。 [GitHub-36831](https://github.com/magento/magento2/issues/36831)

<!-- AC-7988 -->

* 已对以下内容进行了细微更新 `around` 插件。 [GitHub-31443](https://github.com/magento/magento2/issues/31443)

<!-- AC-7989 -->

* 色板 `Helper` 已进行重构，以删除误导性的导入别名。 [GitHub-31373](https://github.com/magento/magento2/issues/31373)

<!-- AC-8708 -->

* 管理员用户现在可以删除或重命名 `sitemap.xml` 文件按预期显示。 以前，管理员用户可以从管理员中删除文件，但该文件仍保留在文件系统中。  [GitHub-37468](https://github.com/magento/magento2/issues/37468)

<!-- ACP2E-1747 -->

* 当已应用优惠券的订单的付款失败时，不再将优惠券标记为使用。 现在，队列消息会按照使用者启动时发布消息的顺序进行处理。 以前，从队列中提取第一条消息只是为了检查消息是否已排队，之后被拒绝，这导致了最后处理第一条消息。

<!-- ACP2E-1627 -->

* 当用户尝试打印传送标签时，Magento Open Source不再在日志文件中引发异常。 以前，如果扩展修改包含附件的响应标头，则系统在日志文件中引发异常。

<!-- AC-7986 -->

* 添加了对于更多HTML类的支持 `elements.xsd`. [GitHub-36891](https://github.com/magento/magento2/issues/36891)

### 常规修复

<!-- AC-8823 -->

* 现在，密码在出现以下情况时按预期显示 **[!UICONTROL Show Password]** 登录页面上的复选框处于活动状态。

<!-- ACP2E-2037 -->

* 客户实体(`rp_token`)验证功能在创建客户帐户期间已从属性验证中删除，并且变音符号验证仅包含在生成的客户电子邮件中。 以前，Magento Open Source不保存客户记录并显示此错误： `Something went wrong while saving the customer`.

<!-- AC-8826 -->

* 删除列后，您现在可以成功地将编辑内容保存到管理页面和块网格。 [GitHub-37525](https://github.com/magento/magento2/issues/37525)

<!-- ACP2E-1972 -->

* 客户现在可以在其他设备上重置密码后，使用新密码从一台设备成功登录。

<!-- ACP2E-1609 -->

* 管理员客户地址 **省/市/自治区** 字段现在会按预期保留上次保存的值。 以前，从此字段移除值时，Magento Open Source会在继续显示已删除的值 **省/市/自治区** 字段。 [GitHub-36846](https://github.com/magento/magento2/issues/36846)

<!-- ACP2E-1508 -->

* 在以下情况下请求类别的RSS馈送期间不再发生错误： **[!UICONTROL RSS Feed Top Level Category]** 已启用。 以前，浏览RSS新闻源类别页面会导致Elasticsearch `CRITICAL` 当出现以下情况时，日志文件出现错误 **[!UICONTROL RSS Feed Top Level Category]** 已启用。

<!-- ACP2E-1490 -->

* 现在已为保存正确的值 `gws_store_groups` 在用户角色创建期间更改角色范围时。 以前，当角色范围被选定为 `All`， `gws_store_groups` 值在用户创建期间保存为null，但在角色编辑期间保存为null。 此外，如果将角色范围选为 `Custom`，然后 `gws_store_groups` 值始终保存为null。

<!-- ACP2E-1446 -->

* 现在，通过单击“管理员登录”页面上的“管理员重置密码”链接，可以在以下情况下访问重置密码页面： **[!UICONTROL Add Store Code to Urls]** 设置已启用。 管理员重置密码链接以前打开了登录页面或404页面。

<!-- ACP2E-1274 -->

* 现在，管理员统计信息仪表板中的日期范围是根据在配置设置中设置的时区来计算的，然后转换为UTC以从数据库中提取数据。

<!-- ACP2E-1665 -->

* 当您过滤存储视图，然后单击 **[!UICONTROL Save]** 在管理员上 **[!UICONTROL Content]** > **[!UICONTROL Hierarchy]**. 以前，单击 **[!UICONTROL Save]** 已刷新页面，但上下文已丢失，并且选定的商店视图不再显示。

<!-- ACP2E-1631 -->

* 单击 **[!UICONTROL Send invitation]** 按钮（管理员） **[!UICONTROL Marketing]** > **[!UICONTROL Private sales]**  > **[!UICONTROL Invitation]**)现在会连同表单密钥一起提交POST请求，并成功发送邀请。 以前，当您单击此按钮时，HTTPPOST方法和表单键都不存在。

<!-- ACP2E-1608 -->

* 现在可以使用AWS S3将零字节文件成功复制到远程存储。

<!-- AC-7402 -->

* 现在，在为商店ID与网站ID不匹配的其他网站创建客户时，管理员用户可以从管理员中添加新的客户地址。 以前，Magento Open Source显示此弹出消息： `Something went wrong`. [GitHub-36582](https://github.com/magento/magento2/issues/36582)

<!-- AC-8247 -->

* CMS块编辑器页面现在显示正确的构件 `block_id` 值。  [GitHub-29644](https://github.com/magento/magento2/issues/29644)

### 礼品卡和包装

<!-- ACP2E-1612 -->

* 您现在可以使用 `updateCartItems` 变异以更新购物车中的礼品卡。 以前，仅购物车中的卡数量可以通过此突变进行更新。

<!-- AC-7530 -->

* 此 `addProductsToCart` 变异现在成功地将礼品卡添加到购物车。 以前，此查询需要礼品卡收件人姓名，但会返回发件人姓名。 Magento Open Source引发此错误： `Please specify a recipient name`. [GitHub-36665](https://github.com/magento/magento2/issues/36665)

### Google ReCAPTCHA

<!-- ACP2E-1539 -->

* 现在，结账工作流中的Google reCAPTCHA可按预期用于支票、汇票和自定义支付方法。

<!-- ACP2E-1311 -->

* 在加载Google ReCAPTCHA复选框之前，无法再提交Magento Open Source表单。

<!-- ACP2E-1338 -->

* reCAPTCHA构件现在位于 **[!UICONTROL Place Order]** 按钮。 以前，小组件显示在页面顶部。

### GraphQL

<!-- AC-8623 -->

* GraphQL库组件的地址错误处理现在可按预期运行。

<!-- AC-9058 -->

* 此 `products` 现在，当“动态定价”设置为“否”且应用折扣时，“查询”会返回所有相关店面定价详细信息。 以前，不会返回产品的价格范围。 [GitHub-35649](https://github.com/magento/magento2/issues/35649)

<!-- ACP2E-1744 -->

* GraphQL事务名称现在仅包含在New Relic日志中的顶级查询名称。 以前，事务名称还包括辅助查询名称。

<!-- AC-8623 -->

* GraphQL库组件的地址错误处理现在可按预期运行。

<!-- AC-7430 -->

* 当产品的可见性设置设置为 `Catalog`， `products` 现在，对该产品的查询可正确解析设置。 以前，提供的任何过滤器都会切换到 `Visibility: Catalog` 设置。 [GitHub-36591](https://github.com/magento/magento2/issues/36591)

<!-- ACP2E-1769 -->

* 此 `customer` 查询现在返回 `product_sale_price` 将产品价格配置为含税时，包含订单税的字段。 [GitHub-36946](https://github.com/magento/magento2/issues/36946)

<!-- ACP2E-1584 -->

* 类型的产品属性 `DateTime` 现在映射到 `FilterRangeTypeInput` 在产品查询中筛选。 以前，这些属性映射到 `FilterMatchTypeInput`. 作为此更改的结果，查询将过滤 `DateTime` 属性需要 `from` 和 `to` 值而不是匹配值。

<!-- ACP2E-1552 -->

* 此 `customer` 现在，当按商店ID进行筛选时，query会按预期仅返回与特定商店视图相关的客户评论。

<!-- AC-7544 -->

* 此 `categories` 当满足以下条件时，查询不再返回错误 `items.redirect_code` 响应值包含null值。 [GitHub-36675](https://github.com/magento/magento2/issues/36675)

<!-- ACP2E-1486 -->

* 此 `changeCustomerPassword` 在成功重置密码后，突变现在会按预期触发电子邮件。

<!-- ACP2E-1494 -->

* `urlResolver` 和 `route` 现在，当满足以下条件时，查询将返回结果： `Target Path` 的URL重写是一个绝对URL。 以前， `urlResolver` 使用查询检索重定向数据时返回了NULL。

<!-- AC-7979 -->

* 此 `products` 查询现在返回正确的标签。 [GitHub-29635](https://github.com/magento/magento2/issues/29635)

<!-- ACP2E-1315 -->

* 此 `categoryList` 查询现在返回填充的 `product` 的部分 `options` 块以按预期捆绑产品的子产品。  以前，不会返回有关捆绑产品子产品的信息。

<!-- AC-7114 -->

* 此 `route` 现在，查询可按预期返回类别和产品的路由，而不会出现内部服务器错误。 [GitHub-36544](https://github.com/magento/magento2/issues/36544)

<!-- ACP2E-1652 -->

* 此 `products` 现在可获取查询 `url_key` 选择多个类别时的值。

<!-- LYNX-17 -->

* `products` 现在，查询仅返回分配给指定共享目录之产品的聚合。

<!-- AC-7974 -->

* 交易名称已添加到New Relic GraphQL交易。 [GitHub-36874](https://github.com/magento/magento2/issues/36874)

<!-- AC-6680 -->

* 此 `OptionValueProvider` 类 `get()` 方法现在会根据给定的返回一个属性选项值 `option_id` 如预期。 以前，它会返回错误。 [GitHub-35910](https://github.com/magento/magento2/issues/35910)

<!-- AC-6745 -->

* 此 `products` 查询现在返回所有可用的聚合（过滤器）及其正确翻译的标签。 以前，价格和类别聚合标签无法按预期进行转换。 [GitHub-36140](https://github.com/magento/magento2/issues/36140)

<!-- AC-6666 -->

* 您现在可以使用片段 `ProductCard` 查询时 `related_products`， `upsell_products`、和  `crossell_products` 日期 `ProductInterface`. [GitHub-29769](https://github.com/magento/magento2/issues/29769)

<!-- AC-7014 -->

* 此 `products` query现在会按保存顺序返回相关、追加销售和交叉销售产品。 [GitHub-36461](https://github.com/magento/magento2/issues/36461)

<!-- AC-8573 -->

* GraphQL查询现在会返回按位置排序的相关产品数据。 [GitHub-33010](https://github.com/magento/magento2/issues/33010)

<!-- AC-8542 -->

* `category_url_path` 已添加至 `ProductAttributeFilterInput`，支持在单个查询中请求某个类别的所有产品。 [GitHub-32460](https://github.com/magento/magento2/issues/32460)

<!-- AC-821 -->

* 更正了以下错误：设置当前存储在GraphQL中的方法是在处理验证的方法之前执行的。 [GitHub-31336](https://github.com/magento/magento2/issues/31336)

### 图像

<!-- ACP2E-1353 -->

* 管理员收藏夹图标上传表单现在支持 `.ico` 文件类型。 [GitHub-34858](https://github.com/magento/magento2/issues/34858)

### 导入/导出

<!-- ACP2E-1930 -->

* 由于内存不足，产品导入不再失败。 以前，由于内存不足，将任意数量的产品导入到已包含约1000万个产品的数据库中失败。

<!-- AC-9116 -->

* 现在，验证检查在没有可导入的有效数据时按预期停止导入过程，Magento Open Source现在显示此错误： `There are no valid rows to import`. 以前，验证在这些条件下通过，但导入过程失败，并显示以下消息： `entity values are mixed`. [GitHub-32905](https://github.com/magento/magento2/issues/32905)

<!-- ACP2E-1754 -->

* 使用同一产品导入URL密钥时，不再覆盖或删除现有的默认存储视图密钥。 现在，仅当没有覆盖时，才会为存储视图重新生成URL重写 `url_key` 值。 以前，使用相同的URL键导入URL会重写现有的默认存储视图URL键。 (    `key_store` URL重写已删除，但在产品的默认存储视图级别上，URL重写仍设置为 `key_store`.)

<!-- ACP2E-1875 -->

* 在导入期间，产品计数不再意外更改。 现在，缓存刷新将推迟到导入过程之后。

<!-- ACP2E-1813 -->

* 计划导入操作的状态现在准确地表示导入操作是成功还是失败。 以前，所有操作都记录为成功。

<!-- AC-7039 -->

* Magento Open Source现在会考虑 **[!UICONTROL Disable Automatic Group Change Based on VAT ID]** 在导入客户记录期间设置。 以前， `disable_auto_group_change` 已忽略导入文件中的值。 [GitHub-36409](https://github.com/magento/magento2/issues/36409)

<!-- AC-965 -->

* `Magento\Framework\Convert\Excel` 现在可成功处理前面带有空格的数字。 Excel XML现在将字段编码为 `String`. 以前，Excel编写器将这些值编码为 `number`，从而导致文件无效。 [GitHub-33422](https://github.com/magento/magento2/issues/33422)

<!-- ACP2E-1641 -->

* 商家现在可以指定显示导入数据的区域设置以及数据验证器应如何解析此数据。 如果未指定区域设置值，则Magento Open Source将使用默认配置区域设置（而不是默认的存储视图）来解析数据。 在管理中，导入和导出过程继续使用管理用户界面区域设置，分别导入、解析和设置数据格式。

<!-- ACP2E-1847 -->

* 使用导入产品 `country_of_manufacture` 由语言环境设置与导入产品的管理员用户不同的管理员用户创建的属性不再引发验证错误。 以前，此导入操作可能会导致 `country_of_manufacture` 属性。

<!-- ACP2E-1994 -->

* 现在，导出的产品具有正确的属性 `manage_stock` 值当 `use_config_manage_stock` 值等于 `1`. 以前，此默认值不正确。

<!-- ACP2E-1620 -->

* 如果在计划的导入操作期间未成功导入图像，Magento Open Source现在会在计划的导入网格中显示信息性错误消息。 以前，不显示错误消息。

<!-- ACP2E-1565 -->

* 当缺少产品映像时，产品导入过程不再中断。 以前，在使用CSV文件导入第三方服务期间缺少产品图像时，Magento Open Source显示以下错误： `Maximum error count has been reached or a system error is occurred!`.

<!-- ACP2E-1391 -->

* 当中的属性值为时，产品导入过程不再引发验证错误 `configurable_variations` 列中包含逗号。

<!-- ACP2E-1377 -->

* 已从导出过程中排除解码。 导入后，CSV导出文件文本保持不变。 因此，重新导入后，描述不会更改。 以前，在导出和导入产品后，页面生成器编辑器中会删除HTML标记。

<!-- ACP2E-1451 -->

* 作为环境变量添加的非默认配置（网站或存储范围）不再中断 `app:config:import` 包含递归错误的进程。

<!-- ACP2E-1569 -->

* 导入后，处于保存时更新模式的目录搜索和价格索引符将不再失效。 以前，在导入新产品和现有产品时，Elasticsearch索引器文档版本会更改版本。

<!-- ACP2E-1482 -->

* 产品报告现已导出到 `var` 目录。  以前，这些报告导出到文档根目录，在云实例中为只读目录。

<!-- ACP2E-1736 -->

* 清空的多选客户地址字段不再中断或停止导出过程。

### 索引

<!-- AC-9223 -->

* 现在，所有索引器都使用相同的颜色来表示索引器状态。 [GitHub-34648](https://github.com/magento/magento2/issues/34648)

<!-- ACP2E-1697 -->

* 在未将规则分配给所有网站的部署中，目录规则产品索引器的性能已得到改进。

<!-- ACP2E-1401 -->

* 在索引器设置为时创建自定义产品类型 **[!UICONTROL Update on schedule]** 不再导致索引更新 `cron` 任务失败。 [GitHub-36471](https://github.com/magento/magento2/issues/36471)

<!-- AC-6816 -->

* `bin/magento indexer:reindex customer_grid` 当客户网格包含新创建的自定义客户属性时，不再因MySQL错误而失败。 [GitHub-36233](https://github.com/magento/magento2/issues/36233)

<!-- AC-8076 -->

* 更改多个索引器的索引器模式（即质量操作索引器模式更改）现在仅在当前模式与正在应用的模式不同时更改索引器的模式。 这通过防止不必要地访问数据库而提高了性能。 [GitHub-36823](https://github.com/magento/magento2/issues/36823)

<!-- AC-6934 -->

* 改进了使用许多属性选项索引产品。 [GitHub-36386](https://github.com/magento/magento2/issues/36386)

### 基础架构

<!-- AC-9390 -->

* 已替换MySQL `CREATE TEMPORARY TABLE ... LIKE` 已重构 `CREATE TEMPORARY TABLE` 以符合MySQL 8.x。 [GitHub-37926](https://github.com/magento/magento2/issues/37926)

<!-- ACP2E-1462 -->

* 当格式错误的HTTP请求发送到服务器时，Magento Open Source显示的错误消息中不再包含指向服务器根目录的完整路径。 现在，只有字符串才会传递到 `explode` 方法作为第二个参数。

<!-- AC-8384 -->

* `restricted_classes.php` 已替换 `Zend_Validate_File_Upload`. 以前，在上传导入文件的过程中，验证器崩溃，该文件的值大于中配置的值 `php.ini `. [GitHub-37281](https://github.com/magento/magento2/issues/37281)

<!-- AC-7093 -->

* 电子邮件模板引擎现在可以正确处理某些嵌套指令(例如， `{{if}}{{depend}}...{{/depend}}{{/if}}`)。 [GitHub-36438](https://github.com/magento/magento2/issues/36438)

<!-- AC-7920 -->

* `product` 现在，具有聚合数据的查询会返回布尔类型产品属性的正确标签值。 [GitHub-29123](https://github.com/magento/magento2/issues/29123)

<!-- AC-2618 -->

* 已将乌克兰区域添加到 `directory_country_region` 表格。 [GitHub-35187](https://github.com/magento/magento2/issues/35187)

<!-- https://github.com/magento/magento2/pull/29173 -->

* 合并时，CSS文件不再损坏 `var/tmp` 和 `pub/static` 位于不同的文件系统上，并且 **[!UICONTROL CSS Merging Enabled]** 已启用。 临时文件是在与目标文件相同的静态目录中创建的，以确保两个文件位于同一文件系统上。 因此，对其重命名的调用是原子调用。 [GitHub-29172](https://github.com/magento/magento2/issues/29172)

<!-- https://github.com/magento/magento2/pull/36769 -->

* 调用成员函数 `getId()` 不再触发异常。

<!-- https://github.com/magento/magento2/pull/34092 -->

* 现在在设计主题配置处理器中对阵列类型强制进行类型检查。  [GitHub-34440](https://github.com/magento/magento2/issues/34440)

### 记录

<!-- ACP2E-1385 -->

* 管理员用户现在可以在管理员的批量操作日志部分中查看由集成创建的批量操作的日志。

### 登录

<!-- ACP2E-1521 -->

* 在一个浏览器中重置密码并随后通过其他浏览器登录不会再导致异常。 [GitHub-36447](https://github.com/magento/magento2/issues/36447)

<!-- ACP2E-1332 -->

* 现在，在按预期激活帐户后，客户会被重定向到登录页面。 以前，客户会自动登录。

### 订购

<!-- ACP2E-1341 -->

* 现在，模拟将在以下期间启动： `send()` 在以下期间完成模拟后调用： `getInfoBlockHtml()` 调用，且不会记录任何错误。 以前， `system.log` 文件被此错误淹没： `main.ERROR: Environment emulation nesting is not allowed`. [GitHub-35603](https://github.com/magento/magento2/issues/35603)

<!-- ACP2E-1918 -->

* 商家现在可以为包含某些项目的订单生成贷项通知单，当其他订单项目可以退款时，这些订单的总数为零。 以前，当客户对订单中的某些项目享有100%折扣时，商家无法执行多次退款。

<!-- AC-8254 -->

* 在管理员对子产品进行重新排序期间，子产品与父产品之间的链接现在显示在订单页面上。 [GitHub-37028](https://github.com/magento/magento2/issues/37028)

<!-- AC-1756 -->

* 订单页的题头部分现在包含有关已发送发票、贷项通知单和发运的预期信息。 [GitHub-27474](https://github.com/magento/magento2/issues/27474)

<!-- AC-7632 -->

* 现在可以正确生成只包含一个可配置产品的订单的贷项通知单。 以前， `isLast()` 函数未返回 `true` 如预期。 [GitHub-36722](https://github.com/magento/magento2/issues/36722)

<!-- ACP2E-1714 -->

* 现在，当对包含捆绑产品的订单进行了部分退款时，订单状态是正确的。 以前，在发出部分退款后，即使剩余的订单尚未完成，订单状态仍被列为完成。 [GitHub-37377](https://github.com/magento/magento2/issues/37377)

<!-- ACP2E-1514 -->

* 首次从管理员使用一次性自定义价格生成订单时，购物者无法再使用自定义价格订购产品。 以前，如果订单包含具有自定义价格的项目，则此自定义价格适用于通过再订购功能下达的其他订单。

<!-- ACP2E-1421 -->

* 购物者不能再在订单页面上保存不正确的订单状态。 发运项目时，订单状态不再从“完成”更改为“处理”。 以前，Magento Open Source在购物者输入评论后保存订单状态之前不会检查当前订单状态。 [GitHub-36562](https://github.com/magento/magento2/issues/36562)

<!-- ACP2E-1367 -->

* 销售订单网格现在会按预期与所有订单异步同步。 [GitHub-36562](https://github.com/magento/magento2/issues/36562)

<!-- ACP2E-1197 -->

* 现在，订单页面的客户订单部分中的按购买日期过滤功能可按预期工作。 以前，当向方法提供相同时区时，时区转换逻辑引发错误，从而导致JavaScript错误。

<!-- ACP2E-1294 -->

* 现在，管理员仪表板在首次加载时显示正确的订单统计数据。 以前，仪表板显示不正确的订单信息，但一旦更新了时间段，则会显示正确的信息。

<!-- ACP2E-1762 -->

* 现在，管理员用户在从管理员创建新订单期间选择商店视图后，会按预期重定向到订单页面。

<!-- ACP2E-1418 -->

* 此 `GET V1/orders/<OrderID>` 现在，端点按顺序返回有关可配置和简单产品的信息，而不管简单产品的库存状态如何。 仅当所选项目（产品）有库存或可供销售时，管理员用户现在才可以下订单。 以前，此API仅返回有关已有产品的信息。

<!-- AC-7901 -->

* 在启用了免运费且发运价格含税且计税是在折扣后应用时，贷项通知单页面不再崩溃。 以前，Magento Open Source抛出 `Division by zero` 例外。 [GitHub-36800](https://github.com/magento/magento2/issues/36800)

<!-- AC-1342 -->

* 使用 `rest/V1/orders/{id}/comments` 端点在不提供订单状态的情况下发布有关订单的注释不再影响订单的显示。 以前，订单状态在报表中记录为NULL。 `sales_order` 和 `sales_order_grid` 表，并且“我的订单”页或“管理员订单”网格均不显示订单。 [GitHub-34180](https://github.com/magento/magento2/issues/34180)

### 页面生成器

<!-- AC-9128 -->

* 在Chrome浏览器中，页面生成器保存操作的性能已得到改进。

<!-- ACP2E-1564 -->

* 从页面生成器轮播向购物车添加产品时，不再重复页面中的项目数量，因为页面中有两个不同的小组件显示相同的产品。

<!-- ACP2E-1542 -->

* Page Builder不再添加 `tabindex` 超链接标记的HTML属性 `a` 编辑超链接时，请保存模板。

<!-- ACP2E-1444 -->

* 产品小部件和页面生成器预览现在可正确处理HTML特殊字符。 以前，产品小组件无法正确显示包含 `&` 字符。

<!-- ACP2E-1441 -->

* 现在，当您在预览模式下选择并更新完整内容块时，Page Builder文本元素内容会按预期更新。

<!-- ACP2E-1362 -->

* 现在，可以将文本从一个页面生成器文本编辑器复制并粘贴到另一个页面生成器文本编辑器，操作方式符合预期。 以前，您尝试粘贴文本的页面无法保存，并且Magento Open Source显示此控制台错误： `[ERROR] Page Builder was rendering for 5 seconds without releasing locks.`.

<!-- ACP2E-1568 -->

* 页面生成器 `column-block` 在旧版Page Builder中创建的内容类型现在可以正确显示。

<!-- ACP2E-1234 -->

* 在从管理员创建产品期间，对产品元数据说明的过滤功能已得到改进。 以前，如果启用了Page Builder，则会根据默认设置生成产品元数据描述` {{name}} {{description}}` 面具。 默认的产品元描述蒙版现在由以下内容组成 `{{name}}`. [GitHub-36107](https://github.com/magento/magento2/issues/36107)

<!-- ACP2E-1758 -->

* 添加不含内容的动态块不再触发错误。

<!-- AC-6645 -->

* 解决了在页面生成器内容中显示列时出现的问题。 以前， `column-line` 内容类型内容未呈现。 [GitHub-3949](https://github.com/magento/pwa-studio/issues/3949)

### 付款

<!-- AC-9142 -->

* PayPal Express结账交易现在包括子产品SKU和完整产品标题。 此 `Magento/Paypal/Model/Cart.php` 文件现在会收集具有父产品标题的子产品SKU，以使用子SKU标识产品标题。 [GitHub-36808](https://github.com/magento/magento2/issues/36808)

<!-- ACP2E-1964 -->

* 此 **卡安全代码不匹配** 现在可在Payflow Pro付款过程中按预期处理配置。 以前，此评估过程从未完成，这会阻止签出。

<!-- ACP2E-1215 -->

* 当购物者没有保管库令牌时，管理签出工作流中不再显示保管库付款方法选项。 [GitHub-36273](https://github.com/magento/magento2/issues/36273)

<!-- ACP2E-1303 -->

* 此 **[!UICONTROL Venmo]** 启用PayPal按钮后，按钮现在可以隐藏。 以前， **[!UICONTROL Venmo]** 无法从购物车、迷你购物车、产品详细信息或结帐页面中删除按钮。

<!-- AC-7105 -->

* 成功完成Paypal Payflow链接支付后，购物者现在会被重定向到成功页面。 [GitHub-36520](https://github.com/magento/magento2/issues/36520)

#### Braintree

<!-- BUNDLE-3273 -->

* 解决了在本地支付启用时，Ideal payments支付的订单的后备URL问题。

<!-- AC-2901 -->

* 现在，每家商店都保存了Braintree付款信息，购物者现在只能看到他们购物时所在的商店中保存的卡信息。 以前，购物者在结账时可以看到所有商店中存储的卡片信息。 [GitHub-34253](https://github.com/magento/magento2/issues/34253)

<!-- BUNDLE-3304 -->

* 现在，当卡付款的保管库被禁用时，购物者可以使用Braintree付款方式将订单签出到多个地址。 [GitHub-37615](https://github.com/magento/magento2/issues/37615)

<!-- BUNDLE-3253 -->

* 购物者再也无法在不添加姓氏的情况下创建PayPal订单。

<!-- ACP2E-1229 -->

* 当购物者更新其帐单地址时，不再在结账工作流中自动取消选择“Braintree保管库付款方式”选项。 以前，当购物者取消选择 **[!UICONTROL My billing and shipping address are the same]** 按钮。

<!-- BUNDLE-3248 -->

* 解决了从Adobe Commerce 2.4.5-p2升级后通过Braintree签出PayPal时出现的问题。 [GitHub-37242](https://github.com/magento/magento2/issues/37242)

<!-- BUNDLE-3257 -->

* 现在，Google支付模式弹出运送地址字段中的地址可按预期呈现电话号码。 以前，电话号码缺失。

<!-- BUNDLE-3228 -->

* 现在，当Braintree响应包含的空值时，订单成功地Braintree `threeDSecureInfo/eciFlag`. 以前，当此值为空时，在签出期间发生PHP错误。

<!-- BUNDLE-3243 -->

* 当购物者在迷你购物车中使用Google Pay结帐时在订单审核页面上应用优惠券时，Magento Open Source不再引发错误。 以前，购物者被重定向到404页。

<!-- BUNDLE-3245 -->

* 购物者现在可以使用Braintree支付和Magento Open Source2.4.6（具有不可见的ReCAPTCHA v2或v3）完成结账。 [GitHub-37241](https://github.com/magento/magento2/issues/37241)

<!-- BUNDLE-3241 -->

* 购物者不能再点击 **[!UICONTROL PayPal]** 按钮购买可配置产品，而无需先选择所需的选项。 以前，购物者可以点击 **[!UICONTROL PayPal]** 按钮，随后重定向回产品页面，并出现错误：

<!-- BUNDLE-3148 -->

* 此 **[!UICONTROL PayPal]** 按钮现在按预期显示在购物车和迷你购物车页面上。 以前，此按钮不显示在购物车页面上，并且会在迷你购物车页面上重复。

<!-- BUNDLE-3244 -->

* 现在，在部署中，商家在其Braintree帐户中为同一货币拥有两个不同的商家帐户ID，则可以在正确的帐户中按预期捕获部分开票的订单。

<!-- BUNDLE-3250 -->

* 在以下情况下，为由Braintree支付的订单创建第二张部分发票时，Magento Open Source不再引发错误 **[!UICONTROL Enable Vault for Card Payments]** 已启用。 以前，当商家尝试创建第二张发票时，Magento Open Source引发此错误： `Your payment could not be taken. Please try again or use a different payment method. Payment method token is invalid`.

<!-- AC-2901 -->

* 现在，每家商店都保存了Braintree付款信息，购物者现在只能看到他们购物时所在的商店中保存的卡信息。 以前，购物者在结账时可以看到所有商店中存储的卡片信息。 [GitHub-34253](https://github.com/magento/magento2/issues/34253)

### 性能

<!-- ACP2E-2098 -->

* 性能 `addProductToCart` 改进了使用多个自定义产品属性执行时的突变。 以前，当使用许多产品属性（大约1000）执行此突变时，Magento Open Source尝试加载所有产品属性。

<!-- ACP2E-1965 -->

* 解决了加载购物车规则使用的产品属性时的性能问题。 现在只加载活动购物车规则的产品属性。

<!-- ACP2E-1864 -->

* 此 `bin/magento setup:perf:generate-fixtures setup/performance-toolkit/profiles/ee/small.xml` 现在，多次运行命令时可成功执行命令。 以前，它在运行多次时引发此错误： `Coupon with the same code already exists`.

### 促销活动

<!-- ACP2E-1290 -->

* 的影响 **[!UICONTROL Fixed amount discount for whole cart]** 价格规则，当与 **[!UICONTROL Apply to shipping amount]** 规则，现在按预期在产品和运费之间按比例分配。 以前，折扣计算不正确。

<!-- ACP2E-1300 -->

* 此 **[!UICONTROL Discard Subsequent Rules]** 设置现在可按预期应用。 启用此设置后，其他低优先级的规则只能应用于其他产品。 [GitHub-35707](https://github.com/magento/magento2/issues/35707)

### 报表

<!-- ACP2E-1541 -->

* 订单报表(**[!UICONTROL REPORTS]** > **[!UICONTROL Sales]** > **[!UICONTROL Orders]**)现在，当使用非默认货币的商店生成订单时，包含正确的订单值。 以前，此报表包含不正确的值。 [GitHub-36742](https://github.com/magento/magento2/issues/36742)

<!-- ACP2E-1477 -->

* 为了清楚起见，修订了销售订单报告表中的误导性信息。

<!-- ACP2E-1435 -->

* 管理员用户现在可以搜索电子邮件中包含的记录  `+` （加）弃用购物车报表页面中的符号。 [GitHub-36560](https://github.com/magento/magento2/issues/36560)

### Search {#search-heading}

<!-- ACP2E-1870 -->

* 现在，在高级搜索中一起应用高级搜索价格和SKU筛选器时，这两个筛选器可以正确工作。 [GitHub-37581](https://github.com/magento/magento2/issues/37581)

<!-- ACP2E-1787 -->

* 不再对空搜索字段执行搜索。 这样可以缩小 `search_query` 表格。 以前，不正确的查询或查询空搜索字段会返回巨大的数据集，这会增加 `search_query` 表并导致了以下问题 `/tmp`.

<!-- ACP2E-1916 -->

* 现在，在对具有下拉自定义属性的目录条目进行排序时，店面过滤器可按预期工作。

<!-- ACP2E-1499 -->

* 搜索结果现在会按预期显示基于属性搜索权重的相关结果。

<!-- AC-7505 -->

* 下的信息性文本 `Search Weight` 属性的 `Storefront Properties` 管理员输入字段 **[!UICONTROL Stores]** > **[!UICONTROL Attributes]** > **[!UICONTROL Product]** 现在描述可能的值。 [GitHub-36646](https://github.com/magento/magento2/issues/36675)

### 配送

<!-- ACP2E-2044 -->

* 此 `cart` 现在，查询将离散发运折扣作为具有唯一折扣标签的单独发运折扣返回。 新 `applied_to` 折扣属性支持对购物车项目应用折扣之间的差异。 以前，所有运费折扣都合并为一个硬编码 **[!UICONTROL Shipping Discount]** 值。

<!-- ACP2E-1826 -->

* 当管理员用户创建重新订购时，当管理员用户单击 **[!UICONTROL Reorder]** 按钮（管理员） **[!UICONTROL Sales]** > **[!UICONTROL Orders]** > **[!UICONTROL View]** )。 如果购物者的通讯簿中保存了相同的地址，则重新排序将始终包含这些地址的更新版本。 以前，送货地址字段预填充了更新的数据，但帐单地址字段则未预填充。

<!-- AC-7003 -->

* 此 **[!UICONTROL Shipping Policy]** 在以下情况下，文本框现在显示在管理员商店视图范围内  **[!UICONTROL Apply custom Shipping Policy]** 已启用并且自定义配送策略可用。 [GitHub-36425](https://github.com/magento/magento2/issues/36425)

<!-- AC-7550 -->

* 此 `cart` 查询现在返回 `selected_shipping_method` 与以下值之一匹配的值： `available_shipping_methods` 载波和方法代码。 以前，当其中一个选定的配送方式包含下划线时，这些承运人/方式代码不匹配。 [GitHub-36606](https://github.com/magento/magento2/issues/36606)

<!-- AC-2556 -->

* 此 `setShippingAddressesOnCart` 当street数组中的第二个值为null时，突变不再引发错误。 以前，会引发以下异常： `The address failed to save. Verify the address and try again`. [GitHub-35160](https://github.com/magento/magento2/issues/35160)

### 税金

<!-- ACP2E-1527 -->

* 您现在可以按预期在“税则”编辑页中编辑税率国家（地区）的值。 以前，不会保存从该页面所做的编辑。

<!-- ACP2E-1143 -->

* 现在，在更新配送方式时，购物车估算区域中的税额会按预期刷新。 以前，购物者在结帐期间更改国家/地区后，不会更新税率。

<!-- AC-8227 -->

* 此 `tax class` 现在，在商店视图范围内为现有可配置产品创建新变体时，新创建的简单产品的值设置为父产品的值。 以前，此值设置为none。 因此，这些产品在购物车中没有添加任何税款，而且客户缺税。 [GitHub-37180](https://github.com/magento/magento2/issues/37180)

### 测试

<!-- ACP2E-2202 -->

* 已重构 `Magento\GraphQl\Catalog\ProductSearchTest::testFilterProductsBySingleCategoryId` 在中处理随机类别顺序的测试 `products` 查询响应。

<!-- AC-6842 -->

* `\Magento\Test\Integrity\Di\CompilerTest::testConstructorIntegrity` test现在验证由注册的模块中的所有PHP类 `ComponentRegistrar()`.

<!-- AC-7098 -->

* 中的大型阵列存在性能问题 `TableNameSniff` 已解决。

<!-- ACP2E-1748 -->

* `CollectionTest::testGetDateRangeFirstPart()` 现在计入夏令时。

### UI

<!-- AC-8823 -->

* 现在，密码在出现以下情况时按预期显示 **[!UICONTROL Show Password]** 登录页面上的复选框处于活动状态。 这是2.4.7-beta1的一个已知问题。

<!-- ACP2E-2034 -->
Magento Open Source现在为具有特殊价格的固定捆绑产品显示正确的价格。 这是2.4.7-beta1的一个已知问题。

<!-- AC-8285 -->

* 更新了店面页脚模板文件中指向GitHub问题列表页面的链接。 [GitHub-37214](https://github.com/magento/magento2/issues/37214)

<!-- AC-6282 -->

* “最近查看的项目”小组件现在显示按产品价格分组的正确税额。 [GitHub-35881](https://github.com/magento/magento2/issues/35881)

<!-- AC-6636 -->

* 管理员用户现在可以按预期拖放为简单产品创建的可自定义选项。 [GitHub-36051](https://github.com/magento/magento2/issues/36051)

<!-- AC-8345 -->

* 现在，产品下拉列表属性类型的顺序与可配置产品页面上的图像顺序匹配。 [GitHub-37285](https://github.com/magento/magento2/issues/37285)

<!-- ACP2E-1969 -->

* 系统消息现在加载得更快。 只加载正在显示的消息。 以前，从数据库加载所有消息非常耗时。

<!-- ACP2E-1804 -->

* 通过设置删除痕迹导航节点 `remove=true` 通过布局XML不再导致删除类别页面上的页面标题。 以前，通过这种方式删除痕迹导航会从类别页面中删除页面标题。

<!-- ACP2E-171 -->

* 现在，当客户注册表单包含多选客户属性时，该表单会按预期加载。 以前，Magento Open Source引发此异常： `[2023-03-05T05:57:40.032602+00:00] report.CRITICAL: Exception: Deprecated Functionality: explode(): Passing null to parameter #2 ($string) of type string is deprecated in /magento2ee/app/code/Magento/CustomAttributeManagement/Block/Form/Renderer/Multiselect.php on line 53 in /lib/internal/Magento/Framework/App/ErrorHandler.php:62`. [GitHub-37189](https://github.com/magento/magento2/issues/37189)

<!-- ACP2E-1602 -->

* 现在，包含单引号的欢迎消息在店面中正确呈现，并且没有控制台错误。 以前，如果欢迎消息包含单引号，则在店面呈现期间不会加载欢迎消息。 Magento Open Source还会显示控制台错误。

<!-- ACP2E-1369 -->

* 当您尝试在“管理顺序”页面中的评论历史记录和返回之间快速更改视图时，Magento Open Source不再引发错误。 以前，Magento Open Source显示此一般错误： `A technical problem with the server created an error`.

<!-- ACP2E-1374 -->

* 如果管理员用户拥有的权限仅限于一个网站，则他们现在可以将特定于网站的产品属性集更新为 `all stores view` 范围。

<!-- ACP2E-1648 -->

* 现在，放大镜小组件会按预期在产品页面上加载。

<!-- ACP2E-1216 -->

* 多行可自定义选项现在可以在发票、发运和贷项通知单PDF文档中正确呈现。 以前，多行文本前面会出现意外的分页符，如果文本超出页面，则文本会被截断。

<!-- AC-7402 -->

* 现在，在为商店ID与网站ID不匹配的其他网站创建客户时，管理员用户可以从管理员中添加新的客户地址。 以前，Magento Open Source显示此弹出消息： `Something went wrong`. [GitHub-36582](https://github.com/magento/magento2/issues/36582)

<!-- ACP2E-1529 -->

* 现在，当“分配公司管理员”电子邮件中包含 `CMS Block URL` 变量。

<!-- ACP2E-1775 -->

* 与在订单详情页面上提交评论相关的错误消息，现在可提供更多信息。 以前，当购物者单击 **[!UICONTROL Submit comment]** 在不更改订单状态或向注释区域输入文本的情况下，Magento Open Source会显示以下消息： `The comment is missing. Enter and try again`.

<!-- ACP2E-1659 -->

* 现在，日历图标按预期显示在管理员的日期范围字段中 **[!UICONTROL Marketing]** > **[!UICONTROL Cart Price Rules]** 为一个字段选择日期后。 以前，为一个字段选择日期后，日历图标不再显示在其他字段中，并且Magento Open Source显示占位符文本。 [GitHub-36499](https://github.com/magento/magento2/issues/36499)

<!-- ACP2E-1717 -->

* 现在已成功加载包含多选字段的客户注册表单。 以前，此表单包含多选字段时未加载，并触发了以下错误：  `report.CRITICAL: Exception: Deprecated Functionality: explode(): Passing null to parameter #2 ($string) of type string is deprecated in /magento2ee/app/code/Magento/CustomAttributeManagement/Block/Form/Renderer/Multiselect.php on line 53 in /lib/internal/Magento/Framework/App/ErrorHandler.php:62`. [GitHub-37189](https://github.com/magento/magento2/issues/37189)

<!-- AC-7092 -->

* 在产品库全屏模式下单击视频缩略图时，现在会按预期显示视频。 以前，不显示视频，并且浏览器控制台显示JavaScript错误。 [GitHub-36456](https://github.com/magento/magento2/issues/36456)

<!-- AC-7806 -->

* 在版权行中添加了一个变量，该变量每年自动更新。 [GitHub-36776](https://github.com/magento/magento2/issues/36776)

<!-- AC-8441 -->

* 现在，产品页面上的图像滑块在移动设备视图中可按预期工作。 以前，仅成功显示第一个图像。 [GitHub-37232](https://github.com/magento/magento2/issues/37232)

### URL重写

<!-- AC-6728 -->

* 将产品添加到类别后，现在可按预期生成所有商店视图的类别产品URL重写。 [GitHub-32910](https://github.com/magento/magento2/issues/32910)

<!-- ACP2E-1783 -->

* 当您尝试在以下情况下为产品URL创建301/302重定向时，Magento Open Source不再引发错误 **生成类别/产品URL重写** 已启用。 创建产品并将其分配给类别后，将创建自动化URL重写：一个针对直接URL，一个针对通过类别路径的产品。 创建新产品URL重写时，将检查产品、类别和商店之间的关联。 现在，此检查基于关联的实体属性（类别和产品）。 以前，此检查是在预先存在的URL重写时执行的。

<!-- ACP2E-1737 -->

* 现在，当从CSV文件导入新类别时，将为所有存储视图生成类别URL重写。

<!-- ACP2E-1700 -->

* 产品URL后缀和类别URL后缀配置现在与 `url_rewrite` 表格。 以前，更新URL后缀配置时出现争用情况，并且配置的URL后缀和 `url_rewrite` 表不匹配。

<!-- ACP2E-1703 -->

* 现在，在创建类别URL重写时，Magento Open Source会在所有级别呈现类别树。 以前，仅显示前三个级别的类别。 [GitHub-36973](https://github.com/magento/magento2/issues/36973)

<!-- ACP2E-1737 -->

* 在导入新类别期间，CSV文件中现在存在类别URL重写。

<!-- ACP2E-1668 -->

* 现在，无URL重写的多存储CMS页面按预期转发。 以前，请求的多存储CMS页面若没有URL重写，则会被重定向到存储主页，但原始CMS页面不会被定向。

### Web API框架

<!-- ACP2E-2053 -->

* 现在，用于更新具有层价格和不同属性集的产品的异步批量REST API操作已成功完成。 以前，无法以这种方式更新具有不同属性集的产品，并且Magento Open Source会显示此错误： `The product was unable to be saved. Please try again`.

<!-- AC-7002 -->

* 此 `POST /V1/products/tier-prices` 现在，如果在层价格创建过程中使用了无效的客户组名称，则端点会返回一条信息更丰富的错误消息。 以前，Magento Open Source返回如下错误： `Notice: Undefined index: XXXXX in ~/public_html/vendor/magento/module-catalog/Model/Product/Price/Validation/TierPriceValidator.php on line 474"`. [GitHub-36431](https://github.com/magento/magento2/issues/36431)

<!-- ACP2E-1776 -->

* 您现在可以执行授权的异步批量API请求，以创建具有非默认组ID的客户。 以前，这些请求会将组ID重置为默认值。

<!-- ACP2E-1543 -->

* 现在，使用批量API创建的客户将收到在其分配的网站中配置的语言版本的客户注册电子邮件。  以前，所有电子邮件都会发送到默认区域设置，而不是客户所分配到网站的区域设置。

<!-- ACP2E-1339 AC-7577-->

* 此 `POST V1/guest-carts` 在以下情况下，呼叫不再提交访客订单： **[!UICONTROL Allow Guest Checkout]** 已禁用。

<!-- ACP2E-1526 -->

* Magento Open Source现在已成功返回 `content` 中的属性（base64图像代码） `GET V1/products/sku/media` 产品媒体API响应。 此 `content` 属性之前未显示在响应中。

## 已知问题

以下已知问题将在Magento Open Source2.4.7-beta3中修复：


## 系统要求

我们的技术栈栈是基于PHP和MySQL构建的。 有关更多信息，请参阅 [系统要求](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/system-requirements.html).

## 安装和升级说明

您可以使用安装Magento Open Source2.4.7-beta2 [Composer](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/composer.html).
