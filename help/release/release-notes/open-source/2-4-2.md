---
title: Magento Open Source2.4.2发行说明
description: 了解2.4.2版本中的新增功能、增强功能、错误修复和已知问题。Magento Open Source
source-git-commit: 4c3a5b6462668993dcfb0ecb9327a7ffc47ced44
workflow-type: tm+mt
source-wordcount: '13940'
ht-degree: 0%

---


# Magento Open Source2.4.2发行说明

Magento Open Source2.4.2引入了性能和安全性的增强功能，并显着改进了平台。 安全性增强包括扩展对 `SameSite` 属性。 Elasticsearch7.9.x和Redis 6.x现在受支持。

此版本包括280多项核心代码的新修复和35项安全增强功能。 它包括由我们的社区成员解决的近290个GitHub问题。 这些社区贡献的内容包括对核心代码进行细微清理，以及在GraphQL中进行重大增强。

2.4.1中识别的所有已知问题已在此版本中修复。

{{bics}}

## 应用 `AC-3022.patch` 继续提供DHL作为航运公司

DHL已引入模式版本6.2，并将在不久的将来弃用模式版本6.0。 Adobe Commerce 2.4.4及更早版本（支持DHL集成）仅支持版本6.0。部署这些版本的商户应适用 `AC-3022.patch` 尽早将DHL作为航运公司继续提供。 请参阅 [应用补丁程序以继续提供DHL作为运输承运人](https://support.magento.com/hc/en-us/articles/7707818131597-Apply-a-patch-to-continue-offering-DHL-as-shipping-carrier) 有关下载和安装修补程序的信息，知识库文章。

## 安全修补程序可用

商家现在无需应用完整季度版本（例如2.4.1-p1）提供的数百项功能修复和增强功能，即可安装对时间敏感的安全修复。 修补程序2.4.0.12（编辑器包2.4.1-p1）是一个安全修补程序，它为我们上一个季度版本2.4.1中已识别的漏洞提供了修补程序。应用于2.4.1版本的所有修补程序都包含在此安全修补程序中。 (A) *热修复* 对解决特定问题或错误的已发布版本进行了修复。)

有关安全修补程序的一般信息，请参阅 [引入新的安全修补程序版本](https://community.magento.com/t5/Magento-DevBlog/Introducing-the-New-Security-Patch-Release/ba-p/141287). 有关下载和应用安全修补程序（包括修补程序2.4.1-p1）的说明，请参阅 [快速启动本地安装](../../../installation/composer.md). 安全修补程序仅包含安全错误修复，而不包含完整修补程序中包含的其他安全增强功能。

## 其他发行信息

尽管这些功能的代码与季度发行版捆绑在一起，但其中一些项目(例如，Progressive Web Application(PWA)Studio)也是独立发布的。 这些项目的错误修复会在特定于项目的单独发行信息中进行记录，该信息可在每个项目的文档中找到。

## 亮点

在此版本中查找以下亮点。

### 大量安全性增强

此版本包括35多项安全修复和平台安全改进。 所有安全修复都已支持到2.4.1-p1和2.3.6-p1。

#### 超过35项安全增强功能，可帮助关闭远程代码执行(RCE)和跨站点脚本(XSS)漏洞

迄今为止，尚未发生与这些问题相关的已确认攻击。 但是，某些漏洞可能会被利用来访问客户信息或接管管理员会话。 大多数这些问题要求攻击者首先获得对管理员的访问权限。 因此，我们提醒您采取一切必要步骤保护您的管理员，包括但不限于以下工作：IP， [双重身份验证](https://devdocs.magento.com/guides/v2.4/security/two-factor-authentication.html)，使用VPN，使用唯一位置，而不是 `/admin`，密码卫生良好。 请参阅 [Adobe安全公告](https://helpx.adobe.com/security/products/magento/apsb21-08.html) 以讨论这些修复的问题。

#### 其他安全增强功能

此版本的安全改进包括：

* 所有核心Cookie现在都支持 `SameSite` 属性。

* 现在，当用户尝试在产品和类别描述字段中保存值时，应用程序会在这些字段中显示标识潜在恶意内容的消息。

* 跨组件的文件系统操作已经过标准化和强化，以防止恶意上载。

* 已修复核心内容安全策略(CSP)违规问题。

{{cve-notice}}

### 基础架构改进

此版本包含对核心质量的增强，这改进了框架的质量以及这些功能领域：客户帐户、目录、CMS、OMS、导入/导出、促销和定位，以及购物车和结账。

### 平台增强功能

* [**Elasticsearch7.9.x现在受支持**](../../../installation/system-requirements.md). 尽管我们建议运行Elasticsearch7.9.x，但版本2.4.x仍与Elasticsearch7.4.x兼容。 <!-- MC-36867-->

* 2.4.2已通过 [清漆6.4](../../../installation/system-requirements.md). 版本2.4.x仍与清漆6.x兼容。

* [**现在支持Redis 6.x**](../../../installation/system-requirements.md). 版本2.4.x仍与Redis 5.x兼容。 <!-- MC-34853-->

* 2.4.2现在与 **编辑器2.x**. 我们建议商户迁移到编辑器2.x。尽管您可以使用编辑器1.x安装此版本，但编辑器1.x的生命周期不久将终止。 有关编辑器2.x功能的概述，请参阅 [编辑器2.0现已可用！](https://blog.packagist.com/composer-2-0-is-now-available/)

此版本中已弃用将安装配置为使用拆分数据库的功能。 当前使用拆分数据库的商家应开始计划还原到单个数据库或迁移到单个数据库，或使用替代方法。 请参阅 [弃用Magento Open Source中的拆分数据库功能](https://community.magento.com/t5/Magento-DevBlog/Deprecation-of-Split-Database-in-Magento-Commerce/ba-p/465187) 有关此问题的概述，请参阅DevBlog文章。  请参阅 [从拆分数据库还原到单个数据库](../../../configuration/storage/revert-split-database.md) ，以获取迁移说明。

### 性能增强

此版本包括代码增强功能，可为具有大型目录的部署提高API性能和管理员响应时间。 多项可扩展性增强功能使2.4.2能够在本机上支持复杂目录，这些目录的容量比以前版本高出20倍。

### Adobe Stock集成

此版本包括Adobe Stock集成v2.1.1。

### GraphQL

此版本为以下功能添加了GraphQL覆盖：

* 添加了 [比较列表](https://devdocs.magento.com/guides/v2.4/graphql/queries/compare-list.html). 购物者可以 [创建](https://devdocs.magento.com/guides/v2.4/graphql/mutations/create-compare-list.html) 和 [删除](https://devdocs.magento.com/guides/v2.4/graphql/mutations/delete-compare-list.html) 比较列表和 [添加](https://devdocs.magento.com/guides/v2.4/graphql/mutations/add-products-to-compare-list.html) 和 [删除](https://devdocs.magento.com/guides/v2.4/graphql/mutations/remove-products-from-compare-list.html) 项目。 此外，以来宾身份创建比较列表的购物者可以以客户身份登录， [保留](https://devdocs.magento.com/guides/v2.4/graphql/mutations/assign-compare-list-to-customer.html) 比较列表。

* 添加了 [`generateCustomerTokenAsAdmin`](https://devdocs.magento.com/guides/v2.4/graphql/mutations/generate-customer-token-as-admin.html) 变异和更新 `Customer` 用于支持远程购买帮助的对象。

* 增加了跨商店的本地化支持，以支持更改语言、购物车和货币等任务。 <!-- MC-37801-->

* 在GraphQL中添加了对联合的支持。 [GitHub-29425](https://github.com/magento/magento2/issues/29425) <!-- ENGCOM-8291 -->

* GraphQL模式已得到增强，可针对具有许多变体的可配置产品优化产品数据检索。 <!-- MC-36138-->

* 已弃用整数类型对象ID，支持 `uid` ID类型的属性。 <!-- MC-36346-->

* 添加了 `staging` 属性 [`ProductInterface`](https://devdocs.magento.com/guides/v2.4/graphql/interfaces/product-interface.html) 和 [`CategoryInterface`](https://devdocs.magento.com/guides/v2.4/graphql/interfaces/category-interface.html) 以确定产品是否已分阶段并查看其关联的促销活动信息。 <!-- MC-33897-->

请参阅 [GraphQL开发人员指南](https://devdocs.magento.com/guides/v2.4/graphql/) 以了解这些增强功能的详细信息。

### PWA Studio

此版本的PWA Studio包括：

* 国际化和本地化。 Venia现在支持多种语言和货币。

* 改进了扩展性框架，以支持通过扩展进行代码更改。

* “我的帐户”相关功能的初始组件，如愿望清单、保存的付款、通讯簿和订单历史记录。

* 各种性能优化和错误修复。

有关增强功能和错误修复的信息，请参阅 [PWA Studio版本](https://github.com/magento/pwa-studio/releases). 请参阅 [兼容性](https://developer.adobe.com/commerce/pwa-studio/integrations/adobe-commerce/version-compatibility/) 以获取PWA Studio版本及其兼容版本的列表。

### 媒体集

**媒体集的新角色资源**. 此版本为商家提供了仅限制管理员访问媒体集的功能，以及控制谁可以执行这些操作：

* 将媒体资产插入内容

* 上传资产

* 编辑资产详细信息

* 从媒体集中删除资产

* 管理文件夹结构。

**内容中的Web优化图像**. 商户现在可以使用 [Web优化的图像呈现](https://docs.magento.com/user-guide/cms/media-gallery-image-optimization.html) （而不是高分辨率图像）。 原始图像在媒体库中保持不变，并且当图像插入内容时，会动态生成图像呈现版本。

### 功能测试框架

MFTF 3.2.1现已可用。 此版本在测试和测试包生成中都引入了错误容差。 中介绍了其他增强功能和错误修复 [功能测试框架Changelog](https://github.com/magento/magento2-functional-testing-framework/blob/develop/CHANGELOG.md).

### 供应商开发的扩展

有关此版本的功能和更改的更新，请参阅以下文章：

* [Amazon Pay](https://docs.magento.com/user-guide/payment/amazon-pay.html)

* [Braintree](https://docs.magento.com/user-guide/payment/braintree.html)

* [dotdigital Engagement Cloud](https://docs.magento.com/user-guide/marketing/dotdigital/engagement-cloud.html)

* [克拉纳](https://docs.magento.com/user-guide/payment/klarna.html)

* [顶点云](https://docs.magento.com/user-guide/tax/vertex.html)

* [Yotpo产品评论](../../../upgrade/modules/upgrade.md)

### AWS S3支持增强功能

Amazon简单存储服务(AWS S3)支持已得到增强，包括对以下项的支持：

* 对象存储和未来的可扩展性

* [存储媒体文件](../../../configuration/remote-storage/remote-storage.md) 在AWS S3上

## 已修复的问题

我们修复了2.4.2核心代码中的数百个问题。

### 安装、升级、部署

<!-- MC-38429-->

* 此版本中已弃用将安装配置为使用拆分数据库的功能。 请参阅 [弃用Magento Open Source中的拆分数据库功能](https://community.magento.com/t5/Magento-DevBlog/Deprecation-of-Split-Database-in-Magento-Commerce/ba-p/465187) DevBlog文章。

<!-- MC-36472-->

* 商户现在可以成功将运行MySQL 8.x的开源部署升级到商务部署。 以前，应用程序在 `AUTO_INCREMENT` 值被还原为所有表的初始值， `row_id` 已在升级期间添加。

<!-- ENGCOM-7280 -->

* 现在，应用程序会显示一条错误消息，用于在运行时出错时标识用于创建修补程序的路径 `bin/magento/setup:db:generate-patch`. [GitHub-27523](https://github.com/magento/magento2/issues/27523)

<!-- ENGCOM-8029 -->

* `block_html`, `full_page`和 `layout` 现在，缓存在 `bin/magento/setup:upgrade` 执行。  [GitHub-28186](https://github.com/magento/magento2/issues/28186)

<!-- ENGCOM-8184 -->

* 中所需的最低PHP版本 `bootstrap.php` 已更新。 [GitHub-30004](https://github.com/magento/magento2/issues/30004)

<!-- MC-38788-->

* 您现在可以执行 `bin/magento/setup:upgrade` 安装示例数据之后。 以前，当您尝试执行 `bin/magento/setup:upgrade`，应用程序显示以下错误： `unable to apply data patch magento\catalogrulesampledata\setup\patch\data\installcatalogrulesampledata for module magento_catalogrulesampledata`. 应用程序在系统日志中还显示此错误： `main.ERROR: Sample Data error: Unable to unserialize value. Error: Syntax error`. [GitHub-30685](https://github.com/magento/magento2/issues/30685)

<!-- MC-36785-->

* 您现在可以按照预期从命令行设置YouTube API密钥。 以前，当您尝试执行 `bin/magento config:sensitive:set catalog/product_video/youtube_api_key`: `There are no sensitive configurations to fill`.

<!-- ENGCOM-8163 -->

* 申请现在遵循 `maxMessages` 在 `queue_consumer.xml`. 以前，应用程序仅使用部署配置值。 [GitHub-29522](https://github.com/magento/magento2/issues/29522)

<!-- ENGCOM-8243 -->

* 现在，使用创建新商店时，新商店的URL生成可按预期工作 `bin/magento setup:config:import`. 以前，生产环境中不会生成URL重写。 [GitHub-30025](https://github.com/magento/magento2/issues/30025)

<!-- ENGCOM-8230 -->

* 当您尝试更改时，应用程序不再引发错误 `backend-frontname` 使用 `ssh` 容器时，不会将其标记为Magento Open Source。 [GitHub-26762](https://github.com/magento/magento2/issues/26762)

<!-- ENGCOM-8230 -->

* 运行时，应用程序不再显示此问题 `bin/magento setup:install` 连接到现有数据库： `Overwrite the existing configuration for db-ssl-verify?[Y/n]`. [GitHub-29612](https://github.com/magento/magento2/issues/29612)

### Adobe Stock集成

<!-- ENGCOM-8020-->

* 增加了对读取的支持 `exif_image.png` 或 `exif-image.jpeg` 元数据。 [GitHub-1449](https://github.com/magento/adobe-stock-integration/issues/1449)

<!-- ENGCOM-8194 8094 8147-->

* 单击“媒体库”的“默认视图”书签时显示的内容不再过滤。 以前，默认视图包含从 `url-filter` 应用程序。 [GitHub-1813](https://github.com/magento/adobe-stock-integration/issues/1813), [GitHub-1789](https://github.com/magento/adobe-stock-integration/issues/1789), [GitHub-1780](https://github.com/magento/adobe-stock-integration/issues/1780)

<!-- ENGCOM-8070 -->

* 已从WYSIWYG OnInsert控制器(`Magento\Cms\Controller\Adminhtml\Wysiwyg\Images\OnInsert::execute()`)并添加到 `Model\Wysiwyg\Images\PrepareImage::execute()` 模型。 [GitHub-1504](https://github.com/magento/adobe-stock-integration/issues/1504)

<!-- ENGCOM-8081 -->

* 区域模拟已从 `media-content:sync` 命令(`\Magento\MediaContentSynchronization\Console\Command\Synchronize::execute`)。 [GitHub-1784](https://github.com/magento/adobe-stock-integration/issues/1784)

### Analytics

<!-- MC-37137-->

* 现在，高级报表可以按预期适用于同一域中的多个环境。 以前，由高级报表生成的CSV文件会失败，因为双引号会使用反斜杠进行转义，而不是使用CSV标准RFC4180要求的其他双引号进行转义。

<!-- MC-35996-->

* 的 `analytics_collect_data` 现在，使用默认或非默认端口连接到MySQL时，作业可成功运行 `env.php`. 以前， `analytics_collect_data` 使用非默认端口时引发错误。

<!-- MC-35407-->

* 由生成的CSV文件 `analytics_collect_data` 现在正确转义。 以前，这些文件没有使用正确的转义生成，这会阻止生成库存报告。

### Braintree

* 购物者现在可以使用Apple Pay成功订购虚拟产品。 以前，应用程序会引发以下错误： `There are no shipping methods available for you right now. Please try again or use an alternative payment method`.

* 默认的PayPal Express Checkout付款方法现在可以与Braintree信用卡付款方法一起按预期工作。 以前，应用程序不显示 **PayPal** 按钮。

### 捆绑产品

<!-- MC-34063-->

* 应用产品不再为报价中的固定价格捆绑产品子项目设置价格。

<!-- MC-38050-->

* 现在，当捆绑产品包括缺货产品时，价格排序可以按预期工作。 以前，按降序排序的价格不会按降序显示产品。

<!-- MC-38576-->

* 现在，当存在许多选项时，应用程序会自动为捆绑产品选项应用默认数量1。 以前，商户必须人工为每个选项分配默认数量。

<!-- ENGCOM-8159 -->

* 订单发票创建页面现在可按预期显示捆绑产品的子产品。 [GitHub-27350](https://github.com/magento/magento2/issues/27350)

<!-- MC-38460 -->

* 现在，当您以自定义价格重新订购属于捆绑产品一部分的简单产品时，应用程序会分配正确的产品价格。 以前，在捆绑产品上设置自定义价格会导致重新订购时附加的简单产品的价格不正确。 [GitHub-30343](https://github.com/magento/magento2/issues/30343)

<!-- MC-30348 -->

* 调用POST `/V1/order/{orderId}/ship` 现在，要发运包含捆绑产品的订单，请按照预期将订单标记为完成。 以前，应用程序会显示以下错误消息： `You can't create a shipment without products`. [GitHub-9762](https://github.com/magento/magento2/issues/9762)

### 购物车和结账

<!-- MC-34264-->

* 现在，当结帐工作流的发运步骤中存在自定义地址属性时，发运方法估算器会按预期工作。 以前，应用程序会显示以下错误消息： `{"message":"Error occurred during \"custom_attributes\" processing. A custom attribute is specified with a missing attribute code. Verify the code and try again."}` [GitHub-27505](https://github.com/magento/magento2/issues/27505)

<!-- MC-35783-->

* 应用程序现在显示 `You have no items in your shopping cart` 消息，如购物者删除购物车中的唯一项目时预期。 以前，购物车数据不更新 `checkout/cart/removeFailed` 当购物者删除了单个项目，且应用程序显示了以下消息时： `1 product requires your attention`.

<!-- MC-36088-->

* 应用产品不再显示不适用的发运方法的订单的发运成本。 以前，应用程序在结帐工作流中为不适用的装运方法显示0的价格。

<!-- MC-36598-->

* 现在，当 **我的帐单和送货地址是相同的** 复选框。

<!-- MC-37351-->

* 购物者在其他域中从一个商店切换到另一个商店时，购物车内容不再丢失。

<!-- MC-38000-->

* 现在，当使用多种送货方法时，购物者可以使用多个地址结帐成功完成订单。 以前，应用程序会显示以下错误： `There has been an error processing your request`. [GitHub-30197](https://github.com/magento/magento2/issues/30197)

<!-- MC-38048-->

* 当购物者从购物车更改商店视图时，应用程序现在会在结账工作流的送货页面上显示正确的默认国家/地区。

<!-- MC-38309-->

* 现在，在来宾购物者登录后重置注销密码后清除客户会话时，应用程序会排除当前会话。 以前，当购物者重置其密码时，应用程序清空了购物车。

<!-- MC-36884-->

* 当购物者更改购物车中的商店视图时，应用程序现在显示商店视图的正确默认国家/地区。 以前，当购物车中的商店视图发生更改时，默认国家/地区不正确。

<!-- MC-38746-->

* 冗余调用 `/rest/V1/guest-carts/cart_id/totals-information` 购物车上的端点已被删除，这改进了购物车性能。 以前，当购物者将产品添加到购物车，然后随后查看购物车时，应用程序称为 `collectAddressTotals` 方法多次。

<!-- MC-38833-->

* 应用程序不再显示 **地区** 字段，用于 **如果国家/地区为可选状态，则允许选择“州”** 设置处于禁用状态。 [GitHub-30747](https://github.com/magento/magento2/issues/30747)

<!-- MC-38813-->

* 从管理员重新订购订单后，应用程序不再在店面结帐工作流中重复发送地址。

<!-- MC-38814-->

* 修正了 `AdminMediaGalleryInsertLargeImageFileSizeTest`.

<!-- MC-37321-->

* 中的所有新记录 `quote` 客人的表现在为 `customer_is_guest field`. 以前，对于将产品添加到购物车的每位新访客，在`quote.customer_is_guest` 字段。

<!-- ENGCOM-8091 -->

* 的 **提交** “Review &amp; Payments（审核和付款）”部分的按钮已移至内部 `<form id="purchaseorder-form"...></form>`，这样可在不更改任何JavaScript的情况下提交隐式表单。 [GitHub-27925](https://github.com/magento/magento2/issues/27925)

<!-- ENGCOM-8428 -->

* 应用程序不再显示 **地区** 字段 **如果国家/地区为可选状态，则允许选择“州”** 设置处于禁用状态。 [GitHub-30747](https://github.com/magento/magento2/issues/30747)

<!-- ENGCOM-8442 -->

* 现在，当购物者单击购物车项目小计时，应用程序可正确更新购物车项目小计 **更新购物车** 使用多个地址签出时。 [GitHub-30408](https://github.com/magento/magento2/issues/30408)

<!-- ENGCOM-8283 -->

* 当 `config.xml` 当前未安装的付款方法存在节点。 以前，应用程序在结帐期间引发异常。 [GitHub-29555](https://github.com/magento/magento2/issues/29555)

<!-- ENGCOM-8215 -->

* 现在，应用程序可在迷你购物车中正确呈现包含特殊字符的产品名称。 [GitHub-29075](https://github.com/magento/magento2/issues/29075)

<!-- ENGCOM-8308 -->

* 现在，应用程序为表费率设置了正确的折扣包。 以前，应用程序在计算表费率时不应用在购物车上设置折扣的购物车规则。 [GitHub-30169](https://github.com/magento/magento2/issues/30169)

### 购物车价格规则

* 现在，在计算订单小计时，不计税时，将按预期应用购物车价格规则。 新 `Subtotal (Incl. Tax)` 选项已添加为购物车价格规则条件。

<!-- MC-37884-->

* 现在，使用GraphQL在优惠券中应用价格规则时，如果 **整个购物车的固定金额折扣** 操作。

### 目录

<!-- MC-34100-->

* 现在，应用程序会按照预期在店面显示所有重新启用的产品。 以前，当某个产品被禁用并重新启用时，在清除清漆页面缓存或重新索引存储之前，应用程序不会显示该产品，因为重新启用某个产品后，页面缓存没有失效。

<!-- MC-37745-->

* 现在可以按预期对大型目录进行部分重新索引。 以前，在使用 `catalogsearch_fulltext` 部分索引器。

<!-- MC-35123-->

* 购物者现在可以按照预期重新订购具有可自定义选项的产品的发票订单。 以前，当购物者尝试重新排序时，应用程序会引发此错误： `{"0":"The product's required option(s) weren't entered. Make sure the options are entered and try again`.

<!-- MC-35212-->

* 您现在可以成功地设置 **布局** 在“类别设计”页面上将 **无布局更新**. 以前，应用程序会还原为 **类别 — 全宽** 当您分配 **无布局更新** 值。

<!-- MC-35490-->

* 解决了店面上的产品订购问题。 以前，当应用程序将产品价格编入索引时，它有时会设置可配置产品的 `min_price` 和 `max_price` 到0 `catalog_product_index_price` 表格，它影响了店面的价格排序顺序。

<!-- MC-35608-->

* 现在，应用程序已成功更新标记为 `Product Type`. 以前，因为 `product_type` 属性在代码中保留，当您尝试更新 `Product Type` 属性： `An attribute with the same code (product_type) already exists.`

<!-- MC-36214-->

* 在您保存产品后，应用程序将不再更改已上传视频在产品详细信息页面的图像和视频部分中的位置。 以前，会为新图像位置分配一个索引值（在列表中的位置），如果现有图像位置与其索引值不一致，则新图像会在列表中放错位置。

<!-- MC-36548-->

* 的 **添加到购物车** 现在，只要 **添加到购物车** 按钮。 以前，如果您在等待产品页面加载时多次单击此按钮，应用程序会引发以下错误： `Invalid Form Key. Please refresh the page`.

<!-- MC-37006 36835-->

* 当商家向类别添加或删除禁用的产品时，应用程序不再刷新类别缓存。 以前，应用程序会刷新相关类别的缓存，尽管产品状态如此。 保存类别时，类别也未分配，这会导致类别缓存刷新。

<!-- MC-37347-->

* 在 **所有商店视图** 范围现在可正常工作。 以前，状态为以下任一项的产品 `Enabled` 或 `Disabled` 仅筛选已启用或已禁用的产品时，会在网格中显示这些值。

<!-- MC-38038-->

* 部分重新索引不再导致缺少的产品和空类别。

<!-- MC-38315-->

* 现在，重新订购可在 **使用JavaScript日历** 已启用(**商店** > **配置** > **目录** > **日期和时间自定义选项**)。 以前，启用此设置后，当您尝试从管理员重新排序之前下达的订单时，应用程序会显示此错误： `Please specify date required option(s)`.

<!-- MC-38719-->

* 现在，在层价格创建期间，应用程序在多站点部署中会显示正确的货币。

<!-- MC-38914-->

* 产品图像自定义属性现在可正确转义。 的 `data-src` 属性的值与 `src` 属性。 以前，URL特殊符号会转义。

<!-- MC-37665-->

* 通过REST API更新类别不再禁用 **使用默认值** “启用类别”、“包含在菜单中”和“URL键属性”中进行设置。

<!-- MC-35363-->

* 现在，保存类别只会刷新与此类别相关的块缓存。 以前，应用程序会刷新所有类别块的缓存。

<!-- MC-30626-->

* 现在，具有百分比价格的自定义选项的价格将按照预期转换为多商店部署中活动商店的基本货币。 以前，具有百分比价格的自定义选项的价格被错误地转换。 [GitHub-26432](https://github.com/magento/magento2/issues/26432)

<!-- MC-38890-->

* 现在，应用程序成功重新创建了图像，并且当商家使用POST发送媒体集数据时，这些图像会按预期在管理员中可见 `rest/all/V1/products`. 以前，应用程序重新创建了这些图像，但在商家通过POST发送媒体集数据时删除了这些图像 `rest/all/V1/products` 如果图像被 `pub/media` 但媒体中仍然有记录，包含这些图像的记录。 因此，该商户在管理员中只看到占位符，因为图像是在更新过程中创建和删除的。

<!-- MC-36903-->

* 现在，在您从网站中取消分配项目时，将按预期删除记录。 以前，在POST时会复制图像 `rest/all/V1/products` 已执行。

<!-- MC-38413-->

* 的 `/V1/categories/{categoryId}/products` 调用现在会按照预期返回属于父类别的所有产品的列表。 以前，如果产品属于父类别的多个子类别，则应用程序会引发以下类型的错误： `Internal Error. Details are available in the application log file. Report ID: webapi-5f8579e37db54`.  [GitHub-30461](https://github.com/magento/magento2/issues/30461)

<!-- MC-32996-->

* 的 `/V1/products/attributes/:attributeCode/options` REST端点现在支持更新现有属性选项。

<!-- MC-30626 ENGCOM-8475-->

* 现在，具有百分比价格的自定义选项的价格将按照预期转换为多商店部署中活动商店的基本货币。 以前，具有百分比价格的自定义选项的价格被错误地转换。 [GitHub-26432](https://github.com/magento/magento2/issues/26432)

<!-- ENGCOM-8395 -->

* 商家现在可以在产品创建期间成功保存新属性。 以前，应用程序不保存属性，并在商家尝试保存属性时将其重定向到商店视图主页。 [GitHub-30362](https://github.com/magento/magento2/issues/30362)

<!-- ENGCOM-7997 -->

* 上的产品网格 **销售** > **订单数** 和 **目录** > **产品** 现在，页面会列出所有相关的商店，而不仅仅是最近创建的商店。 [GitHub-29267](https://github.com/magento/magento2/issues/29267)

<!-- ENGCOM-6698 -->

* 产品存储库现在使用 `store_id` 可用于保存现有产品的属性值时。  以前，产品存储库类会覆盖产品商店ID，并始终分配默认商店ID。 [GitHub-29933](https://github.com/magento/magento2/issues/29933)

### 目录规则

<!-- MC-35065-->

* 目录价格规则现在可以按预期使用，并且可以在产品详细信息页面上使用自定义选项。 以前，该页面上的产品价格不反映适用的目录价格规则。 [GitHub-22856](https://github.com/magento/magento2/issues/22856)

<!-- MC-34265-->

* 现在，产品和目录缓存会按计划过期。 以前，由于 `сron` 运行 `catalogrule_apply_all` 每天任务一次，该任务会将所有目录规则和从属索引器重新编入索引，并清除所有产品和类别的缓存。

### 清理

#### 打字和语法清理

<!-- ENGCOM-7967 -->

* 为了准确起见，“订单失败”页面的标题已进行修订。 以前，此页面的标题为： **我们收到你的命令！**.  [GitHub-29416](https://github.com/magento/magento2/issues/29416)

<!-- ENGCOM-8101 -->

* 删除了 `app/code/Magento/Contact/view/frontend/templates/form.phtml`. [GitHub-29779](https://github.com/magento/magento2/issues/29779)

<!-- ENGCOM-7716 -->

* 更正了 `bin/magento/setup:config:set` 子命令。  [GitHub-28802](https://github.com/magento/magento2/issues/28802)

<!-- ENGCOM-8058 -->

* 在PHPDoc中为 `framework/Registry.php` 文件。 [GitHub-29661](https://github.com/magento/magento2/issues/29661)

<!-- ENGCOM-8273 -->

* 删除了 `app/code/Magento/Catalog/Helper/Product/View.php`. [GitHub-30601](https://github.com/magento/magento2/issues/30601)

<!-- ENGCOM-8181 -->

* 更正了 `app/code/Magento/Ui/view/base/web/js/form/element/ui-select.js`. [GitHub-29987](https://github.com/magento/magento2/issues/29987)

<!-- ENGCOM-8478 -->

* 更正了迷你购物车和结帐订单摘要中“项目”的复数化。 [GitHub-29920](https://github.com/magento/magento2/issues/29920)

<!-- ENGCOM-8309 -->

* 删除了标记分层导航过滤器中内联元素中的空格。 [GitHub-30448](https://github.com/magento/magento2/issues/30448)

<!-- ENGCOM-8056 -->

* `rl` 已更正为 `url` in  `\Magento\Framework\Filter\Template\Tokenizer\Parameter`. [GitHub-29185 ](https://github.com/magento/magento2/issues/29185)

#### 代码清理

<!-- MC-37922-->

* 无关HTML `<br>` 标记已从  **系统**  >  **导入** 页面。

<!-- ENGCOM-8028 -->

* `ChangeQuoteControl` 已重构。 [GitHub-29673](https://github.com/magento/magento2/issues/29673)

<!-- ENGCOM-8027 -->

* `AccessChangeQuoteControl` 其单位测试已进行了重构。 [GitHub-29672](https://github.com/magento/magento2/issues/29672)

<!-- ENGCOM-8053 -->

* 更正了 `app/code/Magento/Captcha/CustomerData/Captcha.php`. [GitHub-29712](https://github.com/magento/magento2/issues/29712)

<!-- ENGCOM-8288 -->

* 更正了按钮列表在“新建属性”页面上的位置。

<!-- ENGCOM-8315 -->

* 为前端添加了正确的块类 `viewModel` 引用示例 `\Magento\Framework\View\Element\Template` 类。 [GitHub-30450](https://github.com/magento/magento2/issues/30450)

<!-- ENGCOM-8090 -->

* 已删除“销售规则”表单中的冗余字段集。 [GitHub-29599](https://github.com/magento/magento2/issues/29599)

<!-- ENGCOM-8448 -->

* 已从 `hierarchy/edit.phtml` 模板。

<!-- ENGCOM-8446 -->

* 更正了 `app/code/Magento/CatalogImportExport/Model/Export/Product.php`. [GitHub-30833](https://github.com/magento/magento2/issues/30833)

<!-- ENGCOM-8277 -->

* 的Docblock注释 `PublisherInterface` 邮件已更正。 [GitHub-30190](https://github.com/magento/magento2/issues/30190)

<!-- ENGCOM-8264 -->

* 更正了 `getStatusByState` 方法。 [GitHub-30173](https://github.com/magento/magento2/issues/30173)

<!-- ENGCOM-8235 -->

* 中更正了方法说明 `app/code/Magento/Quote/Model/Cart/Totals/ItemConverter.php`. [GitHub-30125](https://github.com/magento/magento2/issues/30125)

<!-- ENGCOM-8242 -->

* 删除了多个文件中同一行中冗余的变量分配。 [GitHub-30133](https://github.com/magento/magento2/issues/30133)

<!-- ENGCOM-8263 -->

* 已更改 `@param string $attribute` to `@param AbstractAttribute|string[]|string $attribute` in `EntityAbstract.php`. [GitHub-30191](https://github.com/magento/magento2/issues/30191)

<!-- ENGCOM-8142 -->

* 无效的标记(例如， `@package` 和 `@subpackage`)已从整个代码库的docblock中删除。 [GitHub-30061](https://github.com/magento/magento2/issues/30061)

<!-- ENGCOM-8117 -->

* 构造中未使用的参数 `AdvancedPricing` 类已被删除。 [GitHub-29531](https://github.com/magento/magento2/issues/29531)

### 可配置产品

<!-- MC-35016-->

* 现在，按价格筛选缺货可配置产品时，会将结果显示在正确的价格范围内。

<!-- MC-38930-->

* 当虚拟产品的状态从“启用”更改为“禁用”（反之亦然）时，虚拟产品不再更改类型。 以前，应用程序在产品状态发生更改时，会将产品类型从虚拟更改为简单。

<!-- MC-38197-->

* 的 `getValue()` 方法在更新购物车时不再触发致命错误。

<!-- MC-34444-->

* 可在多个网站上使用的可配置产品不再显示未分配给特定网站的简单子产品。 [GitHub-28291](https://github.com/magento/magento2/issues/28291)

<!-- ENGCOM-8202 -->

* 店面产品页面现在可按预期显示无税的层价。 [GitHub-12225](https://github.com/magento/magento2/issues/12225)

<!-- ENGCOM-8134 8174-->

* 可配置产品的MSRP价格现在可正确转换为所选货币。 以前，应用程序以错误的货币显示价格并引发以下错误：  `Call to a member function setAppliedTaxes() on null`. [GitHub-26526](https://github.com/magento/magento2/issues/26526), [GitHub-29603](https://github.com/magento/magento2/issues/29603)

<!-- ENGCOM-8234 -->

* 商家现在可以保存值为0（零）的特定于商店的文本样本属性选项标签。 以前，值0会被替换为管理员标签选项值。 [GitHub-30073](https://github.com/magento/magento2/issues/30073)

### cron

<!-- MC-37712-->

* 系统消息列表现在可准确反映产品更新之后 `cron` 已运行，且应用程序已按计划更新产品。

<!-- ENGCOM-8164 -->

* 基于的索引 `schedule_id` 和 `status` 已添加到 `cron_schedule` 表。 [GitHub-29601](https://github.com/magento/magento2/issues/29601)

### 自定义客户属性

<!-- MC-23545-->

* 应用程序现在显示类型的客户属性 `file` 帐户信息页面。 以前，当您尝试保存此类型的新属性时，应用程序会显示以下错误： `The "newAttribute" attribute value is empty. Set the attribute and try again` 和 `Validation is failed`.

<!-- MC-23544-->

* 现在，应用程序可正确显示多行自定义客户属性值。 以前，并非显示所有数据。

<!-- MC-36978-->

* 现在，当购物者在创建帐户时输入无效的出生日期时，应用程序会向他们发出警报。 以前，验证器忽略区域设置，并且购物者被重定向到“创建新客户帐户页面”，出现无效日期错误。

<!-- MC-38846-->

* 现在，自定义地址属性可按预期包含在结帐工作流的付款步骤中。

<!-- MC-38114-->

* 现在，在来宾结帐期间和“管理员和我的帐户”订单详细信息页面上，可正确显示自定义地址多选属性。

<!-- MC-37101-->

* 现在，您可以删除自定义客户属性中的前导零 `Input Type` 设置为 `Text` 和 `Input Validation` 设置为 `Numeric Only`.

<!-- MC-36721-->

* 现在，应用程序可成功导出包含自定义性别属性值的客户数据。

### 客户

<!-- MC-35771-->

* 店面客户帐户页面出生日期字段的日历小组件现在使用指定的商店区域设置。

<!-- MC-38498-->

* 在从管理员处为现有客户重新订购时，应用程序不再保存客户地址的重复条目。

<!-- MC-37393-->

* 现在，从管理员中删除多个客户的所有地址将从客户地址列表中删除所有地址，并删除默认的帐单和送货地址。 以前，应用程序从客户地址列表中删除了地址，但没有删除默认的帐单和送货地址。

<!-- MC-37377-->

* 管理员客户地址选项卡现在可以在管理员执行批量删除地址后正确显示地址计数。 以前，应用程序的计数中包含已删除的地址。

<!-- MC-36718-->

* 的DateTime格式 **出生日期** 字段。 以前，在单位数日期之前的前导零丢失。

<!-- MC-36024-->

* 日期格式验证 **出生日期** 字段现在在购物者单击 **创建帐户** 按钮。 以前，购物者可以以无效格式输入值，并在他们单击 **创建帐户** 按钮时，购物者被重定向到“创建新客户帐户页面”，并出现无效日期错误。

<!-- MC-33867-->

* 当管理员尝试保存新客户帐户（包含属性的无效数据）时，应用程序不再引发致命错误。

<!-- MC-36258-->

* 当客户尝试在之前安装了Magento Shipping且当前部署了默认Luma主题的部署中访问其购物车时，应用程序不再引发400错误。 以前，在向服务器发送请求之前，应用程序不会过滤掉由以前安装/启用的模块创建的节名，这些模块在管理员中不受支持，从而导致出现错误。

<!-- MC-35812-->

* 现在，当购物者在 **要求确认电子邮件** 设置启用并 `Magento\Customer\Controller\Account\CreatePost` 已被覆盖。 以前，应用程序不允许对用户注册过程进行此类自定义，在这些情况下，用户的电子邮件确认状态被视为已完成，新用户被自动登录，且未显示错误消息。

<!-- ENGCOM-8039 -->

* 现在，当购物者在商店中使用非默认客户组下订单时，应用程序会将购物者分配到正确的客户组， **启用对客户组的自动分配** 启用。 [GitHub-26976](https://github.com/magento/magento2/issues/26976)

<!-- MC-39783-->

* 现在，当将索引设置为 **按计划更新**. 以前，应用程序不显示网格，并引发以下错误：  `[2020-12-09 11:31:54] report.CRITICAL: The website with id 2 that was requested wasn't found. Verify the website and try again. \{"exception":"[object] (Magento\\Framework\\Exception\\NoSuchEntityException(code: 0): The website with id 2 that was requested wasn't found. Verify the website and try again. at /var/www/html/magento24ee/vendor/magento/module-store/Model/WebsiteRepository.php:110)"}`

### dotdigital

* 从Dotdigital Engagement Cloud检索项目列表时，错误处理已得到改进。

* 在来宾同步期间在存储名称列中同步的值现在是按预期的存储视图名称。 以前，网站名称包含在此列中。

* 在保存订单后对订单状态自动进行循环之前添加了数组检查。

* 解决了由于dotdigital模块依赖于 `magento/module-authorization`.

### 可下载

<!-- ENGCOM-7679 -->

* 在部分退还了该应用程序所属的订单后，该应用程序将不再在“我的下载产品”选项卡中列出可下载的产品。 [GitHub-28388](https://github.com/magento/magento2/issues/28388)

### EAV

<!-- MC-35934-->

* 使用的自定义属性 `\Magento\Eav\Model\Entity\Attribute\Backend\ArrayBackend` 现在，如果通过API调用创建产品时，有效负载中未提供任何值，则使用默认值。

### 电子邮件

<!-- ENGCOM-7961 -->

* `\Magento\Config\Model\Config\Source\Email\Template::toOptionArray` 在 `setPath()` 在之前未调用 `toOptionArray()`. [GitHub-29315](https://github.com/magento/magento2/issues/29315)

<!-- MC-36777-->

* 现在，在您单击 **返回Html版本** 加载电子邮件模板时。

<!-- MC-34803-->

* 发送给包含部分发票的客户的电子邮件现在包含准确的项目小计。 以前，此电子邮件中的小计是订购数量的总数，而不是开票数量的总数。

<!-- MC-38337-->

* 应用程序现在会向所有具有有效电子邮件地址的相关客户发送电子邮件提醒。 以前，应用程序在遇到一个无效地址后停止向客户发送提醒电子邮件。

<!-- ENGCOM-7517 -->

* 现在，在将产品从目录中删除后，以异步模式发送销售电子邮件会按预期工作。 以前，异步电子邮件发送会被阻止，应用程序会显示以下错误：  `main.ERROR: Cron Job sales_send_order_invoice_emails has an error: Call to a member function getData() on null. Statistics: {"sum":0,"count":1,"realmem":0,"emalloc":0,"realmem_start":73400320,"emalloc_start":37177640} [] []main.CRITICAL: Error when running a cron job {"exception":"[object] (RuntimeException(code: 0): Error when running a cron job at /var/www/html/vendor/magento/module-cron/Observer/ProcessCronQueueObserver.php:327, Error(code: 0): Call to a member function getData() on null at /var/www/html/vendor/magento/module-catalog/Helper/Image.php:502)"} []`. [GitHub-26878](https://github.com/magento/magento2/issues/26878)

<!-- ENGCOM-8381 -->

* 在 `sales_email/order_comment/enabled` 已禁用， `sales_email/order_comment/copy_method` 设置为 `bcc`. [GitHub-29915](https://github.com/magento/magento2/issues/29915)

### 框架

<!-- MC-24195-->

* 现在，在搜索客户时，可以正确应用自定义过滤器组。 以前， `afterSearch` 函数未按预期进行OR筛选。 [GitHub-24576](https://github.com/magento/magento2/issues/24576)

<!-- MC-36942-->

* 现在，商店主页上的图像已成功呈现。 以前，页面源HTML已损坏，因为图像base64代码中的三个连续斜杠被错误地解释为注释。

<!-- MC-37369-->

* 使用阿拉伯语区域设置(`ar_SA - Saudi Arabia`)。

<!-- MC-38344-->

* 在商户在部署中保存购物车价格规则后，DatePicker现在显示正确的日期。 [GitHub-30382](https://github.com/magento/magento2/issues/30382)

<!-- MC-31085-->

* 该应用程序现在可以正确表示阿拉伯文千位分组和阿拉伯文小数分隔符符号。 以前，阿拉伯文符号被裁剪。 [GitHub-26676](https://github.com/magento/magento2/issues/26676)

<!-- MC-30631-->

* 应用程序现在从数据库中删除过期的数据库会话 `session` 表。

### 一般修复

<!-- MC-38105-->

* 现在，您可以配置与中定义的处理程序不同的本机会话处理程序 `php.ini`. 以前， `SessionManager` 未将memcache设置为 `save_handler`，而是使用文件 `session_handler`. 应用程序引发了以下错误： `main.CRITICAL: Warning: SessionHandler::read(): open(127.0.0.1:11211/sess_0imeeaqmnvemdg4e3h57tat0ik, O_RDWR) failed: No such file or directory (2) in../vendor/magento/framework/Session/SaveHandler/Native.php on line 22 {"exception":"[object] (Exception(code: 0): Warning: SessionHandler::read(): open(127.0.0.1:11211/sess_0imeeaqmnvemdg4e3h57tat0ik, O_RDWR) failed: No such file or directory (2) in ../vendor/magento/framework/Session/SaveHandler/Native.php on line 22 at ../vendor/magento/framework/App/ErrorHandler.php:61)"}`. [GitHub-24717](https://github.com/magento/magento2/issues/24717)

<!-- ENGCOM-8052 -->

* 已对 `LoginAsCustomer` 模块：

   * 已更换 `around` 插件 `after`

   * 删除了冗余代码

   * 已更换 `(bool)->getValue()` with `isSetFlag`. [GitHub-29689](https://github.com/magento/magento2/issues/29689)

<!-- ENGCOM-8093 -->

* 通过通配符(*)重新加载所有客户数据部分不再导致请求 `customer/section/load` 引发400个错误。 [GitHub-28154](https://github.com/magento/magento2/issues/28154)

<!-- ENGCOM-7994 -->

* 现在，应用程序会将布局在生产模式下呈现时出现的异常传递到 `var/report`. [GitHub-29606](https://github.com/magento/magento2/issues/29606)

<!-- MC-35058-->

* 商家现在可以按预期从类别中取消分配产品。 以前，应用程序引发了与此错误类似的错误： `Could not save product "4" with position 0 to category 3`.

<!-- ENGCOM-7527 -->

* 当不存在的客户请求重置密码时，应用程序现在会引发异常。 [GitHub-26288](https://github.com/magento/magento2/issues/26288)

<!-- MC-33687 ENGCOM-8497-->

* 现在，当管理员在上传具有此属性值的文件时，尝试保存包含客户属性无效值的客户帐户时，应用程序会显示一则信息性错误消息。 以前，应用程序会引发致命错误。 [GitHub-30295](https://github.com/magento/magento2/issues/30295)

<!-- ENGCOM-8400 -->

* 现在，该应用程序将应用 **HTML打印视图的徽标** 配置设置，以按预期存储发票PDF。 [GitHub-24730](https://github.com/magento/magento2/issues/24730)

<!-- ENGCOM-8425 -->

* `static::` 替换为 `self::` 用于访问专用常量的代码库。 [GitHub-30781](https://github.com/magento/magento2/issues/30781)

<!-- ENGCOM-8395 -->

* 现在，当商家单击 **创建新属性** 按钮两次。 以前，应用程序显示一个空页面并引发错误。 [GitHub-30361](https://github.com/magento/magento2/issues/30361)

<!-- ENGCOM-8426 -->

* 应用程序不再显示 `The coupon code has been accepted` 优惠券删除后的消息。 [GitHub-30255](https://github.com/magento/magento2/issues/30255)

<!-- ENGCOM-8396 -->

* 管理员现在可以将小组件分配给特定类别。 [GitHub-30009](https://github.com/magento/magento2/issues/30009)

<!-- ENGCOM-8216 -->

* 属性选择器 `input[type=datetime]` 已被替换为不太特定的输入类型选择器。 [GitHub-30064](https://github.com/magento/magento2/issues/30064)

<!-- ENGCOM-8282 -->

* 应用程序现在可以按预期显示与自定义类别属性关联的特定于存储的值。 [GitHub-13440](https://github.com/magento/magento2/issues/13440)

<!-- ENGCOM-8287 -->

* 现在，应用程序会显示一个提示，询问在单击 **验证增值税号** “订单创建”页上的按钮。 [GitHub-29652](https://github.com/magento/magento2/issues/29652)

<!-- ENGCOM-8031 -->

* 的 `\Magento\Catalog\Model\ImageUploader` 类已重构为使用新 `moveFileFromTmp` 方法。 [GitHub-29598](https://github.com/magento/magento2/issues/29598)

<!-- ENGCOM-8178 -->

* 现在，当商家尝试使用创建产品属性时，应用程序会显示一条信息更丰富的错误消息 `product_type` 和 `type_id` 代码更具描述性。 [GitHub-28479](https://github.com/magento/magento2/issues/28479)

<!-- ENGCOM-8135 -->

* 更正了 **客户令牌生命周期（小时）**  和 **管理员令牌生命周期（小时）** 管理员的字段 **商店**  >  **配置** >  **服务**  > **OAuth** 页面。 [GitHub-29502](https://github.com/magento/magento2/issues/29502)

<!-- ENGCOM-8132 -->

* 应用程序现在可以正确解析包含 `}}` 在小组件内容字段中。 [GitHub-12087](https://github.com/magento/magento2/issues/12087)

<!-- ENGCOM-8098 -->

* 您现在可以从“产品类别”页面中删除过滤器。 以前，当您尝试删除过滤器时，应用程序不允许您删除该过滤器并显示以下错误：  `Something went wrong`. [GitHub-8538](https://github.com/magento/magento2/issues/8538)

<!-- ENGCOM-8050 -->

* `Magento\Framework\MessageQueue\ConfigInterface` 现在，当可选模块时，可以实例化 `Magento_MessageQueue` 已禁用。 以前，应用程序会引发以下错误： `PHP Fatal error:  Uncaught Error: Cannot instantiate interface Magento\Framework\MessageQueue\ConfigInterface in /var/www/magento2/magento2/lib/internal/Magento/Framework/ObjectManager/Factory/AbstractFactory.php:121`. [GitHub-26080](https://github.com/magento/magento2/issues/26080)

<!-- ENGCOM-7312 -->

* 改进了确定应用程序何时可以从永久存储中检索电子邮件值的逻辑。 以前，当未注册用户在首次填写电子邮件字段后返回结帐页面时，应用程序会在结帐页面上显示填充的密码字段。 [GitHub-26903](https://github.com/magento/magento2/issues/26903)

<!-- ENGCOM-7777 -->

* 缺失 `aclResource` 属性已添加到管理员标题中 `AdminNotification` 工具栏块。 以前，即使管理员用户没有角色资源权限查看管理员通知工具栏条目，也会显示该条目。 [GitHub-29067](https://github.com/magento/magento2/issues/29067)

<!-- ENGCOM-8022 -->

* 的 `framework/database/select` `where` 函数现在处理 `type` 正确。 [GitHub-29590](https://github.com/magento/magento2/issues/29590)

<!-- ENGCOM-8260 -->

* 使用效率低下 `array_merge` in循环在整个代码库中都得到了改进，在多个位置（包括在静态内容部署过程中）都改进了性能。 [GitHub-30183](https://github.com/magento/magento2/issues/30183)

<!-- ENGCOM-8445 -->

* 默认的管理员会话生命周期已从加密模块移至安全模块。 [GitHub-30859](https://github.com/magento/magento2/issues/30859)

<!-- ENGCOM-8425 -->

* 现在，应用程序会检查类中的专用常量，并在存在任何类时显示警告 `static::` 打电话给他们。 以前，应用程序会引发以下错误： `Undefined class constant`.

<!-- ENGCOM-8326 -->

* 添加了对符号链接的支持 `root` 在“错误”页面和维护模式下。 以前，如果 `root` 或 `magento/pub` 被符号化到另一个目录，错误处理器(`Magento\Framework\Error\Processor`)未生成正确的视图文件URL。 [GitHub-30296](https://github.com/magento/magento2/issues/30296)

<!-- ENGCOM-8087 -->

* 添加了缺失项 `order_data` 阵列到 `EmailSender` 类。 这使得这些类与Magento的建议保持一致，即使用标量变量而不是电子邮件模板中的对象。 [GitHub-29604](https://github.com/magento/magento2/issues/29604)

### GraphQL

<!-- MC-37615-->

* GraphQL URL解析程序现在可以正确处理查询参数。 以前，在处理带有参数的SEO友好URL时返回NULL。

<!-- ENGCOM-8422 -->

* GraphQL URL解析程序现在可以正确处理CMS页面层次结构。 以前，返回NULL。 [GitHub-30474](https://github.com/magento/magento2/issues/30474)

<!-- MC-38209-->

* 产品的查询 `categories.breadcrumbs` 对于父类别被禁用的类别，数据不再返回痕迹导航数据。 [GitHub-30468](https://github.com/magento/magento2/issues/30468)

<!-- MC-38407-->

* 现在，在禁用URL重写时，可正确返回类别图像的路径。

<!-- MC-36648-->

* 现在，当在GraphQL密码重置操作期间发生错误时，应用程序会返回一条信息更丰富的消息。 [GitHub-30179](https://github.com/magento/magento2/issues/30179)

<!-- MC-38078-->

* 现在，在缓存查询结果时，GraphQL查询结果中的产品位置会按预期进行更新。

<!-- MC-35355-->

* 的 `products` 现在，查询在 `category_id`  过滤器是使用 `in` 关键词。 [GitHub-30349](https://github.com/magento/magento2/issues/30349)

<!-- ENGCOM-8219 -->

* 将规则添加到 `editorconfig` 要支持缩进JSON和YAML文件两个空格。 [GitHub-30066](https://github.com/magento/magento2/issues/30066), [GitHub-30063](https://github.com/magento/magento2/issues/30063)

<!-- ENGCOM-8079 -->

* 的 `FlushCacheByTags` 类已更新为使用插件后处理，而不是绕过插件。 [GitHub-29558](https://github.com/magento/magento2/issues/29558)

<!-- ENGCOM-8370 -->

* 中的代码 `checkout_index_index.xml` 文件已通过删除 `sortOrder` 从 `messages`, `authentication`, `progressBar`, `estimation`和 `sidebar checkout` 组件。 [GitHub-30550](https://github.com/magento/magento2/issues/30550)

<!-- ENGCOM-8379 -->

* 中的内容 `calc` 现在已转义，这样可正确 `calc` 值。 以前，应用程序返回的错误 `calc` 值。 [GitHub-30542](https://github.com/magento/magento2/issues/30542)

<!-- ENGCOM-8030 -->

* URL重写生成器现在可设置类别对象 `url_key`, `url_path`和  `store_id` ，以在保存全局范围的类别URL时默认存储值。 以前，它会保存 `url_key`, `url_path`和 `store_id` 的值。 [GitHub-29585](https://github.com/magento/magento2/issues/29585)###分组产品

<!-- MC-35361-->

* “产品”查询现在可返回分组产品的所有预期数据。 以前， `product_links` 为空数组。

<!-- MC-37718-->

* 现在，当所有子级简单产品都无现货时，已分组的产品在产品编辑页面上列为无现货。

<!-- MC-37249-->

* 现在，当其子简单产品的状态变为无现货时，已分组产品的状态在产品编辑页面上会正确更新。 以前，在子产品更改库存状态后，分组产品父产品的库存库存项目不会更新。

<!-- ENGCOM-8250 -->

* `\Magento\Widget\Controller\Adminhtml\Widget\Instance\Validate` 现在，将短语结果值识别为错误消息，并在小组件验证期间将其输出给用户。 [GitHub-27397](https://github.com/magento/magento2/issues/27397)

<!-- ENGCOM-8311 -->

* 中类别属性的硬编码列表  `Magento\Catalog\Model\Category\DataProvider::getFieldsMap()` 已被替换为从缓存生成的属性列表。 [GitHub-13440](https://github.com/magento/magento2/issues/13440)

<!-- ENGCOM-7759 -->

* 冗余哈希处理 `req.http.host/client.ip` 已删除，且哈希处理由Hiket内置VCL进行。 [GitHub-29988](https://github.com/magento/magento2/issues/29988)

<!-- ENGCOM-8302 -->

* 向 `Magento_Ui` 文件上载程序。 [GitHub-29557](https://github.com/magento/magento2/issues/29557)

<!-- ENGCOM-8405 -->

* 安 `acl.xml` 不一致时 `Magento_LoginAsCustomerAssistance` 已启用，但 `Magento_LoginAsCustomerAdminUi` 或 `Magento_LoginAsCustomerLog` 已更正禁用。 以前，当具有这些凭据的管理员尝试登录到管理员时，应用程序会显示一个空白页面，并在出现以下错误时抛出此错误：  `Exception #0 (LogicException): Could not create an acl object: Invalid Document Element 'resource': The attribute 'title' is required but missing. Line: 13`. [GitHub-30680](https://github.com/magento/magento2/issues/30680)

<!-- ENGCOM-8157 -->

* 应用程序不再引发 `Undefined class constant` 错误 `Interceptor` 在插件创建期间生成。 [GitHub-28981](https://github.com/magento/magento2/issues/28981), [GitHub-29879](https://github.com/magento/magento2/issues/29879)

<!-- ENGCOM-8108 -->

* 现在，该应用程序可以正确处理异步批量操作的消息传送和日志记录。 以前，尽管产品已更新，但 `magento_operation` 和 `queue_message_status` 表未正确更新，系统消息不正确。 [GitHub-29718](https://github.com/magento/magento2/issues/29718)

<!-- ENGCOM-8388 -->

* 现在，购物者在单击时将被重定向到“设置新密码”页面（按预期） **设置新密码** 在重置密码电子邮件中 **要求确认电子邮件** 已为存储启用。 以前，购物者会被重定向回 **忘记密码** 按钮。 [GitHub-27954](https://github.com/magento/magento2/issues/27954)

<!-- ENGCOM-8337 -->

* 使用默认值保存行系统配置时，已更正数组到字符串转换错误。 [GitHub-30314](https://github.com/magento/magento2/issues/30314)

<!-- ENGCOM-8440 -->

* 您现在可以为消息队列设置参数。 [GitHub-30216](https://github.com/magento/magento2/issues/30216)

<!-- ENGCOM-8384 -->

* 基本文件收集器现在遵循 `AppState->emulateAreaCode()`. [GitHub-39656](https://github.com/magento/magento2/issues/29656)

<!-- ENGCOM-8441 -->

* 新 `BlockByIdentifier` 类支持基于CMS块标识符检索布局块。 因此，当从缓存中删除CMS块时，应用程序也会清除布局块缓存。 [GitHub-28309](https://github.com/magento/magento2/issues/28309)

<!-- ENGCOM-8385 -->

* 更正了队列中数值参数转换的问题。 以前，在声明队列时使用数字 `type` 参数 `queue_topology.xml`，则参数值将转换为字符串。 [GitHub-29615](https://github.com/magento/magento2/issues/29615)

### GraphQL

<!-- MC-37615-->

* 的 `urlResolver` 查询现在可以正确处理查询参数。

<!-- ENGCOM-8422 -->

* 的 `urlResolver` 在将自定义CMS节点和页面指定为输入时，查询不再返回NULL。 [GitHub-30474](https://github.com/magento/magento2/issues/30474)

<!-- MC-38209 ENGCOM-8386-->

* 的 `category` 查询不再返回已禁用的父类别的子类别。 [GitHub-30468](https://github.com/magento/magento2/issues/30468)

<!-- MC-38407-->

* 的 `category` 在禁用URL重写的情况下，查询现在可返回类别图像的正确路径。

<!-- MC-36648 8321-->

* 的 `resetPassword` 现在，当发生错误时，变异会返回信息更丰富的消息。 [GitHub-30179](https://github.com/magento/magento2/issues/30179)

<!-- MC-38078 ENGCOM-8504-->

* 的缓存结果 `products` 当产品位置发生更改时，查询会按预期失效。 [GitHub-30467](https://github.com/magento/magento2/issues/30467)

<!-- MC-35355 ENGCOM-8404-->

* 的 `products` 现在，查询在 `category_id` 过滤器是使用 `in` 关键词。 [GitHub-30349](https://github.com/magento/magento2/issues/30349)

<!-- ENGCOM-8373 -->

* 的 `categories` 和 `categoryList` 查询现在可以根据类别权限配置和父类别ID来考虑类别可用性。 [GitHub-29880](https://github.com/magento/magento2/issues/29880), [GitHub-30624](https://github.com/magento/magento2/issues/30624)

<!-- MC-37603-->

* 的 `updateProductsInWishList` 变异现在可正确验证希望列表项目。 [GitHub-30467](https://github.com/magento/magento2/issues/30467)

<!-- ENGCOM-8430 PWA-1107-->

* 在 `ProductInterface` 和 `CategoryInterface` 防止他们在店面使用。 [GitHub-30625](https://github.com/magento/magento2/issues/30625)

* 现在，当将类别权限设置为隐藏价格时，价格会在产品查询结果中隐藏。 [GitHub-29926](https://github.com/magento/magento2/issues/29926)

<!-- MC-36898 PWA-1299-->

* 您现在可以使用 `addProductsToWishList` 突变，将具有用户定义量的捆绑产品添加到愿望清单。

<!-- MC-36946 -->

* 添加到购物车操作的GraphQL响应时间已得到改进。

<!-- ENGCOM-8099 -->

* 的 `products` 查询现在可按预期返回层价值。 [GitHub-29168](https://github.com/magento/magento2/issues/29168)

<!-- ENGCOM-7528 -->

* 删除了冗余 `getMappedNums` 从循环 `lib/internal/Magento/Framework/GraphQl/Query/EnumLookup.php`. [GitHub-30031](https://github.com/magento/magento2/issues/30031)

<!-- ENGCOM-8172 -->

* 的 `products` 当查询的产品具有禁用的相关产品时，查询不再返回错误。 [GitHub-28892](https://github.com/magento/magento2/issues/28892)

<!-- MC-37395 -->

* 的 `cart` 查询现在会返回已转换为正确货币（默认显示货币）的价格。 以前，查询以基本货币返回项目价格值，并将货币代码返回为默认显示货币。

<!-- MC-37388-->

* GraphQL现在遵循目录权限。 应用程序可限制为 `products` 基于购物者客户群组的查询。

<!-- MC-39690-->

* 添加了 `customizable_option` 属性添加到实施 `CartItemInterface`.

<!-- MC-39744-->

* 添加了 `storeConfig` 查询以返回商店、商店组和网站信息。

<!-- MC-37414-->

* 恢复 `SelectedCustomizableOption.type` 属性。 此外， `customizable_options` 属性 `CartItemInterface` 现在为非空。

<!-- MC-23860-->

* 的搜索功能 `products` 查询不再返回已启用类别权限的项目。

<!-- MC-37726-->

* 的 `products` 查询为具有多种货币的商店视图返回正确的货币。

<!-- MC-37727-->

* 标签 `products` 查询过滤器现在会返回翻译后的值（如果适用于非默认存储视图）。

<!-- MC-37728-->

* 在购物车的礼品卡上固定存货额。

<!-- MC-38443-->

* 添加了 `ConfigurableProductOptionsSelection` 数据类型，其中包含与产品的可选配置选项对应的元数据。 在 `products` 查询，以在购物者选择可配置产品选项时最大限度地减少显示的媒体集项目数量。

### 图像

<!-- MC-36942-->

* 现在，商店主页上的图像已成功呈现。 以前，页面源HTML已损坏，因为图像base64代码中的三个连续斜杠被错误地解释为注释。

<!-- ENGCOM-8116 -->

* 对 `fileinfo` 扩展已从CMS模块中删除。 以前，当您尝试使用图像上载器上传图像时，应用程序会抛出错误，该加载器会在您单击 **插入图像** 按钮。 [GitHub-24332](https://github.com/magento/magento2/issues/24332), [GitHub-16531](https://github.com/magento/magento2/issues/16531), [GitHub-29852](https://github.com/magento/magento2/issues/29852)

<!-- ENGCOM-8020 -->

* 增加了对读取的支持 `exif_image.png` 或 `exif-image.jpeg` 元数据。 [GitHub-1449](https://github.com/magento/adobe-stock-integration/issues/1449)

<!-- ENGCOM-8296 -->

* CMYK图像颜色现在可正确呈现。 现在，当Imagick适配器检测到打开的图像具有CMYK色彩空间时，色彩空间将转换为SRGB。 以前，这些图像会以反向颜色呈现。 [GitHub-22375](https://github.com/magento/magento2/issues/22375)

<!-- ENGCOM-8251 -->

* 不再为设置布尔值 `image_with_border.phtml`. 冗余 `max-width` 和 `height` 从 `.product-image-photo`. （这些值已通过重置样式在图像上全局设置。） [GitHub-30186](https://github.com/magento/magento2/issues/30186)

### 导入/导出

<!-- MC-35081-->

* 客户地址 `region_id` 不再分配 `NULL` 值（使用CSV文件导入客户地址时）(`entity type = "customer address"` 和 `import behavior = "add/update"`)删除了某些字段值。

<!-- MC-35295-->

* 现在，您可以在导入期间隐藏店面上的产品图像。

<!-- MC-35836-->

* 当导入的产品 `qty` 设置为0但 `is_in_stock set` 若为1，则产品不会列在类别页面上，并且产品详细信息页面会将其标识为无现货。 以前，导入后，具有这些值的产品会显示在店面中。

<!-- MC-38433-->

* CSV导入不再忽略 `dropdown` 和 `textarea` 其他属性的值。 以前，导入期间不会更新这些属性值。

<!-- MC-37933-->

* 现在，产品导出CSV文件会按预期显示在导出CSV文件的管理员列表中。 以前，当您运行以下命令时，应用程序会引发错误： `bin/magento queue:consumers:start exportProcessor --single-thread --max-messages=10000`.

<!-- MC-37672-->

* 在导入包含孟加拉语（孟加拉语）字母字符的CSV数据时，应用程序不再引发错误。

<!-- MC-36410-->

* 现在，当管理员单击 **检查数据** 在Chrome中工作时，在导入自导出后更改的文件期间。 以前，应用程序显示控制台错误，但没有告诉用户如何继续。

<!-- ENGCOM-8252 -->

* 在您多次导入同一产品CSV数据时，应用程序不再复制产品图像。 [GitHub-21885](https://github.com/magento/magento2/issues/21885)

<!-- ENGCOM-8262 -->

* 在 `vendor/magento/framework/File/Uploader.php` 已被删除。  以前，目录和文件名长度不能超过255个字符。 应用程序导入的产品的图像文件名称超过此限制，但未导入图像文件。 [GitHub-29377](https://github.com/magento/magento2/issues/29377)

<!-- ENGCOM-8153 -->

* 现在可以成功将优惠券代码导出到CSV或XML。 以前，应用程序在您单击 **导出CSV** 或 **导出XML** 你试着出口优惠券。 [GitHub-29277](https://github.com/magento/magento2/issues/29277)

<!-- ENGCOM-8252 -->

* 现在，在导入包含图像的CSV文件后，会删除重复的产品图像。 [GitHub-14398](https://github.com/magento/magento2/issues/14398), [GitHub-21885](https://github.com/magento/magento2/issues/21885)

### 索引

<!-- MC-38003-->

* 改进了部分索引器的性能。 现在，应用程序会清除每次1000 ID批量迭代中更改的缓存ID。 缓存上下文不再累计ID。 以前，每个1000-ID批量小版本的缓存上下文累积缓存ID，并在每个小版本上清除相同的ID集。

<!-- ENGCOM-7929 -->

* 部分重新索引系统与完整重新索引系统之间的不一致已得到纠正。 现在，两个索引系统都使用了相同的代码，这些代码可以正确工作。 以前，两个索引系统对共享索引器使用不同的逻辑，这可能导致索引器在每次运行部分重新索引系统后失效。 [GitHub-29478](https://github.com/magento/magento2/issues/29478), [GitHub-29297](https://github.com/magento/magento2/issues/29297)

<!-- MC-38168-->

* 我们解决了手动索引器存在的问题，该问题会导致类别页面为空或类别页面上的产品计数减少。 在以下情况下，发生类别页面或产品计数不完整的问题：

   * the `catalogsearch_fulltext` 和 `catalog_product_price` 部分索引器在大型目录上执行，直到这些索引器完成执行。

   * 在 `catalog_category_product` 或 `catalog_product_category` 指数，同时对其中一个指数执行完整的重新索引。 这两个索引过程可能会发生冲突，从而导致类别页面中缺少产品。

   * `bin/magento indexer:reindex inventory` 在大目录中执行。 类别页面中缺少产品，直到 `catalogsearch_fulltext` 部分索引器已完成执行。

<!-- MC-39700-->

* 索引器已添加到 `Magento_Bulk` MySQL表，它改进了批量操作的性能。

<!-- MC-38806-->

* 现在，重新索引后，数据库表中的注释可准确反映表状态(`bin/magento indexer:reindex`)。 以前，重新索引后的表注释包含的值与新安装后包含的注释相同。

<!-- ENGCOM-7542 -->

* 的 `SELECT entity_id IN` 在实施MariaDB v.10.3.18的部署中，语句已得到改进，这改进了目录类别索引的性能。 [GitHub-25199](https://github.com/magento/magento2/issues/25199)

<!-- ENGCOM-8237 -->

* Magento Open Source通过消除每个索引器实例多次刷新标记来改进缓存性能。 [GitHub-29890](https://github.com/magento/magento2/issues/29890)

### 基础架构

<!-- MC-34353-->

* 您现在可以使用 `app/etc/env.php` 将消息代理从MYSQL更改为AMQP。

<!-- MC-38242-->

* 相关JavaScript库中已更正了产品数量小数值的余数计算问题。 应用程序先前错误地计算了超过两位的小数分数，随后显示了错误消息。

<!-- MC-38993 ENGCOM-8473-->

* 的 `\Magento\Authorization\Model\Rules::update` 方法已弃用。  [GitHub-29128](https://github.com/magento/magento2/issues/29128)

<!-- ENGCOM-8000 -->

* 在从UTC转换日期对象时，应用程序不再引发致命错误。 以前，在特定条件下， `convertConfigTimeToUtc` 方法引发异常。 [GitHub-29525](https://github.com/magento/magento2/issues/29525)

<!-- ENGCOM-7987 -->

* `DataObject` 已替换为 `\Magento\MediaGalleryCatalogUi\Ui\Component\Listing\Columns\Thumbnail::prepareDataSource`.[GitHub-1711](https://github.com/magento/adobe-stock-integration/issues/1711)

<!-- ENGCOM-7914 -->

* 的 `RequireJS` 解析程序不再无法检测到阻止的资源。 以前，解析程序未正确检测页面上的所有资源是否已加载或处理得当，并且页面仍在加载。 [GitHub-28116](https://github.com/magento/magento2/issues/28116)

<!-- ENGCOM-8229 -->

* 属性存储库代码验证现在遵循 `Magento\Eav\Model\Entity\Attribute::ATTRIBUTE_CODE_MAX_LENGTH` 而不是硬编码值。 [GitHub-29017](https://github.com/magento/magento2/issues/29017)

<!-- MC-35699-->

* HTML缩小不再从PHTML文件中的HTML字符串中去除三个斜杠(///)。 以前，在缩小过程中会将三斜杠解释为注释，并且在部署时会在生成的PHTML文件中完全删除其余的行。

<!-- MC-38201-->

* 商家现在可以在表列级别而不是表级别上配置索引器订阅。 向添加了新参数 `\Magento\Framework\Mview\View\Subscription` 允许对特定视图或表组合忽略列。 [GitHub-30243](https://github.com/magento/magento2/issues/30243)

<!-- MC-30171-->

* 单击 **添加到购物车** 按钮，此时产品页面JavaScript已完全初始化，不会再导致重复 `form_key` 值。 以前，可以将产品添加到购物车并缓存 `form_key` 触发异常的值。 When **添加到购物车** 在JavaScript完全初始化之前被单击，然后 `form_key` 表单数据中发送的值与用户会话不匹配，并且产品未添加到购物车。 [GitHub-13746](https://github.com/magento/magento2/issues/13746)

<!-- ENGCOM-8107 -->

* 当前的cURL客户端现在采用不区分大小写的标头名称。 以前， `Set-Cookie` 比较区分大小写，这可能会导致某些HTTP服务器出现问题。 [GitHub-29524](https://github.com/magento/magento2/issues/29524)

<!-- ENGCOM-8360 -->

* 更新了 `api-functional` 和测试用例XML文件。 [GitHub-30552](https://github.com/magento/magento2/issues/30552)

<!-- ENGCOM-8295 -->

* 向目录产品选项值集合中添加了事件前缀和事件对象，以改进集合加载的自定义 `\Magento\Catalog\Model\ResourceModel\Product\Option\Value\Collection`. [GitHub-29621](https://github.com/magento/magento2/issues/29621)

<!-- ENGCOM-8261 -->

* 所有发生的 `array_merge` 已重构为使用编码标准中推荐的格式。 [GitHub-30005](https://github.com/magento/magento2/issues/30005)

<!-- ENGCOM-7718 -->

* A `head.additional` 类型块 `\Magento\Framework\View\Element\Text\ListText` 已添加到 `adminhtml` `default` 布局(按 `magento2/module-base`)。 [GitHub-29165](https://github.com/magento/magento2/issues/29165)

<!-- ENGCOM-8312 -->

* 向布局模板模块小组件添加了缺失的转义URL方法。 [GitHub-30036](https://github.com/magento/magento2/issues/30036)

<!-- ENGCOM-8127 -->

* 的 `\Magento\Framework\Filesystem\Io\File::read()` 方法现在与 `\Magento\Framework\Filesystem\Io\IoInterface::read()`. [GitHub-27866](https://github.com/magento/magento2/issues/27866)

### 克拉纳

* 删除了对PayPal模块的依赖项。 [GitHub-29421](https://github.com/magento/magento2/issues/29421)

### 记录

<!-- ENGCOM-8443 -->

* 的 `Magento_Logging` 模块现在可正确注册新值以及前面的值。 以前，Value Before Change（更改前值）列中的值显示为N/A，无论这是第一次更改还是下一次更改，还是返回默认值。 [GitHub-26943](https://github.com/magento/magento2/issues/26943)

### 媒体集

<!-- ENGCOM-8014 -->

* 管理员 **商店**  >  **配置**  >  **高级**  >  **系统** 页面已更新，以显示正确的产品名称（媒体集）。 对用户界面进行了细微的重新设计。 [GitHub-1738](https://github.com/magento/adobe-stock-integration/issues/1738)

<!-- ENGCOM-8019 -->

* 媒体集图像描述的“在中使用”部分中的链接现在会显示按选定图像过滤的网格（如预期）。 以前，显示的网格的标题不正确，列表条目也不准确。 [GitHub-1694](https://github.com/magento/adobe-stock-integration/issues/1694)

<!-- ENGCOM-8019 -->

* 您现在可以成功地在媒体库中编辑多个图像。 以前，在向一个图像添加标记后，您无法向另一个图像添加标记。 [GitHub-1755](https://github.com/magento/adobe-stock-integration/issues/1755)

<!-- ENGCOM-8015 -->

* 现在，在从媒体集的图像中删除标记后，“标记”下拉菜单按预期为空。  [GitHub-1703](https://github.com/magento/adobe-stock-integration/issues/1703)

<!-- ENGCOM-8146 -->

* 现在支持对媒体集同步队列消息进行批处理。 [GitHub-1724](https://github.com/magento/adobe-stock-integration/issues/1724)

<!-- ENGCOM-8064 -->

* 现在，当您尝试在 **增强的媒体集** 已禁用。 [GitHub-1760](https://github.com/magento/adobe-stock-integration/issues/1760)

<!-- ENGCOM-8072 -->

* `MediaGalleryMetadata` 现在，如果出现异常，会跳过区段读取器，而是会解析并显示预期的图像元数据。 以前，由于 `exif_read_data` 区段读取器。 [GitHub-1782](https://github.com/magento/adobe-stock-integration/issues/1782)

<!-- ENGCOM-8069 -->

* 文件夹名称长度不再阻止图像上传到媒体集。 媒体集现在将路径列设置为类型 `text`. [GitHub-1778](https://github.com/magento/adobe-stock-integration/issues/1778)

<!-- ENGCOM-8217 -->

* 现在，当从媒体库插入演绎版时，图像上传程序会显示正确的图像大小。 [GitHub-1806](https://github.com/magento/adobe-stock-integration/issues/1806)

<!-- ENGCOM-8467 -->

* 路径验证已添加到 `Mediagallery` uploader插件。 以前，验证失败，并且应用程序在 **启用旧媒体集** 已禁用。 [GitHub-30649](https://github.com/magento/magento2/issues/30649)

<!-- ENGCOM-8057 -->

* `Magento_Cms::media_gallery` 已为新媒体集添加并强制实施ACL子资源，以支持为以下离散操作配置的权限：

   * 上传资产
   * 将资产插入内容
   * 删除资产
   * 创建文件夹
   * 删除文件夹。 [GitHub-1487](https://github.com/magento/adobe-stock-integration/issues/1487)

<!-- ENGCOM-8047 -->

* 长媒体集文本字符串和文件夹名称不再被裁剪。 以前，应用程序会显示裁剪的文本和图像，并显示以下消息：  `We couldn't find any records`. [GitHub-1763 ](https://github.com/magento/adobe-stock-integration/issues/1763), [GitHub-1758 ](https://github.com/magento/adobe-stock-integration/issues/1758)

<!-- ENGCOM-8042 -->

* 应用程序不再显示 **添加选定项** 按钮。 [GitHub-1769](https://github.com/magento/adobe-stock-integration/issues/1769)

<!-- ENGCOM-8047 -->

* 现在，可以按预期在 **内容**  >  **媒体集** 类别网格。 [GitHub-1763 ](https://github.com/magento/adobe-stock-integration/issues/1763)

<!-- ENGCOM-8183 -->

* 库乘法断点选项配置现在可按预期工作。 以前，断点选项配置无法正常工作，因为 `mediaCheck` 页面加载时触发了退出媒体查询函数。 [GitHub-29933](https://github.com/magento/magento2/issues/29933)

### MFTF

<!-- ENGCOM-8359 -->

* 将重复操作替换为 `CheckStaticBlocksTest`. [GitHub-30561](https://github.com/magento/magento2/issues/30561)

<!-- ENGCOM-8267 -->

* `AdminUpdateCategoryAndMakeInactiveTest` 和 `VerifyChildCategoriesShouldNotIncludeInMenuTest` 已重构，以符合MFTF最佳做法。 [GitHub-30058](https://github.com/magento/magento2/issues/30058)

<!-- ENGCOM-8458 -->

* 已删除重复项 `AdminOpenCMSBlocksGridActionGroup`. [GitHub-30896](https://github.com/magento/magento2/issues/30896)

<!-- ENGCOM-8156 -->

* 已更换 `AdminOpentCmsBlockActionGroup` 和AdminOpenCmsBlockActionGroup。 [GitHub-29839](https://github.com/magento/magento2/issues/29839)

<!-- ENGCOM-8226 -->

* 已弃用 `GoToAttributeGridPageActionGroup`. [GitHub-30103](https://github.com/magento/magento2/issues/30103)

<!-- ENGCOM-8061 -->

* 向 `Analytics` 模块。 [GitHub-29500](https://github.com/magento/magento2/issues/29500)

<!-- ENGCOM-7334 -->

* 已更新 `CheckCheckoutSuccessPageAsRegisterCustomerTest` 和 `CheckCheckoutSuccessPageAsGuestTest` ，以在测试运行后取消创建的订单。 [GitHub-28324](https://github.com/magento/magento2/issues/28324)

<!-- ENGCOM-8214 -->

* 已删除 `AdminNavigateToPageGridActionGroup` 由于冗余。 [GitHub-29838](https://github.com/magento/magento2/issues/29838)

<!-- ENGCOM-8122 -->

* 已实施 `ActionGroup` 导航到结帐页面。 [GitHub-29843](https://github.com/magento/magento2/issues/29843)

<!-- ENGCOM-8124 -->

* 已实施 `AdminOpenCreateNewCMSPageActionGroup` ，以导航到创建新的CMS页面。 [GitHub-29824](https://github.com/magento/magento2/issues/29824)

<!-- ENGCOM-8268 -->

* 更正了媒体集的MFTF CMS页面测试中与跳过有关的问题。 [GitHub-30164](https://github.com/magento/magento2/issues/30164)

#### 新测试

<!-- ENGCOM-7804 -->

* 添加了用于向管理员中的朋友发送电子邮件的测试。 [GitHub-29145](https://github.com/magento/magento2/issues/29145)

<!-- ENGCOM-8316 -->

* 添加了管理员从网格中删除CMS块的测试。 [GitHub-30372](https://github.com/magento/magento2/issues/30372)

<!-- ENGCOM-7933 -->

* 添加了将购物车规则应用于单个捆绑项目的测试。 [GitHub-28921](https://github.com/magento/magento2/issues/28921)

<!-- ENGCOM-8075 -->

* 添加了测试以检查 **在中使用** 在删除实体后，将显示媒体集图像的信息。 [GitHub-1774](https://github.com/magento/adobe-stock-integration/issues/1774)

#### 新操作组

* `AssertStorefrontCustomerLogoutSuccessPageActionGroup`. [GitHub-29841](https://github.com/magento/magento2/issues/29841) <!-- ENGCOM-8121 -->

* `AdminOpenConfigurationStoresPageActionGroup`. [GitHub-29848](https://github.com/magento/magento2/issues/29848) <!-- ENGCOM-8259 -->

* `ReloadPageActionGroup`. [GitHub-30683](https://github.com/magento/magento2/issues/30683) <!-- ENGCOM-8394 -->

* `StorefrontClickRefundTabCustomerOrderViewActionGroup`. [GitHub-30032](https://github.com/magento/magento2/issues/30032) <!-- ENGCOM-8203 -->

* `AdminOpenAdminThreeDSecurePageActionGroup`. [GitHub-29845](https://github.com/magento/magento2/issues/29845) <!-- ENGCOM-8115 -->

* `AdminCustomerClickFirstRowEditLinkActionGroup`.  [GitHub-29501](https://github.com/magento/magento2/issues/29501) <!-- ENGCOM-8043 -->

* `StorefrontClickAddToCartButtonActionGroup`. [GitHub-29823](https://github.com/magento/magento2/issues/29823) <!-- ENGCOM-8113 -->

* `AdminDeleteTaxRateActionGroup`. [GitHub-29940](https://github.com/magento/magento2/issues/29940) <!-- ENGCOM-8192 -->

* `AdminOpenWebConfigurationPageActionGroup`. [GitHub-29846](https://github.com/magento/magento2/issues/29846) <!-- ENGCOM-8126 -->

* `AdminOpenGeneralConfigurationPageActionGroup`. [GitHub-29847](https://github.com/magento/magento2/issues/29847) <!-- ENGCOM-8114 -->

* `AdminOrderClickSubmitOrderActionGroup`. [GitHub-29649](https://github.com/magento/magento2/issues/29649) <!-- ENGCOM-8023 -->

* `AdminOpenCatalogProductPageActionGroup`. [GitHub-29941](https://github.com/magento/magento2/issues/29941) <!-- ENGCOM-8209 -->

* `AdminClickInvoiceButtonIntoOrderActionGroup`. [GitHub-25399](https://github.com/magento/magento2/issues/25399) <!-- ENGCOM-8210 -->

* `AdminGridBulkActionGroup`. [GitHub-28324](https://github.com/magento/magento2/issues/28324)<!-- ENGCOM-7334 -->

* `AdminGridColumnShowActionGroup`. [GitHub-28324](https://github.com/magento/magento2/issues/28324)<!-- ENGCOM-7334 -->

* `AdminOpenIndexManagementPageActionGroup`. [GitHub-29825](https://github.com/magento/magento2/issues/29825) <!-- ENGCOM-8123 -->

* `AdminOpenCatalogSearchTermIndexPageActionGroup`. [GitHub-29844](https://github.com/magento/magento2/issues/29844) <!-- ENGCOM-8128 -->

* `AdminClickAddProductToggleAndSelectProductTypeActionGroup`. [GitHub-30917](https://github.com/magento/magento2/issues/30917) <!-- ENGCOM-8439 -->

* `StorefrontCheckoutClickSaveAddressButtonActionGroup`. [GitHub-30916](https://github.com/magento/magento2/issues/30916) <!-- ENGCOM-8454 -->

* `AdminOpenCurrencyRatesPageActionGroup`. [GitHub-30783](https://github.com/magento/magento2/issues/30783) <!-- ENGCOM-8432 -->

* `AdminClickGetShippingMethodsAndRatesActionGroup`. [GitHub-30782](https://github.com/magento/magento2/issues/30782) <!-- ENGCOM-8436 -->

* `AdminSelectFixedShippingMethodActionGroup`. [GitHub-30782](https://github.com/magento/magento2/issues/30782) <!-- ENGCOM-8436 -->

* `StorefrontClickProceedToCheckoutActionGroup`. [GitHub-30926](https://github.com/magento/magento2/issues/30926) <!-- ENGCOM-8438 -->

* `StorefrontOpenMyAccountPageActionGroup`. [GitHub-29842](https://github.com/magento/magento2/issues/29842) <!-- ENGCOM-8143 -->

### 新闻稿

<!-- MC-38789-->

* 管理员用户现在可以在客户订阅排队的新闻稿时，按预期编辑客户帐户。 [GitHub-30645](https://github.com/magento/magento2/issues/30645)

<!-- ENGCOM-8034 -->

* 如果购物者未确认其新闻稿订阅，则应用程序现在会重新发送新闻稿订阅确认。 [GitHub-28422](https://github.com/magento/magento2/issues/28422)

<!-- ENGCOM-8429 -->

* 现在，当客户订阅排队的新闻稿时，您可以按预期编辑客户帐户。 [GitHub-30645](https://github.com/magento/magento2/issues/30645)

### 付款方法

<!-- MC-35161-->

* 现在，在多商店部署中，所有网站的付款方法都会按照预期加载到管理员中。

<!-- MC-35152-->

* 当购物者的名称包含带重音的字母时，应用程序现在可成功完成Payflow Pro付款。 以前，付款未完成，应用程序记录了以下错误： `report.CRITICAL: String to be escaped was not valid UTF-8 or could not be converted`.

#### PayPal

<!-- MC-35692-->

* 在从使用信用卡的付款方法切换到非信用卡付款方法后，商家现在可以成功地从管理员下单。 以前，当商户单击 **提交订单** 按钮，则加载过程已开始但从未完成，并且未下订单。

<!-- MC-37649-->

* 在使用PayPal Express下达订单后，应用程序不再创建重复订单。 以前，当购物者尝试通过PayPal Express支付订单，但PayPal返回错误时，应用程序仍会创建订单。 这会导致商户网站上出现重复订单。 [GitHub-13952](https://github.com/magento/magento2/issues/13952)

<!-- MC-38829-->

* PayPal结算报表现在位于 **报表** > **销售** > **PayPal结算** 如预期。 以前，应用程序未在PayPal结算报表网格中列出这些报表，并显示以下消息： `We couldn't find any records`.

<!-- MC-39442-->

* 单击 **PayPal** 按钮在结帐期间不再触发冗余 `web-api` 呼叫。 以前，触发了两个请求，使产品费用翻了一番。

<!-- ENGCOM-8173 -->

* 现在，来宾购物者可以在 **自动分配给客户组** 启用。 付款在PayPal网关上处理，订单在Magento中创建，购物者会看到订单感谢页面。 以前，在PayPal网关上成功处理了订单，但订单未在Magento Open Source中创建。 购物者而是被重定向到订单审核页面，应用程序在该页面中显示以下错误： `Failed address validation: %1" error`. [GitHub-25399](https://github.com/magento/magento2/issues/25399)

### 性能

<!-- MC-37705-->

* 中的性能问题 `module-catalog-import-export/Model/Import/Product/Option.php` 已被处理。 出口或进口超过100 000条记录所需的时间已减少。 请参阅 [由于有大量产品选项，导入/导出所花费的时间比预期长](https://support.magento.com/hc/en-us/articles/360050695772) 知识库文章。

<!-- MC-37799-->

* `Magento_Csp/Model/BlockCache` 已重构以减少内存消耗和生成不必要的大缓存字符串。 以前，包含动态列入白名单的脚本和样式的页面通常会因性能问题而出现问题。 [GitHub-29964](https://github.com/magento/magento2/issues/29964)

<!-- MC-37816 -->

* 我们改进了计划产品目录出口的性能，这些产品包括100,000多种使用消费者的产品。

<!-- MC-38306 -->

* 在向类别添加或保存禁用的产品时，应用程序不再刷新类别缓存。 以前，应用程序会刷新相关类别的缓存，尽管产品状态会影响服务器性能。

<!-- MC-38518 -->

* 更新购物车中产品数量的页面加载时间已缩短。 以前，应用程序会针对购物车中的每个产品执行多个单独的查询，这会增加页面加载时间。

<!-- MC-39700 -->

* 索引器已添加到 `Magento_Bulk`  MySQL表，它改进了批量操作的性能。

<!-- MC-38593 -->

* 现在，应用程序会缓存可配置产品的子ID。 这通过减少数据库请求数量提高了页面加载性能。 [GitHub-30585 ](https://github.com/magento/magento2/issues/30585)

<!-- MC-37594 -->

* 管理功能板的加载已得到改进。 以前，应用程序在页面完成加载之前将选项卡名称显示为列表。

<!-- MC-37417 -->

* 通过为布局缓存添加到期限制，红色缓存管理已得到改进。 以前，在大型部署中，Redis缓存会快速达到分配的最大内存，并且应用程序在写操作中出错。

<!-- ENGCOM-8016 -->

* 通过删除 `app/code/Magento/Catalog/Model/CategoryLink.php`. [GitHub-29453](https://github.com/magento/magento2/issues/29453)

<!-- ENGCOM-8290 -->

* `Magento\Framework\DB\Adapter\Pdo\Mysql->isTableExists` 已进行重构以提高性能。 冗余调用 `SHOW TABLE STATUS` 检查表是否存在已减少。 [GitHub-29662](https://github.com/magento/magento2/issues/29662)

<!-- ENGCOM-8258 -->

* `getPageLayoutsConfig` 现在保存在缓存中，这改进了配置生成器性能。 [GitHub-29546](https://github.com/magento/magento2/issues/29546)

### 永久

<!-- MC-36647 -->

* 启用永久购物车后，购物者在其会话Cookie过期后无法再下订单。 相反，应用程序会显示登录页面，以便购物者可以登录。 以前，应用程序会按顺序排列。 当 `PHPSESSID` 已过期，并且 `customerSession` 已从永久信息重新创建。

<!-- MC-39127-->

* 现在，在购物者登录到启用了永久性购物车的商店后，应用程序会按预期显示欢迎消息。 以前，应用程序会在 **不是你？** 消息。

<!-- MC-38269-->

* 应用程序不再显示 **不是你？** 当客户选择 **记住我** 登录到启用了永久性购物车的部署时，会显示此选项。

<!-- MC-37109-->

* 客户会话过期后，应用程序不再显示客户购物车的内容。 以前，当来宾客户尝试在启用永久性购物车时签出时，应用程序会显示此错误： `No such entity with cartid = 0`.

### 定价

<!-- MC-34394-->

* 连续的异步价格更新不再相互干扰，并且会为每个操作分配正确的状态。 以前，如果异步价格更新失败，则所有后续的异步价格更新都将失败，直到重新启动相应的队列使用者为止。 [GitHub-27865](https://github.com/magento/magento2/issues/27865)

### 报告

<!-- MC-36652 38925-->

* **报表** > **营销** > **购物车中的产品** 现在，只显示生成报表的用户所允许范围内的记录。 以前，所有数据都可用于所有范围。

<!-- MC-38074-->

* 现在，在购物车中的产品报表中显示产品货币时，应用程序使用在生成报表的商家的角色范围中指定的货币。

<!-- MC-37934-->

* “最近查看”和“最近比较”产品功能现在可以在多商店部署中按预期显示管理员中不同商店和网站的统计信息。 以前，这些功能未考虑所有商店或网站。

<!-- MC-37217-->

* 订单报表中的价格现在使用正确的货币符号。

<!-- ENGCOM-8314 -->

* 现在，当用户单击管理功能板时，应用程序会验证令牌是否存在 **转到高级报表** 按钮。  如果令牌存在，则应用程序会显示“高级报表”页面。 如果未配置令牌，应用程序将在用户指南中显示一个信息页面。 [GitHub-25411](https://github.com/magento/magento2/issues/25411)

### 评论

<!-- MC-37117-->

* 现在，当您单击 **新审阅** 按钮 **营销** > **所有评论**. 单击此页面上的某个产品将打开该产品的预期新审阅表单。

<!-- ENGCOM-8383 -->

* 当您尝试从管理员编辑订单时，应用程序不再引发此错误 **营销**  >  **所有评论**: `Uncaught TypeError: Event.observe is not a function`.  [GitHub-30388](https://github.com/magento/magento2/issues/30388)

### 销售

<!-- MC-36219-->

* 的 `order_created_at` 列 `sales_shipment_grid` 现在会在每次更新后按预期进行更新。

<!-- MC-36405-->

* 现在，您可以成功地从对其具有自定义选项日期的商店重新订购产品， **使用JavaScript日历** 启用。 以前，当您尝试重新订购时，应用程序不会将项目添加到购物车并显示此错误： `Could not add the product with SKU "simp1" to the shopping cart: Please specify date required option(s).`

<!-- MC-36533-->

* 在启用了零小计结账方法的部署中，当购物者签出由总成本为$0的虚拟产品组成的订单时，应用程序不再立即关闭订单。

<!-- MC-36755-->

* 应用程序在处理订单之前不再存档订单。 以前，“管理订单”网格上的多选操作会影响未选定的订单。

<!-- MC-37371-->

* 现在，当沙特里亚尔(SAR)设置为基本货币时，贷项通知单网格会显示正确的货币符号。

<!-- MC-37880-->

* 现在，在结帐过程中，应用程序可以始终如一地在订单页面上显示送货地址信息。

<!-- MC-38666-->

* 的值 `total_qty` 现在与的值匹配 `total_qty_ordered` 在销售发票中。

<!-- MC-38717-->

* 现在，异步发送销售电子邮件只会发送在上次更新日期之后创建的订单的电子邮件。 以前，在启用异步发送的情况下，应用程序不会按日期过滤电子邮件。

<!-- MC-39135-->

* 现在，当从管理员处下订单时，应用程序会按预期发送发票电子邮件。

<!-- MC-38917-->

* 现在，当商家从管理员为客户创建新订单时，应用程序会在会话期间清除现有订单数据。

<!-- MC-38915-->

* 现在，您可以在 **启用对客户组的自动分配** 启用。 您还可以根据增值税验证来分配客户组。 以前，在验证增值税编号时，请求对象不会检查分配的请求 `group_id`. 默认情况下，它使用默认 `group_id`.

<!-- MC-37539-->

* 应用程序不再通过 `Suspected Fraud` 状态为 `Processing` 在商户使用REST API创建部分装运后。

### 销售规则

<!-- MC-34793-->

* 当购物者更改发运方法时，将不再应用已基于发运方法应用的优惠券代码。 以前，当购物者切换送货方法时，应用程序不会清除优惠券代码。

<!-- MC-34649-->

* 购物者应用优惠券代码的频率不能比 **每位客户的使用次数** 设置允许。 以前，如果购物者打开了多个浏览器窗口并同时下了多个订单，则每个订单都会收到折扣，即使 **每位客户的使用次数** 设置的值为 **1**.

### 搜索

<!-- MC-35095-->

* Elasticsearch在购物者搜索搜索同义词时不再引发未知修饰符错误。 以前，转义器在正则表达式中缺少转义斜杠符号，这会导致致命错误。

<!-- MC-37577-->

* 当将子产品配置为可见性设置为时，高级搜索不再将可配置产品的子项作为单个搜索结果返回 **不单独显示**.

<!-- MC-37954-->

* 搜索结果中产品名称的Elasticsearch排序不再区分大小写。

<!-- ENGCOM-8329 -->

* 搜索结果页面现在会在 **将排名最前的搜索结果数设置为缓存0** 设置 **商店**  >  **配置**  >  **目录**  >  **目录**  > **目录搜索**.

<!-- MC-36807-->

* 由于Elasticsearch字段限制，目录搜索索引器现在执行时不会引发错误。 以前，应用程序会引发以下错误： `Limit of total fields [xxx] in index [m24dev_product_1_v10] has been exceeded`.

<!-- MC-35491-->

* 目录搜索性能已得到改进。 禁用 **启用搜索建议** (**商店** > **配置** > **目录** > **目录搜索** )可按预期工作。 以前，应用程序查询MySQL `search_query` 表格，而不是Elasticsearch以自动完成搜索建议。 [GitHub-25534](https://github.com/magento/magento2/issues/25534)

<!-- MC-35256-->

* Elasticsearch现在可以按与MySQL相同的方式过滤产品价格。 字段类型 `price_*`  从 `float` to `double` 在Elasticsearch索引中，以提高精度并纠正浮点误差。

<!-- ENGCOM-8393 -->

* 已向管理员添加了一个按键事件侦听器，用于在输入正斜杠时激活全局搜索表单。 [GitHub-29551](https://github.com/magento/magento2/issues/29551)

<!-- MC-24217-->

* Elasticsearch不再引发错误，而是会在 `string` 值用于按属性筛选产品，其中 `integer` 或 `decimal` 后端类型。 以前，应用程序在 `exception.log`: `number format exception`.

<!-- ENGCOM-8303 -->

* Elasticsearch在搜索词包含  `/`.  [GitHub-25886](https://github.com/magento/magento2/issues/25886), [GitHub-25110](https://github.com/magento/magento2/issues/25110)

* 现在，当 **禁止目录搜索依据** “常规类别权限”中的配置设置已启用。 [GitHub-29927](https://github.com/magento/magento2/issues/29927)

<!-- ENGCOM-8466 -->

* 搜索结果中不再包含同一词语的多个引号。 [GitHub-30104](https://github.com/magento/magento2/issues/30104)

### 装运

<!-- MC-38247 -->

* 当网络中断中断与DHL发送方法的连接时，结帐过程不再失败。 而是应用程序显示其他可用的发运方法。 以前，当与DHL的连接中断时，结帐过程会停止，应用程序会显示以下错误： `Sorry, no quotes are available for this order at this time`. [GitHub-29902](https://github.com/magento/magento2/issues/29902)

<!-- MC-35194-->

* 描述管理员上UPS交付方法的字段 **商店** > **配置** > **销售** > **投放方法** 现在已按预期启用。

<!-- MC-35633-->

* 通过POST创建的发运 `/rest/V1/shipment` 端点现在可以正确更新订单。 以前，应用产品创建了发运，但发运状态仍处于处理状态。

<!-- MC-37120-->

* 当另一个产品在结帐前从购物车中移除，并且带有“收货地址”时，应用程序将不再从购物车中移除简单产品。 [GitHub-30259](https://github.com/magento/magento2/issues/30259)

<!-- MC-38031-->

* 现在，“订单复查”页会按照将发运到多个地址的订单的预期显示发运金额之前的税额。

<!-- ENGCOM-8257 -->

* UPS发运跟踪现在表示状态为 `Delivered On` 仅在包已交付时。 [GitHub-30032](https://github.com/magento/magento2/issues/30032)

<!-- MC-38825-->

* 当购物者从多个地址结帐返回购物车时，应用程序现在会为包含虚拟产品的订单显示正确的购物车小计。

<!-- MC-38682-->

* 现在，商户可以从发运页面为现有订单创建发运标签，该订单在启用JavaScript捆绑后使用FedEx发运。 以前，当商户单击 **创建送货标签** 按钮。

<!-- MC-36953-->

* 发送给客户的发运确认电子邮件中的发运跟踪链接现在可以按预期工作。 以前，此链接会返回404错误。

<!-- ENGCOM-8025 -->

* 现在，当购物者使用多个地址注销，然后删除虚拟产品以外的所有产品时，应用程序会显示一则信息性错误消息。 [GitHub-25595](https://github.com/magento/magento2/issues/25595)

<!-- ENGCOM-8253 -->

* 您现在可以按预期为部分订单创建送货标签。 以前，当您尝试从订单中仅为一个物料创建送货标签时，应用程序将所有产品添加到包中，验证失败。 [GitHub-29552](https://github.com/magento/magento2/issues/29552)

<!-- ENGCOM-8154 -->

* 调用时，将不再绕过发送方法的验证 `/V1/guest-carts/:cartId/totals-information`. [GitHub-25147](https://github.com/magento/magento2/issues/25147)

### Sitemap

<!-- MC-37306-->

* 生成的站点地图 `cron` 现在包含正确的图像URL。 以前，在多商店部署中生成的缓存图像路径不正确。

### 存储

<!-- ENGCOM-7543 -->

* 管理员和主存储切换器现在会反映管理员对存储排序顺序所做的更改。 [GitHub-13401](https://github.com/magento/magento2/issues/13401)

<!-- ENGCOM-8274 -->

* 在商店视图的顶级URL键发生更改后，应用程序现在会为类别和产品创建正确的URL。 以前，当包含修改的商店视图类别树时  `url_keys`，如果类别键没有更改，但类别父项键发生了更改，则在创建URL时，原始代码将使用类别的默认存储视图。 [GitHub-28633](https://github.com/magento/magento2/issues/28633)

### 目标规则

<!-- MC-34998-->

* 产品详细信息页面的加载已得到优化。 我们为数据库表添加了索引，以针对许多情况优化目标规则条件查询。

### 税

<!-- MC-37666-->

* 对来宾订单的增值税验证不再导致应用程序保存报价时客户税分类不正确。 [GitHub-30018](https://github.com/magento/magento2/issues/30018)

<!-- MC-37761-->

* 现在，在配置FPT时，在结帐期间可以保存发运到多个地址的订单。 以前，在完成多个地址的订单后，应用程序会显示空白页面而不是订单成功页面。

<!-- ENGCOM-8158 -->

* 店面产品详细信息页面现在可以按预期显示新旧价格，包含和不含税。 [GitHub-27500](https://github.com/magento/magento2/issues/27500), [GitHub-11998](https://github.com/magento/magento2/issues/11998)

### 测试

<!-- MC-37364-->

* `bin/magento dev:tests:run` 现在可以按预期启动以下测试：全部、单元、集成、全部集成、静态、全部静态、完整性、旧版和默认。

<!-- MC-38488-->

* `AdminMediaGalleryInsertLargeImageFileSizeTest` 已重构。

<!-- ENGCOM-8158 -->

* 单元测试现在与PHPUnit 8兼容。 [GitHub-29779](https://github.com/magento/magento2/issues/29779)

<!-- ENGCOM-8009 -->

* `\Magento\TestFramework\TestCase\WebapiAbstract` 现在包含一个函数，该函数支持比较测试中预期结果和实际结果的大型嵌套数组。 结果中不相关的关键现在可以忽略。 [GitHub-29498](https://github.com/magento/magento2/issues/29498)

<!-- ENGCOM-8024 -->

* `AdminMediaGalleryCatalogUiEditCategoryGridPageTest` 不再随机失败。 [GitHub-1764](https://github.com/magento/adobe-stock-integration/issues/1764)

<!-- ENGCOM-8041 -->

* `dev/tests/integration/testsuite/Magento/Customer/Controller/AccountTest` 已得到改进。 (`assert` 现在基于 `XPath` 选择器 `assertStringContainsString`.) [GitHub-29700](https://github.com/magento/magento2/issues/29700)

<!-- ENGCOM-8017 -->

* 为 `AdminAnalytics` 模块。 [GitHub-29500](https://github.com/magento/magento2/issues/29500)

<!-- ENGCOM-8266 -->

* 集成和API功能测试现在与PHPUnit 9.3兼容。 [GitHub-30146](https://github.com/magento/magento2/issues/30146)

<!-- MC-35798 -->

* 更正了GraphQL的问题 `testRequestCacheTagsForCategoryListOnMultipleIds` 测试。 [GitHub-29372](https://github.com/magento/magento2/issues/29372)

<!-- ENGCOM-7762 -->

* 现在，将在中正确解析包含URL的标头值 `ApiFunctional TestFramework`. [GitHub-26425](https://github.com/magento/magento2/issues/26425)

<!-- MC-35798 8109-->

* 更正了GraphQL的问题 `testRequestCacheTagsForCategoryListOnMultipleIds` 测试。 [GitHub-29372](https://github.com/magento/magento2/issues/29372)

<!-- ENGCOM-8382 -->

* `—no-tablespaces` 已添加到所有发生的 `mysqldump`，它允许在没有 `PROCESS` 权限(自MySQL 5.7.31 / 8.0.21以来需要运行 `mysqldump` )。 [GitHub-30566](https://github.com/magento/magento2/issues/30566)

### 主题

<!-- ENGCOM-8419 -->

* 新 `--no-parent` 标记已添加到 `bin/magento setup:static-content:deploy` 命令来阻止编译主题的父项。 此新标记通过避免不必要的编译，可以显着提高静态内容部署过程的性能。 请注意，使用 `compact` 策略。 [GitHub-30184](https://github.com/magento/magento2/issues/30184)

<!-- MC-37630 -->

* 设计配置不再生成DDL操作。 以前，在更新设计配置时，应用程序会生成可能触发MySQL错误的DDL语句。

<!-- ENGCOM-8112 -->

* 中的冗余代码 `Magento_ConfigurableProduct` 已删除“管理员”主题中的模块。  [GitHub-29857](https://github.com/magento/magento2/issues/29857)

<!-- ENGCOM-8144 -->

* 已删除“空白”主题中冗余的少样式导航和未使用的属性。 [GitHub-29914](https://github.com/magento/magento2/issues/29914)

<!-- ENGCOM-8285 -->

* 为移动设备视图中的空白主题添加了可折叠的导航功能。 [GitHub-30237](https://github.com/magento/magento2/issues/30237)

<!-- ENGCOM-7803 -->

* 已优化主题的Web字体加载。  [GitHub-29526](https://github.com/magento/magento2/issues/29526)

<!-- ENGCOM-8068 -->

* 开发人员现在可以在主题中声明自定义字体时指定字体类型。 [GitHub-29719](https://github.com/magento/magento2/issues/29719)

### 翻译和区域设置

<!-- MC-36836 -->

* 现在，当“管理员”区域设置为阿拉伯语(`ar_SA - Saudi Arabia`)。

<!-- MC-38476 -->

* 当购物者在注册或添加新地址时使用有效的帖子代码输入阿根廷地址时，应用程序不再显示错误消息。 以前，应用程序会显示以下错误： `Provided Zip/Postal Code seems to be invalid. Example: 1234. If you believe it is the right one you can ignore this notice.`

<!-- MC-38663-->

* 当购物者为韩语地址输入五位数的邮政编码时，应用程序不再引发错误。

<!-- ENGCOM-8244 -->

* 添加了对 [ISO 3166-2:UY](https://en.wikipedia.org/wiki/ISO_3166-2:UY). [GitHub-29729](https://github.com/magento/magento2/issues/29729)

<!-- ENGCOM-8220 -->

* `zip_codes.xml` 更新了，以强制执行8位巴西邮政编码。 [GitHub-29984](https://github.com/magento/magento2/issues/29984)

<!-- ENGCOM-8304 -->

* 改进了其余未本地化短语的本地化。 [GitHub-11175](https://github.com/magento/magento2/issues/11175)

<!-- ENGCOM-8380 -->

* 现在可以翻译网格搜索输入占位符。 [GitHub-30510](https://github.com/magento/magento2/issues/30510)

<!-- ENGCOM-8018 -->

* 现在，仅当启用了内联翻译JavaScript模块时，应用程序才会下载这些模块。  [GitHub-29553](https://github.com/magento/magento2/issues/29553)

### UI

<!-- MC-38509-->

* 的 **创建帐户** 按钮在购物者输入无效数据时保持活动状态。 以前，此按钮处于禁用状态，这会阻止购物者在出错后重新尝试创建帐户。 这是2.4.1中的已知问题。 [GitHub-30513](https://github.com/magento/magento2/issues/30513)

<!-- MC-38698-->

* “管理订单编辑”页面上的送货网格加载已得到改进。

<!-- MC-37870-->

* 应用程序现在显示  **与帐单地址相同** 按SKU将产品添加到购物车后，按预期在订单页面上选中该复选框。

<!-- ENGCOM-8007 -->

* 现在，定义有限宽度的CSS类将按预期应用于 **开始时间** 管理员字段 **存储**  >  **配置**  >  **目录**  >  **XML站点地图**  >  **层代设置**.  [GitHub-29496](https://github.com/magento/magento2/issues/29496)

<!-- ENGCOM-7992 -->

* 更正了“条款和条件”复选框标签的显示问题。  [GitHub-24060](https://github.com/magento/magento2/issues/24060)

<!-- ENGCOM-7948 -->

* 当层价格不可用时，应用程序将不再在产品页面上显示层价格块的CSS代码。 [GitHub-29194](https://github.com/magento/magento2/issues/29194)

<!-- ENGCOM-8084 -->

* 已重新排序图像视图详细信息页面上按钮的位置，以符合用户界面指南。  [GitHub-1783](https://github.com/magento/adobe-stock-integration/issues/1783)

<!-- ENGCOM-8342 -->

* 在Internet Explorer/EDGE浏览器中，优惠券代码文本字段现在以适当的宽度显示。

<!-- ENGCOM-7630 -->

* 的 `@button__border-radius` 变量现在在 `lib/web/css/source/lib/variables/_buttons.less` 库。  `border-radius` 的默认值为 `3px`. 以前， `border-radius` 硬编码。  [GitHub-28674](https://github.com/magento/magento2/issues/28674)

<!-- ENGCOM-8067 -->

* 现在，在达到最小搜索字符串长度之前，迷你搜索字段中的提交搜索按钮（放大镜）处于禁用状态。 [GitHub-29704](https://github.com/magento/magento2/issues/29704)

<!-- MC-38807-->

* 的 **预览模板** 按钮现在可以按预期在“编辑队列”页面中工作。

<!-- MC-31892-->

* 现在，当您将属性从一个组移动到另一个组时，应用程序会保留该属性的值。

<!-- ENGCOM-8085 -->

* 在 `lib/web/css/source/lib/variables/_typography.less`. [GitHub-29778](https://github.com/magento/magento2/issues/29778)

<!-- ENGCOM-8211 -->

* 过滤器可见性现在可与管理网格中预期的列可见性配合使用。  [GitHub-30345](https://github.com/magento/magento2/issues/30345)

<!-- ENGCOM-8152 -->

* UI选择组件选项在 `this.disabled(true)` 设置。 [GitHub-29098](https://github.com/magento/magento2/issues/29098)

<!-- ENGCOM-7901 -->

* 的 `@font-family-name__base` 变量在加载Open Sans字体时不再使用。 [GitHub-29515](https://github.com/magento/magento2/issues/29515)

<!-- ENGCOM-8120 -->

* WAI-ARIA属性 `aria-atomic="true"` 已添加到错误容器标记中。 [GitHub-29560](https://github.com/magento/magento2/issues/29560)

<!-- ENGCOM-8175 -->

* UI组件网格现在可显示选定项目的准确计数。 以前，当按关键字搜索选定了所有网格项目，购物者随后在选中标题复选框之前取消选定了某些项目时，网格会显示错误的选择数。 [GitHub-29968](https://github.com/magento/magento2/issues/29968)

<!-- ENGCOM-8118 -->

* 应用产品不再在发票和发运概览页面上显示未呈现的HTML。 [GitHub-29958](https://github.com/magento/magento2/issues/29958)

<!-- ENGCOM-8066 -->

* 单击 **选项** 管理员 **商店**  >  **汇率**  现在将用户导向“系统配置”页面中已展开的货币选项部分。 [GitHub-29336](https://github.com/magento/magento2/issues/29336)

<!-- ENGCOM-8361 -->

* 改进了根据 `adminhtml` 使用选择器小组件类型时显示小组件。 [GitHub-13316](https://github.com/magento/magento2/issues/13316), [GitHub-7252](https://github.com/magento/magento2/issues/7252), [GitHub-6868](https://github.com/magento/magento2/issues/6868)

<!-- ENGCOM-8336 -->

* 改进了Luma主题中确认弹出对话框中文本的填充。 [GitHub-30452](https://github.com/magento/magento2/issues/30452)

### 保管库

<!-- MC-39109-->

* 的 `Vault` 模块现在从支付信息管理服务的请求中识别支付方法代码。 以前，当购物者使用保存的Braintree信用卡下订单时，即使使用了有效的付款方法，应用程序也会引发此错误： `The requested Payment Method is not available`.

<!-- ENGCOM-7977 -->

* 现在，当用户滚动时，应用程序在“作为客户登录”管理员页面上显示的横幅将保留在页面顶部。 [GitHub-29354](https://github.com/magento/magento2/issues/29354)

### 顶点

* 现在，地址建议在修改地址时会按预期删除。

* 已解决阻止某些客户在其帐户面板中保存其地址的争用情况。

* 在某些情况下，顶点地址验证不再将地址编辑页面添加到全页缓存中。

* 现在，在为包含税的金额配置免运费时，将考虑顶点计算税。

### Web API框架

<!-- MC-23904 ENGCOM-8421-->

* 您现在可以使用POST `V1/invoice/:invoiceId/refund` 退回产品数量为零且运费为零的发票(例如， `{"items": [{"qty": 0, "orderItemId": 6, "extensionAttributes": {}}], "appendComment": false, "notify": true, "isOnline": true, "arguments": {"adjustment_negative": 0.0, "adjustment_positive": 0.99, "shipping_amount": 0}}.` )以前，应用程序会引发以下错误： `You can't create a creditmemo without products`. [GitHub-23069](https://github.com/magento/magento2/issues/23069)

<!-- MC-33732 -->

* 您现在可以使用POST `V1/categories` 创建或更新类别。 以前，如果 `default_sort_by` 值设置为数组。 当 `default_sort_by` 值设置为字符串时，应用程序引发以下错误： `Error occurred during \"custom_attributes\" processing. Attribute \"default_sort_by\" has invalid value. The \"string\" value's type is invalid. The \"string[]\" type was expected. Verify and try again.`

<!-- MC-35740 -->

* 使用POST `V1/invoices/:id/capture` 现在，可以按预期方式捕获付款信息。 以前，应用程序授权了订单，但只在支付网关的网站上捕获了订单。

<!-- MC-37794 -->

* 使用POST `V1/order/:orderId/ship` 要创建部分发运，端点会返回正确数量的已发运产品。

<!-- MC-38425-->

* 使用POST创建的发票 `V1/order/:orderID/invoice` 现在按商店信用准确反映部分付款。 以前，当使用商店信用部分支付订单时，会创建发票，而不考虑商店信用。

<!-- MC-36830-->

* GET `rest/all/V1/categories` 和GET `rest/all/V1/categories?rootCategoryId=2` 现在回填 `name` 和 `product_count` 字段。 以前，类别字段值为空。 表名称解析程序插件返回了用于按类别获取产品计数的错误表名称。

<!-- ENGCOM-8286 -->

* PUT `V1/categories/:id` 端点现在会在 `save_rewrites_history` 提供了自定义属性。 [GitHub-29174](https://github.com/magento/magento2/issues/29174), [GitHub-30240](https://github.com/magento/magento2/issues/30240)

### 愿望清单

<!-- MC-33626-->

* 现在，当产品被分配到自定义库存源时，购物者可以将产品添加到愿望清单。 [GitHub-3018](https://github.com/magento/inventory/issues/3018)

<!-- MC-35416-->

* 现在，当客户从店面将产品添加到其期望列表后，管理员可以从管理员客户页面访问管理购物车页面。 以前，当管理员单击 **管理购物车** 按钮： `An error has occurred. See error log for details`.

<!-- MC-35573-->

* 的 **添加到购物车** “共享愿望列表”页面上的按钮现在可以按预期方式对未登录的匿名、来宾和用户使用。

<!-- ENGCOM-8062 -->

* 应用程序现在可以按预期在愿望列表页面中显示所选的可配置产品属性选项。  [GitHub-24091](https://github.com/magento/magento2/issues/24091),  [GitHub-22503](https://github.com/magento/magento2/issues/22503)

<!-- ENGCOM-7779 -->

* 已实施 `ActionInterface` 表示 `\Magento\Wishlist\Controller\Shared\Allcart`. [GitHub-29537](https://github.com/magento/magento2/issues/29537)

## 已知问题

**问题**:的 `[magento_root]/index.php` 文件已被删除，应用程序现在从 `/pub` 默认情况下，使用Apache配置。 子文件夹中提供的存储区将无法按预期工作，并可能显示404错误。 **解决方法**:使用符号链接将安装模拟到子文件夹中。 以下示例使用 `https://shop01.com/shop/` 以说明如何使用符号链接模拟子文件夹中的安装。

1. 为创建子目录 `https://shop01.com/shop/`:

   ```bash
   mkdir magento_root/pub/shop01
   ```

   ```bash
   cd magento_root/pub/shop01
   ```

1. 为新创建目录中的存储父目录创建符号链接：

   ```bash
   ln -s ../media media
   ```

   ```bash
   ln -s ../static static
   ```

   ```bash
   ln -s ../../../pub pub
   ```

   ```bash
   ln -s ../.htaccess .htaccess
   ```

   ```bash
   ln -s ../health_check.php health_check.php
   ```

1. 创建 `index.php` 新目录(`magento_root/pub/shop01/index.php`)并添加以下内容：

```php
   <?php
   require realpath(__DIR__) . '/../../../app/bootstrap.php';

   switch ($_SERVER['HTTP_HOST']) {
       case 'shop01.com':
       case 'www.shop01.com':
           $params = $_SERVER;
           $params[\Magento\Store\Model\StoreManager::PARAM_RUN_CODE] = 'shop01';
           $params[\Magento\Store\Model\StoreManager::PARAM_RUN_TYPE] = 'website';
           $bootstrap = \Magento\Framework\App\Bootstrap::create(BP, $params);
           $app = $bootstrap->createApplication(\Magento\Framework\App\Http::class);
           $bootstrap->run($app);
           break;

       default:
           $bootstrap = \Magento\Framework\App\Bootstrap::create(BP, $_SERVER);
           /** @var \Magento\Framework\App\Http $app */
           $app = $bootstrap->createApplication(\Magento\Framework\App\Http::class);
           $bootstrap->run($app);
       break;
   }
```

1. 配置Apache服务器以指向新子目录。 部署配置可能差异很大。 以下是服务器配置示例：

```xml
   <VirtualHost *:80>
       DocumentRoot "magento_root/pub/shop1"
       ServerName shop01.com
   </VirtualHost>
```

**问题**:当购物者首次在付款页面的CAPTCHA字段中输入正确的代码时，应用程序不会按预期提交付款信息，但会显示以下错误：  `There has been an error processing your request`. 仅当购物者尝试下订单时，要么不输入CAPTCHA代码，要么错误输入CAPTCHA代码，就会发生这种情况。  **解决方法**:刷新页面。 <!-- MC-40506-->

**问题**:当购物者点击时，应用程序会按预期创建Braintree订单 **使用Venmo付款**，但不会在管理员中创建顺序。 请参阅 [2.4.2已知问题：Braintree维恩模付款不起作用](https://support.magento.com/hc/en-us/articles/360054662652/) 知识库文章。  <!-- BUNDLE-2894-->

**问题**:您不能使用 `addConfigurableProductToCart` GraphQL突变，在运行库存的多商店部署中，在非默认的商店视图中将可配置产品添加到购物车。 （Luma店面不会受到影响。） 应用程序显示以下错误： `Could not add item to cart. Please check required options and try again`. **解决方法**:使用 `addProductsToCart` 变异。 [GitHub-31660](https://github.com/magento/magento2/issues/31660)<!-- PWA-1298-->

## 社区贡献

我们感谢更广泛的Magento Open Source群体，并感谢他们对本稿的贡献。

社区工程团队 [Magento参与者](https://magento.com/magento-contributors) 按月、季度和年维护排名最前的参与个人和合作伙伴列表。 在该“参与者”页面中，您可以在GitHub上跟踪指向其合并PR的链接。

### 合作伙伴贡献

下表重点介绍了合作伙伴的贡献。 此表列出了提供拉取请求、外部拉取请求以及与其关联的GitHub问题编号（如果可用）的合作伙伴。

{{$include /help/_includes/release-notes/engcomm-2-4-2-partner.md}}

### 个人参与者贡献内容

下表列出了社区成员的贡献内容。 此表列出了外部拉取请求、与其关联的GitHub问题编号（如果可用），以及贡献拉取请求的社区成员。

{{$include /help/_includes/release-notes/engcomm-2-4-2-issues.md}}

### 系统要求

我们的技术堆栈构建在PHP和MySQL上。 有关更多信息，请参阅 [系统要求](../../../installation/system-requirements.md).

### 安装和升级说明

您可以使用 [编辑器](../../../installation/composer.md).

## 迁移工具包

数据迁移工具可帮助将现有Magento1.x存储数据传输到Magento2.x。此命令行界面包括验证、进度跟踪、日志记录和测试功能。 有关安装说明，请参阅 [安装数据迁移工具](../../../tools/data-migration-tool/install.md). 考虑探索或为 [数据迁移存储库](https://github.com/magento/data-migration-tool).

的 [代码迁移工具包](https://github.com/magento-commerce/code-migration) 帮助将现有Magento1.x存储扩展和自定义项传输到Magento2.x。命令行界面包含用于转换Magento1.x模块和布局的脚本。
