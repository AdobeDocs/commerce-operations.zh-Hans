---
title: Magento Open Source2.4.3发行说明
description: 了解2.4.3Magento Open Source版本中的新增功能、增强功能、错误修复和已知问题。
exl-id: fba0e147-1aa2-4c41-bc7d-51dd6755e014
source-git-commit: 95ffff39d82cc9027fa633dffedf15193040802d
workflow-type: tm+mt
source-wordcount: '13303'
ht-degree: 0%

---

# Magento Open Source2.4.3发行说明

Magento Open Source2.4.3引入了性能和安全性的增强以及重要的平台改进。 安全增强功能包括扩展reCAPTCHA覆盖范围和包含内置速率限制。 核心编辑器依赖项和第三方库已升级到与PHP 8.x兼容的最新版本。Page Builder现在作为Magento Open Source中的捆绑扩展提供。 它现在是Adobe Commerce和Magento Open Source的默认内容编辑工具。

此版本包括核心代码的370多项新修复和33项安全增强。 其中包括我们的社区成员解决近290个GitHub问题。 这些社区贡献的内容涵盖从对核心代码进行次要清理到GraphQL中的重大增强功能。

此版本包括核心代码的370多项新修复和33项安全增强。 Magento Open Source2.4.2发行说明中发现的所有已知问题都已在此版本中修复。

{{bics}}

参见 [Adobe Commerce 2.4.2-p2发行说明](../security/2-4-2-p2.md) 有关Adobe Commerce 2.4.2-p2的信息。

## 其他发行信息

虽然这些功能的代码与季度版本捆绑在一起，但其中几个项目(例如Progressive Web Application(PWA)Studio)也单独发布。 每个项目的文档中都提供了特定于项目的单独发行信息，其中记录了这些项目的错误修复。

## 应用 `AC-3022.patch` 继续提供DHL作为运输承运商

DHL已引入了架构版本6.2，并且将在不久的将来弃用架构版本6.0。 支持DHL集成的Adobe Commerce 2.4.4及更早版本仅支持版本6.0。部署这些版本的商家应适用 `AC-3022.patch` 尽早继续提供DHL作为运输承运商。 请参阅 [应用补丁以继续将DHL作为运输承运人](https://support.magento.com/hc/en-us/articles/7707818131597-Apply-a-patch-to-continue-offering-DHL-as-shipping-carrier) 知识库文章，了解有关下载和安装修补程序的信息。

## 应用MC-43048__set_rate_limits__2.4.3.patch解决API速率限制问题

此修补程序为Web API无法处理数组中包含20个以上项目的请求问题提供了解决方案。 此问题会影响运行Magento Open Source2.4.3、Adobe Commerce 2.4.3或2.3.7-p1的部署。 在这些版本中添加了内置速率限制功能，以防止拒绝服务(DoS)攻击，默认最大速率设置为20。 此修补程序将默认限制还原为更高的值。 如果您怀疑您的存储遇到DoS攻击，Adobe建议将默认输入限制降低到较低的值，以限制可请求的资源数量。 请参阅 [Web API无法处理数组中包含20个以上项目的请求](https://support.magento.com/hc/en-us/articles/4406893342093) 知识库文章。

## 应用AC-384__Fix_Incompatible_PHP_Method__2.4.3_ce.patch解决升级时PHP的严重错误

升级到Magento Open Source2.4.3期间可能会出现以下致命错误：

```terminal
PHP Fatal error: Uncaught Error: Call to undefined function Magento\Framework\Filesystem\Directory\str_contains() in [...]/magento/vendor/magento/framework/Filesystem/Directory/DenyListPathValidator.php:74
```

此错误是由于使用 `str_contains` 函数，它是一个PHP 8.x函数。 应用程序Open Source 2.4.3不支持PHP 8.x。此修补程序将此函数替换为支持的PHP 7.x函数。 请参阅 [Adobe Commerce升级2.4.3、2.3.7-p1 PHP致命错误修补程序](https://support.magento.com/hc/en-us/articles/4408021533069-Adobe-Commerce-upgrade-2-4-3-2-3-7-p1-PHP-Fatal-error-Hotfix) 知识库文章。

## 亮点

在此版本中查找以下亮点。

### 显着的安全增强功能

此版本包括33项安全修复和平台安全改进。 其中许多安全修复已回溯到2.4.2-p2和2.3.7-p1。

#### 三十三项安全增强功能，可帮助消除远程代码执行(RCE)和跨站点脚本(XSS)漏洞

到目前为止，尚未发生任何与这些问题相关的已确认攻击。 但是，可能会攻击某些漏洞以访问客户信息或接管管理员会话。 这些问题中的大多数要求攻击者首先获得对管理员的访问权限。 因此，我们提醒您采取一切必要步骤保护您的管理员，包括但不限于以下工作：IP列入允许列表、 [双重身份验证](https://devdocs.magento.com/guides/v2.4/security/two-factor-authentication.html)，使用VPN，使用唯一位置而不是 `/admin`和良好的密码卫生。 参见 [Adobe安全公告](https://helpx.adobe.com/security/products/magento/apsb21-64.html) 以讨论这些修复的问题。

#### 其他安全增强功能

此版本的安全改进改进了与最新安全最佳实践的符合性，包括：

* A **新的Composer插件** 有助于防止依赖关系混淆，并标识与公共包存储库上的内部包同名的恶意包。 请参阅 [Adobe发行包含2.4.3版的新编辑器插件](https://magento.com/blog/best-practices/adobe-releases-new-composer-plugin-magento-243-release) 博客帖子。

* **速率限制现已内置到API中** 以防止拒绝服务(DoS)攻击。 Web API现在对客户端可请求的资源大小或数量施加限制（默认最大值设置为20，并可根据业务需求配置为其他值）。 参见 [速率限制](https://developer.adobe.com/commerce/webapi/get-started/api-security/) 以了解有关配置这些限制的信息。 <!-- MC-35358-->

* **ReCAPTCHA覆盖范围已扩展** 要包括：

   * ReCAPTCHA涵盖具有相应HTML页的Web API。 （这不包括通过集成访问的Web API。） ReCAPTCHA覆盖范围保护端点免受垃圾邮件攻击。 当使用OAuth的第三方集成服务访问Web API时，将禁用ReCAPTCHA。<!-- MC-34472-->

   * 下单店面页面和支付相关Web API。 默认情况下，这些页面的ReCAPTCHA保护处于禁用状态，可以从管理员启用。 此覆盖添加了一种反暴力机制，以保护存储免受梳理攻击。

{{cve-notice}}

### 基础架构改进

此版本包含提高框架质量和以下功能区域的增强功能：

* 客户帐户

* 目录

* CMS

* OMS

* 导入/导出

* 促销和定位

* 购物车和结帐

* B2B

* 暂存和预览

**现在支持PayPal Pay Later** 在包括PayPal的部署中。 此功能允许购物者以每两周一次分期付款的方式支付订单，而不是在购买时支付全额。 <!-- MC-40556-->

**新 `use_application_lock` 索引模式**. 此 `use_application_lock` 模式允许您通过使用环境变量或通过配置 `app/etc/env.php` 文件。 启用此模式后，在失败后不再需要手动重置索引器。  参见 [使用应用程序锁定模式重新索引进程](https://developer.adobe.com/commerce/php/development/components/indexing/#using-application-lock-mode-for-reindex-processes).

### 平台增强功能

版本2.4.3尚未与PHP 8.x兼容，但下面的平台升级使我们更接近于将来与PHP 8.x兼容。

* 核心编辑器依赖项和第三方库已升级到与PHP 8.x兼容的最新版本。 <!-- MC-39514-->

* KnockoutJS库已升级到v3.5.1（最新版本）。 <!-- MC-40694-->

* 已弃用的TinyMCE v3库已被删除。 此 `Magento_Tinymce3Banner` 与TinyMCE v3.x相关的模块和MFTF测试已从Adobe Commerce中删除。 <!-- MC-42199 42170 -->

* Magento Open Source2.4.3已经过测试并被确认与Redis 6.0.12兼容。 （版本2.4.x仍与Redis 5.x兼容。）

* Laminas库依赖项已升级到与PHP 8.x兼容的版本。 已从删除一些冗余依赖项 `composer.json` 文件。 **Magento Open Source2.4.3使用Laminas 3.4.0**. <!-- MC-39513-->

### 性能增强

此版本包括一些增强功能，它们缩短了产品价格和目录规则索引器的索引时间。 商家现在可以从客户组或共享目录中排除网站，这减少了用于索引的记录数量，并缩短了索引时间。

### Adobe Stock集成

此版本包括Adobe Stock集成v2.1.1。

### GraphQL

此版本添加了共享路由的GraphQL覆盖范围。 此 [路由查询](https://devdocs.magento.com/guides/v2.4/graphql/queries/route.html) 和 [可路由接口](https://devdocs.magento.com/guides/v2.4/graphql/interfaces/routable-interface.html) 在产品、类别和CMS页面上支持路由请求。 此 `urlResolver` 查询已弃用，其功能已被 `route` 查询。

请参阅 [GraphQL开发人员指南](https://devdocs.magento.com/guides/v2.4/graphql/) 以了解有关这些增强功能的详细信息。

### 页面生成器

Page Builder现在作为Magento Open Source中的捆绑扩展提供。 它现在是Adobe Commerce 2.4.3和Magento Open Source2.4.3的默认内容编辑工具。它可以使用任何第三方模块替换WYSIWG编辑器。

Page Builder在以下管理区域中替换了TinyMCE编辑器：

* CMS页面
* CMS块
* 类别描述
* 产品描述

在TinyMCE中创建的所有内容都已作为HTML迁移到页面生成器中。

### PWA Studio

有关增强功能和错误修复的信息，请参阅 [PWA Studio版本](https://github.com/magento/pwa-studio/releases). 参见 [兼容性](https://developer.adobe.com/commerce/pwa-studio/integrations/adobe-commerce/version-compatibility/) PWA Studio版本及其兼容版本的列表。

### 升级兼容性工具

范围 [升级兼容性工具](https://experienceleague.adobe.com/docs/commerce-operations/upgrade-guide/upgrade-compatibility-tool/overview.html) 已根据社区的反馈进行了扩展。 加入我们的 [#upgrade-compatibility-tool](https://magentocommeng.slack.com/archives/C019Y143U9F) Slack渠道，以获得Adobe产品团队和社区的支持，并帮助指导该工具的未来方向。

### 供应商开发的扩展

有关此版本功能和更改的更新，请参阅以下文章：

* [Amazon Pay](https://docs.magento.com/user-guide/payment/amazon-pay.html)

* [Braintree](https://docs.magento.com/user-guide/payment/braintree.html)

* [dotdigital Engagement Cloud](../../../upgrade/modules/upgrade.md)

* [克拉尔纳](https://docs.magento.com/user-guide/payment/klarna.html)

* [顶点云](https://docs.magento.com/user-guide/tax/vertex.html)

* [Yotpo产品审核](../../../upgrade/modules/upgrade.md)

## 修复的问题

我们已在2.4.3核心代码中修复了数百个问题。

### 安装、升级、部署

<!-- MC-41154-->

* 此 `bin/magento setup:db:status` 命令现在会返回一条消息，指示在成功升级后一切都是最新的。 以前，应用程序显示此错误： `Declarative Schema is not up to date`.

<!-- MC-40031 -->

* 现在，创建新可配置产品失败时，在重新加载表单时会保留配置值。 以前，在表单重新加载过程中丢失值，应用程序显示此错误： `The value specified in the URL Key field would generate a URL that already exists`. [GitHub-32102](https://github.com/magento/magento2/issues/32102)

<!-- MC-37596-->

* 运行时，应用程序不再引发异常 `bin/magento setup:upgrade` ，从使用Redis的Magento Open Source部署升级到Adobe Commerce。

<!-- ENGCOM-8508 -->

* 在Galera群集上运行的部署现在支持更多客户。 [GitHub-31038](https://github.com/magento/magento2/issues/31038)

<!-- ENGCOM-9036 MC-41938 -->

* 现在，当应用程序与以下任一组件一起安装时，管理员可以成功登录到部署： `—use-rewrites=0` 选项或 `web/seo/use_rewrites` 在中设置为0 `core_config_data_table`. [GitHub-32100](https://github.com/magento/magento2/issues/32100)

<!-- ENGCOM-8451 -->

* 已更新 `sortOrder` 加载 `AsyncCssPlugin`. 应用程序现在加载 `AsyncCssPlugin` 早于 `JsFooterPlugin`. [GitHub-30882](https://github.com/magento/magento2/issues/30882)

<!-- ENGCOM-8701 -->

* `Magento\Config\Model\Config\PathValidator` 现在检查显示路径以确定元素是否存在，如果它有配置路径，则使用 `config.xml` 用于验证的路径。 [GitHub-27678](https://github.com/magento/magento2/issues/27678)

<!-- ENGCOM-8684 -->

* 现在，使用Grunt或服务器端编译编译较少的文件会产生相同的结果。 以前。 `.abs- styles`，可以扩展其他 `.abs- styles` 在 `_extends.less`，在使用Grunt编译时无法正确输出。 这导致了生产部署与开发部署之间的差异。 [GitHub-7231](https://github.com/magento/magento2/issues/7231)

### Adobe Stock集成

<!-- MC-39754-->

* 应用程序现在会显示一条信息性消息和指向管理员的链接 **商店** > **配置** > **高级** > **系统** “搜索Adobe Stock”页面上的页面，当时 **API密钥（客户端ID）** 和 **客户端密码** 未设置。 以前，应用程序显示此错误： `We couldn't find any records` 没有链接。

### 后端

<!-- MC-40389-->

* 访问受限的管理员（例如，仅为一个网站分配了访问权限的管理员）无法再编辑设置为全局范围的类别。

<!-- MC-39037-->

* 生成的系统报告(**系统** > **支持** > **系统报告**)现已正确呈现。 以前，报表内容未对齐。

<!-- MC-30152 ENGCOM-8625-->

* 应用程序现在会关闭 **价格** 字段满足以下条件时 **动态价格** 创建捆绑包产品期间将启用设置。 以前，当您从以下位置删除值时，应用程序会引发验证错误： **价格** 字段时间 **动态价格** 设置已启用。 [GitHub-26214](https://github.com/magento/magento2/issues/26214)

<!-- MC-24840-->

* 当部署中的管理员URL与默认网站URL不同时，不会再发生无限重定向，因为部署中的应用程序配置为可从两个URL访问。

### 捆绑产品

<!-- MC-41810-->

* 您现在可以使用 `addProductsToCart` 进行变异，将具有多个复选框选项的捆绑产品添加到购物车。

<!-- MC-41614-->

* 现在，使用临时表执行捆绑产品价格索引，从而避免锁定数据库表。 以前，应用程序使用物理表，导致表被锁定。

<!-- MC-41177 magento/magento2#32594-->

* 现在，可以将捆绑项目的价格设置为0.00。以前，在将价格设置为0.00后返回到编辑页面时，价格会返回到其默认值。 [GitHub-32383](https://github.com/magento/magento2/issues/32383)

<!-- MC-40603-->

* 现在，如果在下订单之前更改了价格，则包含捆绑产品的订单的订单详细信息会显示捆绑产品的正确价格。

<!-- MC-40035-->

* 捆绑产品库存状态现在会根据其子产品的库存状态进行更新。 以前，当从产品中移除一个选件时，并且捆绑销售产品具有两个具有相同SKU的选件时，捆绑销售产品显示为缺货。

<!-- MC-39276-->

* 管理员现在可以更改捆绑产品的值 `Shipment Type` 属性移到其他属性组之后。 以前，此属性保存时始终使用 `Together` 值（如果它被移动到属性集中默认组以外的属性组）。

<!-- MC-38900-->

* GraphQL `setGuestEmailOnCart` 变异现在可以正确更新来宾电子邮件。 以前，报价和报价地址表不会更新。

<!-- MC-37719-->

* 通过REST API调用向捆绑产品添加、删除或更新子产品现在会按预期触发重新索引。 以前，这些操作不会触发重新索引，因此，在执行手动重新索引之前，捆绑包产品不会更改其库存状态。

<!-- MC-35725 ENGCOM-8568-->

* 该应用程序现在为具有层价格的捆绑产品显示正确的价格范围。 [GitHub-30284](https://github.com/magento/magento2/issues/30284)

<!-- MC-35638-->

* 现在，在捆绑包选项的价格发生更改后，应用程序会在购物车页面上和结帐工作流的配送步骤中显示相同的总价。

<!-- MC-32617-->

* 您现在可以通过从客户购物车访问捆绑包产品来成功配置捆绑包产品。 以前，配置产品页面从未完全加载，并且您无法保存设置。

<!-- MC-30317 ENGCOM-7141-->

* 商家现在可以在多商店部署的每个商店视图上为捆绑产品指定唯一价格。 网站特定价格保存在 `catalog_product_bundle_selection_price` 表格。 以前，应用程序不会根据网站范围确定捆绑产品的价格，即使在  **商店** > **配置** > **目录** > **目录** > **价格** > **目录价格范围** 已设置为 `Website`. 未保存网站特定的价格 `catalog_product_bundle_selection_price`. [GitHub-12584](https://github.com/magento/magento2/issues/12584)

<!-- ENGCOM-8705 MC-38953-->

* 在以下情况下，捆绑产品的发票现在会显示相关简单产品的正确数量： **动态定价** 已禁用。 以前，与捆绑产品关联的简单产品具有父产品的数量，而不是捆绑产品的数量)。 [GitHub-30802](https://github.com/magento/magento2/issues/30802)

<!-- magento/magento2#30374 MC-36930-->

* 此 `updateProductsInWishlist` 变异现在可以成功更新愿望清单中捆绑产品所包含的商品。 以前，此变异不会更新愿望清单项，而是删除该项并创建一个新项，从而更改项ID。

### 缓存

<!-- ENGCOM-8554-->

* 此 `varnish6.vcl` 文件已更新，以绕过客户页面的缓存。

### 验证码

<!-- MC-41572-->

* 现在，CAPTCHA可正确验证购物者提供的数据，并且购物者多次尝试通过PayPal Payflow Pro结帐失败后，CAPTCHA字段现在会按预期显示。

<!-- MC-41281-->

* 验证码验证不会再在结账工作流的支付页面上随机失败。

<!-- MC-41001-->

* 在超过失败的完成尝试次数后，应用程序现在会按预期显示CAPTCHA字段。 以前，尽管应用程序提示您再次尝试验证码质询，但它不显示验证码字段。

<!-- MC-40359-->

* 现在，验证码在结账页面上可按预期工作。 以前，在购物者正确应答了验证码质询后，结帐页面上的加载程序从未完成，应用程序会显示以下错误： `captchaData[formId] is undefined`. （仅当购物者使用先前访问运行2.3.5-p1的部署的同一浏览器时，才会发生此错误。）

<!-- ENGCOM-8630-->

* `_.isEmpty()` 签入 `defaultCaptcha.js` 文件现在已成功完成。 以前，这些检查未完成，因此，升级后无法加载签出页面。 [GitHub-31641](https://github.com/magento/magento2/issues/31641)

### 购物车和结账

<!-- MC-41911-->

* 现在，在转换和更新购物车中的产品数量时，应用程序会考虑特定于区域设置的小数位置。

<!-- MC-40657-->

* 现在，仅当购物者单击 **下单** 按钮。 以前，每当购物者在结帐工作流中更改付款方式时，应用产品会在“应用折扣代码”块中显示此消息： `The order wasn't placed. First, agree to the terms and conditions, then try placing your order again`.

<!-- MC-39581-->

* 现在，如果购物者未能单击 **更新** 按钮并返回到送货步骤。

<!-- MC-37807 ENGCOM-8530-->

* 带有可自定义选项的产品 `(File)` 现在，在整个多送货结帐过程中按预期包括活动链接。 以前，缺少此链接。 [GitHub-31095](https://github.com/magento/magento2/issues/31095)

<!-- MC-37689-->

* 对于支持多种货币的商店，管理员购物车现在会以正确的货币显示产品价格。 以前，价格会多次转换为指定的货币 — 先是将产品从店面添加到购物车时，然后在随后管理员上呈现订单时再次转换。

<!-- MC-35640-->

* 购物者现在可以将最低广告价格(MAP)超过正常产品价格的产品添加到购物车中。

<!-- MC-35289-->

* 使用多个地址结帐时，购物者现在可以从结帐工作流中成功更改其帐单地址。

<!-- MC-29335 magento/magento2#32251 -->

* 现在，由来宾创建的所有付费支付交易都保存到数据库，并如预期般显示在管理员中。 以前，数据库中只保存了一小部分并发订单，并且大多数订单由于数据库锁定导致超时而丢失。 [GitHub-25862](https://github.com/magento/magento2/issues/25862)

<!-- MC-23989-->

* 现在，当访客将产品放入迷你购物车时，应用程序可正确显示包含特殊字符的内联欢迎消息。 以前，应用程序不会将产品添加到迷你购物车或显示欢迎消息。 [GitHub-32250](https://github.com/magento/magento2/issues/32250)

<!-- MC-41165-->

* 现在，启用店内交付后，签出工作流的配送页面即可成功加载。 以前，应用程序抛出JavaScript错误，并且送货签出页面未完全呈现。

<!-- ENGCOM-9006-->

* 添加了 `itemResolvers` 目录参数 `di.xml` 文件。 因此，如果禁用了可配置和分组的产品模块，则签出不再中断。 [GitHub-30860](https://github.com/magento/magento2/issues/30860)

<!-- ENGCOM-8944-->

* 应用程序现在显示 **付款和送货信息** 区段。 [GitHub-30257](https://github.com/magento/magento2/issues/30257)

<!-- MC-39158 ENGCOM-8493-->

* 当购物车包含具有多个选项的捆绑产品时，应用程序现在可以正确应用具有购物车级别固定折扣的购物车价格规则。 以前，购物车价格规则未完全应用于订单。 [GitHub-30952](https://github.com/magento/magento2/issues/30952)

<!-- MC-40983 ENGCOM-8828-->

* 此 **添加到购物车** 类别列表视图上的按钮现在可按预期使用。 [GitHub-32232](https://github.com/magento/magento2/issues/32232)

<!-- ENGCOM-8490-->

* 您现在可以使用POST `/V1/carts/mine/items` 向购物车中添加自定义数量的分组产品。 [GitHub-26909](https://github.com/magento/magento2/issues/26909)

<!-- ENGCOM-8886-->

* 应用程序不再使用送货地址填充签出工作流的帐单地址区域。 以前，当 **省/市/自治区** 帐单地址字段为空，并且送货和帐单地址不同，应用程序填充了帐单地址 **省/市/自治区** 包含来自配送地址信息的字段。 [GitHub-31608](https://github.com/magento/magento2/issues/31608)

### 目录

<!-- MC-36787-->

* 批量更新 **启用数量增量** 和 **数量增量** 属性现在可按预期工作。 [GitHub-29544](https://github.com/magento/magento2/issues/29544)

<!-- MC-41575-->

* 在您最近与管理员启用了产品同步后，应用程序不再引发JavaScript错误。 以前，应用程序显示此JavaScript错误： `Cannot read property 'status' of undefined`.

<!-- MC-41534-->

* 自定义主题布局更新现已按预期应用。 以前，自定义主题布局更新被忽略。

<!-- MC-41499-->

* 现在，产品类别缓存已按预期清除 `cron` 期间 `indexer_update_all_views` 执行。 以前，重新索引后“类别”页面上的产品计数不正确。

<!-- MC-41422-->

* 现在，如果在存储视图的产品更新REST API请求中未指定属性，则属性值将保持不变。 以前，如果未指定属性，应用程序会将该属性值重置为其默认范围值。

<!-- MC-41284-->

* 管理产品网格(Admin **目录** > **产品**)现在，按SKU过滤产品时显示正确的产品计数。

<!-- MC-40873-->

* 现在，如果启用了类别权限，则当产品添加到CMS页面时，应用程序会显示准确的库存状态，并阻止显示指定客户组的价格。 以前，无论真实库存状态如何，所有产品都显示为缺货。

<!-- MC-40859-->

* 现在，“高级定价客户组价格”批价格输入字段的最小宽度为5位数。 以前，在低分辨率显示屏上，此字段中只显示两个符号。

<!-- MC-40825-->

* 现在，应用程序在删除产品后成功删除产品媒体映像。 以前，成功删除产品后，产品媒体图像会保留在文件夹中。

<!-- MC-40811 magento/magento2#32042-->

* 当您在“管理员”中创建或编辑产品，然后创建“计划设计更新”时，页面布局现在会按预期更新。 [GitHub-32007](https://github.com/magento/magento2/issues/32007)

<!-- MC-40773-->

* 值为零的自定义产品属性现在可以成功另存为空白。 以前，应用程序不会将此值更新为空白。

<!-- MC-40736 ENGCOM-8789-->

* 自定义类别布局更新文件现在按预期应用于产品。 以前，更新文件句柄(`catalog_category_view_*`)与产品句柄不匹配。 [GitHub-27285](https://github.com/magento/magento2/issues/27285)

<!-- MC-40679-->

* 已为管理员产品列表的固定产品税(FPT)列禁用排序。 以前，在对FPT列进行排序后，无法重新加载Products页面。

<!-- MC-40443-->

* 现在，当匹配的产品在每个网站上具有不同的价格时，Page Builder产品小组件预览可在多网站部署中按预期工作。

<!-- MC-40344 ENGCOM-8629-->

* 使用GET的产品搜索中按位置排序 `/rest/V1/products/?searchCriteria[filterGroups]` 现在按预期工作。 以前，产品收藏集中没有字段 `position` 值进行排序。 [GitHub-31591](https://github.com/magento/magento2/issues/31591)

<!-- MC-40122-->

* 管理员用户现在可以在 **名称** 和 **SKU** 产品网格中的字段。 以前，应用程序将多个空格折叠为单个空格。

<!-- MC-39869-->

* 现在，当Admin的可销售数量为0时，产品在店面显示为缺货。 以前，这些产品在店面中以库存形式列出，并且应用程序显示活动 **添加到购物车** 按钮。 [GitHub-31117](https://github.com/magento/magento2/issues/31117)

<!-- MC-39809-->

* 管理员现在可以添加带有可自定义选项的产品 `(File)` 从“管理客户”页面的“购物车”部分（“客户活动”列）转到“订购的商品”网格。 以前，应用程序不会将项目添加到列表中，因为值在插入之前格式不正确 `\Magento\Catalog\Model\Product\Type\AbstractType::_prepareOptions`.

<!-- MC-39619-->

* 该应用程序不再提示购物者为仅有一个选项的捆绑产品选择产品选项。

<!-- MC-39617-->

* 应用程序现在会在创建新小部件的过程中显示布局更新中的所有子类别（锚点和非锚点类别）。

<!-- MC-39481-->

* 此 `product` 仅为一个存储视图更新产品名称时，查询不再覆盖多存储部署中所有存储视图的默认值。 [GitHub-31083](https://github.com/magento/magento2/issues/31083)

<!-- MC-39470 magento/magento2#31492-->

* 当您更改与管理员相关的产品、追加销售和交叉销售列表的每页值时，Magento Open Source会按预期更新总页数。 [GitHub-31059](https://github.com/magento/magento2/issues/31059)

<!-- MC-39444-->

* 管理员现在可以添加具有两个或多个可自定义选项的产品 `(File)` SKU的订单。

<!-- MC-39140-->

* 当具有受限权限的管理员将产品小部件添加到管理员中的CMS页面时，应用程序不再引发错误。 以前，当管理员单击 **保存** 按钮：  `We are sorry, an error has occurred while generating the content`.

<!-- MC-39134-->

* 产品详细信息页面现在会打开，其中填充了可自定义的日期选项，该日期来自前一订单的日期。 **使用JavaScript日历** 已启用。 现在，如果自定义日期选项值解析器的格式不是基于当前配置，则该值解析器会回退到替代格式。 以前，自定义日期选项值为空。

<!-- MC-39104-->

* 当产品缺货时，应用程序现在在购物车中仅显示一个错误。 以前，应用程序显示冗余消息。 [GitHub-27469](https://github.com/magento/magento2/issues/27469)

<!-- MC-38575-->

* 您现在可以设置 `required_options` 和 `has_options` 使用创建或更新捆绑产品时，按预期显示捆绑属性 `POST /V1/product/:sku` 端点。 以前，这些自定义属性设置为0（零），尽管已尝试将其设置为1（一）。

<!-- MC-35717  magento/partners-magento2ee#427-->

* 管理员现在可以添加带有可自定义选项的产品 `(File)` SKU的订单。 [GitHub-30285](https://github.com/magento/magento2/issues/30285)

<!-- MC-30625-->

* 您现在可以保存产品和价格，而无需指定 `type_id`. [GitHub-13639](https://github.com/magento/magento2/issues/13639)

<!-- MC-39024-->

* 现在，当REST时，店面上可按预期提供组产品 `PUT /V1/products/:sku/links` 请求用于将新的子产品与新的组产品相关联。 以前，产品在运行后未正确索引 `bin/magento cron:run`.

<!-- ENGCOM-9010 8947-->

* 您无法再使用创建产品 `NULL` sku值。 以前，您可以通过自定义导入器或直接在数据库中创建没有SKU值的产品，但当您尝试从管理员中编辑该产品时，应用程序会引发错误。 [GitHub-27411](https://github.com/magento/magento2/issues/27411)， [GitHub-32525](https://github.com/magento/magento2/issues/32525)

<!-- ENGCOM-8902-->

* 向简单产品添加所需的自定义选项时，不会再毫无警告地将其从父复合产品中删除。 应用程序现在会显示信息性警告，并且不会保存产品。  以前，应用程序保存了产品更改并且不显示警告。 [GitHub-30492](https://github.com/magento/magento2/issues/30492)

### 目录规则

<!-- MC-39896-->

* 此 `products` 现在，当目录价格规则应用于项目时，查询会返回当前值。 [GitHub-26738](https://github.com/magento/magento2/issues/26738)

<!-- ENGCOM-8367-->

* 以开头的临时表 `catalogrule_product__temp` 当购物车或目录规则过期、被禁用或变得不活动后重新索引失败时，现在会按预期删除。 [GitHub-22273](https://github.com/magento/magento2/issues/22273)

<!-- ENGCOM-8949-->

* 时区现在以相同的方式应用于 `\Magento\CatalogRule\Model\Indexer\IndexBuilder::reindexById` 和 `\Magento\CatalogRule\Model\Indexer\IndexBuilder::reindexByIds`. [GitHub-29549](https://github.com/magento/magento2/issues/29549)

### CMS内容

<!-- MC-41471-->

* 现在，上传期间，大图像会按预期调整大小， **启用前端调整大小** 已启用配置设置。

<!-- MC-40663 ENGCOM-8883-->

* 修复了CMS页面保存控制器的错误处理。 以前，当 `Error` 对象被抛出 `cms_page_prepare_save` 事件，应用程序将此对象传递给 `addExceptionMessage` 函数中，因为此函数需要 `Exception`. 通过使用添加错误消息来解决此问题 `addErrorMessage` 函数。 [GitHub-30149](https://github.com/magento/magento2/issues/30149)

### 可配置产品

<!-- MC-40719-->

* 单击产品的可配置选项时，应用程序不再复制产品图像库中的产品缩略图。

<!-- MC-37418-->

* 现在，当您从希望列表编辑可配置产品时，应用程序显示的配置弹出窗口会在您单击 **确定** 按钮。

<!-- MC-39878  magento/magento2#31472-->

* 现在，应用产品可以正确为仅包含一个可配置产品的订单生成发票。 [GitHub-31143](https://github.com/magento/magento2/issues/31143)

<!-- ENGCOM-8673-->

* 购物者现在可以从非默认商店视图将可配置产品添加到购物车。 以前，当非默认商店视图上的购物者尝试添加可配置产品时，应用程序显示以下错误： `Could not add item to cart. Please check required options and try again`. [GitHub-31660](https://github.com/magento/magento2/issues/31660)

### 内容安全策略(CSP)

<!-- ENGCOM-8577-->

* 内容安全策略现在支持通过以下方式加载base64编码的图像和字体： `data: scheme`.

### cron

<!-- MC-30804-->

* Cron清理查询已重构，以减少或消除以下性能问题： `cron` 作业在挂起状态下仍然卡住，MySQL查询速度越来越慢，CPU使用率增加。 [GitHub-26507](https://github.com/magento/magento2/issues/26507)

<!-- ENGCOM-8571-->

* `cronjobs` 已处于状态 `running` 超过24小时后会自动更改为状态 `error`.  因此，该作业的新实例可以再次运行，并且当作业错误地仍设置为状态时，您无需手动更改作业状态 `running`. 以前，如果 `cronjob` 卡在状态 `running`，应用程序阻止启动同一作业的新实例，您必须手动更改作业状态。 [GitHub-8933](https://github.com/magento/magento2/issues/8933)

<!-- ENGCOM-8571-->

* `cron` 作业现在按预期完成，不会再引发此序列化错误：  `[Magento\Framework\DB\Adapter\DeadlockException]SQLSTATE[40001]: Serialization failure: 1213 Deadlock found when trying to get lock; try restarting transaction, query was: DELETE FROM cron_schedule WHERE (status = 'missed') AND (job_code in ('indexer_reindex_all_invalid', 'indexer_update_all_views', 'indexer_clean_all_changelogs')) AND (created_at < '2018-09-28 18:32:28')`. [GitHub-18409](https://github.com/magento/magento2/issues/18409)

<!-- ENGCOM-8571-->

* `indexer_update_all_views`  cron作业现在可在以前的失败后按预期运行。 失败的运行在 `cron_schedule schedule`，后续运行不会自动失败。 以前， `cron_schedule` 填充了待处理作业的表，以及 `indexer_update_all_views` cron作业未运行。 [GitHub-23054](https://github.com/magento/magento2/issues/23054)

<!-- ENGCOM-8571-->

* `cron` 死锁不再由导致 `cron` 尝试在组重叠的大型部署中设置锁定。 [GitHub-8933](https://github.com/magento/magento2/issues/8933)

<!-- ENGCOM-8571-->

* `cron` 死锁不再发生在 `cron_schedule` 表格仅保留几个 `cron` 作业已运行。 [GitHub-22438](https://github.com/magento/magento2/issues/22438)

### 自定义客户属性

<!-- MC-41611-->

* 此 **状态** 店面客户帐户通讯簿中的字段现在加载为，并保留为下拉页面元素。 此 **提交** 现在，在完全加载所有页面元素之前，按钮处于禁用状态。 以前，应用程序在将此字段渲染为下拉元素之前将其加载为文本框，购物者可以在文本字段中输入并保存值，这稍后会导致结帐时出错。

<!-- MC-40329-->

* 在上传文件时，当您在“管理客户地址”字段中保存带有文件附件的客户地址属性时，应用程序不再引发错误。 发生此问题的原因是，控制器操作中缺少返回语句。 以前，应用程序引发此错误： `Something went wrong while saving the file`.

<!-- MC-39354-->

* 现在，RESTGET车API调用会返回帐单和送货地址的正确自定义属性值。 以前，自定义地址属性在“我的帐户店面”页面和“管理员”的订单详细信息页面中显示不正确。

<!-- MC-24495-->

* 该应用程序现在可以成功处理包含输入类型的客户地址属性的文件 `file (attachment)`. 以前，应用程序在上传附加文件期间抛出此错误： `Something went wrong while saving the file`.

### 客户

<!-- MC-40579-->

* 现在，按帐户创建日期过滤可生成符合配置的时区设置并捕获所有相关已创建帐户的结果。

<!-- MC-40502-->

* 如果之前缓存了数据，则客户网格过滤器现在为受限制用户使用正确的网站选项。 以前，客户网格过滤器从缓存中检索网站参数，并为受限制的用户包含不正确的数据。

<!-- MC-39189-->

* 当多网站部署中删除一个网站时，应用程序不再在“管理员客户”页面上引发异常。 以前，当管理员尝试访问全面的客户列表时，应用程序未显示所有客户，并显示以下错误： `The website with id 2 that was requested wasn't found. Verify the website and try again`.

<!-- MC-38913-->

* 具有权限的管理员现在可以从客户的“帐户信息”选项卡将客户重新分配到不同的网站。

<!-- MC-39852-->

* 现在，在创建输入类型的客户地址属性时，您可以成功上传文件 `(File)`. 以前，当您尝试上载并保存文件时，应用程序会引发以下错误： `Something went wrong while saving the file`.

### 目录

<!-- MC-39520-->

* 当购物者在结帐工作流的配送区段输入无效的邮政编码时，应用程序不再引发异常。 [GitHub-23371](https://github.com/magento/magento2/issues/23371)

### 可下载

<!-- MC-35779-->

* 现在，当订单包含可下载的产品和具有可下载选项的可配置产品时，应用程序会在新订单电子邮件中显示可下载产品的链接。 以前，应用程序显示指向独立的可下载产品的链接，但不会显示指向具有可下载选项的可配置产品的链接。

### EAV

<!-- MC-41756-->

* 客户地址属性日期值现在以四位数格式而不是两位数格式保存。

### 电子邮件

<!-- MC-39757-->

* 管理员重置密码页面上的密码重置链接现在可按预期工作。 以前，当自定义模板用于重置管理员密码页面时，应用程序在管理员单击电子邮件内的链接时显示此消息： `Your password reset link has expired`. 发生此情况是因为自定义电子邮件模板包含用户ID的错误变量。

<!-- MC-41588-->

* 现在，如果在商店视图级别启用，则从管理员那里发送客户电子邮件可以正常使用。 以前，在商店视图级别而不是全局级别启用电子邮件通知设置时，应用程序不会发送客户电子邮件。

<!-- MC-40950-->

* 现在，应用程序会按预期在多站点部署中发送电子邮件，因为并非所有网站都启用了异步电子邮件发送。 以前，如果至少有一个网站禁用了此设置，那么即使启用了此设置，也不会从任何网站发送电子邮件。 发票、发运和贷项通知单电子邮件具有类似的问题。 但是，已成功发送订单备注、发票备注、发运备注和贷项通知单备注电子邮件。 [GitHub-31950](https://github.com/magento/magento2/issues/31950)

<!-- MC-30127 magento/magento2#31455-->

* 发票和发票PDF现在包含与预期相同的捆绑产品价格。 以前，发票PDF包含的捆绑产品价格不正确。 [GitHub-12856](https://github.com/magento/magento2/issues/12856)

<!-- ENGCOM-9021-->

* 已向电子邮件模板筛选方法中添加字符串转换，以确保返回值为 `string`. 以前，当未处于开发人员模式时捕获到异常时，应用程序返回 `phrase` 对象。 这进而触发了致命攻击 `Uncaught TypeError`. [GitHub-32671](https://github.com/magento/magento2/issues/32671)

<!-- ENGCOM-8807-->

* 现在，启用异步发送后，订单确认电子邮件会按预期发送(**商店**  >  **配置**  >  **销售**  > **销售电子邮件**  >  **常规设置**  >  **异步发送**)。 [GitHub-31950](https://github.com/magento/magento2/issues/31950)

<!-- MC-18023 ENGCOM-9000-->

* 当客户尝试从“联系我们”表单发送电子邮件时出现异常时，应用程序现在会按预期记录错误。 [GitHub-23645](https://github.com/magento/magento2/issues/23645)

### 框架

<!-- MC-41712-->

* 现在会检查Admin中的父类是否存在docblock注释，以及原始类和继承的接口。 以前，由于未检查父类，因此在Admin中执行任何触发事件的与客户相关的操作都会导致错误。 应用程序在异常日志中记录此错误： `report.CRITICAL: Method's return type must be specified using @return annotation.`.

<!-- MC-41192-->

* 在启用了Redis页面缓存的部署中停止Redis服务器时，应用程序不再引发致命错误。

<!-- MC-40739-->

* 该申请现在遵守 **从备份中排除介质文件夹** 启用备份时的设置 `bin/magento config:set system/backup/functionality_enabled 1`. 以前，尽管进行了此设置，但介质文件夹仍会进行备份，因为 `/magento` 用双//格式不正确。

<!-- MC-40654 ENGCOM-8881-->

* 该应用程序现在会按预期翻译“管理购物车”页面上的所有可翻译字符串。 以前，转换加载发生得太晚，并跳过所有订阅控制器操作预调度的观察者。 [GitHub-31849](https://github.com/magento/magento2/issues/31849)

<!-- MC-39776-->

* 现在，当 **客户登录** “启用扩展”设置已禁用。 以前，应用程序抛出JavaScript错误。

<!-- MC-39193-->

* 由分支的子进程的异常处理 `ProcessManager` 已得到改进。 现在发生异常时，主进程将退出，并且只显示一次错误消息。 以前，会记录多个索引器故障并显示多个消息。 [GitHub-30622](https://github.com/magento/magento2/issues/30622)

<!-- MC-39132-->

* 全局Magento Open Source插件(例如， `webapi_rest` 和 `graphql` )时，将不再为新自定义区域类型触发 `di.xml` 此文件不包含已注册的插件。

<!-- MC-38770-->

* 初始化期间发生的异常不再缓存，现在会触发500响应代码。

<!-- ENGCOM-8232-->

* 最后一个处理程序合并到 `communication.xml` 文件不再覆盖之前创建的所有处理程序。 [GitHub-29528](https://github.com/magento/magento2/issues/29528)

### 常规修复

<!-- MC-41194-->

* 现在，应用程序在“我的产品评论”页面和“我的帐户”页面上显示最近评论的正确星数。 以前，该应用程序仅对第一次审阅应用审阅星标，而页面上其他审阅则不被选中。

<!-- MC-40653-->

* 标头中的帐户链接现在遵循WCAG标准。 以前，标头中的帐户链接包含重复的ID，这会导致WCAG验证失败。

<!-- MC-39765-->

* 当访客购物者使用无效地址时，应用程序不再引发系统日志生成的错误。 以前，应用程序会间歇性地显示此错误，而不是呈现页面： `No such entity with addressId`. [GitHub-15115](https://github.com/magento/magento2/issues/15115)

<!-- MC-39747-->

* 对于格式不受支持的图像，图像大小调整过程不再暂停。 以前，何时 `catalog:images:resize` 遇到不受支持的图像格式，进程已停止，应用程序显示此错误： `bin/magento catalog:images:resize Unsupported image format`.

<!-- ENGCOM-8925-->

* 管理员已添加对徽标图像的WEBP和AVIF支持。 [GitHub-32495](https://github.com/magento/magento2/issues/32495)

<!-- MC-38156-->

* 您无法再更改 `media_gallery` 属性。 以前，当您更改 `media_gallery` 属性返回 `global`，应用程序引发错误。

<!-- MC-36818  magento/partners-magento2ee#470-->

* 在更新结束日期之后，作为计划更新添加的相关产品将不再显示在店面产品页面上。 [GitHub-469](https://github.com/magento/partners-magento2ee/issues/469)

<!-- MC-33499 magento/partners-magento2ee#446-->

* 选择实体类型后，筛选功能现在可在计划导出列表中按预期工作。 以前，过滤器不起作用，并且应用程序抛出JavaScript错误。 [GitHub-361](https://github.com/magento/partners-magento2ee/issues/361)

<!-- MC-30084 ENGCOM-8674-->

* 现在，类别图像可按预期从 `catalog/tmp/category` 目录到 `catalog/category` 使用数据库存储方法保存类别时的目录。 中的图像行 `media_storage_file_storage` 表格现在也具有正确的内容 `directory_id`. [GitHub-11995](https://github.com/magento/magento2/issues/11995)

<!-- MC-24768-->

* 在向CMS层次结构提交更改后，商家现在会按预期收到有关失效缓存的通知。 以前，应用程序在保存CMS层次结构时不会使缓存失效。

<!-- MC-24725-->

* 对购物车的购物车部分的冗余AJAX请求已减少。 以前，应用程序未正确加载购物车小计，这会再次触发购物车重新加载。

<!-- MC-23740-->

* 添加了对URL的验证，以防止在URL键中包含保留字。 参见 [定义已知统一资源标识符(URI)](https://tools.ietf.org/html/rfc5785)

<!-- ENGCOM-9037-->

* 在运行PHP 7.4的部署中，当应用程序运行 **生成“类别/产品”URL重写** 设置已设置为 **否**，购物者会尝试访问不存在的类别路径。 以前，应用程序返回500错误，指出： `Trying to access array offset on value of type bool`. [GitHub-31984](https://github.com/magento/magento2/issues/31984)

<!-- ENGCOM-8901-->

* `nowdoc` 已替换 `heredoc` 在 `Magento_Backend` 存储切换器。 [GitHub-32262](https://github.com/magento/magento2/issues/32262)

<!-- ENGCOM-8685-->

* 阿根廷、玻利维亚、智利、厄瓜多尔尔、圭亚那、巴拉圭、秘鲁、苏里南和委内瑞拉地区已加入 `directory_country_region` 表格。 [GitHub-31169](https://github.com/magento/magento2/issues/31169)

<!-- ENGCOM-8505-->

* 阿尔巴尼亚、丹麦、希腊、冰岛、葡萄牙和瑞典等地区也加入其中 `directory_country_region` 表格。 [GitHub-31040](https://github.com/magento/magento2/issues/31040)

<!-- MC-30104 magento/magento2#31480 -->

* 现在，当发生异常时，消息会在MysqlMQ消息队列中标记为错误。 [GitHub-18140](https://github.com/magento/magento2/issues/18140)

<!-- ENGCOM-8579-->

* 现在，在为管理员贷项通知单和发票页加载税务信息时，应用产品会引用正确的分类对象。 [GitHub-31197](https://github.com/magento/magento2/issues/31197)

<!-- MC-40346-->

* Royal Mail Click &amp; Drop集成现在按预期工作。 以前，当您尝试激活其集成时，应用程序会引发此错误： `Sorry! Something went wrong. Please try again later`. [GitHub-28996](https://github.com/magento/magento2/issues/28996)

<!-- ENGCOM-8498-->

* 现在，在URL中传递了错误的发运、贷项通知单或发票ID时，应用产品将显示一则信息性错误消息。 以前，应用程序抛出致命错误。 [GitHub-30424](https://github.com/magento/magento2/issues/30424)

<!-- ENGCOM-8632-->

* 已删除静态文件位置的递归。  应用程序现在显示404页而不是500错误。 以前，默认NGINX配置中的错误会导致无限递归。 [GitHub-31530](https://github.com/magento/magento2/issues/31530)

<!-- ENGCOM-8550-->

* 的名称 `cms_index_noroute.xml` 文件已更正为 `cms_noroute_index.xml`. [GitHub-31300](https://github.com/magento/magento2/issues/31300)

<!-- ENGCOM-8516-->

* 此 `.editorconfig` 文件已重构，以更正 `db_schema_whitelist.json` 文件。 [GitHub-31171](https://github.com/magento/magento2/issues/31171)

<!-- ENGCOM-9018-->

* 调整浏览器窗口大小不再触发重复的绑定放大镜事件。 [GitHub-30788](https://github.com/magento/magento2/issues/30788)

<!-- ENGCOM-8722-->

* 应用程序在筛选时不再引发SQL异常 `Magento\Users\Model\ResourceModel\Users\Collection` 作者： `user_id`. [GitHub-31216](https://github.com/magento/magento2/issues/31216)

### 礼品卡

<!-- MC-32651-->

* 价格范围验证逻辑已添加到礼品卡创建页面。 以前，管理员可创建一个卡片，其最小值超过最大值。 [GitHub-493](https://github.com/magento/partners-magento2ee/issues/493)

<!-- MC-32638979 magento/partners-magento2ee#40851-->

* 此 `addRequisitionListItemsToCart` 现在，当请求不包含的值时，查询会按预期返回自定义礼品卡的金额 `allow_open_amount`.

### 礼品消息

<!-- ENGCOM-8539-->

* 现在，管理员在登录后直接重定向到所请求的“管理员”页面。  以前，当管理员登录时，他们会被重定向到管理员功能板（或配置为启动页面的任何页面），并且必须手动导航到他们的目标。 [GitHub-31042](https://github.com/magento/magento2/issues/31042)

### Google标签管理器

<!-- MC-39072-->

* 现在，启用Google Tag Manager后，结账工作流付款页面上账单地址的UI组件可正确使用报价地址。 以前，支付页面上发生JavaScript错误。

### GraphQL

<!-- MC-41885-->

* GraphQL `products` 现在，查询会返回按“属性编辑”页面上使用的相同排序顺序排序的属性选项。

<!-- MC-41473-->

* 对的响应 `{ category(id: 2){ children { name children { name } } } }` GraphQL请求现在包含正确排序的类别树。

<!-- MC-41030-->

* 此 `CartItemPrices` 对象现在包含新的GraphQL字段 `fixed_product_taxes`，返回应用于购物车项目的固定产品税的数组。 以前，应用于购物车项目的固定产品税不包括在购物车查询中。

<!-- MC-40920-->

* 对GraphQL的空请求现在引发响应代码200而不是500。 以前，GraphQL解析器在生成查询结果之前抛出异常。

<!-- MC-40867 magento/partners-magento2ee#532 -->

* 此 `applyRewardPointsToCart` 变异现在更新了购物车的全部总计，以准确反映扣除的奖励点数的值。 [GitHub-486](https://github.com/magento/partners-magento2ee/issues/486)

<!-- MC-40379-->

* 使用GraphQL链接追加销售产品时，GraphQL响应中不再包含禁用的产品。

<!-- MC-40262-->

* 商家现在可以使用GraphQL `setShippingAddressesOnCart` 在禁用访客结帐时为购物车的帐单和送货地址设置的方法。

<!-- MC-39508-->

* 此 `categoryList` 查询在上包含多个片段时，不再引发异常 `CategoryTree` 对象。 [GitHub-31086](https://github.com/magento/magento2/issues/31086)

<!-- MC-38995-->

* GraphQL `product` query现在返回正确的客户组价格。

<!-- MC-38822-->

* GraphQL `products` 查询响应现在根据产品属性位置对聚合进行排序。

<!-- ENGCOM-8462-->

* 当产品和类别URL后缀包含null值时，应用程序在GraphQL查询期间不再引发类型错误。 [GitHub-30909](https://github.com/magento/magento2/issues/30909)

<!-- magento/magento2#31164-->

* 此 `CustomizableDateValue` 对象现在包含 `type` 属性。 其值是一个可设置为DATE、DATE_TIME或TIME的枚举。

<!--  magento/partners-magento2ee#421-->

* 此 [`dynamicBlocks` 查询](https://devdocs.magento.com/guides/v2.4/graphql/queries/dynamic-blocks.html) 返回与指定过滤器匹配的动态块的内容。

<!-- ENGCOM-8603-->

* POST `V1/products/special-price-delete` 请求现在仅删除具有指定的价格 `store_id` 如预期。 以前，该调用会从所有商店中移除指定SKU的所有特殊价格。 [GitHub-25907](https://github.com/magento/magento2/issues/25907)

<!--  magento/partners-magento2ee#280 -->

* 修复了错误 `country_code` 中的属性 `createGiftRegistry` 突变。

<!-- magento/partners-magento2ee#280 -->

* 修复了的问题 `giftRegistryUid` 的属性 `updateGiftRegistryItems` 突变。

<!-- magento/partners-magento2ee#280 -->

* 添加了额外的检查以防止 `updateGiftRegistryRegistrants` 变体，用来将随机人作为注册者添加到礼品注册表。

<!-- magento/magento2#31380 -->

* 此 `addConfigurableProductsToCart` 现在，突变可返回指定产品的正确缩略图。 以前，它会返回父产品的缩略图。

<!-- ENGCOM-8477-->

* 此 `products` 为将来日期设置特殊价格时段时，查询不再公开产品的特殊价格。 [GitHub-30210](https://github.com/magento/magento2/issues/30210)， [GitHub-29631](https://github.com/magento/magento2/issues/29631)

<!-- magento-engcom/magento2ee#576-->

* 此 `customer` 查询响应现在包括 `total_giftcard` 属性作为的一部分 `OrderTotal` 对象。

<!-- MC-41084 ENGCOM-9042 -->

* 更正了导致出现以下问题的原因： `products` 查询以返回有关没有层定价集的项目的价格层的错误信息。 [GitHub-32279](https://github.com/magento/magento2/issues/32279)

### 图像

<!-- MC-38951-->

* 使用POST创建或更新捆绑产品时，现在可以按预期设置required_options和has_options捆绑属性 `/V1/product/:sku` 端点。 以前，这些自定义属性设置为0（零），尽管已尝试将其设置为1（一）。

### 导入/导出

<!-- MC-41576-->

* 现在，导出页面实体属性网格中产品实体的类别ID过滤器可按预期工作。

<!-- MC-41439-->

* 现在，当所有子产品缺货时，分组的产品库存状态会按预期更新，显示为缺货。 [GitHub-32647](https://github.com/magento/magento2/issues/32647)

<!-- MC-41184-->

* 现在，当子产品库存状态通过导入进行更新时，可配置产品库存状态会按预期自动更新。 以前，当子产品库存状态通过导入更新时，产品库存状态不会自动更新。

<!-- MC-41151-->

* 您现在可以在计划导出中保存空值。 以前，应用程序会在创建或保存导出后更新空筛选器值。 两者 `no` 和 `not specified` 值在数据库中以零表示，其值为 `not selected` 被覆盖 `no`.

<!-- MC-41092-->

* 现在，在导出产品、库存来源和客户实体时，导出过程会考虑用户角色范围。 以前，导出过程忽略用户角色范围，该范围允许导出专用用户角色导出实体。

<!-- MC-40943-->

* 应用产品现在将产品税分类设置为 `None` 如果使用导入产品 `tax_class_name` 值 `None` 或 `0`. 以前，如果 `product tax_class_name` 为 `None` 在CSV文件中，应用程序创建一个新的税分类 `None`，与现有的税分类重复。 如果 `product tax_class_name` 为 `0` 在CSV文件中，应用程序忽略了该值，产品税分类在导入后没有变化。

<!-- MC-40898-->

* 管理员现在可以成功更改 `name` 捆绑产品的 `bundle_values` 来自管理员。 以前，在您从管理员更改名称后，应用程序在店面上将产品显示为缺货。 产品还与同一SKU合并到一个捆绑包选项部分中。

<!-- MC-40333-->

* 现在，在导出客户数据时，应用程序会考虑用户范围。 以前，当您尝试导出客户时，应用程序会从所有网站导出客户数据。

<!-- MC-40305-->

* 现在，该应用程序在CSV文件导入期间，会按预期删除向上销售、交叉销售和相关产品之间的产品关系。 `__EMPTY__VALUE__` 在CSV文件中指定。

<!-- MC-40012-->

* 导出许多客户的自定义地址数据（管理员） **系统** > **导出**)不再会定期导致内存错误。 以前，在导出自定义地址数据时，应用程序尝试加载所有客户数据，这会导致内存耗尽，并且应用程序会引发内存分配失败错误。

<!-- MC-39977-->

* 在默认CSV导入过程中，不再导入重复层价格。 以前，缺少验证以防止输入重复层价格，当发生重复层价格时，商家无法保存产品。 商家在尝试安排产品更改时也看到此错误： `SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry…`.

<!-- MC-39609  magento/magento2#31397-->

* 现在，所有产品映像都将在导入期间进行验证。 以前，当产品具有多个映像时，应用程序仅验证第一个映像。 [GitHub-28236](https://github.com/magento/magento2/issues/28236)

<!-- MC-39483-->

* 现在，您可以在导入期间按预期从客户地址中删除区域。 以前，当客户地址以空区域导入时，分配区域不会更改。

<!-- MC-38810-->

* 现在，将包含JSON或HTML内容的产品正确导出为CSV文件。 以前，CSV文件在不正确的字段中包含重叠的数据字符串。

### 索引

<!-- MC-39718 ENGCOM-8567-->

* 当子进程失败时，进程管理器现在退出，并出现错误。 以前，如果传递给Process Manager的函数数（例如，索引器维度）低于 `MAGE_INDEXER_THREADS_COUNT` 环境变量。 [GitHub-30964](https://github.com/magento/magento2/issues/30964)

<!-- MC-39272-->

* 使用RESTPUT链接产品时，现在可在店面搜索结果中按预期提供产品 `/V1/products/:sku/links` 当索引器模式设置为时请求 **保存时更新**.

<!-- MC-38310 magento/magento2#32693-->

* 现在，当索引器模式设置为时，目录价格规则索引器可按预期工作 **保存时更新**. [GitHub-370](https://github.com/magento/partners-magento2ee/issues/370)

<!-- ENGCOM-8890-->

* 现在，删除不包含产品的已禁用类别对目录搜索和类别平面索引表没有影响。 以前，删除非活动类别会触发完全重新索引。 [GitHub-23297](https://github.com/magento/magento2/issues/23297)

<!-- ENGCOM-8599 8474-->

* 自定义索引器现在可以为订阅使用不同的实体列名称。 以前，数据库触发器使用索引器中上次设置为的列名 **按计划更新** 而不是指定的索引器。 [GitHub-21853](https://github.com/magento/magento2/issues/21853)

<!-- ENGCOM-8887-->

* 应用程序不再发送AJAX请求以重新加载客户数据部分(`Magento_Customer/js/section-config`)，不受请求影响。 [GitHub-31948](https://github.com/magento/magento2/issues/31948)

<!-- MC-39569-->

* 在类别中添加、删除或重新排序产品后，以下索引器不再失效： `catalog_category_product` 和 `catalogsearch_fulltext` （以及他们的家属）。 以前，这些意外移除会触发对站点的完全重新索引。 现在，当未启用平面目录时，在这些情况下将阻止完全重新索引。

### 基础架构

<!-- MC-41445-->

* 依赖关系 `pelago/emogrifier` 已从版本3.1.0更新到5.0.0。此更新导致对引入了向后不兼容的更改 `Magento\Email\Model\Template\Filter` 类。 在电子邮件模板渲染期间执行更改的代码。 参见 [BIC参考](https://developer.adobe.com/commerce/php/development/backward-incompatible-changes/reference/).

<!-- MC-42212-->

* 更正了以下问题： `\Magento\CatalogInventory\Model\Indexer\Stock\CacheCleaner::getCategoryIdsByProductIds` 无法保存新产品。

<!-- MC-42199-->

* 已弃用的TinyMCE v3库已被删除。 此 `Magento_Tinymce3Banner` 与TinyMCE v3.x相关的模块和MFTF测试已从Adobe Commerce中删除。

<!-- MC-41497-->

* 应用程序不再抛出 `Invalid header value detected` 当购物者输入包含法语变音标记（例如“é”、“e”）的电子邮件地址时，“联系我们”表单上出现错误。 应用程序现在将用户名中的UTF-8字母转换为ASCII编码。 以前，UTF-8字母不会在电子邮件地址的唯一部分中转换为ASCII编码。

<!-- MC-39947-->

* 将插件添加到父类时，应用程序不再引发PHP致命错误。 [GitHub-31291](https://github.com/magento/magento2/issues/31291)

<!-- ENGCOM-9012-->

* 更新了以下模块的README.md文件： `Magento_Msrp`， `Magento_MsrpConfigurableProduct`， `Magento_MsrpGroupedProduct`， `Magento_Multishipping`， `Magento_MysqlMq`. [GitHub-32577](https://github.com/magento/magento2/issues/32577)

<!-- magento/partners-magento2ee#501-->

* `phpcpd` 已更新至v6.0.3，以兼容PHP 8。

<!-- ENGCOM-9073-->

* `ramsey/uuid` 更新了以兼容PHP 8.0。 [GitHub-31777](https://github.com/magento/magento2/issues/31777)， [GitHub-826](https://github.com/magento/magento2-functional-testing-framework/issues/826)

<!-- ENGCOM-8997-->

* `colinmollenhour/php-redis-session-abstract` 已更新至v1.4.4，以兼容PHP 8。 [GitHub-32709](https://github.com/magento/magento2/issues/32709)

<!-- ENGCOM-8527-->

* 更正了中的制表符和空格无效组合 `phpstan.neon` 文件。 [GitHub-31239](https://github.com/magento/magento2/issues/31239)

<!-- ENGCOM-8668-->

* 移除了对过时资产的使用 `$_isScopePrivate` 整个代码库。 [GitHub-30506](https://github.com/magento/magento2/issues/30506)

<!-- ENGCOM-8551-->

* 不再对页面布局进行硬编码  `Magento\Widget\Block\Adminhtml\Widget\Instance\Edit\Chooser\Container`.  因此， `getPageLayouts()` 函数现在会按预期返回由不同模块声明的实际页面布局列表。 以前，只返回硬编码布局。 [GitHub-31168](https://github.com/magento/magento2/issues/31168)

<!-- ENGCOM-8509-->

* 此 `composer.lock` 文件已更新至编码标准的最新版本。 [GitHub-31152](https://github.com/magento/magento2/issues/31152)

<!-- ENGCOM-9015 -->

* 添加了一个缺失的依赖项 `web-token/jwt-framework` 打包到 `magento/module-jwt-framework-adapter`. [GitHub-32578](https://github.com/magento/magento2/issues/32578)

<!-- ENGCOM-9019 -->

* 被动监听器已添加到 `fotorama.js` 库以提高Lighthouse量度分数。 [GitHub-31140](https://github.com/magento/magento2/issues/31140)

<!-- ENGCOM-9014 -->

* 更新了Google Analytics模块的README.md文件。 [GitHub-32616](https://github.com/magento/magento2/issues/32616)

<!-- ENGCOM-8375 -->

* Process Manager现在可以正确处理分支流程中的异常。 主进程现在退出，应用程序现在只显示一次错误消息。 此外，现在，当分支进程中抛出异常时，会处理这些异常。 以前，应用程序记录多个索引器故障并显示多个错误消息。  [GitHub-30622](https://github.com/magento/magento2/issues/30622)

<!-- ENGCOM-8544 -->

* 将插件添加到父类时，应用程序不再引发错误。 (此 `optionsProvider` 现在，参数声明于 `getContentIdentities` 在 `Assest.php`.) 以前，应用程序引发此错误：  `Error: Cannot instantiate interface Magento\Framework\Data\OptionSourceInterface`. [GitHub-31291](https://github.com/magento/magento2/issues/31291)

<!-- ENGCOM-8549 -->

* 正在执行 `Magento\Framework\Filesystem\Io\Ftp::ls()` 现在，空文件夹上会按预期返回空数组。 以前，应用程序引发此异常： `Invalid argument supplied for foreach() in vendor/magento/framework/Filesystem/Io/Ftp.php…`. [GitHub-31288](https://github.com/magento/magento2/issues/31288)

<!-- ENGCOM-8791 -->

* 此 `update` 角色和规则的方法在中已标记为已弃用 `app/code/Magento/Authorization/Model/Role.php`. [GitHub-30756](https://github.com/magento/magento2/issues/30756)

<!-- ENGCOM-8946 -->

* SameSite Cookie参数的连接已得到纠正。 以前，不正确的连接会将 `lex` 后缀至 `value`， `domain`和其他参数。 [GitHub-26377](https://github.com/magento/magento2/issues/26377)， [GitHub-32440](https://github.com/magento/magento2/issues/32440)

<!-- ENGCOM-8698 ENGCOM-9034 -->

* `allure-framework/allure-phpunit` 已在整个代码库中升级到v1.3.1。 以前，应用程序显示此错误：  `Warning: Use of undefined constant GLOB_BRACE - assumed 'GLOB_BRACE' (this will throw an Error in a future version of PHP) in /var/www/html/src/vendor/allure-framework/allure-phpunit/src/Yandex/Allure/Adapter/AllureAdapter.php:74.` [GitHub-24635](https://github.com/magento/magento2/issues/24635)

<!-- ENGCOM-8783 -->

* 应用程序现在会在运行错误时显示更多信息性错误 `bin/magento` 命令的生产模式。 以前，应用程序不显示错误消息或显示的消息缺少信息。 [GitHub-32786](https://github.com/magento/magento2/issues/32786)

<!-- ENGCOM-8953 -->

* 此 `ArrayIterator` 更新了PHP对象，使其可与PHP 7.4正常配合使用。 [GitHub-32088](https://github.com/magento/magento2/issues/32088)

<!-- ENGCOM-8469 -->

* 当客户尝试在没有可用的装运承运人时完成订单时，应用程序不再引发错误。 而是显示结帐页面和以下消息： `Sorry, no quotes are available for this order at this time`. 以前，应用程序显示一个空白的结账页面，并在异常日志中记录此消息： `array_keys() expects parameter 1 to be array, null given`. [GitHub-30830](https://github.com/magento/magento2/issues/30830)

<!-- ENGCOM-8557 -->

* 应用程序不再将每个Cookie记录为单独的上下文。 此 `$_COOKIE` 数组也已转换为字符串。 以前，由于每个Cookie都记录为单独的上下文，因此，当Cookie数量超过50时，应用程序会记录以下消息： `Unable to send the cookie. Maximum number of cookies would be exceeded`. [GitHub-31334](https://github.com/magento/magento2/issues/31334)

### 发票

<!-- ENGCOM-8472 -->

* 在Admin中创建新发票时， **电子邮件副本** 复选框现在按预期工作。 以前，如果在中启用了发送发票电子邮件的全局设置，则会忽略该复选框 **销售电子邮件**. 它现在具有一致性，其操作方式与发运和贷项通知单创建页面相同。 [GitHub-28511](https://github.com/magento/magento2/issues/28511)

### 媒体集

<!-- MC-41728-->

* `bin/magento media-gallery:sync` 现在，在处理缺少XMP信息的PNG图像时，会按预期失败。

<!-- ENGCOM-8814-->

* 中的条目 `catalog_product_entity_media_gallery` 表会在删除相关产品时按预期删除。 [GitHub-17727](https://github.com/magento/magento2/issues/17727)

<!-- ENGCOM-8945-->

* 启用JavaScript缩小功能后，现在可以在媒体集中更新图像详细信息。 以前，图像详细信息未保存，应用程序显示此错误： `TypeError: Cannot read property 'call' of undefined in jquery.validate`. [GitHub-31633](https://github.com/magento/magento2/issues/31633)

### MFTF

中介绍了新功能和MFTF核心错误修复 [功能测试框架更改日志](https://github.com/magento/magento2-functional-testing-framework/blob/develop/CHANGELOG.md).

<!-- ENGCOM-8496-->

* 此 `magento indexer:reindex` 和 `cache:flush` 命令和 `AdminReindexAndFlushCache` 操作组已从测试中删除，以改进以下模块的执行： `Bundle`， `Catalog`， `CatalogRule`， `CatalogRuleConfigurable`， `CatalogUrlRewrite`， `Downloadable`， `Indexer`， `Paypal`、和 `Sales`. [GitHub-31031](https://github.com/magento/magento2/issues/31031)

<!-- ENGCOM-8562-->

* `AdminSubmitCategoriesPopupActionGroup` 已添加到测试中，以防止测试失败。 [GitHub-31251](https://github.com/magento/magento2/issues/31251)

<!-- ENGCOM-8562-->

* 测试已重构为 `StorefrontCheckQuickSearchStringActionGroup` 和 `StorefrontAssertProductNameOnProductMainPageActionGroup` （现有操作组）。 [GitHub-31251](https://github.com/magento/magento2/issues/31251)

#### 重构的测试

以下测试已重构以缩短执行时间：

`AddOutOfStockProductToCompareListTest`  <!-- ENGCOM-8547-->

`AdminApplyTierPriceToProductWithPercentageDiscountTest` <!-- ENGCOM-8522-->

`AdminCheckingCreditMemoTotalsTest` <!-- ENGCOM-8606-->

`AdminCheckDashboardWithChartsTest` <!-- ENGCOM-8897-->

`AdminConfigDefaultProductLayoutFromConfigurationSettingTest`  <!-- ENGCOM-8891-->

`AdminCreateInvoiceTest` <!-- ENGCOM-8581-->

`AdminCreateOrderAddProductCheckboxTest` <!-- ENGCOM-8492-->

`AdminMassOrdersCancelCompleteAndClosedTest` <!-- ENGCOM-8538-->

`AdminMassOrdersCancelProcessingAndClosedTest`  <!-- ENGCOM-8670-->

`AdminMassOrdersHoldOnCompleteTest`  <!-- ENGCOM-8897-->

`AdminMassOrdersHoldOnPendingAndProcessingTest`  (已弃用的替换 `AdminMassOrdersHoldOnPendingAndProcessingTest`) <!-- ENGCOM-8669-->

`AdminMassOrdersUpdateCancelPendingOrderTest` <!-- ENGCOM-8602-->

`AdminMassProductPriceUpdateTest` <!-- ENGCOM-8587-->

`AdminMassUpdateProductAttributesMissingRequiredFieldTest` <!-- ENGCOM-8511-->

`AdminOrdersReleaseInUnholdStatusTest`  <!-- ENGCOM-8592—-->

`AdminPanelIsFrozenIfStorefrontIsOpenedViaCustomerViewTest`  <!-- ENGCOM-8601-->

`AdminSortingByWebsitesTest`  <!-- ENGCOM-8583-->

`AdminUpdateSimpleProduct` <!-- ENGCOM-8536-->

`AdminUpdateSimpleProductWithRegularPriceInStockEnabledFlatTest`  <!-- ENGCOM-8533-->

`AdminValidateShippingTrackingNumberTest`  <!-- ENGCOM-8593-->

`CancelOrdersInOrderSalesReportTest`  <!-- ENGCOM-8591-->

`ProductsQtyReturnAfterOrderCancelTest` <!-- ENGCOM-8506-->

`StorefrontConfigurableProductBasicInfoTest`  <!-- ENGCOM-8711-->

#### 操作组

在以下测试中，重复性活动已由活动组替换：

`AdminCheckConfigurableProductPriceWithDisabledChildProductTest`  <!-- ENGCOM-8574-->

`AdminConfigurableProductCreateTest` <!-- ENGCOM-9013-->

`AdminConfigurableProductRemoveAnOptionTest` <!-- ENGCOM-9038-->

`AdminCreateProductDuplicateUrlkeyTest` <!-- ENGCOM-9007-->

`AdminCreateSimpleProductNegativePriceTest` <!-- ENGCOM-900-->

`AdminCreateSimpleProductZeroPriceTest`  <!-- ENGCOM-9040-->

`AdminCreateVirtualProductFillingRequiredFieldsOnlyTest` <!-- ENGCOM-9003-->

`AdminUpdateSimpleProductWithRegularPriceInStockDisabledProductTest` <!-- ENGCOM-9002-->

`AdminUpdateSimpleProductWithRegularPriceInStockNotVisibleIndividuallyTest`  <!-- ENGCOM-9011-->

`AdminUpdateSimpleProductWithRegularPriceInStockVisibleInCatalogOnlyTest`  <!-- ENGCOM-9041-->

#### 新建操作组

`AdminClearFiltersOnGridActionGroup` <!-- ENGCOM-8604-->

`AdminClickAddNewPageOnPagesGridActionGroup`  <!-- ENGCOM-8613-->

`AdminClickInsertWidgetActionGroup` <!-- ENGCOM-8614-->

`AdminClickRefundOfflineOnNewMemoPageActionGroup` <!-- ENGCOM-8580-->

`AdminFillAccountInformationOnCreateOrderPageActionGroup` <!-- ENGCOM-8495-->

`AdminGoToOrderStatusPageActionGroup`  <!-- ENGCOM-8615-->

`AdminOpenCMSPagesGridActionGroup`<!-- ENGCOM-8682-->

`AdminSelectAttributeSetOnEditProductPageActionGroup` <!-- ENGCOM-8566-->

`AssertAdminProductIsAssignedToCategoryActionGroup`  (使用SKU并单击第一行来替换筛选产品网格（以减少测试执行时间） <!-- ENGCOM-8535 8534-->

`AssertLinkActionGroup` <!-- ENGCOM-8457-->

`AssertStorefrontCartDiscountActionGroup` <!-- ENGCOM-8431-->

`ClickPlaceOrderActionGroup` <!-- ENGCOM-8671-->

`SaveCmsPageActionGroup` <!-- ENGCOM-8683-->

`StorefrontAssertProductNameIsNotOnProductMainPageActionGroup` <!-- ENGCOM-8562-->

`StorefrontGuestCheckoutProceedToPaymentStepActionGroup` <!-- ENGCOM-8582-->

`StorefrontHoverProductOnCategoryPageActionGroup` <!-- ENGCOM-8575-->

`StorefrontSelectCustomizeAndAddToTheCartButtonActionGroup` <!-- ENGCOM-8573-->

#### 已删除操作组

<!-- ENGCOM-8525 8558 8608 8546 8695 8889 8681 8627 8714-->

* 已删除  `CliIndexerReindexActionGroup` （或更改了值），以缩短 `Backend`， `Bundle`， `BundleImportExport`， `Catalog`， `CatalogRule`， `CatalogSearch`， `Checkout`， `Downloadable`，  `Elasticsearch`，  `Elasticsearch6`，  `Indexer`， `LayeredNavigation`，  `LoginAsCustomer`，  `Newsletter`， `Sales`， `SalesRule`， `Search`， `Store`，  `Swatches`， `UrlRewrite`， `Weee`、和 `Wishlist`模块。

<!-- ENGCOM-8893 8951 8893 9001 8715 8724 8721 8843-->

* 已删除 `CliCacheFlushActionGroup` 起始日期 `Catalog`， `CatalogUrlRewrite`， `Checkout`， `Config`， `ConfigurableProduct`，`Contact`， `Cookie`， `CurrencySymbol`， `Customer`， `Downloadable`， `Elasticsearch`， `Elasticsearch6`， `Fedex`， `Indexer`， `LayeredNavigation`，`LoginAsCustomer`， `Msrp`， `Multishipping`， `Sales`， `Swatches`， `Translation`， `UrlRewrite`， `Vault`， `Weee`、和 `Wishlist` 模块。

### 新闻稿

<!-- ENGCOM-8948 MC-40885-->

* 应用程序不再向在新闻稿队列创建和发送新闻稿之间时间段内已取消订阅新闻稿的客户发送新闻稿电子邮件。 [GitHub-32116](https://github.com/magento/magento2/issues/32116)

<!-- ENGCOM-8675-->

* 应用程序现在执行新闻稿启用设置(**商店**  >  **设置**  >  **配置**  >  **客户**  >  **新闻稿**  >  **常规选项**)。 以前，这些设置始终从多存储部署中的默认范围中检索。 [GitHub-31188](https://github.com/magento/magento2/issues/31188)

<!-- ENGCOM-8551-->

* REST调用GET `/V1/customers/search` 现在，为订阅了多个新闻稿的客户返回正确信息。 [GitHub-31168](https://github.com/magento/magento2/issues/31168)

<!-- ENGCOM-8817-->

* 缓存订阅状态已从新闻稿插件中删除。 [GitHub-19345](https://github.com/magento/magento2/issues/19345)

### 订购

<!-- MC-40963-->

* 现在，当将部分开票的订单的商店贷项返回客户帐户时，应用产品可以正确计算已开票的客户余额。

<!-- ENGCOM-8710-->

* 现在，当应用程序保存退款的客户余额时，会按预期保存修改后的订单。 [GitHub-393](https://github.com/magento/partners-magento2ee/issues/393)

### 支付方式

<!-- MC-41525-->

* 应用程序现在呈现付款块 `frontend` 无论发送电子邮件的区域为何。 (当前区域现在模拟为 `frontend` 在呈现付款块之前。) 以前，在发送电子邮件的区域呈现付款块。 因此，无论销售电子邮件是从管理员触发还是由REST API触发，资产的URL都尝试从错误的区域(`webapi_rest` 或 `adminhtml`)。

<!-- MC-40810-->

* 应用程序现在将可下载产品的链接发送到在结帐期间指定的电子邮件地址。 以前，当访客购物者使用PayPal Express Checkout并输入不同的电子邮件地址提交订单和结帐时，应用程序将可下载的产品链接发送到第一个地址。

<!-- MC-38051-->

* 现在，应用产品会在支持多种货币的部署的“付款方法”页上显示可用商店贷项的准确值。

<!-- MC-37820-->

* 当访客购物者在结帐期间将订单的送货地址更改为其他国家/地区时，付款方法列表现在会按预期更新。 以前，更改帐单地址不会触发可能付款方法的更新。

#### PayPal

<!-- MC-39895-->

* 购物者现在可以成功结帐一个PayPal Payflow Pro订单，该订单的送货地址包含特殊字符。 以前，应用程序拒绝支付这些订单的款项。

<!-- MC-39861-->

* 在使用PayPal成功付款后，购物者现在会被重定向回订单成功页面。 以前，由于会话数据丢失，购物者被重定向到空白页面。

### 性能

<!-- MC-41647-->

* 大目录上的管理员SKU搜索性能已得到改进。 查询优化器提示现在会在查询执行期间强制使用索引。

<!-- MC-41440-->

* 性能  `catalog_product_alert` 在大表（几百万行）上运行cron进程已得到改进。 以前， `catalog_product_alert` 已加载所有产品警报，这会导致内存不足异常。

<!-- ENGCOM-8752-->

* 当仅需要一个编辑页面呈现管理员表单时，应用程序不再加载所有CMS页面。  现在，这些页面的加载速度更快。 [GitHub-30936](https://github.com/magento/magento2/issues/30936)

<!-- ENGCOM-8510-->

* 中的数值 `WHERE IN` 现在，表达式将转换为数字，而不是字符串，这可以提高某些版本的MariaDB的查询性能。 [GitHub-31135](https://github.com/magento/magento2/issues/31135)

* 此 `use_application_lock` 模式允许您通过使用环境变量或通过配置 `app/etc/env.php` 文件。 启用此模式后，在失败后不再需要手动重置索引器。 如果未启用此模式，则必须在失败后手动重置索引器。 参见 [使用应用程序锁定模式重新索引进程](https://developer.adobe.com/commerce/php/development/components/indexing/#using-application-lock-mode-for-reindex-processes).

### 定价

<!-- MC-41767-->

* 现在，当购物者更新店面的产品数量时，应用程序会使用分组的价格正确更新产品的价格。 [GitHub-32669](https://github.com/magento/magento2/issues/32669)

<!-- MC-39282-->

* 现在，当为产品分配了层价格且分配了层价格时，可以保存捆绑包产品。 `Magento\Framework\Api\ExtensibleDataObjectConverter` 用于转换产品数据。 以前，何时 `Magento\Framework\Api\ExtensibleDataObjectConverter` 用于在保存产品时将产品数据转换为阵列，但应用程序未保存该产品并显示以下错误： `Notice: Undefined index: price in app/code/Magento/Catalog/Model/Product/Type/Price.php on line 382.`

<!-- MC-36811-->

* 计划价格更新现在应用于购物车中已有的产品。 [GitHub-356](https://github.com/magento/partners-magento2ee/issues/356)

<!-- MC-24693-->

* 现在，当启用数量递增并且小数库存小于1时，将按预期将层价格应用于产品。 以前，最低层价格数量设置为1。

### 产品视频

<!-- MC-39755-->

* 您现在可以使用 **添加视频** 按钮（管理员） **目录** > **产品**)以连续添加多个视频。 以前，视频字段保留上一个视频的详细信息。

<!-- MC-40817-->

* 现在，在移动设备上可以按预期方式进入产品页面上的产品视频全屏模式。 以前，进入全屏模式会导致视频在退出全屏模式之前暂停。

<!-- MC-39759-->

* 导航箭头按钮(**下一个** 和 **上一个**)现在按预期显示在店面产品视频中。

<!-- MC-40463-->

* 商家现在可以使用添加Vimeo视频 **插入视频** 按钮。 以前，应用程序显示404错误。 [GitHub-31753](https://github.com/magento/magento2/issues/31753)

### 引用

<!-- MC-39531-->

* 此 `/V1/guest-carts/examplecartid/items` 现在，调用会返回所请求的存储视图。 以前，它返回存储中的第一个存储视图，而不是请求的视图。

<!-- MC-33893 ENGCOM-8992-->

* 现在可配置发票发送。 以前，无法配置发票发送，应用程序始终会在创建发票后发送发票。 发票和订单电子邮件均在一个观察者的范围内发送。 现在，在发送订单电子邮件和发票电子邮件时，由单独的观察者管理。 [GitHub-27656](https://github.com/magento/magento2/issues/27656)

### 报告

<!-- MC-39737-->

* 上次审查日期（管理员） **报告** > **审核** > **按产品** 现在显示正确的审阅日期。 以前，应用程序显示的是产品创建日期而不是审阅日期。

### 审核

<!-- MC-40116-->

* 现在，可以在“我的帐户”页面的“审核详细信息”部分中正确计算产品审核评等星级。

<!-- MC-39763-->

* 产品评论详细信息页面的平均产品评分和产品评分部分现在可以正确呈现。 以前，当应用程序计算店面评级时，审核ID未设置，并且产品审核模板未正确呈现。

<!-- MC-36149-->

* 此 **成为第一个查看此产品的用户** 在管理员批准审阅后，链接现在会按预期更改为审阅计数。

<!-- ENGCOM-8501 MC-30270-->

* 管理员现在可以按预期在产品编辑页面的产品审阅部分对产品审阅进行排序。 [GitHub-30270](https://github.com/magento/magento2/issues/30270)

<!-- MC-41003  magento/magento2#32259-->

* 现在，在管理员批准并保存来自与存储区不同的域的审阅后，使用正确的存储ID保存审阅。 [GitHub-17510](https://github.com/magento/magento2/issues/17510)

### 奖励

<!-- MC-39820-->

* 当购物者结帐时用多个地址检查或取消检查 **商店积分（奖励积分）** 选项。

### 销售

<!-- MC-39796-->

* 管理员用户现在可以在以下时段下缺货商品订单： **允许延期交货** 设置已启用(**商店** > **配置** > **目录** > **库存** > **产品库存期权**)。 以前，应用程序抛出错误。

<!-- MC-42280-->

* 现在，当姓氏以空格结尾时，购物者可以在“订单和退货”页面上找到订单。

<!-- MC-41438-->

* 现在，当分配了100%折扣的购物车价格规则应用于同时需缴纳目录产品和折扣税并且符合免运费的订单时，系统会使用正确的总计创建发票。 以前，订单价格正确，但发票不正确。 [GitHub-30853](https://github.com/magento/magento2/issues/30853)

<!-- MC-40384-->

* 现在，按日期过滤订单可返回准确的结果。 以前，当您按订单日期过滤订单时，应用程序不会返回在00:00 UTC之后下达的订单。

<!-- MC-40030-->

* 在以下情况下，贷项通知单网格现在显示正确的货币符号： **网站** 范围用于 **价格** 多存储部署中的属性。

<!-- MC-40013-->

* 重新加载“管理员创建新订单”页面后，付款方法单选按钮在结帐工作流的“付款和送货信息”部分上不再消失。 [GitHub-32106](https://github.com/magento/magento2/issues/32106)

<!-- MC-39891-->

* 现在，阿拉伯文本在发票中正确显示。

<!-- MC-39864-->

* 现在，应用产品会为贷项通知单正确计算部分贷项通知单税总额，这些贷项通知单基于将PayPal Payment Pro部署为付款网关的商店中的订单或发票。 以前，对于具有多个发票的订单，应用产品会核销该订单的全部税，以便在贷项通知单中取消部分发票。

<!-- MC-39521 ENGCOM-8528-->

* 该应用程序不再在向客户发送新订单电子邮件时产生随机数据库死锁。 以前，发生死锁是因为应用程序保存了整个对象及其相关对象，而不是更新的SQL列。 应用程序显示此类型的错误： `SQLSTATE[40001]: Serialization failure: 1213 Deadlock found when trying to get lock; try restarting transaction`. [GitHub-31090](https://github.com/magento/magento2/issues/31090)

<!-- MC-39353-->

* 店面订单详细信息页面现在显示正确的已发运产品数量。 以前，产品数量不正确，因为订单发运页的模板已呈现 **装运数量** 作为 `int`. 此任务已更改为 `float`.

<!-- MC-39026-->

* 在以下情况下，应用产品不再发送订单发票的副本： **发票的电子邮件副本** 按钮未选中。 以前，应用程序会向发送电子邮件 **客户** 和 **将发票电子邮件副本发送至**. [GitHub-28511](https://github.com/magento/magento2/issues/28511)

<!-- MC-38973-->

* 从管理员为现有客户创建新订单时，应用产品不再为客户帐户创建重复的地址条目。 此 **保存在通讯簿中** 复选框已重命名为 **添加到通讯簿** 和现在在管理员中默认处于未选中状态。

<!-- MC-38834-->

* 该应用程序现在使用已上传到的徽标 **HTML打印视图的徽标** 设置。 以前，应用程序显示LUMA徽标而不是上传的徽标。

<!-- MC-38625-->

* 现在，当项目数超过20时，店面上的订单项目分页会按预期工作。 以前，页面生成器会考虑子产品，因此总计数不正确。

<!-- MC-23915 ENGCOM-8713-->

* 应用产品现在会在“订单”页和“贷项通知单”页网格上显示小计和发运和处理值的正确货币符号。 [GitHub-22662](https://github.com/magento/magento2/issues/22662)

<!-- ENGCOM-8486-->

* 使用Safari的管理员现在可以从管理员成功将产品添加到订单。 以前，当管理员单击 **将所选产品添加到订单** 按钮时，应用程序显示旋转加载图标，页面挂起。

### 销售规则

<!-- MC-40671-->

* 该应用程序现在使用应用购物车价格规则 **最大数量折扣应用于** 或 **折扣数量步骤（购买X）** 将多个购物车价格规则应用于购物车时的条件。 以前，如果购物车价格规则包含 **最大数量折扣应用于** 或 **折扣数量步骤（购买X）** 在另一个购物车价格规则之后应用，总折扣减少到为配置的值 **最大数量折扣应用于** 或 **折扣数量步骤（购买X）** 乘以产品价格。

<!-- MC-39827-->

* 现在，优惠券报表可准确反映实施拆分数据库的部署中的优惠券活动。

<!-- MC-39477-->

* 包含条件“类别”的购物车价格规则 **不是** 现在按预期应用于未分配给类别但为其父产品分配的可配置子产品/简单产品。

<!-- MC-39034-->

* GraphQL `cart` 现在，当优惠券应用于订单时，query会返回购物车计费步骤的正确总计。

### 搜索 {#search-heading}

<!-- MC-41138-->

* 类别页不再包含这些重复的HTML元素ID： `modes-label`， `mode-list`， `toolbar-amount`， `sorter`， `limiter`.

<!-- MC-40981-->

* 部分单词搜索结果不再包含意外或不相关的匹配项，并且搜索会在店面和管理层上生成一致的结果。 该应用程序现在使用其他分析器（没有词干分析器）进行部分单词搜索。 以前，搜索结果显示的产品不包含搜索关键词。 （默认分析器以前包含一个词干分析器，并且由于在搜索时使用相同的分析器来搜索部分单词，因此搜索结果可能会产生意外或不相关的匹配。）

<!-- MC-40715-->

* 现在，如果搜索查询包含多个单词，并且产品名称配置为不可搜索，则快速搜索会返回结果。 以前，如果产品名称配置为不可搜索，则应用程序会对包含多个单词的搜索查询引发查询异常。

<!-- MC-40672-->

* 搜索结果现在包括 `weight` 属性时，按照预期执行。

<!-- MC-40409-->

* 当您查看启用了Elasticsearch的空类别页时，应用程序不再引发错误。 相反，它会按预期呈现页面并显示一条信息性消息。 以前，空的全文索引会在类别页面上触发异常。

<!-- MC-40376-->

* 如果购物者在开始搜索后单击搜索字段之外的内容，搜索字段自动完成功能现在可以按预期工作。 现在，当购物者继续键入时，自动完成建议会重新显示。 以前，应用程序不显示自动完成建议，并且单击搜索框不会使搜索建议再次可见（尽管键入其他字母显示）。

<!-- MC-34217-->

* 现在，在高级搜索中根据产品的完整或部分SKU搜索产品会返回预期的产品。

<!-- MC-31395-->

* 分层导航筛选器现在可显示准确的产品计数。 以前，Elasticsearch中的产品计数值不是按目录权限筛选的。

<!-- MC-23881 ENGCOM-8618-->

* 当ElasticsearchURL页面参数超出分页范围时，类别不再引发错误。 [GitHub-23843](https://github.com/magento/magento2/issues/23843)

<!-- MC-24033  magento/magento2#3274-->

* 您现在可以将自定义Elasticsearch字段映射器添加到 `Magento\Elasticsearch\Model\Adapter\FieldMapper\Product\FieldProvider\FieldName\Resolver\CompositeResolver`.

<!-- ENGCOM-9029 MC-24026-->

* 开发人员现在可以更改Elasticsearch映射。 以前，发送到默认映射中Elasticsearch服务器的动态模板是硬编码的，这会阻止开发人员在Elasticsearch中索引与自定义模块关联的任何额外数据。

<!-- ENGCOM-8464 -->

* 禁用搜索建议后，搜索字段（表单微搜索）现在可按预期工作。

### 配送

<!-- MC-41464-->

* 现在，当购物者在结帐期间使用多个地址删除产品后导航回购物车页面时，应用程序会按预期更新运费。

<!-- MC-41343-->

* 现在，当购物车中的某些项目符合免费送货条件时，应用程序会显示正确的调整后送货价格。 以前，当购物车中的部分项目符合免费配送条件时，应用程序不会调整配送价格并向购物者显示完整配送价格。

<!-- MC-41186-->

* 仅限特定网站的管理员用户现在可以为同一网站上下达的订单创建装运。 以前，当缺少默认商店视图权限的管理用户尝试发送在管理员用户有权访问的商店视图中的订单时，应用程序会引发此异常： `Notice: Undefined offset: 1 in /app/code/Magento/Catalog/Model/Product/Attribute/Backend/GroupPrice/AbstractGroupPrice.php on line 293`.

<!-- MC-41069-->

* 应用程序现在在确定订单是否满足免费DHL装运条件时考虑相关的购物车价格规则折扣。

<!-- MC-40702-->

* 对于支持多种货币的商店，如果订单使用非基本货币，则装运标签现在会按预期使用基本货币而不是订单货币。 [GitHub-31891](https://github.com/magento/magento2/issues/31891)

<!-- MC-40678-->

* 现在，当购物者离开多配送页面后在结帐期间返回购物车页面时，应用程序会显示正确的订单小计。 [GitHub-31889](https://github.com/magento/magento2/issues/31889)

<!-- MC-40541 magento/magento2#31841 -->

* 在管理员订单创建期间编辑帐单信息不再更改具有不同默认装运和帐单地址客户的装运信息。 [GitHub-31786](https://github.com/magento/magento2/issues/31786)

<!-- MC-37385 ENGCOM-8578-->

* 应用程序不再取消选中 **附加注释** 购物者点击时的复选框 **获取配送方式和费率** 并从管理员创建订单时选择配送方式。

<!-- MC-36425-->

* 购物者现在可以使用“返回”浏览器按钮返回到“选择配送方式”页面，同时结帐具有多个地址的订单。 以前，应用程序显示损坏的“选择配送方式”页面。 [GitHub-30268](https://github.com/magento/magento2/issues/30268)

<!-- MC-40021 ENGCOM-8983-->

* 在购物者更改“收货地址”多地址页上的数量并单击浏览器的“返回”按钮后，产品数量现在保持不变。

<!-- ENGCOM-9096-->

* 在结帐期间应用购物车价格规则时，统一费率配送方式费用不再为零。 [GitHub-21832](https://github.com/magento/magento2/issues/21832)

<!-- ENGCOM-8537-->

* 在以下情况下，当商家尝试使用DHL发送订单时，应用程序不再引发错误 **创建配送标签** 复选框已启用，并且产品名称包含unicode字符。 以前，应用程序在请求创建标签时显示此错误： `The response is in wrong format`.

<!-- ENGCOM-8952 -->

* 您可以在多站点部署中成功向管理员下单，其中 `United States` 在一个网站上启用，并且`Disable all countries` 启用为其他网站上的默认范围。 以前，应用程序不会下订单并显示以下错误： `Please check the shipping address information. "regionId" is required. Enter and try again`.

### 存储

<!-- MC-40538-->

* 应用程序不再处理 `0` 作为空值。 以前，应用程序将请求路径开头的整数值视为存储ID，这会对SEO产生意外影响。

<!-- MC-40313-->

* 插件 `\Magento\Framework\App\ActionInterface` 下 `lib/internal/Magento/Framework/App/Action/Plugin` 已删除，以符合以下准则：应使用插件自定义来自另一个模块的一个模块的行为。 [GitHub-28050](https://github.com/magento/magento2/issues/28050)

<!-- MC-24772-->

* 现在，当您尝试选择时，应用程序会显示此消息 `Website` 默认为 `Store View` 在网站创建期间被禁用： `Please enable your Store View before using this Web Site as Default`. 以前，网站崩溃，应用程序不显示警报。

### 税金

<!-- MC-39571-->

* 现在，应用产品会在验证最小订单金额时考虑隐藏税额。

<!-- MC-38025 ENGCOM-8612-->

* 现在，当购物者导航回其购物车并在将捆绑产品添加到购物车后继续结帐时，应用程序会按预期显示固定产品税(FPT)。 [GitHub-30250](https://github.com/magento/magento2/issues/30250)

<!-- MC-37657 magento/magento2#31850-->

* 应用程序现在会预填充 **增值税号** 管理员为现有客户创建订单时，使用已保存的VAT编号的“管理员新订单”页的“地址信息”部分中，开单地址和发运地址的输入字段。 [GitHub-31846](https://github.com/magento/magento2/issues/31846)

<!-- ENGCOM-8617 magento-engcom/magento2ee#558-->

* 应用程序现在显示 **增值税号** 在以下情况下，客户注册页面上的字段： `customer/create_account/vat_frontend_visibility` 已启用。

### 测试

<!-- MC-41393-->

* 测试环境已升级到Redis 6.0.12。

<!-- ENGCOM-8529-->

* 已删除 `CacheCleaner::cleanAll();` 来自集成测试。

<!-- ENGCOM-8898-->

* 添加了针对此方案的测试：当客户订阅了排队的新闻稿时，管理员用户可以编辑客户帐户。

<!-- ENGCOM-8484-->

* 已删除 `cache:flush` 测试中的命令以缩短 `Catalog`， `CatalogUrlRewrite`、和 `LoginAsCustomer` 模块。

<!-- ENGCOM-8499-->

* 删除了冗余参数，并将POST更改为中所需的GET `\Magento\Logging\Model\ProcessorTest::testLoggingProcessorLogsActionShipping`.

### 主题

<!-- MC-41474-->

* 在以下情况下，客户登录页面不再显示此消息： **将JS代码移动到页面底部** 设置(**存储** > **配置** > **前进** > **开发人员** > **JavaScript设置**)和Cookie均已启用： `The store will not work correctly in the case when cookies are disabled`.

<!-- MC-40982-->

* 标头中的帐户链接现在遵循WCAG标准。 以前，标头中的帐户链接包含重复的ID，这会导致WCAG验证失败。

<!-- MC-40278-->

* 应用程序现在优先配置商店徽标图像的商店配置，而不是布局配置。 以前，徽标图像的大小是固定的，不会因商店而异。

<!-- MC-35227-->

* 该应用程序现在在使用标准Magento Open Source主题的店面页面上显示一致的页面元素。 以前，并非所有样式都应用于空白主题，因此并非所有页面元素都显示在使用此主题的页面中。 （例如，“我的订单”页面搜索字段中不存在放大镜图标。）

### 翻译和区域设置

<!-- MC-23553-->

* 配置内联翻译后，添加到字符串的括号将不再转义。 以前， `escapeHtmlAttr` 方法将括号转换为HTML实体代码。

<!-- ENGCOM-8694-->

* 管理员中无法翻译的短语现在可翻译。 （此拉取请求有助于不断努力将所有管理员字符串本地化。） [GitHub-11175](https://github.com/magento/magento2/issues/11175)

<!-- ENGCOM-8584-->

* 模板中用于管理存储的付款方法的文本字符串(**我的帐户**  >  **存储的支付方式** )现在可翻译。

<!-- MC-30798 ENGCOM-8717-->

* 现在，从管理员发送的Order电子邮件使用商店区域设置，而不是与管理员帐户关联的区域设置。

### UI

<!-- MC-41784-->

* 管理员页脚现在显示正确的产品版本。

<!-- MC-41067-->

* 现在，在管理装运创建期间，源的分页已按预期显示。

<!-- MC-40240-->

* 现在，当您使用自定义日期属性过滤产品时，产品网格过滤器可正常工作，管理员用户区域设置为 `en_GB`.

<!-- MC-39279-->

* 现在，捏合缩放手势可在iOS设备上的产品页面图像库放大器中按预期工作。

<!-- MC-38787-->

* 现在，管理员产品网格搜索结果的分页从每个搜索的第1页开始，与预期相符。

<!-- MC-38423-->

* 缩放时购物车显示的异常已得到解决。 以前，缩放此页面时显示的元素会重叠。

<!-- MC-38226-->

* 使用PayPal Express签出时显示的订单审核页面现在已成功加载。 以前，模板包含未使用的 **更新投放方法** 按钮，在页面渲染期间，该按钮仅被脚本部分隐藏。

<!-- MC-37941-->

* 当存在冗长的评级名称时，产品页面的“客户审核”部分中的评级星级和审核文本现在具有适当的间距。

<!-- MC-37688-->

* 现在，选项按预期显示在“存档发票”、“发运”和“贷项通知单”页的“活动”下拉列表中。

<!-- MC-23729  magento/magento2#31549-->

* 现在，应用程序在以下情况下显示正确的时间值 `datetime` 组件 `timeOnly` 选项设置为 **是**. [GitHub-23157](https://github.com/magento/magento2/issues/23157)

<!-- ENGCOM-8514 -->

* 在Admin上创建新构件后，您现在可以删除布局更新 **内容** > **小组件**.  [GitHub-29936](https://github.com/magento/magento2/issues/29936)

<!-- ENGCOM-8502 MC-35716-->

* 此 **删除布局更新** 按钮现在可以按预期方式用于您从管理员添加的任何布局 **内容** > **小组件**. 以前，在添加多个布局时，此按钮不适用于除第一个选定布局以外的任何布局。 [GitHub-30286](https://github.com/magento/magento2/issues/30286)

<!-- ENGCOM-8524 -->

* 应用程序现在使用在布局文件中设置的页面标题作为客户帐户编辑文件的浏览器页面标题。 以前， `Magento\Customer\Controller\Account\Edit` 控制器操作强制将页面标题值设置为 `Account Information`. [GitHub-30724](https://github.com/magento/magento2/issues/30724)

<!-- ENGCOM-8896 8826-->

* 这些页面中添加了允许商家在显示和隐藏密码之间切换的复选框：
   * 客户登录
   * 客户注册
   * 客户编辑（“更改密码”部分）
   * 客户设置新密码 [GitHub-31557](https://github.com/magento/magento2/issues/31557)

<!-- ENGCOM-8545 -->

* 删除了在更改属性集后将产品添加到分组产品集时出现的网格单元格中的冗余标头。 [GitHub-30911](https://github.com/magento/magento2/issues/30911)

<!-- ENGCOM-8895 -->

* 应用程序现在显示 `DateRange` 在的登录区域进行筛选 **客户**  >  **登录** 页面。 以前，应用程序显示 `Text` 筛选条件。 [GitHub-30328](https://github.com/magento/magento2/issues/30328)

<!-- ENGCOM-9009 -->

* 已从模板文件中删除JavaScript，并将其移动到单独的文件中，以减少管理员页面上的渲染问题。 以前，在启用了HTML缩小的部署中，管理员页面无法正确呈现。 应用程序显示此错误： `An error has happened during application run. See exception log for details`. [GitHub-32454](https://github.com/magento/magento2/issues/32454)

<!-- ENGCOM-9044 -->

* 此 `dropdownDialog` 构件现在仅加载可拖动和可调整大小的构件 `jquery-ui` 所需的块。 以前，它加载了大量不必要的代码，这会增加加载时间并降低性能。 [GitHub-32810](https://github.com/magento/magento2/issues/32810)

### URL重写

<!-- MC-41550-->

* 在通过批量更新将产品分配给网站后，现在可按预期生成多站点部署中特定网站的产品URL重写。

<!-- MC-40780 magento/magento2#32598-->

* 当满足以下条件时，应用程序现在可以正确生成子类别的URL路径： **使用默认值** 已为父类别启用URL键复选框。 以前，在层次结构中移动类别会导致错误 `url_path` 在多存储视图部署中使用不同的URL密钥时的值。 [GitHub-16202](https://github.com/magento/magento2/issues/16202)

<!-- MC-40371-->

* 应用程序现在会更新 `url_path` 在类别层次结构中移动类别时，分配给所有商店范围的类别。 以前，在层次结构中移动类别会导致错误 `url_path`.

<!-- MC-39463-->

* 现在，使用自定义URL从管理员创建的URL重定向可成功运行。 以前，GraphQL缓存来自GraphQL的响应 `urlResolver` 查询并返回URL重写更新后的旧值。

<!-- MC-38931  magento/magento2#31106-->

* 现在，从网站中删除产品时，产品URL重写会按预期删除。 [GitHub-24184](https://github.com/magento/magento2/issues/24184)

<!-- ENGCOM-8719 -->

* 添加了 `main_table` 参考 `store_id` 在 `addStoreFilter` 的功能 `app/code/Magento/UrlRewrite/Model/ResourceModel/UrlRewriteCollection.php` 收藏集。 以前，每当出现 `join` 添加到集合中，该集合中还包含 `store_id` 列。 [GitHub-31853](https://github.com/magento/magento2/issues/31853)

<!-- ENGCOM-8894 -->

* 此 `PUT /V1/products/:sku` REST端点现在会按预期重新生成产品URL重写。 以前，端点会重新生成产品 `url_key` 值，而不是URL重写。 [GitHub-30316](https://github.com/magento/magento2/issues/30316)

### 用户

<!-- MC-40777-->

* 您现在可以保存有效的新用户角色（管理员） **系统** > **权限** > **用户角色**)和整个 `Catalog` 已选择树排除 `Edit Product Design` ( **目录** > **库存** > **产品** > **编辑产品设计**)。 以前，应用程序不保存此角色中的用户所做的产品更改并显示以下错误： `Not allowed to edit the product's design attributes`. [GitHub-31973](https://github.com/magento/magento2/issues/31973)

<!-- MC-38442-->

* 现在，在为新的管理员用户生成电子邮件时，应用程序使用正确的自定义电子邮件模板。 以前，应用程序使用旧的默认模板，省略了管理员的名字和姓氏。

<!-- MC-38122-->

* 应用程序现在在向新用户发送电子邮件时使用正确的电子邮件模板。 以前，即使选择了自定义模板，应用程序也使用默认模板。

### VersionCMS

<!-- MC-39953-->

* 现在，在更改版面后，应用程序会将正确的主题应用到CMS页面。 以前，无论为页面分配了哪个主题，应用程序都会在您保存布局更改后将分配的主题更改为Luma。

### 视频

<!-- MC-42059 ENGCOM-9039-->

* 现在，当启用和使用高级JavaScript捆绑包时，产品库中会按预期显示视频。 [GitHub-32501](https://github.com/magento/magento2/issues/32501)

<!-- ENGCOM-8532-->

* 现在，属于可配置产品的简单产品的YouTube视频可按预期工作。 以前，图像是按ID而不是位置排序的。 因此，一些视频被视为图像。 [GitHub-29690](https://github.com/magento/magento2/issues/29690)

### Web API框架

<!-- MC-41758-->

* 目录API现在可通过添加新值和删除旧值来正确更新产品的自定义选项值。 以前，API不会删除旧值。

<!-- MC-34431-->

* POST `/V1/guest-carts/:cartId/billing-address` 现在，将地址ID作为整数而不是字符串返回。

### 构件

<!-- MC-39128-->

* 管理员现在可以删除小部件的所有布局更新。 以前，当小部件多次更新布局时，管理员只能删除第一次更新。

<!-- MC-39107-->

* 单击 **添加到购物车** 产品小组件上的按钮不再导致页面重新加载。 以前，单击 **添加到购物车** 将产品添加到购物车之前，产品小组件上的按钮导致当前页面重新加载。

### 愿望清单

<!-- MC-40651-->

* 当您单击 **编辑项目** 希望列表中的产品的按钮。 [GitHub-32119](https://github.com/magento/magento2/issues/32119)

<!-- MC-40417-->

* 现在，当您使用愿望清单中的可自定义文件选项更新产品时，应用程序会显示正确的产品价格。 以前，应用程序显示错误的产品价格，并且不显示指向上传文件的链接。

<!-- MC-39060-->

* 对于具有多个愿望清单的客户，愿望清单中的产品总数现在与愿望清单中的项目数匹配。 以前，缺货产品包含在产品总数中。

<!-- MC-36779 magento/magento2#31110-->

* 现在，应用程序在将产品添加到订单后，会将其从愿望列表中删除。 [GitHub-30260](https://github.com/magento/magento2/issues/30260)

<!-- MC-34456 ENGCOM-8816-->

* 现在，购物者可以从愿望清单中将相关产品添加到购物车中。 以前，当购物者单击 **全选** 相关产品部分的链接。 [GitHub-32274](https://github.com/magento/magento2/issues/32274)

## 已知问题

**问题**： _禁用reCAPTCHA时出现JavaScript错误_. 如果为签出禁用了reCAPTCHA，则签出会继续进行，但应用程序会显示 `Uncaught TypeError` 控制台日志中出错。  此问题将在以后的版本中修复。 <!-- MC-42589 42649-->

**问题**： _内容安全策略错误_. 店面在控制台日志中显示以下错误： `The Content-Security-Policy directive frame-ancestors does not support the source expression unsafe-inline`. 店面性能不受影响。 <!-- MC-42613-->

**问题**： _礼品卡金额的PayPal信用卡显示异常_. 启用PayPal信用并配置多个礼品卡金额时，如果购物者更改礼品卡价值的金额，店面不会更新分期付款的金额。 此问题的修复将包含在Adobe Commerce 2.4.4和Magento Open Source2.4.4中。<!-- MC-42499 AC-344-->

**问题**：  _此&#x200B;**添加到订单**按钮不适用于通过SKU添加到购物车的产品_.  当您单击 **添加到订单** 按SKU将产品添加到订单后的按钮： `An error has happened during application run`. 产品未添加到购物车。 **解决方法**：使用添加产品功能。 <!-- AC-345-->

## 社区投稿

我们感谢更广泛的Magento Open Source界，并感谢他们对这一版本的贡献。

社区工程团队 [Magento参与者](https://magento.com/magento-contributors) 按月、季度和年维护最佳贡献个人和合作伙伴的列表。 在该参与者页面中，您可以单击链接，以访问他们在GitHub上合并的PR。

### 合作伙伴投稿

下表列出了合作伙伴的贡献。 此表列出了提出拉取请求的合作伙伴、外部拉取请求以及与其关联的GitHub问题编号（如果可用）。

{{$include /help/_includes/release-notes/engcomm-2-4-3-partner.md}}

### 个人投稿人

下表列出了来自社区成员的贡献。 此表列出了外部拉取请求、与其关联的GitHub问题编号（如果可用）以及促成拉取请求的社区成员。

{{$include /help/_includes/release-notes/engcomm-2-4-3-issues.md}}

### 系统要求

我们的技术栈栈是基于PHP和MySQL构建的。 有关更多信息，请参阅 [系统要求](../../../installation/system-requirements.md).

### 安装和升级说明

您可以使用安装Magento Open Source2.4.3 [Composer](../../../installation/composer.md).

## 迁移工具包

数据迁移工具可帮助将现有Magento1.x存储数据转移到Magento2.x。此命令行界面包括验证、进度跟踪、日志记录和测试功能。 有关安装说明，请参阅 [安装数据迁移工具](../../../tools/data-migration-tool/install.md). 考虑探索或参与 [数据迁移存储库](https://github.com/magento/data-migration-tool).

此 [代码迁移工具包](https://github.com/magento-commerce/code-migration) 帮助将现有Magento1.x存储扩展和自定义项传输到Magento2.x。命令行界面包括用于转换Magento1.x模块和布局的脚本。
