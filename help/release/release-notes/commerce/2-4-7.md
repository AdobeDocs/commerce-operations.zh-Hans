---
title: Adobe Commerce 2.4.7发行说明
description: 了解2.4.7 Adobe Commerce版本中的新增功能、增强功能、错误修复和已知问题。
exl-id: 6ceb1d6d-5076-49a1-925f-913aa3598c90
source-git-commit: 783386ee707968a26ebed83864d8e30896730698
workflow-type: tm+mt
source-wordcount: '20216'
ht-degree: 0%

---


# Adobe Commerce 2.4.7发行说明

Adobe Commerce 2.4.7引入了对PHP 8.3的支持。它引入了数百种质量修复和增强功能。 核心编辑器依赖项和第三方库已升级到最新可用版本。 此版本包括显着的性能改进，包括更快地加载具有许多选项的复杂产品的产品列表页面，以及增强索引器管理。 此版本增加了GraphQL对自定义属性和GraphQL解析器缓存的覆盖范围。 它还引入了对最近更新的FedEx和UPS服务的支持。

{{bics}}

## 其他发行信息

虽然这些功能的代码与Adobe Commerce核心代码的发行版本捆绑在一起，但其中几个项目(例如B2B和Progressive Web Applications (PWA) Studio)也单独发行。 每个项目的文档中都提供了特定于项目的单独发行信息，其中记录了这些项目的错误修复。

## Adobe Commerce 2.4.7亮点

在此版本中查找以下要点。

### 安全性增强

此版本包含与Adobe Commerce 2.4.6-p5、2.4.5-p7和2.4.4-p8中包含的相同的安全修复和平台安全改进。 有关这些已修复问题的最新讨论，请参阅[Adobe安全公告](https://helpx.adobe.com/cn/security/products/magento/apsb24-18.html)。

到目前为止，尚未发生与这些问题相关的已确认攻击。 但是，可能会利用某些漏洞访问客户信息或接管管理员会话。 这些问题中的大多数要求攻击者首先获得对管理员的访问权限。 因此，我们提醒您采取一切必要步骤保护您的管理员，包括但不限于以下工作：

* IP 列入允许列表
* [双重身份验证](https://developer.adobe.com/commerce/testing/functional-testing-framework/two-factor-authentication/)
* 使用VPN
* 使用唯一位置而不是`/admin`
* 良好的密码卫生

#### 其他安全增强功能

此版本的安全性改进改进了与最新安全最佳实践的兼容性。

* **更改未生成的缓存键的行为**：

   * 块的非生成缓存键现在包含与自动生成的键的前缀不同的前缀。 （未生成的缓存键是通过template指令语法或`setCacheKey`或`setData`方法设置的键。）
   * 块的非生成缓存键现在只能包含字母、数字、连字符(-)和下划线字符(_)。<!-- AC-9831 -->

* **自动生成的优惠券代码数量的限制**。 Commerce现在限制自动生成的优惠券代码数量。 默认最大值为250,000。 商家可以使用新的&#x200B;**[!UICONTROL Code Quantity Limit]**&#x200B;配置选项(**[!UICONTROL Stores]** > **[!UICONTROL Settings:Configuration]** > **[!UICONTROL Customers]** > **[!UICONTROL Promotions]**)，以防止使用许多优惠券使系统不堪重负。<!-- AC-8753 -->

* **优化默认管理员URL生成进程**。 默认管理员URL的生成已针对增加的随机性进行了优化，这会降低生成的URL的可预测性。<!-- AC-9028 -->

* **添加了Subresource Integrity (SRI)支持**&#x200B;以符合PCI 4.0要求验证支付页面上的脚本完整性。 子资源完整性(SRI)支持为驻留在本地文件系统中的所有JavaScript资源提供完整性哈希。 默认SRI功能仅在管理员和店面区域的支付页面上实施。 但是，商家可以将默认配置扩展到其他页面。 请参阅[Commerce PHP开发人员指南](https://developer.adobe.com/commerce/php/development/security/subresource-integrity/)._中的_&#x200B;子资源完整性<!--AC-1153-->

* **对内容安全策略(CSP)的更改** — 对Adobe Commerce内容安全策略(CSP)的配置更新和增强以符合PCI 4.0要求。 有关详细信息，请参阅[Commerce PHP Developer Guide](https://developer.adobe.com/commerce/php/development/security/content-security-policies/)中的&#x200B;_内容安全策略_。<!--AC-11513-->

   * Commerce管理员和店面区域的付款页面的默认CSP配置现在为`restrict`模式。 对于所有其他页面，默认配置为`report-only`模式。  在低于2.4.7的版本中，CSP在所有页面中均配置为`report-only`模式。

   * 添加了一个nonce提供程序，以允许在CSP中执行内联脚本。 nonce提供程序有助于为每个请求生成唯一的nonce字符串。 随后，这些字符串将附加到CSP标头。

   * 添加了用于配置自定义URI以报告“管理员”中“创建订单”页面和“店面”中“结帐”页面的CSP违规的选项。 您可以从管理员添加配置，或通过将URI添加到`config.xml`文件来添加。

     >[!NOTE]
     >
     >将CSP配置更新为`restrict`模式可能会阻止管理员和店面中付款页面上现有的内联脚本，这会导致页面加载时出现以下浏览器错误： `Refused to execute inline script because it violates the following Content Security Policy directive: "script-src`。 通过更新白名单配置以允许所需的脚本修复这些错误。 请参阅[Commerce PHP开发人员指南](https://developer.adobe.com/commerce/php/development/security/content-security-policies/#troubleshooting)中的&#x200B;_疑难解答_。

* 新的全页缓存配置设置可以帮助减轻与HTTP `{BASE-URL}/page_cache/block/esi`端点相关的风险。 此端点支持来自Commerce布局句柄和块结构的无限制、动态加载的内容片段。 新的&#x200B;**[!UICONTROL Handles params size]**&#x200B;配置设置设置此端点的`handles`参数的值，该值确定每个API允许的最大句柄数。 此属性的默认值为100。 商家可以从管理员(**[!UICONTROL Stores]** > **[!UICONTROL Settings:Configuration]** > **[!UICONTROL System]** > **[!UICONTROL Full Page Cache]** > **[!UICONTROL Handles params size]**)更改此值。 请参阅[将Commerce应用程序配置为使用Varnish](https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cache/configure-varnish-commerce.html?lang=zh-Hans)。<!-- AC-9113 -->

* **通过REST和GraphQL API传输的付款信息的本机费率限制**。 商家现在可以[为使用REST和GraphQL传输的付款信息](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/config/sales/sales#rate-limiting)配置费率限制。 此新增的保护层支持对分拣攻击的防范，并可能会减少一次测试多个信用卡号码的分拣攻击的数量。 这是现有REST端点的默认行为的更改。 请参阅[速率限制](https://developer.adobe.com/commerce/webapi/get-started/rate-limiting/)。

* [isEmailAvailable](https://developer.adobe.com/commerce/webapi/graphql/schema/customer/queries/is-email-available/) GraphQL查询和([V1/customers/isEmailAvailable](https://adobe-commerce.redoc.ly/2.4.7-admin/tag/customersisEmailAvailable/#operation/PostV1CustomersIsEmailAvailable)) REST端点的默认行为已更改。 默认情况下，API现在始终返回`true`。 商家可以通过将Admin中的&#x200B;*[启用来宾签出登录](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/config/sales/checkout)*&#x200B;选项设置为`yes`来启用原始行为，但这样做可能会向未经身份验证的用户公开客户信息。

### 平台增强功能

此版本的平台升级可改善对最新安全最佳实践的合规性。

Adobe Commerce 2.4.7包含以下平台升级：

* **PHP 8.3兼容性**。 此发行版本引入了对PHP 8.3的支持。Commerce现在同时支持PHP 8.3和8.2。PHP 8.2将支持到其2025年12月服务终止(EOS)日期。 2025年12月之后，所有运行2.4.7部署的商家都应迁移到PHP 8.3。<!-- AC-8988 -->

Adobe Commerce 2.4.7仍与PHP 8.1兼容，仅用于升级目的。 不支持PHP 8.1，因此不建议使用。 Adobe Commerce 2.4.7核心代码、所有捆绑的扩展以及所有Adobe拥有的扩展和SaaS服务都与PHP 8.3兼容。<!-- AC-9668 -->

* **RabbitMQ 3.13支持**。 此版本与最新版本的RabbitMQ 3.13兼容。兼容性仍与RabbitMQ 3.11和3.12兼容，这两个版本分别支持到2024年8月和2024年12月，但Adobe建议仅将Adobe Commerce 2.4.7与RabbitMQ 3.13一起使用。<!-- AC-9659 -->

* **编辑器2.7.x**。 与Composer 2.2.x的兼容性得以保留。<!-- AC-9663 -->

* **清漆缓存7.4支持**。 此版本与最新版本的Varnish Cache 7.4兼容。与6.0.x和7.2.x版本的兼容性保持不变，但我们建议仅将Adobe Commerce 2.4.7与Varnish Cache版本7.4或版本6.0 LTS一起使用。<!-- AC-9662 -->

* **Elasticsearch 8.11**&#x200B;兼容性<!-- AC-9661 -->

* Opensearch 2.12和OpenSearch 1.3支持<!-- AC-9659 -->

* **Redis 7.2** <!-- AC-10811 -->

* `extjs`库已替换为最新版本的`jsTree`。<!-- AC-9320 -->

* 已删除`jquery/fileUpload`库。<!-- AC-10569 -->

Adobe Commerce核心代码中的所有JavaScript Libraries和NPM依赖项均已更新至最新可用版本。 所有Laminas库依赖项都已更新到与PHP 8.3兼容的最新版本。<!-- AC-9667 9665 -->

#### 其他升级

* **每个订单支持多张优惠券**。 商家现在可以使用新的[配置选项](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/config/sales/sales#multicoupon-settings)配置每个订单可以应用的最大优惠券数量&#x200B;**[!UICONTROL Maximum number of coupons per order]**。 默认情况下，此值设置为1。 您现在可以使用[REST](https://developer.adobe.com/commerce/webapi/rest/modules/multicoupon/)或[GraphQL](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/apply-coupons/)将多个优惠券应用到购物车。

* Commerce UPS XML API网关已迁移到新的[Commerce UPS REST API](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/stores-sales/delivery/shipping-carriers/ups)，以支持UPS对其[API安全模型](https://developer.ups.com/oauth-developer-guide)进行的更新。 (UPS正在为所有API实施OAuth 2.0安全模型（持有者令牌）。) 所有以前的Commerce UPS XML API已从Adobe Commerce 2.4.7代码库中移除。<!-- AC-8918 -->

* Adobe Commerce [集成](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/stores-sales/delivery/shipping-carriers/fedex)与FedEx已从旧版FedEx WSDL Web服务迁移到最新的FedEx RESTful API。 FedEx Web服务跟踪、地址验证和验证邮政编码WSDLS将于2024年5月停用。<!-- AC-1470 -->

* 增加了对新的USPS Ground Advantage配送方法的支持。 这是与USPS的新配送方法USPS Ground Advantage（2023年7月发布）的开箱即用集成。 此新集成可用于通过USPS配送服务检索配送费率并安排配送和退货。 USPS Ground Advantage发运方法取代了这些发运方法，在USPS Ground Advantage发运方法发布时，这些发运方法已停用：

   * USPS零售场
   * 一流包服务
   * 包裹选择接地<!-- AC-9182 -->

* Temando配送模块已从核心Commerce代码库中移除。 Adobe Commerce 2.4.4已弃用此功能。<!-- AC-8130 -->

### 性能和可扩展性增强

Commerce 2.4.7包括以下对Commerce性能和可扩展性的增强：

* 企业商家现在可以在Adobe Commerce中配置最多&#x200B;**1百万个基于优惠券的活动购物车价格规则**，购物车和结账操作的性能不会发生显着下降。<!-- ACPT-1198 -->

* **增强的索引器管理**。 新`indexer:set-status`命令支持索引器状态的动态管理。 管理员用户可以使用此命令将索引器状态更改为`suspended`、`invalid`或`valid`。 此功能对于在大量批量操作（如产品导入或更新）期间管理系统性能特别有用，因为它允许控制索引器何时由系统的cron作业自动触发。 请参阅[管理索引器](https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cli/manage-indexers.html?lang=zh-Hans)。

* **具有许多选项的复杂产品的产品列表页面**。 对于包含具有超过100个选项的复杂产品的产品列表页面，加载时间已缩短。 GraphQL按类别列出产品的请求性能也得到了改进。<!-- ACPT-1683 -->

* REST **导入API[&#128279;](https://developer.adobe.com/commerce/webapi/rest/modules/import/)现在支持** JSON格式。 商家现在可以每分钟将100,000条记录以JSON格式导入Adobe Commerce。<!-- ACPT-943 -->

* **销售规则性能改进**。 通过许多（大约100,000个）有效的销售规则提高了企业部署的性能。 大量实施促销的企业部署通常会部署许多活动的购物车规则。 在结账操作期间，这些类型的运行Commerce 2.4.7的企业部署将不会看到与配置的购物车价格规则数量有关的性能下降。<!-- ACPT-1198 -->

* **对于具有许多存储区的部署，存储级配置的保存操作速度更快**。 在具有500个以上存储的部署中保存配置设置可能非常耗时。 新的[异步配置](../../../performance/configuration.md#asynchronous-configuration-save)模块通过运行使用使用者处理消息队列中的保存操作的cron作业来启用异步配置保存操作。 默认情况下，AsyncConfig处于禁用状态。

* **加快生成大型配置的配置缓存**。 启用配置缓存后，`bin/magento cache:clean config`命令现在会预预热配置缓存。 这减少了为大型配置生成配置缓存所需的停机时间。 在将数据写入缓存之前，配置保存操作不再清理`config_scopes`缓存，这还可以减少写入配置数据时锁定其他请求的时间。

### GraphQL应用程序服务器

[GraphQL Application Server](../../../performance/application-server.md)使Adobe Commerce能够在Commerce GraphQL API请求之间保持状态，并且无需引导，从而增加所有GraphQL API的吞吐量、降低延迟并高效使用资源。 通过在进程之间共享应用程序状态，GraphQL API请求变得明显更高效，GraphQL API响应速度平均提高30%。<!-- ACPT-27 -->

GraphQL Application Server仅适用于Adobe Commerce。 它不适用于Magento Open Source。 您必须[提交Adobe Commerce支持](https://experienceleague.adobe.com/zh-hans/docs/commerce-knowledge-base/kb/help-center-guide/magento-help-center-user-guide)票证，才能在Pro项目中启用GraphQL应用程序服务器。

>[!NOTE]
>
>GraphQL Application Server当前与[[!DNL Amazon Simple Storage Service (AWS S3)]](https://aws.amazon.com/s3/)不兼容。 云基础架构上的Adobe Commerce客户当前将[!DNL AWS S3]用于[远程存储](../../../configuration/remote-storage/cloud-support.md)，不能使用GraphQL Application Server。<!-- ACPT-1840 -->

### Adobe Commerce扩展中继包

此版本引入了Adobe Commerce扩展metapackage v2.0.0，它自动将所选Adobe Commerce扩展与此核心版本捆绑在一起。 运行`composer update`时将安装此中继包中包含的这些扩展版本，从而简化升级到最新核心版本时升级这些扩展的过程。 这些扩展维护独立的发放计划。

适用于Adobe Commerce 2.4.7的Adobe Commerce扩展元包包含以下扩展：

* [Adobe Commerce管理UI SDK](https://developer.adobe.com/commerce/extensibility/admin-ui-sdk/)
* [Adobe Commerce与Adobe IMS的集成](https://experienceleague.adobe.com/docs/commerce-admin/start/admin/ims/adobe-ims-integration-overview.html?lang=zh-Hans)
* 适用于Adobe Commerce的[Adobe I/O Events](https://developer.adobe.com/commerce/extensibility/events/)
* [Adobe Stock](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/content-design/wysiwyg/adobe-stock/adobe-stock)
* [Braintree](https://experienceleague.adobe.com/docs/commerce-admin/stores-sales/payments/braintree.html?lang=zh-Hans)
* [付款服务](https://experienceleague.adobe.com/docs/commerce/payment-services/guide-overview.html?lang=zh-Hans)

此扩展metapackage的未来版本可能包含其他扩展。

### Adobe Commerce webhook

Commerce webhook (v1.2.0)允许开发人员配置同步逻辑，以在Adobe Commerce事件触发时执行对外部系统的调用。 当Commerce必须立即使用第三方端点计算或验证订单总计、税额或付款等值，并将结果写回Adobe Commerce时，需要同步调用。

Commerce webhook现在默认安装。 查看[Adobe Commerce Webhook概述](https://developer.adobe.com/commerce/extensibility/webhooks/)

### Adobe Stock

Adobe Stock包(`adobe-stock-integration`)现已打包到Commerce扩展元包(`extensions-metapackage`)中，以支持更频繁的更新。<!-- CABPI-630 -->

### B2B

>[!NOTE]
>
>2.4.7版本与B2B 1.4.2兼容。但是，Adobe建议客户在升级之前等待即将发布的B2B 1.5.0 GA版本，该版本包括对PHP 8.3的支持。请参阅[B2B发行说明](https://experienceleague.adobe.com/docs/commerce-admin/b2b/release-notes.html?lang=zh-Hans)。

### Braintree

* **[!DNL Vaulted PayPal]和[!DNL Pay Later]更改** — 以前保存/存储其PayPal帐户的登录客户可以选择按以下方式付款：
   * [!DNL Pay Now] （无需登录到其[!DNL PayPal]帐户，用户可以使用默认卡支付）
   * 使用其他融资来源付款
   * 使用其他帐户付款
   * [!DNL PayPal Pay Later]或[!DNL PayPal Credit]按钮

* 对&#x200B;**的[!DNL Google Pay]** 3DS支持 — 包括对[!DNL Google Pay]非令牌化卡的3DS验证支持。 有关详细信息，请参阅[Braintree文档](https://developer.paypal.com/braintree/docs/guides/3d-secure/client-side/android/v3#using-3d-secure-with-google-pay)。

* **[!DNL Vault Apple Pay Payments]** — 允许已登录的客户将其[!DNL Apple Pay]付款保存到Commerce商店帐户以用于未来的交易。 这减少了结账的步骤数，并为回头的客户创造了更快的结账体验。

* **[!DNL Vault Google Pay Payments]** — 允许已登录的客户将其[!DNL Google Pay]付款保存到Commerce商店帐户以用于未来的交易。 这减少了结账的步骤数，并为回头的客户创造了更快的结账体验。

* **[!DNL Vault Venmo Payments]** — 允许已登录的客户将其[!DNL Venmo]帐户保险库/存储到其Commerce存储帐户，以便用于未来的交易。 这减少了结账的步骤数，并为回头的客户创造了更快的结账体验。

* **[!DNL Vault ACH Payments]** — 允许登录的客户将其ACH付款保存到Commerce商店帐户，以便用于未来的交易。 这减少了结账的步骤数，并为回头的客户创造了更快的结账体验。

* 签出顶部的&#x200B;**[!UICONTROL Express Payment]按钮** — 为鼓励更快的签出体验，我们在签出开始时引入了[!DNL Express Payment]选项。 客户现在可以通过[!DNL PayPal]、[!DNL PayPal Pay Later]、[!DNL Apple Pay]和[!DNL Google Pay Express]付款进行付款。

* 管理员配置中的&#x200B;**[!DNL Braintree]发行说明和支持链接** — 商家现在可以直接从Commerce管理员在线链接到Braintree支持和发行说明。

* **GraphQL支持除[!DNL Braintree]之外的所有[!DNL Venmo]**&#x200B;付款方法 — GraphQL API中公开了更多配置。 这对于Headless应用程序特别有用。

* 帐户区域&#x200B;**[!DNL Vaulting]中的**&#x200B;付款 — 已登录的客户现在可以在客户帐户区域[保管库/商店](https://experienceleague.adobe.com/zh-hans/docs/commerce-admin/stores-sales/payments/braintree#step-3-complete-the-advanced-settings)新信用卡/借记卡和[!DNL PayPal]帐户。 以前，客户在结账时保存他们的付款以供以后使用时只能进行保险库/存储，现在他们可以在无需创建新交易的情况下保险库新的信用卡/借记卡和PayPal帐户。

* **无摩擦交易** — 无摩擦交易通过减少完成在线信用/借记卡交易的客户点击/步骤数来加快付款流程。 以前（启用3DS时），每个客户都会受到3DS的挑战。 有了新的无摩擦交易功能，客户只有在银行要求时才能获得3DS。 这会减少购物车放弃率，提高转化率，并带来更多销售。

* **争议Webhook** — 当客户对Braintree中的事务提出争议时，争议状态现在将传递到Commerce。 它可以在&#x200B;**[!UICONTROL Sales]** > **[!UICONTROL Order]**&#x200B;网格中搜索并附加到每个订单。

### Commerce与Adobe IMS集成

Adobe IMS集成包(`adobe-commerce/adobe-ims-metapackage`)现已打包到Commerce扩展元包(`extensions-metapackage`)中，以支持更频繁的更新。<!-- CABPI-630 -->

### GraphQL

Commerce 2.4.7包括增强的GraphQL缓存功能、对GraphQL架构的自定义属性支持、对Headless订单取消的支持，以及改进的解析器缓存。

* **更灵活的购物车管理**。 现在，`clearCart`突变可在单次操作中清除指定购物车的内容。 它替换了已弃用的`clearCustomerCart`突变。<!-- LYNX-254 -->

* **创建购物车突变方面的改进**。 已添加`createGuestCart`突变以替换已弃用的`createEmptyCart`突变。 以前，如果您使用`createEmptyCart`，则无法确定购物车是用于来宾还是已登录的客户。<!-- LYNX-224 -->

* **订单项现在包含产品图像**。 `OrderItemInterface`公开产品图像，这允许将图像与订购的产品关联并更有效地加载。  [GitHub-32369](https://github.com/magento/magento2/issues/32369) <!-- AC-7918 -->

* **对解析程序缓存的扩展支持**。 以下GraphQL查询解析器现在可以在GraphQL解析器结果缓存中缓存，这提高了使用POST请求提交查询时的性能：

   * `Magento\CustomerGraphQl\Model\Resolver\Customer::resolve`
   * `Magento\CustomerGraphQl\Model\Resolver\CustomerAddress::resolve`
   * `Magento\CustomerGraphQl\Model\Resolver\IsSubscribed::resolve` <!-- B2B-2658 -->
   * `Magento\CatalogGraphQl\Model\Resolver\Product\MediaGallery::resolve` <!-- B2B-2677 -->

* **支持订单取消**。 [cancelOrder](https://developer.adobe.com/commerce/webapi/graphql/schema/orders/mutations/cancel-order/)突变允许客户取消订单，传递其标识符和取消原因。<!-- LYNX-197 -->

   * `order_cancellation_enabled`中的新`order_cancellation_reasons.description`和`storeConfig`响应字段
查询支持用户发起的订单取消请求。 查看[查询商店的订单取消配置](https://developer-stage.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/#query-a-stores-order-cancellation-configuration)

* **对自定义属性的增强支持**。 通过丰富API数据以支持所有属性类型，增强了GraphQL自定义属性支持。 GraphQL EAV属性架构现在支持在管理员中扩展客户属性和客户地址对象，以及使用GraphQL检索它们。 特定的增强功能包括： <!-- LYNX-61 110-->

   * 扩展/添加了针对特定领域（如客户和客户地址）的自定义属性支持
   * 添加了自定义属性的缓存
   * 增强了对产品的现有自定义属性支持

* **增强的GraphQL缓存功能提高了页面加载速度**。 为这些查询添加了缓存功能，从而加快了大多数PWA页面的页面加载时间：

   * [`availableStores`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/available-stores/)
   * [`countries`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/countries/)和[国家/地区](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/country/)
   * [`storeConfig`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/)
   * [`currency`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/currency/)
   * [`customAttributeMetadata`](https://developer.adobe.com/commerce/webapi/graphql-api/index.html#query-customAttributeMetadata)

* **已改进GraphQL分析器性能**。 通过减少每个请求调用解析方法的次数，GraphQL解析器的性能已得到改进。 现在只调用一次。 以前，解析器至少被调用三次。

#### 针对现有突变的新字段

* 已将`quickorder_active`字段添加到[storeConfig](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/)和[availableStores](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/available-stores/)查询。 此字段指示是否启用快速订购功能。

* 已将以下字段添加到`setBillingAddressOnCart`和`setShippingAddressesOnCart`变动：

   * `fax`
   * `middlename`
   * `prefix`
   * `suffix`

#### 新的查询和变动

* [`attributeForms`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/attributes-form/)查询<!-- LYNX-151 -->
* [`attributesList`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/attributes-list/)查询<!-- LYNX-150 -->
* [`guestOrder`](https://developer.adobe.com/commerce/webapi/graphql/schema/orders/queries/guest-order/)查询
* [`guestOrderByToken`](https://developer.adobe.com/commerce/webapi/graphql/schema/orders/queries/guest-order-by-token/)查询
* [`recaptchaFormConfig`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/recaptcha-form-config/)查询
* [`cancelOrder`](https://developer.adobe.com/commerce/webapi/graphql/schema/orders/mutations/cancel-order/)突变<!-- LYNX-172 -->
* [`customAttributeMetadataV2`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/custom-attribute-metadata-v2/)查询
* [`applyCouponsToCart`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/apply-coupons/)突变
* [`clearCart`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/clear-cart/)突变
* [`confirmEmail`](https://developer.adobe.com/commerce/webapi/graphql/schema/customer/mutations/confirm-email/)突变
* [`createGuestCart`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/create-guest-cart/)突变
* [`estimateShippingMethods`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/estimate-shipping-methods/)突变
* [`estimateTotals`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/estimate-totals/)突变
* [`removeCouponsFromCart`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/remove-coupons/)突变

#### 已弃用的查询和变动

* `clearCustomerCart`突变<!-- LYNX-254 -->
* [`createEmptyCart`](https://developer.adobe.com/commerce/webapi/graphql/schema/cart/mutations/create-empty-cart/)突变<!-- LYNX-224 -->
* [`attributesMetadata`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/attributes-metadata/)查询
* [`customAttributeMetadata`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/custom-attribute-metadata/)查询

### Inventory management

Inventory management (v1.2.7)提供了用于管理产品库存的工具。 此社区开发的功能与Adobe Commerce和Magento Open Source核心代码捆绑在一起。

### 支付

* 为除Venmo外的所有支付方法的核心操作添加了GraphQL支持。 [结帐](https://developer.adobe.com/commerce/webapi/graphql/schema/checkout/)中介绍了付款服务的新GraphQL端点。<!-- BUNDLE-3326 -->

* 除Venmo之外，已改进所有支付方法的信用卡保险存储。 购物者现在可以保存或保存其ACH支付，并从其帐户页面查看或删除它们。 商家可以从管理员启用和禁用ACH保险存储付款。<!-- BUNDLE-3324 -->

* 结账工作流现在包含快速付款部分，其中提供PayPal、Google Pay和Apple Pay **[!UICONTROL Express]**&#x200B;按钮。<!-- BUNDLE-3322 -->

[付款选项](https://experienceleague.adobe.com/docs/commerce/payment-services/payments-checkout/payments-options.html?lang=zh-Hans)引入了支持的付款方法。

### PWA Studio

PWA Studio v14.0与Adobe Commerce 2.4.7兼容。它包括多项增强功能，可改善辅助功能。 有关错误修复的信息，请参阅[PWA Studio发行版](https://github.com/magento/pwa-studio/releases)。 有关PWA Studio版本及其兼容的Adobe Commerce核心版本的列表，请参阅[版本兼容性](https://developer.adobe.com/commerce/pwa-studio/integrations/adobe-commerce/version-compatibility/)。

### Web API框架

**每个购物车使用多个优惠券**

新的REST端点支持查看、添加和删除与购物车关联的多个优惠券。

>[!NOTE]
>
>几个REST终结点路由首次包含字符串`V2`而不是`V1`。 例如，`GET /rest/default/V2/carts/{cartId}/coupons`。 对于Commerce商家，这些端点旨在替换端点的`V1`版本。 这些端点仅在Adobe Commerce中可用。<!-- LYNX-208 -->

返回与购物车关联的所有优惠券代码：

`GET  /rest/{store_code}/V2/carts/{cartId}/coupons`
`GET  /rest/{store_code}/V2/carts/mine/coupons`

将优惠券代码附加到购物车：

`POST /rest/{store_code}/V2/carts/{cartId}/coupons/{couponCode}`
`POST /rest/{store_code}/V2/carts/mine/coupons/{couponCode}`

替换购物车中的优惠券代码：

`PUT /rest/{store_code}/V2/carts/{cartId}/coupons`
`PUT /rest/{store_code}/V2/carts/mine/coupons`

从购物车中删除优惠券代码：

`POST /rest/{store_code}/V2/carts/{cartId}/coupons/deleteByCodes`
`POST /rest/{store_code}/V2/carts/mine/coupons/deleteByCodes`

**其他端点**
此版本引入了两个新的REST端点，它们为REST API `GET`和`POST V1/products/attributes`端点的限制提供了解决方法。 这些端点为`is_filterable`选项的`Filterable(with results)`和`Filterable(no results)`选项的&#x200B;**[!UICONTROL Use in Layered Navigation]**&#x200B;属性返回相同的值。 （`is_filterable`属性是`Boolean`类型，不允许将此属性设置为`Filterable(no results)`。）

两个新的REST端点已实施作为解决方法：

* `PUT /V1/products/attributes/{attributeCode}/is-filterable/{isFilterable}`。 路径参数： `attributeCode` (`String`)和`isFilterable` （`int`值为： 0表示否； 1表示否；`Filterable (with results)`； 2表示否`Filterable (no results)`）。
* `GET /V1/products/attributes/{attributeCode}/is-filterable`。 路径参数： `attributeCode` (`String`)。<!-- ACP2E-2275 -->

## 修复的问题

我们已在Adobe Commerce 2.4.7核心代码中修复了数百个问题。 此版本中包含的已修复问题的子集如下所述。 另外还介绍了早期Commerce 2.4.7 Beta版本中包含的修复。

### 安装、升级、部署

<!-- AC-10396 -->

* 从设置过程中删除了不必要的缓存操作。 以前，Commerce在运行`bin/magento setup:db-data:upgrade`或`bin/magento setup:upgrade`时将其配置写入磁盘是不必要的，这会导致某些模块在安装期间出现问题。 [GitHub-38124](https://github.com/magento/magento2/issues/38124)

<!-- ACP2E-1675 -->

* 内存不足和大型表格导致的部署问题已得到解决。 由于与大型MySQL表相关的内存超出错误，`bin/magento  setup:upgrade`命令不再失败。

<!-- ACP2E-2198 -->

* 删除`bin/magento setup:install`后，`app/etc/config.php`现在成功完成。 以前，在安装期间不会重新生成缺少的文件，Commerce会引发错误。 [GitHub-37805](https://github.com/magento/magento2/issues/37805)

<!-- AC-8381 -->

* 在安装同时安装表和相关`bin/magento setup:upgrade`索引器的新模块时，`mview`已重构为成功运行。 [GitHub-37304](https://github.com/magento/magento2/issues/37304)

<!-- ACP2E-1882 -->

* 由于分隔符错误，数据库还原不再失败。 以前，Commerce在执行`bin/magento setup:rollback --db`时引发此错误： `Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'delimiter' at line 1, query was: delimiter ;;`。

<!-- ACP2E-1505 -->

* `bin/magento setup:upgrade`命令不再失败，因为出现此类型的MySQL内存限制相关错误： `PHP Fatal error:  Allowed memory size of 4294967296 bytes exhausted (tried to allocate 20480 bytes)`。 多选属性迁移已优化为在`setup:upgrade`期间减少内存消耗。

<!-- ACP2E-1751 -->

* 现在，从管理员和命令行均可按预期生成数据库备份。 以前，Adobe Commerce引发此错误： `Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'delimiter' at line 1, query was: delimiter ;;`。

<!-- ACP2E-1604 -->

* 在不指定`setup:config:set`参数的情况下运行`--lock-db-prefix`不再从`env.php`文件中清除当前值。

<!-- ACP2E-1498 -->

* 清漆配置已更新，以防止来宾用户访问与其他客户组相关的缓存内容。

<!-- AC-7113 -->

* 启用&#x200B;**[!UICONTROL Checkout Async]**&#x200B;后，购物者现在可以在实施拆分数据库的部署中下订单。 以前，Adobe Commerce引发此错误： `An error occurred on the server. Please try to place the order again`。

<!-- https://github.com/magento/magento2/pull/33092 -->

* 现在，在安装同时安装表和相关`bin/magento setup:upgrade`索引器的新模块时，`mview`成功完成。

<!-- ENGCOM-9243 -->

* 当消息队列主题不包含主题名称时，`bin/magento setup:upgrade`现在显示信息更丰富的错误消息。 [GitHub-34246](https://github.com/magento/magento2/issues/34246)

<!-- https://github.com/magento/magento2/pull/36239 -->

* 当合并的XML文件无效时，`bin/magento setup:upgrade`现在显示信息更丰富的错误消息。 错误消息现在包含文件名。

### 管理员UI

<!-- AC-10998 -->

* 默认情况下，仪表板上的图表现在已成功禁用。 [GitHub-38430](https://github.com/magento/magento2/issues/38430)

<!-- AC-9423 -->

* 现在，管理员销售菜单可正确显示子菜单。 以前，分列符无法正常工作，并且某些子菜单未显示。 [GitHub-37812](https://github.com/magento/magento2/issues/37812)

<!-- AC-3122 -->

* 在网格中选择多个页面时，**[!UICONTROL Select]**&#x200B;下拉菜单选项现在显示在管理员&#x200B;**[!UICONTROL Content]** > **[!UICONTROL Pages]**&#x200B;中。 [GitHub-35386](https://github.com/magento/magento2/issues/35386)

<!-- AC-9209 -->

* 更正了配置设置中默认值`system/dashboard/enable_charts`的路径。 现在，图表按预期显示在管理员中。 [GitHub-37668](https://github.com/magento/magento2/issues/37668)

<!-- AC-9632 -->

* 更正了管理员客户网格的显示问题。 以前，网格列未完全包含在显示的页面中。

<!-- AC-2916 -->

* 现在，悬停颜色可按预期应用于管理员静态网格的行。 [GitHub-35358](https://github.com/magento/magento2/issues/35358)

<!-- AC-7551 -->

* 当购物者输入不含空格的希腊邮政编码时，结账工作流不再显示警告。 [GitHub-36676](https://github.com/magento/magento2/issues/36676)

<!-- AC-9357 -->

* 管理员`It's time to change your password`链接现在会按预期重定向到“更改管理员密码”页面。 [GitHub-37902](https://github.com/magento/magento2/issues/37902)

<!-- ACP2E-2460 -->

* 现在，无论分配给用户的访问级别如何，子菜单标题都会指示任何同级。 以前，即使子菜单存在多个同级组，这些信息也会对具有有限访问权限的管理员用户隐藏。

<!-- AC-9164 -->

* 现在，产品页面的`title`标记和`meta title`标记中均包含页面标题后缀。 [GitHub-37680](https://github.com/magento/magento2/issues/37680)

<!-- ACP2E-2023 -->

* 产品库存状态条件现在正确应用于相关产品规则。

<!-- ACP2E-2083 -->

* **[!UICONTROL Login as Customer]**&#x200B;按钮现在在移动设备上正确显示。

<!-- ACP2E-2146 -->

* 如果登录的管理员用户缺少添加新客户组的权限，Adobe Commerce将不再显示“管理员&#x200B;**[!UICONTROL Add new customer group]**”按钮。

<!-- ACP2E-2286 -->

* 具有受限权限的管理员用户现在可以保存其父产品已分配给其他范围的子产品。 以前，对于未分配到子产品更改范围的父产品，Commerce会使其缓存失效。

<!-- ACP2E-2042 -->

* 管理员用户现在可以成功地在管理员过滤器视图之间切换，而不会损坏或丢失视图数据。 [GitHub-37529](https://github.com/magento/magento2/issues/37529)

<!-- ACP2E-2068 -->

* 存档的订单网格现在会按预期以新订单状态异步更新。 在存档网格中更新订单状态的基于事件的方法可生成准确的订单状态，包括贷项通知单后退款。

<!-- ACP2E-2049 -->

* “管理网格操作”下拉菜单现在可以按预期悬停在&#x200B;**[!UICONTROL Content]** > **[!UICONTROL Pages]**（以及B2B模块中的共享目录）的选定链接上。 以前，此菜单大部分是隐藏的，管理员用户必须滚动才能查看选项。 [GitHub-36710](https://github.com/magento/magento2/issues/36710)

### 分析

<!-- ACP2E-2266 -->

* 产品详细信息页面`meta itemprop="image"`和`meta itemprop="description"`属性现在可用于主产品映像。 [GitHub-37497](https://github.com/magento/magento2/issues/37497)

<!-- ACP2E-2314 -->

* 当&#x200B;**[!UICONTROL Catalog Price Scope]**&#x200B;设置为&#x200B;**[!UICONTROL Website]**&#x200B;时，购物车网格中产品的“报表”部分现在显示正确的产品价格。 以前，将产品分配给默认网站以外的网站时，产品价格显示为零。

<!-- AC-9275 -->

* 收入报表现在按预期显示在Google Analytics (GA4)门户中。 [GitHub-37605](https://github.com/magento/magento2/issues/37605)

<!-- ACP2E-1880 -->

* Google Tag Manager数据层中的`price`和`quantity`值现在按预期发送给Google Analytics。 以前，这些值以字符串形式发送。

<!-- ACP2E-2030 -->

* 解决了在将部署数据发送到New Relic模块时处理标头数据时的错误。

<!-- ACP2E-1833 -->

* 禁用Google Analytics 4标记后，Google Analytics 3标记现在会按预期触发。

### 横幅

<!-- ACP2E-1818 -->

* 重构了加载横幅内容的方式，以删除过多的数据库查询，从而缩短了购物车加载时间。

### 捆绑产品

<!-- ACP2E-1464 -->

* 启用&#x200B;**[!UICONTROL Display Out Of Stock*]**&#x200B;后，类别产品计数现在可以正确计入捆绑产品。

<!-- AC-8966 -->

* `customerCart`查询现在按预期返回捆绑产品的所有应用折扣。 以前，应用于捆绑产品的总折扣返回为零。

<!-- ACP2E-2618 -->

* 产品详细信息页面现在显示已应用100%折扣的捆绑产品的正确价格。 以前，Commerce对捆绑产品的价格不应用100%折扣。

<!-- ACP2E-2377 -->

* 购物车价格规则现在应用于产品捆绑包，而不是应用于动态定价捆绑产品的每个子产品。

<!-- ACP2E-1650 -->

* 更正了使用`POST V1/shipment`端点创建包含捆绑产品的装运时发生的错误。 终结点现在按预期添加项目，且不再返回此错误： `The shipment couldn't be saved`。

<!-- ACP2E-1926 -->

* 现在，您可以保存捆绑产品的计划更新，该捆绑产品包含一个具有无限计划更新的简单产品。 现在，创建捆绑产品快照时，所链接的产品将被ID、实体ID以及SKU占用。 以前，当保存捆绑产品上的计划更新时，会检查简单产品的原始版本，而不是简单产品的当前版本。

<!-- ACP2E-1650 -->

* 当产品设置了`GET V1/shipment/`装运类型时，您现在可以使用&#x200B;**[!UICONTROL together]** API路由创建具有捆绑产品的装运。 捆绑产品现在还可根据其装运类型属性进行验证。

<!-- ACP2E-2038 -->

* 购物者现在可以编辑店面购物车中捆绑产品的数量。 以前，在店面购物车中编辑产品并显示错误时，Adobe Commerce不会处理`ItemId`的null值。 [GitHub-37696](https://github.com/magento/magento2/issues/37696)

<!-- ACP2E-1801 -->

* 现在，可以使用包含斜杠(`/`)字符的SKU将捆绑包产品成功添加到管理员订单中。 以前，管理员用户无法使用此方法将产品添加到管理员订单，Commerce引发了JavaScript错误。

<!-- ACP2E-1799 -->

* 为相应的简单产品启用&#x200B;**[!UICONTROL Qty Uses Decimal]**&#x200B;后，管理员用户现在可以为新添加的捆绑包选项设置十进制默认值。 以前，只能为保存的选择设置小数值。

<!-- ACP2E-1347 -->

* 优化了使用大量选项保存捆绑产品的性能

<!-- ACP2E-1478 -->

* 现在，无需在产品选项中复制SKU，即可成功导入捆绑包产品。 以前，当您导入包含重复条目的捆绑产品时，Adobe Commerce会在产品选项中创建多个重复的SKU。

<!-- ACP2E-1388 -->

* 现在，当捆绑包中的某个产品缺货时，可以正确计算捆绑包产品价格。 以前，如果属于捆绑销售的产品缺货，则会将其从价格计算中删除。

<!-- ACP2E-1503 -->

* 现在，在购买捆绑产品的最后一个所需子产品时，捆绑产品会显示为缺货。 以前，当简单的产品缺货时，店面中捆绑销售的产品会显示为现货。

<!-- ACP2E-1443 -->

* 解决了使用`addBundleProductsToCart`突变将带有非必需选项的捆绑产品添加到购物车时的性能问题。

<!-- ACP2E-1264 -->

* 启用`categoryList`配置设置后，**[!UICONTROL Show out-of-stock products]**&#x200B;查询现在会按预期返回所有捆绑包选项。 以前，缺货的选项不包含在查询响应中。

<!-- ACP2E-1345 -->

* 现在，当目录价格范围设置为`POST V1/products`时，使用`website`创建的捆绑产品将成功。 以前，出现完整性约束冲突。 [GitHub-35595](https://github.com/magento/magento2/issues/35595)

### 缓存

<!-- AC-11411 -->

* 现在，在缓存设置为Fastly CDN (**[!UICONTROL Caching Application=Fastly CDN]**)的商店中，购物者可以看到类别。 这同时影响了客人购物者和注册客户。

<!-- ACP2E-2070 -->

* 现在，登录后的缓存Cookie在浏览网站后是相同的。 以前，登录控制器发送错误的缓存Cookie，并且页面可能已缓存多次。

<!-- ACP2E-1840 -->

* 对于包含GraphQL块的CMS页面上的CMS GET操作，现在会按预期在Fastly缓存中清除响应。 现在，后续计划更新会显示这些页面的准确、更新内容。

<!-- ACP2E-1524 -->

* 现在，当父产品的某个子产品已从管理员中保存时，其页面缓存会按预期清除。 引入了一项插件检查，以便像其他产品类型一样，使可配置变体的缓存失效，而不管索引器状态（计划或实时）如何。 以前，在管理员更新可配置变量后，店面上的价格不会正确更新。

<!-- ACP2E-1454 -->

* 为AWS凭据添加了缓存机制。 凭据提供程序现在使用Commerce缓存来缓存从AWS检索到的凭据以进行EC2配置。

<!-- AC-7639 -->

* 现在，插件可按预期工作，该插件的目的是在保存与可配置产品关联的简单产品时添加可配置缓存标记。 当`POST V1/products`更新简单产品时，所有相关的可配置缓存标记都会按预期删除。 以前，并非所有价格都会在店面更新，缓存必须手动清空。 [GitHub-36726](https://github.com/magento/magento2/issues/36726)

### 购物车和结账

<!-- ACP2E-2658 -->

* Commerce现在通过在启用永久购物车时生成整页可缓存页面(例如产品详细信息页面(PDP)和CMS页面)时不加载用户特定的报价数据来优化性能。 以前，系统会在生成这些页面期间不必要地加载特定于用户的会话和引用数据，从而影响性能。

<!-- ACP2E-2684 -->

* 自定义地址自定义属性现在按预期保存在数据库中。 以前，保存在数据库中的属性值前面会附加属性代码。

<!-- ACP2E-2517 -->

* 改进了为产品属性生成购物车规则过滤器文本。 单个产品不再加载多次。

<!-- AC-8920 -->

* 现在，如果在结账过程中发生错误，且购物者不再执行之前的结账步骤，Adobe Commerce会显示信息性错误消息。 以前，购物者返回到送货页面。

<!-- ACP2E-2520 -->

* `cart`查询不再返回虚拟购物车的配送方式和地址。 以前，当购物车包含物理和虚拟产品，并且所有物理产品都被移除时，购物车查询响应将继续包含送货信息。

<!-- ACP2E-2267 -->

* 现在，当触发“添加到购物车”操作时，Commerce会显示信息性消息。 以前，店面并不总是按需要显示`The requested qty is not available`。

<!-- ACP2E-2166 -->

* 对于拥有大地址簿的客户，结帐页面加载时间已缩短。 Commerce现在仅处理&#x200B;**[!UICONTROL Customer Addresses Limit]**&#x200B;设置中指定的客户地址数。 以前，Commerce加载整个通讯簿。

<!-- ACP2E-2174 -->

* 当一件商品缺货时，现在可以按预期更改手推车中库存商品的产品数量。 以前，购物者不能在任何商品缺货时更改其产品数量。

<!-- ACP2E-2269 -->

* `AdvancedSalesRule`产品属性过滤器现在可以正确处理十进制属性后端类型。 因此，将`Coupon Type`设置为&#x200B;**[!UICONTROL No Coupon]**&#x200B;的购物车规则现在可按预期工作。

<!-- ACP2E-2376 -->

* 现在，整个购物车折扣的全部金额按预期应用于包含捆绑包和可配置产品的购物车。

<!-- ACP2E-2092 -->

* 客户分区Cookie现在将执行Cookie的域设置。 以前，即使共享了会话，迷你购物车在包含子域的商店中没有按预期更新。

<!-- AC-9340 -->

* 在区域ID处理期间，将订单发送到多个地址不再触发错误。

<!-- AC-8853 -->

* 现在，在购物车级别应用的固定折扣金额是正确的。[GitHub-37496](https://github.com/magento/magento2/issues/37496)

<!-- AC-2044 -->

* 现在，当购物者在选择统一费率发运方法（将发运方法设置为条件的购物车价格规则适用）后应用优惠券时，优惠券将成功应用于订单。 以前，购物车页面显示“优惠券无效”错误，且未应用优惠券。 [GitHub-34866](https://github.com/magento/magento2/issues/34866)

<!-- AC-8596 -->

* 当购物者使用Chrome自动完成填写其送货地址，然后在重新加载送货方法块之前单击&#x200B;**[!UICONTROL My billing and shipping address are the same]**&#x200B;下一步&#x200B;**时，**&#x200B;复选框现在默认保持选中状态。 [GitHub-33725](https://github.com/magento/magento2/issues/33725)

<!-- ACP2E-2005 -->

* `applied_rule_ids`表中的`quote_item`值现在包含已应用规则ID的正确列表。 以前，此值仅包含上次应用的规则ID。

<!-- ACP2E-2025 -->

* 现在，当从服务器中删除会话时，本地存储中的迷你购物车和客户数据会重置。 以前，删除会话文件时仍会显示此数据。

<!-- ACP2E-1763 -->

* 启用永久购物车后，不再错误地从管理员合并离散购物车。

<!-- ACP2E-1988 -->

* 结账配送步骤中的默认配送地址不再使用之前选择的店内配送地址进行填充。

<!-- ACP2E-1614 -->

* 刷新缓存后，购物车中的产品不再从相关和追加销售产品列表中排除。

<!-- ACP2E-1580 -->

* 购物车税和配送估算器现在可以准确地反映默认目标配置。 以前，当您配置默认纳税目标计算设置并指定省/市/自治区和ZIP时，**[!UICONTROL Estimate Tax and Shipping]**&#x200B;下的购物车中只显示ZIP值。 这是由于Adobe Commerce在调用条件语句（用于从管理员设置默认区域ID）之前将区域ID设置为undefined所致。

<!-- ACP2E-1547 -->

* 启用永久购物车后，Adobe Commerce在签出期间不再引发此错误： `Invalid state change requested`。 以前，引发此错误时，有时会创建多个具有相同`quote_id`的订单。

<!-- ACP2E-1456 -->

* 迷你购物车现在显示反映购物车税务配置设置的捆绑产品价格。 以前，迷你购物车始终在捆绑产品的价格中包含税费。

<!-- ACP2E-1414 -->

* 提高了依赖活动购物车的客户区段规则的性能，这减少了将产品添加到购物车所需的时间。

<!-- AC-7503 -->

* 从购物车页面提供的配送估计值现在准确。 `collectShippingRates`现在只设置一次。 以前，运费估计数是重复的。 [GitHub-36648](https://github.com/magento/magento2/issues/36648)

<!-- ACP2E-1417 -->

* 指定购物车中的产品缺货时，`cart`查询不再返回错误。 以前，使用此查询进行购买的购物者无法在商品缺货且结账页面为空白时完成购买。

<!-- ACP2E-1459 -->

* 如果页面在登录移动环境期间重新加载，则对`POST V1/guest-carts/<cartId>/shipping-information`的来宾API请求不再返回`cancel`状态。 以前，Adobe Commerce引发500错误并记录此异常： `TypeError: Argument 2 passed to Magento\CustomerCustomAttributes\Model\Plugin\ProcessCustomerShippingAddressCustomAttributes::beforeSaveAddressInformation() must be of the type string, null given`。

<!-- AC-7886 -->

* 现在，当应用购物车规则的&#x200B;**[!UICONTROL Subtotal (Excl. Tax)]**&#x200B;条件时，可按预期计算免运费资格。 [GitHub-36760](https://github.com/magento/magento2/issues/36760)

<!-- AC-6672 -->

* `cart`查询现在返回产品的正确层定价。 [GitHub-29655](https://github.com/magento/magento2/issues/29655)

<!-- ACP2E-1162 -->

* 已将信息性错误消息添加到结账页面，以指导购物者在配送页面上应用优惠券与所选配送方式冲突时进行购物。 以前，有一条信息告诉购物者返回上一页。

<!-- ENGCOM-8387 -->

* 现在，仅当需要身份验证弹出窗口时，才会将其初始化，而不是在启用了来宾签出时。 现在，当访客购物者尝试继续结帐，且访客结帐被禁用时，它会进行初始化。 [GitHub-30672](https://github.com/magento/magento2/issues/30672)

### 购物车价格规则

<!-- AC-2054 -->

* 购物车价格规则产品子选择条件现在包括预期的`total (incl.tax)`选项。 [GitHub-34871](https://github.com/magento/magento2/issues/34871)

<!-- ACP2E-2029 -->

* `If an item is FOUND/NOT FOUND in the cart with ALL/ANY of these conditions true`目录价格规则条件现在可以正确与类别和SKU属性一起使用。 以前，在购物车价格优惠券逻辑中无法正确应用此条件，并且订单应用了无效优惠券。 [GitHub-37660](https://github.com/magento/magento2/issues/37660)

<!-- ACP2E-1932 -->

* 现在，您可以在禁用`Magento_OfflineShipping`扩展的情况下成功保存新的购物车价格规则。 以前，Adobe Commerce引发此错误： `report.ERROR: Warning: Undefined array key "simple_free_shipping"`。 [GitHub-37580](https://github.com/magento/magento2/issues/37580)

<!-- ACP2E-1516 -->

* 现在，当为商店配置了与一种配送方式相关的购物车价格规则，并且在结帐期间此配送方式更改为另一种配送方式时，购物车价格规则可按预期应用。 以前，从未在`applied_rule_ids`表中更改`sales_order_item`值，并且购物车价格规则未应用于该订单。

### 目录

<!-- AC-10746 -->

* 运行`bin/magento cache:clean`或`bin/magento cache:flush`不再刷新整个内置或Varnish全页缓存，除非另外指定。 [GitHub-38301](https://github.com/magento/magento2/issues/38301)

<!-- ACP2E-2257 -->

* 当`catalog_product_price dimensions-mode`设置为`website`时，商家现在可以使用产品轮播创建CMS块。 以前，Commerce未保存块并引发此SLQ错误： `report.CRITICAL: PDOException: SQLSTATE[42S02]: Base table or view not found: 1146 Table`。

<!-- AC-6847 -->

* 在产品详细信息页面上更改产品颜色时，Commerce不再显示重复图像。  [GitHub-36243](https://github.com/magento/magento2/issues/36243)

<!-- ACP2E-2504 -->

* 在大型多商店环境中添加新商店或更改现有商店后，优化了同步网站特定值的算法。

<!-- ACP2E-2631 -->

* 已改进缓存图像文件的清理过程，以避免在`pub/media/catalog/product`文件夹中创建隐藏目录。 以前，隐藏的目录在清理操作期间会导致磁盘空间问题。 该操作可以终止，这会留下从未删除的临时隐藏目录。

<!-- AC-10316 -->

* 现在，已正确计算捆绑产品价格，并且解决了计算价格时的操作顺序问题。 [GitHub-35665](https://github.com/magento/magento2/issues/35665)

<!-- AC-6996 -->

* 已从`catalog_product_price`索引查询中删除不必要的子句，这改进了此索引器在具有大型目录的存储上的性能。 [GitHub-32382](https://github.com/magento/magento2/issues/32382)

<!-- ACP2E-2522 -->

* 当此字段留空时，Commerce不再将产品描述文本插入到产品详细信息页面&#x200B;**[!UICONTROL Meta Description]**&#x200B;字段中。 以前，当产品描述包含由页面生成器或其他HTML编辑器生成的HTML代码时，HTML显示在元&#x200B;**[!UICONTROL Description]**&#x200B;字段中，并且您不能将此字段留空。

<!-- ACP2E-2308 -->

* 可配置产品PDP页面上的可配置产品选项不再受页面上的其他可配置产品选项的影响。 以前，当产品详细信息页面上存在产品轮播时，具有下拉属性的可配置产品不再触发异常。 当页面上存在其他具有样本选项的可配置产品时，可配置产品选项不可选。

<!-- ACP2E-2260 -->

* 现在，将根据商店视图配置显示最近查看的产品信息。 以前，不会根据商店视图更新最近查看的产品数据，包括名称和首选语言。

<!-- ACP2E-2296 -->

* 现在，在基于Chromium的Web浏览器中，Vimeo视频可在移动设备视图的产品页面上按预期播放。

<!-- ACP2E-1959 -->

* 现在，`bin/magento catalog:images:resize`命令可正确为分配给具有自定义主题的自定义网站的产品生成产品图像。

<!-- ACP2E-1982 -->

* 现在已根据`NULL`使用默认值`NOT NULL`复选框按预期为默认存储保存具有&#x200B;**或**&#x200B;值的元数据。 以前，取消选中此复选框时，不会保存具有`NULL`值的元数据。

<!-- ACP2E-2093 -->

* 商家现在可以从产品详情页面成功删除现有图像，然后上传具有相同名称的新图像。 以前，在这些情况下，店面产品页面不显示正确的图像。

<!-- ACP2E-2128 -->

* 现在，当产品映像`productDetail`属性设置为空时，`alt`查询将返回产品名称而不是null。

<!-- ACP2E-2215 -->

* 现在，包含可下载产品和实物产品的订单在完成后即包含指向可下载产品的工作链接。 以前，直到同一订单中的实际产品发货后，才能使用指向可下载产品的链接。

<!-- ACP2E-2343 -->

* 现在，当某个类别从一个存储/根类别移动到另一个存储/根类别时，会更新URL重写。 现在，当子类别转移到新的父类别时，将删除过时的数据库条目。 数据库现在仅包含相关条目。 以前，`url_path`未使用正确的存储ID进行更新。

<!-- ACP2E-2152 -->

* REST `V1/products/<sku>/media`终结点现在可以处理多个媒体图像的同时上载。 以前，在同时处理多个请求时，会创建不一致的数据，并在将数据保存到数据库时Commerce引发错误。

<!-- ACP2E-2259 -->

* 现在，当使用新创建的客户帐户的购物者注销时，客户区段横幅会按预期运行。 以前，即使在该帐户会话结束（即，注册的购物者注销）后，也会显示为已登录客户区段创建的横幅。

<!-- ACP2E-2219 -->

* 类别产品和产品类别索引器的部分重新索引性能已得到改进。 以前，`indexer_update_all_views` cron作业针对单个产品或类别多次运行重新索引器。

<!-- ACP2E-2043 -->

* 当产品库存状态根据库存配置（数量）自动更新为缺货时，库存状态随后将在库存数量更新时更新为有库存。 以前，当产品的库存配置更新为库存时，`stock_status_changed_auto`设置会被忽略。

<!-- AC-8904 -->

* 启用&#x200B;**[!UICONTROL Remember Category Pagination]**&#x200B;设置后，工具栏排序现在可在搜索页面上按预期运行。 [GitHub-33220](https://github.com/magento/magento2/issues/33220)

<!-- ACP2E-1640 -->

* 现在，在选中存储视图范围中的&#x200B;**[!UICONTROL Use Default Value]**&#x200B;复选框时，多选属性会按预期保存。 以前，在编辑产品并保存默认值时取消选中此复选框。

<!-- ACP2E-1878 -->

* 具有网站限制访问权限的管理员用户现在可以将图像添加到其范围内的产品。 如果管理员用户无产品访问权限，Commerce将显示一条信息性消息。 以前，具有网站限制访问权限的管理员用户无法将图像添加到他们有权访问的产品。

<!-- ACP2E-1956 -->

* 在存储视图范围内编辑产品时，未覆盖用户定义的`special_from_date`、`special_to_date`、`news_from_date`和`news_to_date`值。

<!-- AC-6761 -->

* 在多商店部署中，当产品名称因商店而异，Commerce现在在“管理员”>“**[!UICONTROL Category]**”>“**[!UICONTROL Products in category]**”中按名称对产品进行排序后显示正确的名称。 [GitHub-36208](https://github.com/magento/magento2/issues/36208)

<!-- ACP2E-1975 -->

* `addProductsToCart`突变现在返回带有数据的可自定义选项。 以前，它只返回空的可自定义选项。 [GitHub-37599](https://github.com/magento/magento2/issues/37599)

<!-- ACP2E-1859 -->

* 现在，当管理员用户在清除缓存但未重新加载类别页面后将新产品添加到类别时，产品位置和ID选择可正确显示。 以前，产品位置和选择不匹配，显示不正确。

<!-- ACP2E-1779 -->

* 商家现在可以更新可下载产品计划更改的将来开始日期或时间。 以前，Adobe Commerce在可下载产品的未来开始日期或时间更新期间引发此错误： `The downloadable link isn't related to the product. Verify the link and try again`。

<!-- ACP2E-1943 -->

* 现在，店面上正确显示了产品延交状态。 以前，可发运的产品被错误地标识为延期交货。

<!-- ACP2E-1948 -->

* 当管理员用户将商店视图从产品创建期间使用的视图更改为其他商店视图时，从管理员访问可下载产品不再会导致错误。 现在，当管理员用户将商店视图从所有商店视图切换到默认商店视图时，产品价格已成功转换为浮点数。 以前，Adobe Commerce会引发错误。 [GitHub-37519](https://github.com/magento/magento2/issues/37519)

<!-- ACP2E-1994 -->

* 现在，当`manage_stock`值等于`use_config_manage_stock`时，导出的产品具有正确的`1`值。 以前，此默认值不正确。

<!-- ACP2E-1479 -->

* 当您保存使用自定义选项创建的产品时，Adobe Commerce在删除其图像后不再显示警告消息。

<!-- ACP2E-1419 -->

* 现在，产品缩略图图像会按预期显示在产品重新上架时发送的产品库存警报电子邮件中。 以前，此图像不显示在警报电子邮件中

<!-- AC-3003 -->

* 类别树中的产品计数（管理员&#x200B;**[!UICONTROL Catalog]** > **[!UICONTROL Category]**）现在准确。 以前，无法从`catalog_category_product_index`表中检索类别产品计数。 已修复触发此错误的拼写错误。 [GitHub-35417](https://github.com/magento/magento2/issues/35417)

<!-- ACP2E-1239 -->

* 禁用主题`product_image_white_borders`中的`view.xml`时，产品详细信息页面上的主产品图像在页面加载期间不再明显下移。 以前，由于Fotorama JS中的高度设置不正确，导致产品图像在页面加载期间明显向下偏移。

<!-- ACP2E-1361 -->

* 现在，当客户订阅了价格下降警报时，将会向客户发送有关产品价格下降的通知。 以前，由于应用程序级别的缓存，不能始终发送降价通知。

<!-- ACP2E-1422 -->

* 在通过Web API创建产品属性的过程中添加了服务器端验证。 当&#x200B;**[!UICONTROL Use in Layered Navigation Catalog]**&#x200B;字段值为&#x200B;**[!UICONTROL Catalog Input Type for Store Owner]**、`Text Field`、`Text Area`、`Text Editor`或`Date`时，您无法启用`Date and Time`字段。 以前，类别和搜索结果中会忽略产品。

<!-- ACP2E-1413 -->

* 现在，购物者打开页面、更改分页、导航到产品页面，然后返回到类别页面后，类别页面以正确的分页重新加载。 [GitHub-36563](https://github.com/magento/magento2/issues/36563)

<!-- ACP2E-1334 -->

* 当&#x200B;**[!UICONTROL Display Out of Stock Products]**&#x200B;设置为&#x200B;**是**&#x200B;时，作为可配置产品选项的缺货简单产品现在在店面中显示为已禁用。 以前，所有选项都显示为可用，无论其状态和实际可用性如何。

<!-- ACP2E-1384 -->

* 更新特定商店视图中的网站范围属性不再覆盖全局范围中该属性的值。 以前，在相同的SKU和`store_view_code`中有多个行可用时导入产品价格，会导致默认和“所有商店”视图范围的价格不准确。

<!-- ACP2E-1632 -->

* 商家现在可以从管理员将GIF图像添加到产品的图像库。 以前，Adobe Commerce显示此错误： `imagecolorsforindex(): Argument #2 ($color) is out of range`。

<!-- ACP2E-1709 -->

* 已添加检查以处理未定义数组键导致的错误。 以前，在生成声明性架构白名单期间出错。

<!-- ACP2E-1749 -->

* Adobe Commerce现在返回自定义日期`01/01/1970`的有效结果。 以前，自定义属性返回此错误： `Invalid input datetime format of value '1/01/1970`。 [GitHub-37274](https://github.com/magento/magento2/issues/37274)

<!-- AC-6507 -->

* 使用片段的`routes`查询现在可按预期返回类别信息。 以前，类别页面上发生内部服务器错误。 [GitHub-35906](https://github.com/magento/magento2/issues/35906)

<!-- ACP2E-1772 -->

* 已解决`cataloginventory_stock`部分重新索引过程的问题，索引器性能已得到改进。 以前，库存和产品类别无法准确更新。

<!-- AC-8226 -->

* 现在，当产品所属的类别已移至新父级时，Adobe Commerce会为产品生成301重定向。 [GitHub-37039](https://github.com/magento/magento2/issues/37039)

### 目录规则

<!-- ACP2E-1834 -->

* 现在，当通过计划更新启用目录规则时，该规则将正确地编制索引。 因此，现在可以正确生成折扣价格并编制索引。 以前，当两个目录规则可用，并且在第一个规则的目录规则索引操作完成之前在第一个规则之后激活一个规则时，不会为第二个目录规则生成目录规则折扣价格。

<!-- ACP2E-1579 -->

* 现在，目录规则可按预期方式在多网站环境中应用。

### 可配置的产品

<!-- ACP2E-1881 -->

* 商户现在可以在配置可配置产品时选择&#x200B;**[!UICONTROL Skip quantity at this time]**&#x200B;和&#x200B;**[!UICONTROL Skip image uploading at this time]**，而不会影响关联的简单产品的来源。 以前，选择&#x200B;**[!UICONTROL Skip quantity at this time]**&#x200B;会导致产品源消失。

<!-- AC-7099 -->

* 当所有选项的价格都相同时，不再为可配置产品价格显示&#x200B;**[!UICONTROL As low as]**&#x200B;标签。

<!-- ACP2E-2464 -->

* 现在，具有网站权限的管理员用户可以将属于可配置产品的子产品保存在不同的商店上下文中。 重新索引流程现在会跳过这种可配置产品。

<!-- ACP2E-2003 -->

* 计划更新禁用了一个子产品时，不再将具有两个子产品的可配置产品标记为缺货。

<!-- AC-8060 -->

* 提高了具有多个选项的可配置产品的保存操作性能。 以前，在产品保存操作期间可能会发生超时。 [GitHub-36928](https://github.com/magento/magento2/issues/36928)

<!-- ACP2E-1764 -->

* 现在，当购物者选择产品选项时，可配置产品价格的店面显示会按预期发生变化。 [GitHub-37378](https://github.com/magento/magento2/issues/37378)

### 优惠券

<!-- ACP2E-2495 -->

* 现在，当之前使用优惠券的订单失败时，可以再次使用每个客户使用次数有限的优惠券代码。 以前，取消前一订单时不会发布促销代码。

<!-- ACP2E-2428 -->

* 包含空格字符的优惠券代码将不再失效。 以前，如果优惠券代码包含空格字符（在实际代码之前或之后），则验证失败。 [GitHub-38048](https://github.com/magento/magento2/issues/38048)

<!-- ACP2E-1551 -->

* 购物者现在可以使用由同一购物车价格规则生成的两个单独的自动生成优惠券代码。 当优惠券类型选择为`Uses per Coupon`时，`Auto`字段现在已启用（与优惠券类型=`Specific Coupon`类似） 。 如果代码不同，这又使购物者可以将多个优惠券代码应用于相同的购物车价格。

<!-- ACP2E-1496 -->

* 现在，当购物者的一次性优惠券应用于的订单被取消时，该优惠券值会按预期恢复。

<!-- ACP2E-1195 -->

* `GET V1/coupons/<couponId>`端点现在会像对自动生成的优惠券一样，返回手动创建的优惠券的完整预期响应。 以前，某些字段被忽略（例如，`usage_limit`、`usage_per_customer`和`created_at`）。

### cron

<!-- ACP2E-2457 -->

* `aggregate_sales_report_bestsellers_data` cron作业不再创建非常大的临时MySQL表，现在已成功完成。 此cron作业现在为每个存储插入数据，而不是同时为所有存储插入数据。 以前，此cron作业可能导致`No space left on device`错误。

<!-- ACP2E-2427 -->

* 通过阻止cron作业尝试获取不必要的cron作业锁定，`cron_schedule`表中的挂起记录数已减少。 以前，cron作业会在运行该作业时太晚时尝试获取锁。 `cron_schedule`中的Cron作业未标记为已错过，即使它们已经过了计划时间。 Commerce还在错误日志中重复显示此错误： `report.WARNING: Could not acquire lock for cron job: indexer_update_all_views`。

<!-- AC-9207 -->

* 修复了cron表达式中按零分的致命错误。 [GitHub-37804](https://github.com/magento/magento2/issues/37804)

<!-- ACP2E-1792 -->

* 通过在报价表中添加`sales_clean_quotes`和`store_id`的复合索引，`updated_at columns` cron进程已优化为运行得更快。 此更改可改进处理多个报价时的cron作业性能。

<!-- AC-7987 -->

* 管理员用户现在可以查看`bin/magento cron:run`进程当前正在执行的任务。 当前正在运行的进程的标题现在列出了组和作业名称。 [GitHub-34321](https://github.com/magento/magento2/issues/34321)

### 客户

<!-- AC-6748 -->

* Adobe Commerce现在根据配置设置在“编辑客户”页面上显示&#x200B;**[!UICONTROL Date of Birth]**、**[!UICONTROL Tax/VAT Number]**、**[!UICONTROL Gender]**、**[!UICONTROL Telephone]**、**[!UICONTROL Company]**&#x200B;和&#x200B;**[!UICONTROL Fax]**&#x200B;字段。 [GitHub-36196](https://github.com/magento/magento2/issues/36196)

### 客户区段

<!-- ACP2E-2471 -->

* 客户区段条件现在会按预期加载所有匹配的客户。 以前，客户区段匹配客户列表不包含所有匹配的客户。

### EAV

<!-- ACP2E-2222 -->

* EAV索引器不再要求在批处理期间删除不可见实体。 默认情况下，索引器不再批处理不可见产品，索引器性能也得到了改进。

### 电子邮件

<!-- ACP2E-2125 -->

* 包含变音符号或重音符号的电子邮件（即utf8电子邮件）现在受客户和公司支持，也受来宾和注册客户下订单的支持。 以前，Commerce不保存包含变音符号并显示此错误的客户记录： `Something went wrong while saving the customer`。

<!-- ACP2E-2503 -->

* 电子邮件发件人名称不能再包含冒号字符。 新的验证规则现在阻止保存管理员&#x200B;**[!UICONTROL Stores]** > **[!UICONTROL General]**&#x200B;的“存储电子邮件地址”部分中包含冒号字符的发件人姓名。 以前，商家可以保存包含冒号字符的发件人名称，这会导致邮件服务器错误。

<!-- ACP2E-2018 -->

* 对于具有自定义图像选项的产品，图像选项不再显示为“返回客户电子邮件”（默认模板）中的HTML标记。

<!-- ACP2E-1529 -->

* 当“分配公司管理员”电子邮件中包含`CMS Block URL`变量时，公司管理员详细信息现在会按预期保存，并且管理员会被正确重定向。

<!-- AC-2903 -->

* 客户电子邮件地址现在可以包含变音符号。 以前，前端验证禁止创建电子邮件地址中包含变音符号的用户。 [GitHub-12075](https://github.com/magento/magento2/issues/12075)

<!-- ACP2E-1682 -->

* 库存和价格警报电子邮件现在会根据为网站默认商店视图配置的语言进行翻译。 以前，不翻译这些电子邮件。

<!-- ACP2E-1571 -->

* `POST V1/order/notify-orders-are-ready-for-pickup`现在会发送电子邮件提醒客户，只有在订单就绪后才能提货。 现在，仅当无一例外履行了请求时，才会触发电子邮件。

### 框架

<!-- AC-10873 -->

* 改进了在输出带有Varnish的HTTP标头时添加`UNCACHEABLE`值的调试。 以前，仅输出`HIT`或`MISS`值。 [GitHub-37912](https://github.com/magento/magento2/issues/37912)

<!-- AC-10884 -->

* 添加了支持默认Varnish压缩处理的代码。 [GitHub-38309](https://github.com/magento/magento2/issues/38309)

<!-- AC-8502 -->

* `bin/magento varnish:vcl:generate`命令现在包含`input-file argument`。 这支持向Git存储库中添加相对于Commerce根的自定义VCL。 [GitHub-37363](https://github.com/magento/magento2/issues/37363)

<!-- AC-10739 -->

* 从代码库中移除了对Varnish 4.x和5.x的支持。 [GitHub-38304](https://github.com/magento/magento2/issues/38304)

<!-- AC-8023 -->

* `phpcodesniffer-composer-installer`中的`composer.json`已升级到v1.0.0。[GitHub-36913](https://github.com/magento/magento2/issues/36913)

<!-- AC-10858 -->

* 已从代码库中删除不符合[RFC3986](https://www.rfc-editor.org/rfc/rfc3986.html)的字符。 [GitHub-38355](https://github.com/magento/magento2/issues/38355)

<!-- AC-10692 -->

* 修复了`Magento\Reports\Block\Adminhtml\Shopcart\Product\Grid`类中错误的PHP文档标记。 [GitHub-38186](https://github.com/magento/magento2/issues/38186)

<!-- AC-10865 -->

* 在编码实践要求`app/etc/env.php`文件中包含的任何缓存部分都将包含前端部分时创建的整个代码库中重构的代码。 此重构可解决升级2.4.4之前版本的Commerce部署时存在的潜在问题。 [GitHub-38363](https://github.com/magento/magento2/issues/38363)

<!-- AC-8005 -->

* 澄清了在API调用期间提供值为0的库存ID时与`StockItemValidator.php`关联的错误消息。 [GitHub-31107](https://github.com/magento/magento2/issues/31107)

<!-- AC-10583 -->

* 向`$tagGenerators`中的`CompositeTagGenerator`添加了默认空数组，以防止依赖项注入编译期间出错。 以前，在禁用`bin/magento setup:upgrade`和`Magento_DirectoryGraphQl`模块的情况下运行`Magento_StoreGraphQl`命令会导致错误。 [GitHub-38165](https://github.com/magento/magento2/issues/38165)

<!-- AC-9232 -->

* 已删除未使用的`AlgorithmProviderFactory`类以及包含`JweAlgorithmManagerFactory.php`、`JweContentAlgorithmManagerFactory.php`和`JwsAlgorithmManagerFactory`的类中该类上的依赖项。 [GitHub-37783](https://github.com/magento/magento2/issues/37783)

<!-- AC-9776 -->

* `var/log/system.log`文件不再包含`main.INFO error`消息。 菜单条目日志已从INFO级别移至DEBUG级别。 以前，`var/log/system.log`文件被如下消息所淹没： `Add of item with id Magento_Theme::design_config was processed … `。

<!-- AC-8809 -->

* 当`exec()`返回false时，Redis预加载不再失败。 已将验证添加到预加载过程，以防止`array_combine`将`false`作为第二个参数接收。 因此，当`exec()`返回`false`时，预加载将继续运行。 [GitHub-37509](https://github.com/magento/magento2/issues/37509)

<!-- AC-8220 -->

* 已重构`Magento_CatalogWidget`模块，将`$block`转义函数替换为`$escaper`转义函数。 [GitHub-37107](https://github.com/magento/magento2/issues/37107)

<!-- AC-9336 -->

* `Swaziland`在整个代码库中已更新为`Eswatini`。 [GitHub-37873](https://github.com/magento/magento2/issues/37873)

<!-- ACP2E-2638 -->

* 已将新尼加拉瓜货币(NIO)添加到可用货币列表中。

<!-- AC-10591 -->

* 在`reponseBody`中将`responseBody`变量的名称更改为`app/code/Magento/CatalogRule/Controller/Adminhtml/Promo/Catalog/NewConditionHtml.php`。[GitHub-38093](https://github.com/magento/magento2/issues/38093)

<!-- AC-9221 -->

* 解决了在启用了小数数量的产品的事务处理中发生的小计舍入错误。 [GitHub-37817](https://github.com/magento/magento2/issues/37817)

<!-- ACP2E-2127 -->

* 现在，管理员客户网格的日期过滤器可根据指定的区域设置按预期工作。

<!-- AC-9027 -->

* 由于`bin/magento setup:upgrade`变量数据类型，`$schemaPatch`命令不再失败。 以前，字符串值被传递到`get_class`函数，这会导致错误。 [GitHub-37545](https://github.com/magento/magento2/issues/37545)

<!-- ACP2E-2485 -->

* 为Adobe Commerce Cloud上的从属连接启用`synchronous_replication`时不再发生严重数据库读取失败。

<!-- ACP2E-2345 -->

* 现在，如果连接在您为使用者设置`max_messages = 0`时在事务期间超时，则恢复到MySQL数据库的连接。 以前，连接被终止。

<!-- ACP2E-2121 -->

* `magento/module-release-notification`核心模块在2.4-develop代码中被标记为已弃用，注释为： `Starting from Magento 2.4.7,  Magento_ReleaseNotification module is deprecated in favor of another in-product messaging mechanism`。

<!-- AC-9388 -->

* 现在，代理代码生成会按预期为生产模式下运行的部署生成代理和工厂文件。 [GitHub-35252](https://github.com/magento/magento2/issues/35252)

<!-- AC-1477 -->

* 印度拉达克州现在作为选项列在管理员地址&#x200B;**[!UICONTROL State]**&#x200B;下拉菜单中。 [GitHub-33698](https://github.com/magento/magento2/issues/33698)

<!-- AC-8388 -->

* 现在，事件倒计时滚动条在类别页面上按预期显示。

<!-- AC-8369 8368 8365 8317 8351 8357 8377 8357 8351 8323-->

* 已从代码库中移除禁止的`@author`标记，这些模块包括： `Magento_user-variable-wee`、`Magento_Catalog`和`Magento_Customer`、`Magento_Wishlist`、`Magento_Review` `Tax`以及整个框架。 [GitHub-37245](https://github.com/magento/magento2/issues/37245)，[GitHub-37246](https://github.com/magento/magento2/issues/37246)，[GitHub-37249](https://github.com/magento/magento2/issues/37249)，[GitHub-37263](https://github.com/magento/magento2/issues/37263)

<!-- AC-9489 -->

* `User`模块中的JSON序列化程序已替换为更准确的新序列化程序(`JsonHexTag`)。 以前，当包含未转义元素时，Commerce在尝试使用由常规序列化器序列化的数据时有时会崩溃。 [GitHub-31377](https://github.com/magento/magento2/issues/31377)

<!-- ACP2E-2138 -->

* 运行完全重新索引(`bin/magento indexer:reindex`)时不再发生管道损坏错误。 AMPQ连接现在在进程管理器分支进程之前关闭。

<!-- ACP2E-2244 -->

* 队列消息验证器现在验证所有数组元素的子类型。 以前，Commerce引发异常。

<!-- ACP2E-2066 -->

* `app/etc/env.php`中每个主题的队列连接配置现在可以正常工作。 以前，使用自定义交换创建新消息队列时，产品警报队列无法正确生成。 如果使用自定义交换在`app/etc/env.php`中配置了主题的队列连接，则会为该自定义交换的所有主题创建新的绑定。 商家无法处理产品提醒。

<!-- ACP2E-2144 -->

* 将MariaDB服务器升级到版本10.5.1或更高版本时，使用`/* mariadb-5.3 */`注释标记的临时格式在`bin/magento setup:install`期间不再导致错误。

<!-- ACP2E-2147 -->

* 现在，AwsS3驱动程序可按预期工作，取代基本默认文件存储实施。 以前，当为文件存储配置此驱动程序时，数据可能会损坏。 [GitHub-37844](https://github.com/magento/magento2/issues/37844)

<!-- ACP2E-1999 -->

* 使用`bin/magento config:show`变量的`set`和`$_ENV`命令现在支持使用包含逗号或大写字符的网站和商店代码。

<!-- AC-8923 -->

* 添加了在Tailwind 3中使用的具有`!important`的类以支持CSS布局。 [GitHub-37568](https://github.com/magento/magento2/issues/37568)

<!-- AC-9115 -->

* `jQuery`文件中已添加缺失的`trim-input.js`依赖项。 [GitHub-37683](https://github.com/magento/magento2/issues/37683)

<!-- AC-9387 -->

* 事件特定的详细信息现在作为`context`方法的第二个属性(`log`)传递。 [GitHub-37879](https://github.com/magento/magento2/issues/37879)

<!-- AC-9109 -->

* 已将宽高比值添加到目录图像，并从UI框架中删除了不必要的脚本。 [GitHub-37691](https://github.com/magento/magento2/issues/37691)

<!-- AC-9188 -->

* 修订了由无效XML配置触发的错误消息，以提供更多信息。 [GitHub-37788](https://github.com/magento/magento2/issues/37788)

<!-- AC-9335 8817-->

* 已重构的已弃用代码，这些代码与在整个代码库中创建动态属性有关。

<!-- AC-7009 -->

* 对于产品数据库极为活跃的大型商店，索引器的性能已得到改进。 现在，索引器对每个索引的最新产品信息编制一次索引，而不是多次。 以前，产品会从网站上消失，并且网站上的产品数据可能会过期。 [GitHub-30012](https://github.com/magento/magento2/issues/30012)

<!-- ACP2E-1971 -->

* 当从属数据库连接可用时，`mview_state`记录状态现在可以准确地指示基于更改日志活动的状态。 以前，即使更改日志中没有新条目，这些记录在云部署中仍处于`waiting`状态。

<!-- ACP2E-2022 -->

* 添加了对货币格式的`precision`选项的支持，以保留与已弃用`ZendCurrency`类的功能等同性。

<!-- AC-8854 -->

* Cookie消息已转换为可观察属性，开发人员现在可以操纵状态，这可能会触发UI更改。 以前，Cookie是只读的，无法控制。 [GitHub-37308](https://github.com/magento/magento2/issues/37308)

<!-- AC-6325 -->

* 现在，当管理员的Commerce实例连接到S3存储时，他们便可以生成发票。 以前，Commerce显示此错误： `Cannot create image resource. File not found`。 [GitHub-35706](https://github.com/magento/magento2/issues/35706)

<!-- AC-6906 -->

* 当VIES验证服务进行的增值税编号验证失败时，Adobe Commerce现在会按预期记录例外消息。 [GitHub-36065](https://github.com/magento/magento2/issues/36065)

<!-- AC-8146 -->

* 在创建管理员角色期间，已从用于获取管理员角色的查询中删除了`Administrators`名称。 [GitHub-36998](https://github.com/magento/magento2/issues/36998)

<!-- AC-8607 -->

* `bin/magento setup:config:set`文件中包含无效的数据库用户名时，`app/etc/env.php`命令不再失败。 [GitHub-37409](https://github.com/magento/magento2/issues/37409)

<!-- AC-8595 -->

* 在默认Admin UI组件中对保留字按列排序不会再导致`var/log/exception.log`中出现SQL错误。 [GitHub-37423](https://github.com/magento/magento2/issues/37423)

<!-- AC-8562 -->

* 添加了`AddDataForCostaRica.php`以提供哥斯达黎加的国家信息。 [GitHub-37382](https://github.com/magento/magento2/issues/37382)。

<!-- AC-8577 -->

* 改进了用户尝试从管理员访问无效URL的方案的错误消息。 [GitHub-35682](https://github.com/magento/magento2/issues/35682)。

<!-- ACP2E-1841 -->

* 货币符号的`Param $options[`position`]`现在按预期工作，并且支持货币符号位置的自定义。 以前，在从Zend Framework 1迁移后，`toCurrency`方法忽略`position`参数。 在整个管理员界面中都会出现此问题。

<!-- AC-8817 -->

* 已重构的已弃用代码，这些代码与在整个代码库中创建动态属性有关。

<!-- AC-8154 -->

* 通过扩展Adobe Commerce和Magento Open Source 2.4.6之前版本中的TinyMCE编辑器而创建的自定义样式格式，现在可在页面生成器`text`内容类型中按预期使用。 以前，自定义样式格式会被忽略，并且只有在升级到Adobe Commerce 2.4.6-p1后才会加载默认格式。 [GitHub-36950](https://github.com/magento/magento2/issues/36950)

<!-- AC-8576 -->

* 已将以下信息性注释添加到`quote.php`文件： `Important: This method also copies customer data to quote and removes quote addresses`。 [GitHub-37400](https://github.com/magento/magento2/issues/37400)

<!-- ACP2E-1973 -->

* 锁定提供程序的实例化现在通过`\Magento\Framework\Lock\Proxy`类。 锁定提供程序现在通过`lock`文件配置了`app/etc/env.php`设置。

<!-- ACP2E-1492 -->

* 已对订单实施互斥，以防止在并发请求更新期间出现争用情况。 以前，订单取消的并发请求（争用条件）导致`inventory_reservation`表中出现重复条目。

<!-- ACP2E-1381 -->

* `populateWithArray`函数现在将对象属性正确转换为大小写，使其与`AbstractModel` getter和setter兼容。 以前，当数据属性名称一行包含多个大写字母时，Snake大小写格式不正确。

<!-- ACP2E-1522 -->

* 现在，保存产品后，`catalog_product_entity_varchar`表中的自动增量值将正确递增。 以前，此值会增加十。

<!-- ACP2E-1701 -->

* 当您尝试刷新JavaScript/CSS缓存时，Adobe Commerce不再引发此文件系统异常： `No such file or directory`。

<!-- ACP2E-1358 -->

* `value_id`中的`customer_entity_int`值现在正确递增。 更新包含这些属性的实体时执行更新查询，而不是`insert on duplicate key update`。 因此，在EAV模型中使用的自动增量列现在以线性方式增长。 以前，对列的自动递增过程由于插入查询失败而跳过值。 [GitHub-28387](https://github.com/magento/magento2/issues/28387)

<!-- AC-8462 -->

* 从不需要的`id`属性中删除不必要的空格。 (此错误是由Adobe Commerce 2.4.6代码更改引入的。)

<!-- AC-7923 -->

* 当存储处于单存储模式时，存储代码不再出现在存储URL中。 [GitHub-36831](https://github.com/magento/magento2/issues/36831)

<!-- AC-7988 -->

* 对`around`插件进行了小幅更新。 [GitHub-31443](https://github.com/magento/magento2/issues/31443)

<!-- AC-7989 -->

* 样本`Helper`已重构，以删除误导性的导入别名。 [GitHub-31373](https://github.com/magento/magento2/issues/31373)

<!-- AC-8708 -->

* 管理员用户现在可以按预期删除或重命名`sitemap.xml`文件。 以前，管理员用户可以从管理员中删除文件，但该文件仍保留在文件系统中。 [GitHub-37468](https://github.com/magento/magento2/issues/37468)

<!-- ACP2E-1747 -->

* 当已应用优惠券的订单的付款失败时，不再将优惠券标记为使用。 现在，队列消息会按照使用者启动时发布消息的顺序进行处理。 以前，从队列中提取第一条消息只是为了检查消息是否已排队，之后被拒绝，这导致了最后处理第一条消息。

<!-- ACP2E-1627 -->

* 当用户尝试打印传送标签时，Adobe Commerce不再在日志文件中引发异常。 以前，如果扩展修改包含附件的响应标头，则系统在日志文件中引发异常。

<!-- AC-7986 -->

* `elements.xsd`中添加了对更多HTML类的支持。 [GitHub-36891](https://github.com/magento/magento2/issues/36891)

### 常规修复

<!-- AC-10591 -->

* 在`reponseBody`中将`responseBody`变量的名称更改为`app/code/Magento/CatalogRule/Controller/Adminhtml/Promo/Catalog/NewConditionHtml.php`。[GitHub-38093](https://github.com/magento/magento2/issues/38093)

<!-- ACP2E-2647 -->

* 计划产品更新不再清除多选属性数据。 以前，当计划产品更新时，产品的多选属性数据会被错误清除。 [GitHub-37675](https://github.com/magento/magento2/issues/37675)

<!-- AC-2904 -->

* 使用非默认存储范围保存产品时，使用`ProductRepository`加载时不再导致未更改属性成为存储范围。 [GitHub-8897](https://github.com/magento/magento2/issues/8897)

<!-- ACP2E-2132 -->

* 现在，在启用了访问限制的情况下，购物者可以访问配置为层次结构节点的页面。 以前，发生无限重定向循环，且浏览器引发此错误： `ERR_TOO_MANY_REDIRECTS`。

<!-- ACP2E-2404 -->

* 在产品详细信息页面上的自定义字段验证中添加了信息性错误消息。 [GitHub-38006](https://github.com/magento/magento2/issues/38006)

<!-- ACP2E-2511 -->

* 名称字段中现在可以使用特殊字符。 以前，名称验证器中限制了&amp;字符，当客户名称包含&amp;字符时，这会阻止客户添加或编辑操作。 [GitHub-38080](https://github.com/magento/magento2/issues/38080)

<!-- ACP2E-2469 -->

* 对特定商店具有受限访问权限的管理员用户现在可以使用批量更新操作来更新产品审查。 以前，Commerce引发此异常： `report.CRITICAL: TypeError: array_intersect(): Argument #1 ($array) must be of type array, null given in app/code/Magento/AdminGws/Model/Models.php:439`。

<!-- AC-8600 -->

* storefront登录页面的“显示密码”功能现在可按预期显示密码。 以前，不会显示密码。 [GitHub-37432](https://github.com/magento/magento2/issues/37432)

<!-- ACP2E-2062 -->

* 产品比较列表现在始终特定于网站来访购物者，不包含从其他网站添加的产品，包括分配给两个网站的产品。

<!-- ACP2E-2087 -->

* 将包含表情符号的CMS内容块保存到数据库后，该表情符号将不再被截断。 以前，由于默认数据库配置不支持四字节字符，因此在emoji后截断内容。

<!-- ACP2E-2154 -->

* 当使用&#x200B;**Products进行配置以匹配**&#x200B;设置时，相关产品规则的&#x200B;**是**&#x200B;条件之一现在可以正常工作。 以前，此规则不标识任何产品。

<!-- ACP2E-2164 -->

* CMS页面网格现在根据分配给管理员用户的商店视图来筛选页面。 以前，不应用角色范围。

<!-- AC-8823 -->

* 当登录页面上的&#x200B;**[!UICONTROL Show Password]**&#x200B;复选框处于活动状态时，密码现在按预期显示。

<!-- ACP2E-2037 -->

* 客户实体(`rp_token`)验证的“重置密码令牌”系统属性已在客户帐户创建期间从属性验证中删除，并且变音符号验证仅包含在生成的客户电子邮件中。 以前，Commerce未保存客户记录并显示此错误： `Something went wrong while saving the customer`。

<!-- AC-8826 -->

* 删除列后，您现在可以成功地将编辑内容保存到管理页面和块网格。 [GitHub-37525](https://github.com/magento/magento2/issues/37525)

<!-- ACP2E-1933 -->

* 公司管理员现在可以从店面添加公司用户。 以前，当管理员用户尝试添加新用户时，Commerce会记录此错误： `report.CRITICAL: Error: Call to a member function __toArray() on null in app/code/Magento/LoginAsCustomerLogging/Observer/LogSaveCustomerObserver.php:123`。

<!-- ACP2E-1972 -->

* 客户现在可以在其他设备上重置密码后，使用新密码从一台设备成功登录。

<!-- ACP2E-1609 -->

* 管理员客户地址&#x200B;**省/市/自治区**&#x200B;字段现在会按预期保留上次保存的值。 以前，当您从此字段中移除值时，Commerce继续在&#x200B;**州/省**&#x200B;字段中显示已删除的值。 [GitHub-36846](https://github.com/magento/magento2/issues/36846)

<!-- ACP2E-1796 -->

* 当您首次取消选择，然后选择新创建的Adobe Commerce页面时，CMS不再引发约束冲突错误。

<!-- ACP2E-1639 -->

* 现在，层次结构网站根已正确分配到新创建的CMS页面。 以前，在新创建的CMS页面上，层级网站根目录选择不匹配。

<!-- ACP2E-1508 -->

* 启用&#x200B;**[!UICONTROL RSS Feed Top Level Category]**&#x200B;后，在请求类别的RSS源期间不再发生错误。 以前，在启用`CRITICAL`时，浏览RSS馈送类别页面会导致日志文件中的Elasticsearch **[!UICONTROL RSS Feed Top Level Category]**&#x200B;错误。

<!-- ACP2E-1490 -->

* 现在，如果在创建用户角色期间更改了角色范围，则会为`gws_store_groups`保存正确的值。 以前，将角色范围选为`All`时，`gws_store_groups`值会在用户创建期间保存为null，但在角色编辑期间不会保存为null。 此外，如果将角色范围选为`Custom`，则`gws_store_groups`值始终保存为null。

<!-- ACP2E-1446 -->

* 启用&#x200B;**[!UICONTROL Add Store Code to Urls]**&#x200B;设置后，现在可以通过单击“管理员登录”页面上的“管理员重置密码”链接来访问“重置密码”页面。 管理员重置密码链接以前打开了登录页面或404页面。

<!-- ACP2E-1274 -->

* 现在，管理员统计信息仪表板中的日期范围是根据在配置设置中设置的时区来计算的，然后转换为UTC以从数据库中提取数据。

<!-- ACP2E-1665 -->

* 在筛选商店视图，然后单击管理员&#x200B;**[!UICONTROL Save]** > **[!UICONTROL Content]**&#x200B;上的&#x200B;**[!UICONTROL Hierarchy]**&#x200B;后，CMS层次结构筛选器可按预期工作。 以前，单击&#x200B;**[!UICONTROL Save]**&#x200B;刷新页面，但上下文已丢失，并且选定的商店视图不再显示。

<!-- ACP2E-1631 -->

* 单击&#x200B;**[!UICONTROL Send invitation]**&#x200B;按钮（管理员&#x200B;**[!UICONTROL Marketing]** > **[!UICONTROL Private sales]** > **[!UICONTROL Invitation]**）现在可随表单密钥一起提交POST请求并成功发送邀请。 以前，当您单击此按钮时，HTTP POST方法和表单键都不存在。

<!-- ACP2E-1608 -->

* 现在可以使用AWS S3将零字节文件成功复制到远程存储。

<!-- AC-7402 -->

* 现在，在为商店ID与网站ID不匹配的其他网站创建客户时，管理员用户可以从管理员中添加新的客户地址。 以前，Adobe Commerce显示此弹出消息： `Something went wrong`。 [GitHub-36582](https://github.com/magento/magento2/issues/36582)

<!-- AC-8247 -->

* CMS块编辑器页面现在显示正确的构件`block_id`值。 [GitHub-29644](https://github.com/magento/magento2/issues/29644)

### 礼品卡和包装

<!-- AC-7372 -->

* 商家不能再创建具有负值的礼品卡。

<!-- ACP2E-1890 1806-->

* `setGiftOptionsOnCart`突变现在会按预期从订单中删除礼品包装。 现在在购物车级别取消设置`gift_wrapping_id`的值。 以前，即使在购物车级别取消设置`gift_wrapping_id`的值，订单下达后该值也会更新为之前的值。

<!-- ACP2E-1866 -->

* 现在，当从应用礼品卡的订单中处理简单产品的部分退款时，礼品卡帐户将按预期保持有效。 以前，会删除礼品卡帐户。

<!-- ACP2E-1805 -->

* 现在，从购物车中删除礼品消息时，`setGiftOptionsOnCart`突变会成功更新数据库。 以前，数据库中不会更新消息详细信息，并且不会从购物车中删除礼品消息。

<!-- ACP2E-1741 -->

* 礼品注册表`Event Information`标签现在已按预期翻译。

<!-- ACP2E-1586 -->

* 现在，可以正确计算自定义礼品卡金额的小计。

<!-- ACP2E-1350 -->

* 现在，使用多个地址结账时可正确应用礼品卡。 以前，多地址装运的礼品卡金额应用不正确，导致礼品卡金额无效。

<!-- ACP2E-1341 -->

* 现在，在`send()`调用期间完成模拟后，`getInfoBlockHtml()`调用期间将开始模拟，并且不会记录任何错误。 以前，`system.log`文件会因以下错误而泛滥： `main.ERROR: Environment emulation nesting is not allowed`。 [GitHub-35603](https://github.com/magento/magento2/issues/35603)

<!-- ACP2E-1612 -->

* 您现在可以使用`updateCartItems`突变来更新购物车中的礼品卡。 以前，仅购物车中的卡数量可以通过此突变进行更新。

<!-- ACP2E-1669 -->

* 礼品包装现已按预期包含在基于合并购物车的报价中。 以前，已成功合并礼品消息，但无法封装选定内容。

<!-- AC-7530 -->

* `addProductsToCart`突变现在已成功将礼品卡添加到购物车。 以前，此查询需要礼品卡收件人姓名，但会返回发件人姓名。 Adobe Commerce引发此错误： `Please specify a recipient name`。 [GitHub-36665](https://github.com/magento/magento2/issues/36665)


### Google Tag Manager

<!-- ACP2E-1520 -->

* Google Tag模块现在可将正确的数据推送到Data Layer。 以前，页面展示数据不会推送到数据层。

### GraphQL

<!-- AC-8964 -->

* 在查询包含可配置产品的列表时，`getCustomerWishlist`查询不再导致内部服务器错误。

<!-- AC-8966 -->

* `customerCart`查询现在按预期返回捆绑产品的所有应用折扣。 以前，应用于捆绑产品的总折扣返回为零。

<!-- AC-8964 -->

* 在查询包含可配置产品的列表时，`getCustomerWishlist`查询不再导致内部服务器错误。

<!-- AC-9147 -->

* `is_subscribed`标志的声明、其解析程序、缓存和相关测试已从`CustomerGraphQl`模块移至`NewsletterGraphQl`模块。

<!-- ACP2E-3957 -->

* X-Magento-Cache-Id标头已从GraphQL突变响应中删除。 由于突变是状态更改操作（如将项目添加到购物车或下订单），因此不会缓存它们。 包含此标头具有误导性，如果应用缓存，可能会导致错误行为。 此更改符合GraphQL的最佳实践以及Adobe Commerce架构的核心原则。

<!-- AC-9362 -->

* `addProductsToCart`突变不再报告`user_errors`中的不相关错误。 以前，`user_errors`中包含与购物车相关的错误以及预期的操作错误。 [GitHub-37908](https://github.com/magento/magento2/issues/37908)

<!-- ACP2E-2119 -->

* `products`查询产品筛选器现在可以返回部分匹配结果和完全匹配结果。 新`match_type` (PARTIAL， FULL)属性支持指定匹配类型。 以前，查询仅返回完全匹配项。

<!-- ACP2E-2155 -->

* 已将互斥体添加到`addConfigurableProductsToCart`查询，以防止并发请求更新期间出现争用情况。 以前，当商家发送两个并行请求以将相同的配置产品添加到购物车时，会添加两个具有相同产品SKU的单独项目。 [GitHub-37847](https://github.com/magento/magento2/issues/37847)

<!-- ACP2E-2201 -->

* 当&#x200B;**[!UICONTROL Use in Layered Navigation]**&#x200B;设置为&#x200B;**[!UICONTROL Filterable (no results)]**&#x200B;时，GraphQL响应中的产品聚合现在包括非零的属性值。 以前，只返回非零值。

<!-- ACP2E-2141 -->

* 针对涉及自定义产品属性的购物车相关操作，改进了`setShippingAddressForEstimate`查询的性能。 以前，在参数作为变量发送时，查询会加载所有产品属性。

<!-- ACP2E-2255 -->

* `products`查询`ConfigurableProduct.configurable_options`字段现在仅返回至少具有一个已启用产品的值。 以前，此字段返回禁用的简单产品。

<!-- ACP2E-2151 -->

* 通过减少`GetCategories query`生成的不必要的SQL查询数，提高了其性能。

<!-- AC-8623 -->

* GraphQL库组件的地址错误处理现在可按预期运行。

<!-- AC-9058 -->

* 现在，当动态定价设置为“否”且应用折扣时，`products`查询返回所有相关店面定价详细信息。 以前，不会返回产品的价格范围。 [GitHub-35649](https://github.com/magento/magento2/issues/35649)

<!-- ACP2E-1744 -->

* GraphQL事务名称现在仅包含在New Relic日志中的顶级查询名称。 以前，事务名称还包括辅助查询名称。

<!-- AC-8623 -->

* GraphQL库组件的地址错误处理现在可按预期运行。

<!-- AC-7430 -->

* 当产品的可见性设置设置为`Catalog`时，对该产品的`products`查询现在可以正确解析该设置。 以前，提供的任何过滤器都会切换到`Visibility: Catalog`设置。 [GitHub-36591](https://github.com/magento/magento2/issues/36591)

<!-- ACP2E-1769 -->

* 现在，当产品价格已配置为含税时，`customer`查询会返回包含订单税的`product_sale_price`字段。 [GitHub-36946](https://github.com/magento/magento2/issues/36946)

<!-- ACP2E-1584 -->

* 类型`DateTime`的产品属性现在映射到产品查询中的`FilterRangeTypeInput`筛选器。 以前，这些属性映射到`FilterMatchTypeInput`。 作为此更改的结果，筛选`DateTime`属性的查询需要`from`和`to`值，而不是匹配值。

<!-- ACP2E-1552 -->

* 现在，`customer`查询在按商店ID进行筛选时，只按预期返回与特定商店视图相关的客户评论。

<!-- AC-7544 -->

* 当`categories`响应值包含null值时，`items.redirect_code`查询不再返回错误。 [GitHub-36675](https://github.com/magento/magento2/issues/36675)

<!-- ACP2E-1465 -->

* 现在，在完全缓存清理后，基于规则的相关产品会按预期在GraphQL响应中加载。 以前，没有为请求的实体加载负责基于规则的匹配的product EAV属性，尽管在重新加载店面产品页面后加载了这些属性。

<!-- ACP2E-1486 -->

* 成功重置密码后，`changeCustomerPassword`突变现在会按预期触发电子邮件。

<!-- ACP2E-1494 -->

* 现在，当URL重写的`urlResolver`是绝对URL时，`route`和`Target Path`查询会返回结果。 以前，`urlResolver`查询在用于检索重定向数据时返回NULL。

<!-- AC-7979 -->

* 当存在多个存储视图时，`products`查询现在返回正确的标签。 [GitHub-29635](https://github.com/magento/magento2/issues/29635)

<!-- ACP2E-1315 -->

* `categoryList`查询现在按预期返回捆绑产品的子产品在`product`块中填充的`options`节。 以前，不会返回有关捆绑产品子产品的信息。

<!-- AC-7114 -->

* `route`查询现在会按预期返回类别和产品的路由，而不会出现内部服务器错误。 [GitHub-36544](https://github.com/magento/magento2/issues/36544)

<!-- ACP2E-1652 -->

* 现在，在选择多个类别时，`products`查询会提取`url_key`值。

<!-- LYNX-1716-->

* `product`查询现在仅返回分配给指定共享目录的产品聚合。 以前，未分配给共享目录的产品聚合数据会显示在分层导航中。

<!-- AC-6680 -->

* `OptionValueProvider`类`get()`方法现在按预期返回基于给定`option_id`的属性选项值。 以前，它会返回错误。 [GitHub-35910](https://github.com/magento/magento2/issues/35910)

<!-- AC-6745 -->

* `products`查询现在返回所有可用的聚合（过滤器）及其正确翻译的标签。 以前，价格和类别聚合标签无法按预期进行转换。 [GitHub-36140](https://github.com/magento/magento2/issues/36140)

<!-- AC-6666 -->

* 在`ProductCard`上查询`related_products`、`upsell_products`和`crosssell_products`时，您现在可以使用片段`ProductInterface`。 [GitHub-29769](https://github.com/magento/magento2/issues/29769)

<!-- AC-7014 -->

* `products`查询现在会按保存顺序返回相关、追加销售和交叉销售产品。 [GitHub-36461](https://github.com/magento/magento2/issues/36461)

<!-- AC-8573 -->

* GraphQL查询现在会返回按位置排序的相关产品数据。 [GitHub-33010](https://github.com/magento/magento2/issues/33010)

<!-- AC-8542 -->

* `category_url_path`已添加到`ProductAttributeFilterInput`，它支持在单个查询中请求某个类别的所有产品。 [GitHub-32460](https://github.com/magento/magento2/issues/32460)

<!-- AC-821 -->

* 更正了以下错误：设置当前存储在GraphQL中的方法是在处理验证的方法之前执行的。 [GitHub-31336](https://github.com/magento/magento2/issues/31336)

### 图像

<!-- ACP2E-1353 -->

* 管理员收藏夹图标上传表单现在支持`.ico`文件类型。 [GitHub-34858](https://github.com/magento/magento2/issues/34858)

### 导入/导出

<!-- ACP2E-2261 -->

* 产品导入过程现在使用正确的分隔符解析值。 以前，导入过程使用管道(“|”)运算符来解析多选值，直到确定的值分隔符不等于缺省值为止。 导入过程随后失败。

<!-- ACP2E-2490 -->

* 现在，当通过CSV导入更新`URL Key`值时，会自动创建301重定向。

<!-- ACP2E-2129 -->

* 运输表费率现在按预期在表费率导入CSV文件中更新。 表速率上载文件会暂时存储，直到异步配置处理器cron作业运行为止。 此cron作业会选取文件的新位置并相应地对其进行处理。 以前，表速率没有按预期更新，因为异步处理器在错误位置查找文件。

<!-- ACP2E-2298 -->

* “导出文件”网格现在显示所有导出的文件，而不考虑时间戳。 以前，网格不显示具有相同时间戳的所有导出文件。 [GitHub-36951](https://github.com/magento/magento2/issues/36951)

<!-- ACP2E-2028 -->

* 现在可以成功导入带有可自定义选项的产品。 以前，选项数据在导入过程中会丢失。 [GitHub-37598](https://github.com/magento/magento2/issues/37598)

<!-- ACP2E-2214 -->

* 现在，导出的CSV文件中的特殊字符可在Excel中按预期使用。 [GitHub-37921](https://github.com/magento/magento2/issues/37921)

<!-- ACP2E-2301 -->

* 使用&#x200B;**[!UICONTROL Customers and Addresses (single file)]**&#x200B;导入库存来源和客户地址  选项现在已成功完成。

<!-- ACP2E-1930 -->

* 由于内存不足，产品导入不再失败。 以前，由于内存不足，将任意数量的产品导入到已包含约1000万个产品的数据库中失败。

<!-- AC-9116 -->

* 当没有要导入的有效数据时，验证检查现在会按预期停止导入过程，Commerce现在显示此错误： `There are no valid rows to import`。 以前，验证在这些条件下通过，但导入过程失败，出现以下消息： `entity values are mixed`。 [GitHub-32905](https://github.com/magento/magento2/issues/32905)

<!-- ACP2E-1754 -->

* 使用同一产品导入URL密钥时，不再覆盖或删除现有的默认存储视图密钥。 现在，仅当没有被覆盖的`url_key`值时，才会为存储视图重新生成URL重写。 以前，使用相同的URL键导入URL会重写现有的默认存储视图URL键。 （`key_store` URL重写已删除，但产品默认商店视图级别上的URL重写仍设置为`key_store`。）

<!-- ACP2E-1875 -->

* 在导入期间，产品计数不再意外更改。 现在，缓存刷新将推迟到导入过程之后。

<!-- ACP2E-1813 -->

* 计划导入操作的状态现在准确地表示导入操作是成功还是失败。 以前，所有操作都记录为成功。

<!-- AC-7039 -->

* Commerce现在在导入客户记录期间会考虑&#x200B;**[!UICONTROL Disable Automatic Group Change Based on VAT ID]**&#x200B;设置。 以前，忽略导入文件中的`disable_auto_group_change`值。 [GitHub-36409](https://github.com/magento/magento2/issues/36409)

<!-- AC-965 -->

* `Magento\Framework\Convert\Excel`现在已成功处理前面有空格的数字。 Excel XML现在将字段编码为`String`。 以前，Excel编写器将这些值编码为`number`，从而导致文件无效。 [GitHub-33422](https://github.com/magento/magento2/issues/33422)

<!-- ACP2E-1641 -->

* 商家现在可以指定显示导入数据的区域设置以及数据验证器应如何解析此数据。 如果未指定区域设置值，Adobe Commerce将使用默认配置区域设置（而不是默认的存储视图）来解析数据。 在管理中，导入和导出过程继续使用管理用户界面区域设置，分别导入、解析和设置数据格式。

<!-- ACP2E-1847 -->

* 导入由语言环境设置与导入产品的管理员用户不同的管理员用户创建的具有`country_of_manufacture`属性的产品时，不再引发验证错误。 以前，此导入操作可能会导致`country_of_manufacture`属性出现验证错误。

<!-- ACP2E-1981 -->

* 库存源数据现在由库存导入流程成功导入，Commerce现在会在导入流程完成时显示完整的通知消息。 以前，缺少通知消息。

<!-- ACP2E-1889 -->

* 当索引器处于计划模式时，已删除了冗余索引器失效。

<!-- ACP2E-1994 -->

* 现在，当`manage_stock`值等于`use_config_manage_stock`时，导出的产品具有正确的`1`值。 以前，此默认值不正确。

<!-- ACP2E-1620 -->

* 在计划的导入操作期间，如果图像未成功导入，Adobe Commerce现在会在计划的导入网格中显示信息性错误消息。 以前，不显示错误消息。

<!-- ACP2E-1565 -->

* 当缺少产品映像时，产品导入过程不再中断。 以前，在使用CSV文件导入第三方服务期间缺少产品图像时，Adobe Commerce显示以下错误： `Maximum error count has been reached or a system error is occurred!`。

<!-- ACP2E-1476 -->

* 在启用了B2B的部署中，客户从客户网格导出的性能已得到改进。

<!-- ACP2E-1391 -->

* 当`configurable_variations`列中的属性值包含逗号时，产品导入过程不再引发验证错误。

<!-- ACP2E-1377 -->

* 已从导出过程中排除解码。 导入后，CSV导出文件文本保持不变。 因此，重新导入后，描述不会更改。 以前，在导出和导入产品后，会在页面生成器编辑器中删除HTML标记。

<!-- ACP2E-1451 -->

* 作为环境变量添加的非默认配置（网站或存储范围）不再以递归错误中断`app:config:import`进程。

<!-- ACP2E-1569 -->

* 导入后，处于保存时更新模式的目录搜索和价格索引符将不再失效。 以前，在导入新产品和现有产品时，Elasticsearch Indexer文档版本会更改版本。

<!-- ACP2E-1482 -->

* 产品报告现已导出到`var`目录。 以前，这些报告导出到文档根目录，在云实例中为只读目录。

<!-- ACP2E-1736 -->

* 清空的多选客户地址字段不再中断或停止导出过程。

### 索引

<!-- AC-10911 -->

* 改进了在未设置目录规则时`catalogrule_product`索引器的性能。 [GitHub-34784](https://github.com/magento/magento2/issues/34784)

<!-- ACP2E-2204 -->

* 价格索引器性能问题已得到解决。 索引器的性能不再逐渐降低。 索引器已重构，通过更改临时表的创建方式来提高索引器处理速度。 这些临时表现在由更耗时的DELETE语句重新创建。

<!-- ACP2E-2033 -->

* 价格索引器性能已得到改进。 在价格索引器中添加了索引提示，以缩短在索引期间触发的MySQL查询的运行时间。

<!-- AC-9223 -->

* 现在，所有索引器都使用相同的颜色来表示索引器状态。 [GitHub-34648](https://github.com/magento/magento2/issues/34648)

<!-- ACP2E-1697 -->

* 在未将规则分配给所有网站的部署中，目录规则产品索引器的性能已得到改进。

<!-- ACP2E-1401 -->

* 当索引器设置为&#x200B;**[!UICONTROL Update on schedule]**&#x200B;时创建自定义产品类型不再导致索引更新`cron`任务失败。 [GitHub-36471](https://github.com/magento/magento2/issues/36471)

<!-- ACP2E-1574 -->

* 由于目录权限索引而导致的店面产品详细信息页面上的显示问题已得到解决。 以前，Adobe Commerce先清除索引表，然后在完整`catalogpermissions_product`或`catalogpermissions_category`索引过程中重新索引。 在完成重新索引之前，目录权限在店面中无法按预期工作。

<!-- AC-6816 -->

* 当客户网格包含新创建的自定义客户属性时，`bin/magento indexer:reindex customer_grid`不再因MySQL错误而失败。 [GitHub-36233](https://github.com/magento/magento2/issues/36233)

<!-- AC-8076 -->

* 更改多个索引器的索引器模式（即质量操作索引器模式更改）现在仅在当前模式与正在应用的模式不同时更改索引器的模式。 这通过防止不必要地访问数据库而提高了性能。 [GitHub-36823](https://github.com/magento/magento2/issues/36823)

### 基础架构

<!-- AC-10866 -->

* 向管理员使用情况启用控制器添加了缺失的`return`语句。 以前，没有`return`语句，并且`FrontendController`类中的控制器处理不正确。 [GitHub-31374](https://github.com/magento/magento2/issues/31374)

<!-- AC-9390 -->

* 已将MySQL `CREATE TEMPORARY TABLE ... LIKE`替换为重构的`CREATE TEMPORARY TABLE`，以符合MySQL 8.x。[GitHub-37926](https://github.com/magento/magento2/issues/37926)

<!-- ACP2E-1462 -->

* 当格式错误的HTTP请求发送到服务器时，Adobe Commerce在显示的错误消息中不再包含指向服务器根目录的完整路径。 现在，只有字符串才会作为第二个参数传递给`explode`方法。

<!-- AC-8384 -->

* `restricted_classes.php`已替换`Zend_Validate_File_Upload`。 以前，在上传大于`php.ini `中配置的值的导入文件时，验证器崩溃。 [GitHub-37281](https://github.com/magento/magento2/issues/37281)

<!-- ACP2E-1146 -->

* 现在，由数据源模型提供并使用设置数据修补程序（通常来自第三方模块）安装的属性选项可用于客户区段规则。 以前，此组合不会返回与配置的区段匹配的客户列表。

<!-- AC-7093 -->

* 电子邮件模板引擎现在可以正确处理某些嵌套指令（例如，`{{if}}{{depend}}...{{/depend}}{{/if}}`）。 [GitHub-36438](https://github.com/magento/magento2/issues/36438)

<!-- AC-7920 -->

* 带有聚合数据的`product`查询现在返回布尔类型产品属性的正确标签值。 [GitHub-29123](https://github.com/magento/magento2/issues/29123)

<!-- https://github.com/magento/magento2/pull/29173 -->

* 当`var/tmp`和`pub/static`位于不同的文件系统上并且启用了&#x200B;**[!UICONTROL CSS Merging Enabled]**&#x200B;时，合并后的CSS文件不再损坏。 临时文件是在与目标文件相同的静态目录中创建的，以确保两个文件位于同一文件系统上。 因此，对其重命名的调用是原子调用。 [GitHub-29172](https://github.com/magento/magento2/issues/29172)

<!-- https://github.com/magento/magento2/pull/36769 -->

* 修复了在`getId()`上调用成员函数`int`时可能发生的错误，该错误有时会在管理员中查看客户时触发异常。

<!-- https://github.com/magento/magento2/pull/34092 -->

* 现在在设计主题配置处理器中对阵列类型强制进行类型检查。 [GitHub-34440](https://github.com/magento/magento2/issues/34440)

### Inventory management

<!-- ACP2E-1883 -->

* 现在，在贷项通知单中包含产品数量退货后，产品会自动返回到库存状态。 以前，如果某个产品缺货，但贷项通知单退回了该产品的库存，则商家必须手动更改产品库存状态。

<!-- ACP2E-2123 -->

* 通过删除冗余请求来重新索引默认源项目，改进了异步模式下库存索引器的性能。

<!-- AC-7023 -->

* 更正了Inventory Indexer中影响可配置产品店面库存计数准确性的问题。 [GitHub-36421](https://github.com/magento/magento2/issues/36421)

<!-- ACP2E-2082 -->

* 现在，通过REST `V1/inventory/source-items`更新库存源项目的工作速度更快。 调用不再触发对未更改库存产品的重新索引或清理缓存操作。

<!-- ACP2E-1842 -->

* REST `V1/products/<sku>`现在会在更新产品的库存状态时触发自动股票重新索引。 以前，不会为要更新的产品触发股票重新索引。

<!-- ACP2E-1653 -->

* 当`V1/inventory/source-items`更新子产品时，店面上的可配置产品库存状态现在会按预期更新。

<!-- ACP2E-2114 -->

* `POST <store_code>/V1/inventory/source-items` REST调用现在验证返回库存源项目中空白的有效负载，并根据需要发送有关验证的错误消息。

<!-- ACP2E-2072 -->

* 为产品启用&#x200B;**[!UICONTROL No Manage Stock]**&#x200B;设置后，商家现在可以通知购物者订单已准备好提货。 以前，启用此设置时，Commerce显示此错误消息： `Your order is not ready for pickup`。

<!-- ACP2E-2227 -->

* 商家现在可以为订单创建贷项通知单，其中删除了与可配置产品关联的简单产品。 以前，商家无法创建贷项通知单，Commerce抛出`TypeError`异常。

<!-- ACP2E-2310 -->

* 应用过滤器后，管理网格源计数现在会返回有效记录。 以前，`getSourcesCount`方法始终会在应用过滤器后返回源总数。

<!-- ACP2E-1364 -->

* 当您使用“从股票移动到底部”选项对产品进行排序时，“类别”页面不再重定向到管理员功能板。 通过将SQL join语句放在条件语句中（仅在确保该语句尚未包含之后），该问题已得到解决。 以前，页面重定向到管理员信息板，并显示消息：`Invalid security or form key. Please refresh the page`。

<!-- ACP2E-1488 -->

* `AUTO_INCREMENT`表的`inventory_source_item`不再随每`UPDATE`操作增加。 以前，每次更新都会增加此表的`AUTO_INCREMENT`，这最终会在向`AUTO_INCREMENT`添加新记录时导致`inventory_source_item table`值超出范围。 因此，管理员用户在尝试从管理员创建新产品时收到以下错误： `Numeric value out of range...`。

<!-- ACP2E-1378 -->

* 管理员用户现在可以从管理员将产品添加到特定商店视图范围内的客户购物车Inventory management 。 以前，库存ID确定不正确，管理员用户无法将产品添加到客户购物车。

<!-- ACP2E-1399 -->

* 清单和目录之间的同步不再依赖于&#x200B;**[!UICONTROL Synchronize with Catalog]**&#x200B;配置设置。 以前，只有在启用此设置的情况下才能正确同步产品。

<!-- ACP2E-1382 -->

* 当购物者从订单中扣除的产品数量在选择配送源时位于可用产品范围之内时，Adobe Commerce在重新加载页面后不再引发错误。

<!-- ACP2E-1259 -->

* 现在，当批量库存更新更新可配置产品及其子产品`Stock Availability`值时，可配置产品库存状态会正确更新。 以前，无法通过批量更新将可配置产品及其子产品返回到库存。

<!-- ACP2E-2096 -->

* 非默认来源的数据类型已更新为`DECIMAL (12, 4)`，最多可支持8个整数位数，这与默认库存实施的限制相同。 该值现在与管理员添加和编辑产品页面同步，该页面支持对所有类型的库存源进行最多八位数的输入验证。 以前，仅支持&#x200B;**[!UICONTROL Quantity]**&#x200B;字段（用于非默认源）的输入，最多可支持6位数。

<!-- ACP2E-2054 -->

* 现在，在处理从店面订购的非默认来源以进行发运时，默认和非默认来源都会显示产品可销售数量的正确信息。 以前，Adobe Commerce显示的产品来源库存状态不正确。

<!-- ACP2E-1950 -->

* `\Magento\Catalog\Model\Product::getIsSalable()`现在根据产品对象(`\Magento\Catalog\Model\Product::getStoreId()`)中定义的范围返回库存状态。 以前，`getIsSalable()`根据当前范围返回库存状态，而不考虑产品对象。

### 记录

<!-- ACP2E-1788 -->

* 更新了系统报告功能中的日期时间格式，在报告中包含来自日志文件的记录。

<!-- ACP2E-1385 -->

* 管理员用户现在可以在管理员的批量操作日志部分中查看由集成创建的批量操作的日志。

### 登录

<!-- ACP2E-1521 -->

* 在一个浏览器中重置密码并随后通过其他浏览器登录不会再导致异常。 [GitHub-36447](https://github.com/magento/magento2/issues/36447)

<!-- ACP2E-1332 -->

* 现在，在按预期激活帐户后，客户会被重定向到登录页面。 以前，客户会自动登录。

### 媒体集

<!-- ACP2E-2568 -->

* 商家现在可以将同名不同大小写（混合使用大写和小写字符）的图像上传到媒体集。 Commerce以前，图像文件名在Page Builder中不区分大小写，并且名称与大小写不同的文件将被覆盖（在区分大小写的文件系统上托管）。

### 新闻稿

<!-- AC-10806 -->

* Commerce现在会先检查是否启用了新闻稿订阅功能，然后再接受新闻稿的新订阅者。 [GitHub-33040](https://github.com/magento/magento2/issues/33040)

### 订购

<!-- AC-8857 -->

* 从管理员购物车移动到要订购的项目列表的产品现在会按预期从购物车中删除。 [GitHub-37538](https://github.com/magento/magento2/issues/37538)

<!-- ACP2E-2535 -->

* 商户现在可以按照预期，为部分以奖励积分支付的订单部分退款创建贷项通知单。 以前，当商家创建部分退货时，订单状态被错误地标识为“已关闭”，并且管理员订单页面不显示贷项通知单选项。

<!-- ACP2E-2632 -->

* 当循环日志存档频率设置为每周或每月间隔时，管理员操作日志循环现在可按预期工作。 以前，如果设置每周或每月间隔，则不会轮换日志。

<!-- ACP2E-2583 -->

* Commerce现在对部分取消的订单应用正确的折扣金额。 以前，在更改订单时，`base_discount_cancelled`列中计算的折扣金额计算不正确。 在折扣订单的发票中添加了对负值的支持。

<!-- ACP2E-2585 -->

* 现在，导入订单时，REST `V1/orders`端点会按预期应用礼品卡。 以前，不会保存对此端点中礼品卡扩展属性的更改。

<!-- ACP2E-2412 -->

* Commerce现在根据管理员用户在管理员中创建订单时提供的排序顺序对自定义客户地址属性进行排序。

<!-- ACP2E-2400 -->

* 现在，当商家从此页面启动搜索时，“管理销售订单网格”页面会按预期加载。 以前，当商家尝试从该表中搜索订单时，页面冻结，Commerce在浏览器控制台中显示`Request-URI Too Long`错误。

<!-- ACP2E-2294 -->

* 现在，当全部订单金额已用商店贷记加其他付款方式退款时，订单状态将标记为“已结”而不是“完成”。 以前，订单状态标记为完成，因为退款金额计算不正确。

<!-- ACP2E-2213 -->

* 通过减少从数据库加载订单的次数，提高了`OrderRepository::get()`方法的性能。 以前，此方法会多次加载订单。 [GitHub-36636](https://github.com/magento/magento2/issues/36636)

<!-- ACP2E-1918 -->

* 商家现在可以为包含某些项目的订单生成贷项通知单，当其他订单项目可以退款时，这些订单的总数为零。 以前，当客户对订单中的某些项目享有100%折扣时，商家无法执行多次退款。

<!-- AC-8254 -->

* 在管理员对子产品进行重新排序期间，子产品与父产品之间的链接现在显示在订单页面上。 [GitHub-37028](https://github.com/magento/magento2/issues/37028)

<!-- AC-1756 -->

* 订单页的题头部分现在包含有关已发送发票、贷项通知单和发运的预期信息。 [GitHub-27474](https://github.com/magento/magento2/issues/27474)

<!-- AC-7632 -->

* 现在可以正确生成只包含一个可配置产品的订单的贷项通知单。 以前，`isLast()`函数未按预期返回`true`。 [GitHub-36722](https://github.com/magento/magento2/issues/36722)

<!-- ACP2E-1961 -->

* 通过优化主数据查询改进了`aggregate_sales_report_bestsellers_data` cron作业的性能。

<!-- ACP2E-1962 -->

* 在管理员用户无权访问客户网站的情况下，使用客户余额的离线退款创建贷项通知单时，Adobe Commerce不再引发错误。 以前，Adobe Commerce引发此错误： `More permissions are needed to view this item`，管理员用户无法创建商店退款。

<!-- ACP2E-1714 -->

* 现在，当对包含捆绑产品的订单进行了部分退款时，订单状态是正确的。 以前，在发出部分退款后，即使剩余的订单尚未完成，订单状态仍被列为完成。 [GitHub-37377](https://github.com/magento/magento2/issues/37377)

<!-- ACP2E-1514 -->

* 首次从管理员使用一次性自定义价格生成订单时，购物者无法再使用自定义价格订购产品。 以前，如果订单包含具有自定义价格的项目，则此自定义价格适用于通过再订购功能下达的其他订单。

<!-- ACP2E-1421 -->

* 购物者不能再在订单页面上保存不正确的订单状态。 发运项目时，订单状态不再从“完成”更改为“处理”。 以前，Adobe Commerce在购物者输入评论后保存订单状态之前不会检查当前订单状态。 [GitHub-36562](https://github.com/magento/magento2/issues/36562)

<!-- ACP2E-1387 -->

* 当正在返回的可配置产品被删除时，Adobe Commerce不再在storefront订单返回页面上引发错误。 Adobe Commerce以前记录此错误： `report.CRITICAL: Error: Call to a member function getShipmentType() on null in magento2ee/app/code/Magento/Rma/view/frontend/templates/return/create.phtml:52`。

<!-- ACP2E-1367 -->

* 销售订单网格现在会按预期与所有订单异步同步。 [GitHub-36562](https://github.com/magento/magento2/issues/36562)

<!-- ACP2E-1197 -->

* 现在，订单页面的客户订单部分中的按购买日期过滤功能可按预期工作。 以前，当向方法提供相同时区时，时区转换逻辑引发错误，从而导致JavaScript错误。

<!-- ACP2E-1294 -->

* Adobe Commerce功能板现在在首次加载时显示正确的订单统计数据。 以前，仪表板显示不正确的订单信息，但一旦更新了时间段，则会显示正确的信息。

<!-- ACP2E-1762 -->

* 现在，管理员用户在从管理员创建新订单期间选择商店视图后，会按预期重定向到订单页面。

<!-- ACP2E-1418 -->

* `GET V1/orders/<OrderID>`端点现在按顺序返回有关可配置和简单产品的信息，而不管简单产品的库存状态如何。 仅当所选项目（产品）有库存或可供销售时，管理员用户现在才可以下订单。 以前，此API仅返回有关已有产品的信息。

<!-- AC-7901 -->

* 在启用了免运费且发运价格含税且计税是在折扣后应用时，贷项通知单页面不再崩溃。 以前，Adobe Commerce引发`Division by zero`异常。 [GitHub-36800](https://github.com/magento/magento2/issues/36800)

<!-- AC-1342 -->

* 使用`rest/V1/orders/{id}/comments`端点在不提供订单状态的情况下发布有关订单的注释不再影响订单的显示。 以前，订单状态在`sales_order`和`sales_order_grid`表中记录为NULL，并且“我的订单”页面或“管理员订单”网格都不会显示订单。 [GitHub-34180](https://github.com/magento/magento2/issues/34180)

<!-- ACP2E-1597 -->

* 现在，如果发票、发运和贷项通知单包含的ID与订单ID不同，则可以成功地将它们及其相关订单一起从存档中移回。 以前，如果将订单移至存档并恢复，则当ID号不匹配时，该订单中会缺少发票、发运、贷项通知单记录。 [GitHub-36847](https://github.com/magento/magento2/issues/36847)

### 页面生成器

<!-- AC-8777 -->

* 现在，在页面生成器中调整大小时，图像保持正确的纵横比。 [GitHub-37493](https://github.com/magento/magento2/issues/37493)

<!-- AC-10919 -->

* 现在，当您尝试上传的图像大于指定的最大文件大小时，Page Builder会根据需要显示错误消息。 以前，对于小于指定最大值的已上传图像文件，Commerce会显示一条警报弹出消息。

<!-- ACP2E-1992 -->

* CMS页面产品滑块现在包括已选择包含在滑块中的任何子产品的父产品。 以前，从滑块中排除父产品。

<!-- ACP2E-2115 -->

* 禁用`Magento_AsyncConfig`模块后，HTML转换的内容现在会按预期显示在电子邮件模板中。 以前，电子邮件模板仅包含原始HTML。

<!-- AC-9128 -->

* 在Chrome浏览器中，页面生成器保存操作的性能已得到改进。

<!-- ACP2E-1954 -->

* 现在，您可以使用“管理员”>“**[!UICONTROL Content]**”>“**[!UICONTROL Pages]**”中的“页面生成器”选项，使用`text`元素在所有样式中插入复制的文本。 以前，页面生成器只显示纯文本，不保存样式。

<!-- ACP2E-1646 -->

* 当管理员用户具有特定ACL时，在使用页面生成器编辑产品内容期间不再显示CORS错误。 管理员用户现在可以保存产品。 以前，页面生成器不会保存产品，因此保存过程会冻结。

<!-- ACP2E-1852 -->

* 现在，精确的文件大小信息包含在页面生成器中已上传图像的图像预览中。

<!-- ACP2E-2016 -->

* 现在，页面生成器页面元素在Chrome浏览器(v112)中以可接受的速度呈现。 以前，在Chrome浏览器中运行页面生成器来保存内容的速度较慢，Commerce在浏览器控制台中记录此错误： `[ERROR] Page Builder was rendering for 5 seconds without releasing locks`。

<!-- ACP2E-1654 -->

* 现在，当Page Builder视频元素直接链接到远程视频文件时，该元素可在iOS上的移动Safari浏览器中按预期自动播放。 以前，不显示预览图像。

<!-- ACP2E-1974 -->

* 页面生成器现在在Chrome浏览器中按预期工作。 以前，并不总是保存在该浏览器中所做的内容更改。

<!-- ACP2E-2086 -->

* 加载管理员产品编辑页面时，产品不再生成间歇性`Uncaught TypeError` JavaScript错误。

<!-- ACP2E-1886 -->

* 现在，通过页面生成器编辑器上传的图像在&#x200B;**[!UICONTROL Content]** > **[!UICONTROL Media Gallery]**&#x200B;上标记为已使用。 以前，这些图像被标记为&#x200B;**在媒体集中的任何地方**&#x200B;都未使用。

<!-- ACP2E-1564 -->

* 从页面生成器轮播向购物车添加产品时，不再重复页面中的项目数量，因为页面中有两个不同的小组件显示相同的产品。

<!-- ACP2E-1542 -->

* 当您编辑超链接，然后保存模板时，Page Builder不再将`tabindex` HTML属性添加到超链接标记`a`。

<!-- ACP2E-1444 -->

* 产品小部件和页面生成器预览现在可正确处理HTML特殊字符。 以前，产品小组件无法正确显示包含`&`字符的SKU。

<!-- ACP2E-1441 -->

* 现在，当您在预览模式下选择并更新完整内容块时，Page Builder文本元素内容会按预期更新。

<!-- ACP2E-1362 -->

* 现在，可以将文本从一个页面生成器文本编辑器复制并粘贴到另一个页面生成器文本编辑器，操作方式符合预期。 以前，您尝试粘贴文本的页面无法保存，Adobe Commerce显示此控制台错误： `[ERROR] Page Builder was rendering for 5 seconds without releasing locks.`。

<!-- ACP2E-1568 -->

* 在旧版本的页面生成器中创建的页面生成器`column-block`内容类型现在可以正确显示。

<!-- ACP2E-1234 -->

* 在从管理员创建产品期间，对产品元数据说明的过滤功能已得到改进。 以前，如果启用Page Builder，则会基于默认` {{name}} {{description}}`掩码生成产品元数据描述。 默认的产品元描述掩码现在由`{{name}}`组成。 [GitHub-36107](https://github.com/magento/magento2/issues/36107)

<!-- ACP2E-1758 -->

* 添加不含内容的动态块不再触发错误。

### 付款

<!-- ACP2E-2533 -->

* Commerce现在可以通过阻止在出现此错误时创建订单来正确处理来自PayPal的502错误。 以前，尽管PayPal发生了502错误，导致Commerce记录与PayPal记录不一致，但仍会创建订单。

<!-- AC-9142 -->

* PayPal Express结账交易现在包括子产品SKU和完整产品标题。 `Magento/Paypal/Model/Cart.php`文件现在会收集子产品SKU及其父产品标题，以使用子SKU标识产品标题。 [GitHub-36808](https://github.com/magento/magento2/issues/36808)

<!-- ACP2E-1964 -->

* 在Payflow Pro付款过程中，**[!UICONTROL Card Security Code Does Not Match]**&#x200B;配置设置现在按预期处理。 以前，此评估过程从未完成，这会阻止签出。

<!-- ACP2E-1215 -->

* 当购物者没有保管库令牌时，管理签出工作流中不再显示保管库付款方法选项。 [GitHub-36273](https://github.com/magento/magento2/issues/36273)

<!-- ACP2E-1303 -->

* 启用PayPal按钮后，现在可以隐藏&#x200B;**[!UICONTROL Venmo]**&#x200B;按钮。 以前，无法从购物车、迷你购物车、产品详细信息或结帐页面中移除&#x200B;**[!UICONTROL Venmo]**&#x200B;按钮。

<!-- BUNDLE-3313 -->

* 购物者现在可以在结账期间应用优惠券代码时选择配送方式。 以前，在这些条件下，Commerce会引发错误，并为订单分配固定运费。

<!-- BUNDLE-3310 -->

* PayPal和PayPal信用支付方法的店面处理问题已得到解决。

<!-- BUNDLE-3273 -->

* 解决了在本地支付启用时，Ideal payments支付的订单的后备URL问题。

<!-- BUNDLE-3253 -->

* 购物者再也无法在不添加姓氏的情况下创建PayPal订单。

#### Braintree

<!-- AC-2901 -->

* 现在，每家商店可保存Braintree付款信息，购物者现在只能看到他们购物时所在的商店中保存的卡信息。 以前，购物者在结账时可以看到所有商店中存储的卡片信息。 [GitHub-34253](https://github.com/magento/magento2/issues/34253)

<!-- BUNDLE-3304 -->

* 现在，当卡付款的保管库被禁用时，购物者可以使用Braintree付款方法结账要发往多个地址的订单。 [GitHub-37615](https://github.com/magento/magento2/issues/37615)

<!-- BUNDLE-3244 -->

* 现在，在部署中，商家在其Braintree帐户中为同一货币拥有两个不同的商家帐户ID，因此在正确帐户中可按预期捕获部分开票的订单。

<!-- BUNDLE-3250 -->

* 启用&#x200B;**[!UICONTROL Enable Vault for Card Payments]**&#x200B;后，为Braintree支付的订单创建第二张部分发票时，Adobe Commerce不再引发错误。 以前，当商家尝试创建第二张发票时，Adobe Commerce引发此错误： `Your payment could not be taken. Please try again or use a different payment method. Payment method token is invalid`。

<!-- ACP2E-1229 -->

* 当购物者更新其帐单地址时，不再在结账工作流中自动取消选择Braintree Vault付款方法选项。 以前，当购物者取消选择&#x200B;**[!UICONTROL My billing and shipping address are the same]**&#x200B;按钮时，将取消选择付款方式。

<!-- BUNDLE-3248 -->

* 解决了从Adobe Commerce 2.4.5-p2升级后通过Braintree签出PayPal时出现的问题。 [GitHub-37242](https://github.com/magento/magento2/issues/37242)

<!-- BUNDLE-3257 -->

* 现在，Google支付模式弹出运送地址字段中的地址可按预期呈现电话号码。 以前，电话号码缺失。

<!-- BUNDLE-3228 -->

* 现在，当Braintree响应包含`threeDSecureInfo/eciFlag`的空值时，可以通过Braintree成功下达订单。 以前，当此值为空时，在签出期间发生PHP错误。

<!-- BUNDLE-3243 -->

* 当购物者在迷你购物车中使用Adobe Commerce Pay结帐时在订单审核页面上应用优惠券时，Google不再引发错误。 以前，购物者被重定向到404页。

<!-- BUNDLE-3245 -->

* 购物者现在可以使用Braintree Payments和Adobe Commerce 2.4.6（具有不可见的ReCAPTCHA v2或v3）完成结账。 [GitHub-37241](https://github.com/magento/magento2/issues/37241)

<!-- BUNDLE-3241 -->

* 购物者无法再单击&#x200B;**[!UICONTROL PayPal]**&#x200B;按钮来购买可配置产品，而无需先选择所需的选项。 以前，购物者可以单击&#x200B;**[!UICONTROL PayPal]**&#x200B;按钮，随后被重定向回产品页面，并出现错误：

<!-- BUNDLE-3148 -->

* **[!UICONTROL PayPal]**&#x200B;按钮现在按预期显示在购物车和迷你购物车页面上。 以前，此按钮不显示在购物车页面上，并且会在迷你购物车页面上重复。

### 性能

<!-- AC-9753 -->

* 在&#x200B;**Sales** > **Orders**&#x200B;页面的批量操作下拉菜单中的多次点击不再生成多个POST请求。  [GitHub-37997](https://github.com/magento/magento2/issues/37997)

<!-- AC-10944 -->

* 当购物者导航到触发301重定向的页面时，仅缓存`200`或`404`响应，除非该页面的Cache-Control标头包含`private `。 以前，缓存Cache-Control标头中带有`private`的HTTP状态200，并且缓存HTTP状态301，除非其Cache-Control标头中包含`private`。 [GitHub-36492](https://github.com/magento/magento2/issues/36492)

<!-- AC-9302 -->

* 已从`Magento\Catalog\Controller\Adminhtml\Product\Initialization\Helper`中删除未使用的`Magento\Catalog\Model\ProductRepository`。 以前，`ProductRepository`加载此帮助程序，它是一个`Adminhtml`控制器。 [GitHub-37864](https://github.com/magento/magento2/issues/37864)

<!-- AC-9127 -->

* 当许多选项添加到捆绑产品时，提高了页面加载速度的性能。 [GitHub-29409](https://github.com/magento/magento2/issues/29409)

<!-- ACP2E-2069 -->

* 已优化从&#x200B;**[!UICONTROL Products in Category]**&#x200B;选项卡将产品分配给类别的流程。 现在，在网格中完全加载产品之前，**[!UICONTROL Assign]**&#x200B;选项卡中的&#x200B;**[!UICONTROL Remove]**&#x200B;和&#x200B;**[!UICONTROL Add Product by SKU]**&#x200B;按钮处于禁用状态。 以前，管理员用户无法按SKU在包含数百万个已注册产品的目录中添加产品。

<!-- ACP2E-2098 -->

* 使用许多自定义产品属性执行时，`addProductToCart`突变的性能已得到改进。 以前，当使用许多产品属性（大约1000个）执行此突变时，Commerce会尝试加载所有产品属性。

<!-- ACP2E-1965 -->

* 解决了加载购物车规则使用的产品属性时的性能问题。 现在只加载活动购物车规则的产品属性。

<!-- ACP2E-1864 -->

* 现在，多次运行时`bin/magento setup:perf:generate-fixtures setup/performance-toolkit/profiles/ee/small.xml`命令可成功执行。 以前，它在运行多次时引发此错误： `Coupon with the same code already exists`。

### 促销活动

<!-- ACP2E-1290 -->

* 与&#x200B;**[!UICONTROL Fixed amount discount for whole cart]**&#x200B;规则一起应用时，**[!UICONTROL Apply to shipping amount]**&#x200B;价格规则的效果现在按预期在产品和装运金额之间按比例分配。 以前，折扣计算不正确。

<!-- ACP2E-1300 -->

* **[!UICONTROL Discard Subsequent Rules]**&#x200B;设置现已按预期应用。 启用此设置后，其他低优先级的规则只能应用于其他产品。 [GitHub-35707](https://github.com/magento/magento2/issues/35707)

### reCAPTCHA

<!-- ACP2E-2509 -->

* 不可见的reCAPTCHA v3现在对签出页面&#x200B;**[!UICONTROL Sign in]**&#x200B;按钮按预期工作。 以前，购物者无法登录，Commerce会引发JavaScript错误。

<!-- ACP2E-1539 -->

* 现在，结账工作流中的Google reCAPTCHA可按预期用于支票、汇票和自定义支付方法。

<!-- ACP2E-1311 -->

* 在加载Adobe Commerce ReCAPTCHA复选框之前，无法再提交Google表单。

<!-- ACP2E-1338 -->

* reCAPTCHA构件现在位于支付页面上的&#x200B;**[!UICONTROL Place Order]**&#x200B;按钮之前。 以前，小组件显示在页面顶部。

### 报告

<!-- ACP2E-1541 -->

* 现在，当使用非默认货币的商店生成订单时，订单报表(**[!UICONTROL REPORTS]** > **[!UICONTROL Sales]** > **[!UICONTROL Orders]**)包含正确的订单值。 以前，此报表包含不正确的值。 [GitHub-36742](https://github.com/magento/magento2/issues/36742)

<!-- ACP2E-1477 -->

* 为了清楚起见，修订了销售订单报告表中的误导性信息。

<!-- ACP2E-1435 -->

* 管理员用户现在可以从“放弃的购物车报告”页面搜索包含`+` （加）符号的电子邮件的记录。 [GitHub-36560](https://github.com/magento/magento2/issues/36560)

<!-- AC-7394 -->

* 现在，从GraphQL管理中禁用New Relic后，Commerce交易名称可正确显示。 [GitHub-36112](https://github.com/magento/magento2/issues/36112)

### 审核

<!-- ACP2E-1998 -->

* 启用“不可见reCAPTCHA v3”后，购物者无法再快速提交重复的产品评论。

### 奖励

<!-- ACP2E-2099 -->

* 积分过期后，将不再发送奖励积分过期电子邮件。 已重构`magento_reward_balance_warning_notification`和`magento_reward_expire_points` cron任务，以增加灵活性和电子邮件发送容量。 以前，商家无法在短时间内发送由这些cron任务生成的许多电子邮件。 这可能会导致延迟提交对时间敏感的通知。

<!-- ACP2E-2283 -->

* 过期奖励积分现在会按预期从购物者当前的奖励积分余额中扣除。

<!-- ACP2E-1473 -->

* 奖励积分余额更新电子邮件通知现在会考虑当前商店上下文。 以前，奖励积分余额更新电子邮件使用默认存储区的配置设置。

<!-- ACP2E-1329 -->

* 现在，创建贷项通知单后，奖励积分可以退款。 以前，商家在创建贷项通知单后无法退款奖励积分，并且订单状态仍为`Completed`，而不是`Closed`。

### RMA

<!-- ACP2E-2246 -->

* REST `POST /V1/returns`请求现在为每个产品创建一个RMA。 以前，此请求可以绕过验证过程，为每个产品返回多个RMA。

<!-- ACP2E-2450 -->

* 当&#x200B;**[!UICONTROL Show on Storefront]** RMA属性设置为&#x200B;**no**&#x200B;时，RMA属性现在会自动添加到默认EAV表单中。 以前，在创建自定义返回属性且&#x200B;**[!UICONTROL Show on Storefront]** RMA属性设置为&#x200B;**no**&#x200B;时，RMA项目详细信息弹出窗口为空白。

<!-- ACP2E-2211 -->

* 现在，当启用产品编辑页面上的&#x200B;**[!UICONTROL Enable RMA]**&#x200B;复选框时，**[!UICONTROL Use Config]**&#x200B;属性的值与配置中指定的值匹配。

<!-- ACP2E-1230 -->

* 现在，单个产品级别的&#x200B;**[!UICONTROL Enable RMA]**&#x200B;属性遵循存储RMA设置配置。 以前，无论应用商店配置设置是什么，在添加产品时，此设置都会默认处于关闭状态。

### Search {#search-heading}

<!-- ACP2E-2272 -->

* 页眉的小型搜索前端上的自动完成搜索建议现在可以按预期工作。 以前，在启用此功能时，自动完成不会填充此字段。 [GitHub-37557](https://github.com/magento/magento2/issues/37557)

<!-- ACP2E-2101 -->

* 通过添加索引器，改进了从管理员搜索栏进行查询的性能。 以前，`search_query`表越大，完成查询所需的时间就越长。

<!-- ACP2E-2279 -->

* 现在，按名称的字母顺序对产品排序对包含土耳其字符的名称可以正常使用。

<!-- ACP2E-1854 -->

* 现在，仅当&#x200B;**[!UICONTROL Use in Search Results Layered Navigation]**&#x200B;设置设置为&#x200B;**[!UICONTROL Use in Search]**&#x200B;时，才会显示&#x200B;**[!UICONTROL Yes]**&#x200B;产品属性属性。

<!-- ACP2E-1870 -->

* 现在，在高级搜索中一起应用高级搜索价格和SKU筛选器时，这两个筛选器可以正确工作。 [GitHub-37581](https://github.com/magento/magento2/issues/37581)

<!-- ACP2E-1787 -->

* 不再对空搜索字段执行搜索。 这将缩小`search_query`表的大小。 以前，不正确的查询或查询空搜索字段会返回巨大的数据集，这会增加`search_query`表的大小并导致`/tmp`出现问题。

<!-- ACP2E-1916 -->

* 现在，在对具有下拉自定义属性的目录条目进行排序时，店面过滤器可按预期工作。

<!-- ACP2E-1499 -->

* 搜索结果现在会按预期显示基于属性搜索权重的相关结果。

<!-- AC-7505 -->

* 管理员`Search Weight` > `Storefront Properties` > **[!UICONTROL Stores]**&#x200B;上&#x200B;**[!UICONTROL Attributes]**&#x200B;属性的&#x200B;**[!UICONTROL Product]**&#x200B;输入字段下的信息性文本现在描述了可能的值。 [GitHub-36646](https://github.com/magento/magento2/issues/36675)

### 配送

<!-- ACP2E-2515 -->

* 现在，在禁用动态价格属性后将捆绑产品添加到购物车时，购物车价格规则可按预期工作。 无论动态属性是启用还是禁用，都会应用免费配送和正确的表费率。 以前，无法按预期应用免运费。

<!-- AC-9729 -->

* 在为订单创建部分发运后，Commerce现在会按预期转移到新的发运页面。 以前，在创建部分发运后，Commerce不会为订单的其余产品创建完整的发运页面。 [GitHub-38063](https://github.com/magento/magento2/issues/38063)

<!-- AC-8795 -->

* 现在，可以正确计算将订单发送到多个地址的总金额。 以前，当报价包含多个送货地址时，收集器总数会更新`$quote->getShippingAddress()`中给定地址的送货金额，而不是按预期由`$shippingAssignment`传递。 [GitHub-37283](https://github.com/magento/magento2/issues/37283)

<!-- ACP2E-2459 -->

* 当管理员用户使用登录作为客户功能时，Commerce不再在使用多个运送地址进行签出时引发异常。

<!-- ACP2E-2258 -->

* 现在，当您在创建运输标签后将产品添加到包时，产品会在“创建软件包”页的“产品”网格中正确列出。

<!-- ACP2E-2044 -->

* `cart`查询现在将离散配送折扣作为具有唯一折扣标签的单独配送折扣返回。 新的`applied_to`折扣属性支持对购物车项目应用的折扣之间的差异。 以前，所有运费折扣合并为一个硬编码的&#x200B;**[!UICONTROL Shipping Discount]**&#x200B;值。

<!-- ACP2E-1826 -->

* 当管理员用户创建重新订购时，当管理员用户单击&#x200B;**[!UICONTROL Reorder]**&#x200B;按钮（管理员&#x200B;**[!UICONTROL Sales]** > **[!UICONTROL Orders]** > **[!UICONTROL View]** ）时，初始订单中的账单地址和送货地址会自动填充相关字段。 如果购物者的通讯簿中保存了相同的地址，则重新排序将始终包含这些地址的更新版本。 以前，送货地址字段预填充了更新的数据，但帐单地址字段则未预填充。

<!-- AC-7003 -->

* 现在，启用&#x200B;**[!UICONTROL Shipping Policy]**&#x200B;并且自定义配送策略可用时，**[!UICONTROL Apply custom Shipping Policy]**&#x200B;文本框会在“管理应用商店视图”范围中可见。 [GitHub-36425](https://github.com/magento/magento2/issues/36425)

<!-- AC-7550 -->

* `cart`查询现在返回与`selected_shipping_method`运营商和方法代码之一匹配的`available_shipping_methods`值。 以前，当其中一个选定的配送方式包含下划线时，这些承运人/方式代码不匹配。 [GitHub-36606](https://github.com/magento/magento2/issues/36606)

<!-- AC-2556 -->

* 当街数组中的第二个值为空时，`setShippingAddressesOnCart`突变不再引发错误。 以前，引发此异常： `The address failed to save. Verify the address and try again`。 [GitHub-35160](https://github.com/magento/magento2/issues/35160)

### Sitemap

<!-- AC-2465 -->

* 现在，XML Sitemap在多层部署中可按预期工作。 以前，站点地图不包含为每个存储分配的默认页面。 [GitHub-35001](https://github.com/magento/magento2/issues/35001)

<!-- AC-2267 -->

* 在启用了网站`id != 1`和单商店模式的情况下，商家现在可以创建并保存产品。 以前，保存操作失败，并显示以下消息： `SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails`。 [GitHub-35009](https://github.com/magento/magento2/issues/35009)

### 暂存

<!-- ACP2E-2665 -->

* 在暂存功能板中，销售规则的暂存更新不再重复。

<!-- ACP2E-2173 -->

* 现在，如果购物者在计划更新过程中将捆绑产品添加到购物车，则会正确更新捆绑产品。 以前，如果在计划任务处理过程中将带选项的捆绑产品添加到购物车，Commerce会引发此异常： `Some of the products below do not have all the required options. Please select all required options`。

<!-- ACP2E-2252 -->

* 计划更新现在可以保持捆绑选项的正确价格。 以前，对于特定网站或商店浏览次数，这些价格会更改为零。

<!-- ACP2E-2150 -->

* 如果未指定结束日期，则更新计划更新不再删除暂存项目的先前版本。 以前，更新暂存项目时，如果未指定结束日期，则会删除项目的回滚版本。 删除之前，Commerce未引发错误或警告管理员用户。

<!-- ACP2E-1923 -->

* 在计划更新购物车价格规则后，商店视图标签值不再被清除。 以前，即使更新中未指定这些标签，也会将其清除。

<!-- ACP2E-1803 -->

* 现在，内容暂存预览对链接的页面可正常使用。 以前，您无法导航到暂存预览中的链接页面，而是被错误地定向到店面页面。

<!-- ACP2E-1876 -->

* 暂с留暂存更新不再导致删除在稍后日期分配的计划更新。

<!-- ACP2E-1501 -->

* 启用JavaScript内容实验后，当您添加或编辑类别的计划更新时，Google Analytics不再发生错误。

<!-- ACP2E-1344 -->

* 商家现在可以在查看或编辑类别现有计划更新后成功保存该更新。 以前，Adobe Commerce在`system.log`中引发错误。

<!-- ACP2E-1596 -->

* 现在，在应用计划更新且购物车中包含之前添加的产品时，可下载链接会按预期保留。 以前，可下载的链接从客户的“我的帐户（我的可下载产品）”页面和“管理员订单”视图页面中消失。

<!-- ACP2E-1458 -->

* 现在，在应用支持产品的暂存更新后，产品可按预期显示在店面上。 以前，产品在管理员中启用，但在目录清单的索引器模式设置为“按计划更新”时，产品在店面类别中不可见。 完全重新索引修复了问题。

<!-- ACP2E-1647 -->

* 当没有要处理的临时更新时，`staging.synchronize_entity_period`表中的`magento_bulk`使用者队列不再增加。 以前，如果将`cron`配置为每分钟运行一次，则每分钟会向此表添加一条与`staging.synchronize_entity_period`使用者相关的新记录。

<!-- ACP2E-1415 -->

* 在保存其他产品时，为产品创建计划更改时，Adobe Commerce不再引发SQL错误。 以前，Adobe Commerce显示此错误： `The product with the SKU "%1" couldn't be added to the current update`。

### Target规则

<!-- ACP2E-1438 -->

* 现在，Target规则可正确用于不同的存储视图。 以前，由于相关产品规则缓存存在问题，导致在多商店部署中无法显示推荐的产品。

### 税金

<!-- ACP2E-2651 -->

* 现在，在配置税并启用FPT的情况下，发票会显示正确的小计。

<!-- ACP2E-2245 -->

* 现在，当将&#x200B;**[!UICONTROL Regular Price]**&#x200B;设置为含税时，为具有&#x200B;**[!UICONTROL Special Price]**&#x200B;值的产品选择自定义选项时，Commerce会显示&#x200B;**[!UICONTROL Price Display Settings]**&#x200B;值的正确值。

<!-- ACP2E-2303 -->

* 现在，按照配置设置指定的方式，税已按预期包含在结账工作流配送价格中。

<!-- AC-9758 -->

* `cart`查询`applied_taxes`响应值现在按预期包括所有个别税则。 以前，如果配置了多个税则，它会返回总税值。

<!-- ACP2E-2247 -->

* 税务规则创建期间&#x200B;**[!UICONTROL Additional Settings]**&#x200B;部分的折叠/展开图标现在可按预期工作。 以前，只有展开图标有效。 [GitHub-37922](https://github.com/magento/magento2/issues/37922)

<!-- ACP2E-1527 -->

* 您现在可以按预期在“税则”编辑页中编辑税率国家（地区）的值。 以前，不会保存从该页面所做的编辑。

<!-- ACP2E-1143 -->

* 现在，在更新配送方式时，购物车估算区域中的税额会按预期刷新。 以前，购物者在结帐期间更改国家/地区后，不会更新税率。

<!-- AC-8227 -->

* 在“商店视图”范围中创建现有可配置产品的新变体时，新创建的简单产品的`tax class`值现在设置为父产品的值。 以前，此值设置为none。 因此，这些产品在购物车中没有添加任何税款，而且客户缺税。 [GitHub-37180](https://github.com/magento/magento2/issues/37180)

### 测试

<!-- ACP2E-2501 -->

* 改进了`AdminCreateOrderWithVirtualProductFromDefaultSourceWithBackorders`测试，以消除过早完成电子邮件字段导致的失败。

<!-- AC-10863 -->

* `StorefrontVerifyProductAfterPartialReindexOnSeveralWebsitesTest`已重构以提高可靠性。 [GitHub-38359](https://github.com/magento/magento2/issues/38359)

<!-- ACP2E-2501 -->

* 通过引入一个额外步骤来显式设置要在搜索中使用的属性，修复了`AdminSimpleProductwithTextandVisualSwatch`测试。

<!-- AC-9194 -->

* 更正了`SortbyTest`单元测试中的拼写错误。 [GitHub-37792](https://github.com/magento/magento2/issues/37792)

<!-- AC-9035 -->

* 删除了对单元测试中不存在的类的引用。 [GitHub-37636](https://github.com/magento/magento2/issues/37636)

<!-- ACP2E-2604 -->

* 改进了`AdminCreateOrderWithVirtualProductFromDefaultSourceWithBackorders`测试，以消除过早完成电子邮件字段导致的失败。

<!-- ACP2E-2202 -->

* 已重构`Magento\GraphQl\Catalog\ProductSearchTest::testFilterProductsBySingleCategoryId`测试以处理`products`查询响应中的随机类别顺序。

<!-- AC-7098 -->

* 已解决`TableNameSniff`中大型数组的性能问题。

<!-- ACP2E-1690 -->

* 编辑礼品注册表功能的集成测试不再依赖现有的实体ID。 所有必需的数据现在都通过夹具获得。 以前，`\Magento\GiftRegistry\Controller\Index\EditPostTest`失败。

<!-- ACP2E-1748 -->

* `CollectionTest::testGetDateRangeFirstPart()`现在计入夏令时。

<!-- ACP2E-1824 -->

* 修复了`StorefrontDeleteItemFromRequisitionListPrintView`的弃用通知。

### UI框架

<!-- AC-9604 -->

* 图像上传程序现在在动态行中按预期工作。 现在，以跨国阵列形式发送图像时，可以正确上传图像。 [GitHub-37957](https://github.com/magento/magento2/issues/37957)

<!-- AC-10877 -->

* 文件上传样式在Luma主题中不再重复。 [GitHub-32373](https://github.com/magento/magento2/issues/32373)

<!-- AC-9984 -->

* 街道字段客户帐户编辑地址表单中的街道字段现已正确保存。 现在，这些字段按表单中给定的键正确排序。 [GitHub-37973](https://github.com/magento/magento2/issues/37973)

<!-- AC-9107 -->

* 更正了礼品注册表&#x200B;**[!UICONTROL Message]**&#x200B;文本字段中的光标行为。

<!-- AC-3001 -->

* 产品详细信息页面的累积版面偏移(CLS)值已得到改进。 （此量度量化页面布局的视觉稳定性。）[GitHub-35410](https://github.com/magento/magento2/issues/35410)

<!-- AC-10567 -->

* 改进了模板渲染期间发生的错误消息传递。 Commerce现在会显示一条信息性消息。 以前，当发生PHP错误时，Commerce显示HTML泄露。

<!-- ACP2E-2595 -->

* 自定义客户属性（类型`File attached`）现在可以正确处理已删除的图像，然后上传。 以前，上传的自定义属性、删除的自定义属性以及再次上传的自定义属性无法从店面保存。

<!-- AC-9125 -->

* 更正了日历模板文件中的语法错误。 [GitHub-37725](https://github.com/magento/magento2/issues/37725)

<!-- AC-6445 -->

* 现在，在启用单店模式时，管理员用户可以更改店面徽标。 以前，Commerce显示默认的回退徽标。 [GitHub-35952](https://github.com/magento/magento2/issues/35952)

<!-- ACP2E-2045 -->

* Mixins配置值不再为空，jQuery mixin现在不论加载位置如何，均可正常工作。 以前，jQuery mixin在浏览器间加载不一致。

<!-- AC-8823 -->

* 当登录页面上的&#x200B;**[!UICONTROL Show Password]**&#x200B;复选框处于活动状态时，密码现在按预期显示。

<!-- ACP2E-2034 -->

* Adobe Commerce现在为具有特殊价格的固定捆绑产品显示正确的价格。

<!-- AC-8285 -->

* 更新了店面页脚模板文件中指向GitHub问题列表页面的链接。 [GitHub-37214](https://github.com/magento/magento2/issues/37214)

<!-- AC-6282 -->

* “最近查看的项目”小组件现在显示按产品价格分组的正确税额。 [GitHub-35881](https://github.com/magento/magento2/issues/35881)

<!-- AC-6636 -->

* 管理员用户现在可以按预期拖放为简单产品创建的可自定义选项。 [GitHub-36051](https://github.com/magento/magento2/issues/36051)

<!-- AC-8345 -->

* 现在，产品下拉列表属性类型的顺序与可配置产品页面上的图像顺序匹配。 [GitHub-37285](https://github.com/magento/magento2/issues/37285)

<!-- ACP2E-1969 -->

* 系统消息现在加载得更快。 只加载正在显示的消息。 以前，从数据库加载所有消息非常耗时。

<!-- ACP2E-1804 -->

* 通过布局XML设置`remove=true`来删除痕迹导航节点不再导致删除类别页面上的页面标题。 以前，通过这种方式删除痕迹导航会从类别页面中删除页面标题。

<!-- ACP2E-1717 -->

* 现在，当客户注册表单包含多选客户属性时，该表单会按预期加载。 以前，Adobe Commerce引发此异常： `[2023-03-05T05:57:40.032602+00:00] report.CRITICAL: Exception: Deprecated Functionality: explode(): Passing null to parameter #2 ($string) of type string is deprecated in /magento2ee/app/code/Magento/CustomAttributeManagement/Block/Form/Renderer/Multiselect.php on line 53 in /lib/internal/Magento/Framework/App/ErrorHandler.php:62`。 [GitHub-37189](https://github.com/magento/magento2/issues/37189)

<!-- ACP2E-1602 -->

* 现在，包含单引号的欢迎消息在店面中正确呈现，并且没有控制台错误。 以前，如果欢迎消息包含单引号，则在店面呈现期间不会加载欢迎消息。 Adobe Commerce还显示控制台错误。

<!-- ACP2E-1369 -->

* 当您尝试在“管理员顺序”页面中的评论历史记录和返回之间快速更改视图时，Adobe Commerce不再引发错误。 以前，Adobe Commerce显示此常规错误： `A technical problem with the server created an error`。

<!-- ACP2E-1374 -->

* 权限仅限一个网站的管理员用户现在可以将特定于网站的产品属性集更新为`all stores view`范围。

<!-- ACP2E-1648 -->

* 现在，放大镜小组件会按预期在产品页面上加载。

<!-- ACP2E-1216 -->

* 多行可自定义选项现在可以在发票、发运和贷项通知单PDF文档中正确呈现。 以前，多行文本前面会出现意外的分页符，如果文本超出页面，则文本会被截断。

<!-- AC-7402 -->

* 现在，在为商店ID与网站ID不匹配的其他网站创建客户时，管理员用户可以从管理员中添加新的客户地址。 以前，Adobe Commerce显示此弹出消息： `Something went wrong`。 [GitHub-36582](https://github.com/magento/magento2/issues/36582)

<!-- ACP2E-1529 -->

* 当“分配公司管理员”电子邮件中包含`CMS Block URL`变量时，公司管理员详细信息现在会按预期保存，并且管理员会被正确重定向。

<!-- ACP2E-1775 -->

* 与在订单详情页面上提交评论相关的错误消息，现在可提供更多信息。 以前，当购物者单击&#x200B;**[!UICONTROL Submit comment]**&#x200B;而未更改订单状态或在评论区中输入文本时，Adobe Commerce显示此消息：`The comment is missing. Enter and try again`。

<!-- ACP2E-1659 -->

* 为一个字段选择日期后，日历图标现在按预期显示在管理员&#x200B;**[!UICONTROL Marketing]** > **[!UICONTROL Cart Price Rules]**&#x200B;的日期范围字段中。 以前，为一个字段选择日期后，日历图标不再显示在其他字段中，并且Adobe Commerce会显示占位符文本。 [GitHub-36499](https://github.com/magento/magento2/issues/36499)

<!-- ACP2E-1717 -->

* 现在已成功加载包含多选字段的客户注册表单。 以前，此表单包含多选字段时未加载，并触发了以下错误： `report.CRITICAL: Exception: Deprecated Functionality: explode(): Passing null to parameter #2 ($string) of type string is deprecated in /magento2ee/app/code/Magento/CustomAttributeManagement/Block/Form/Renderer/Multiselect.php on line 53 in /lib/internal/Magento/Framework/App/ErrorHandler.php:62`。 [GitHub-37189](https://github.com/magento/magento2/issues/37189)

<!-- AC-7092 -->

* 现在，在产品库全屏模式下单击视频缩略图可按预期显示视频。 以前，不显示视频，并且浏览器控制台显示JavaScript错误。 [GitHub-36456](https://github.com/magento/magento2/issues/36456)

<!-- AC-7806 -->

* 在版权行中添加了一个变量，该变量每年自动更新。 [GitHub-36776](https://github.com/magento/magento2/issues/36776)

<!-- AC-8441 -->

* 现在，产品页面上的图像滑块在移动设备视图中可按预期工作。 以前，仅成功显示第一个图像。 [GitHub-37232](https://github.com/magento/magento2/issues/37232)

### URL重写

<!-- AC-8039 -->

* `crossorigin`元素的`linkTypes`属性已添加到`HEAD`。[GitHub-32509](https://github.com/magento/magento2/issues/32509)

<!-- ACP2E-2549 -->

* 现在，可基于多存储部署中的存储级别可见性配置生成URL重写。 以前，当产品可见性设置为默认存储范围下的&#x200B;**不可见**&#x200B;时，不会为非默认存储生成URL重写。

<!-- AC-10464 -->

* `Category::getUrl()`不再获取301重定向。 [GitHub-38152](https://github.com/magento/magento2/issues/38152)

<!-- ACP2E-2629 -->

* 在为自定义存储生成缺失的URL重写时，Commerce不再为根类别和多存储设置中设置为&#x200B;**[!UICONTROL Not Visible Individually]**&#x200B;的产品生成产品URL重写。

<!-- ACP2E-2481 -->

* 规范URL标记现在反映类别URL键属性更新后发生的预期更改。 以前，使用过时的类别URL，这会立即触发对新URL的重定向。

<!-- AC-6728 -->

* 将产品添加到类别后，现在可按预期生成所有商店视图的类别产品URL重写。 [GitHub-32910](https://github.com/magento/magento2/issues/32910)

<!-- ACP2E-1783 -->

* 启用&#x200B;**生成类别/产品URL重写**&#x200B;后，当您尝试为产品URL创建301/302重定向时，Commerce不再引发错误。 创建产品并将其分配给类别后，将创建自动URL重写：一个针对直接URL，一个针对通过类别路径的产品。 创建新产品URL重写时，将检查产品、类别和商店之间的关联。 现在，此检查基于关联的实体属性（类别和产品）。 以前，此检查是在预先存在的URL重写时执行的。

<!-- ACP2E-1737 -->

* 现在，当从CSV文件导入新类别时，将为所有存储视图生成类别URL重写。

<!-- ACP2E-1700 -->

* 产品URL后缀和类别URL后缀配置现在与`url_rewrite`表中的后缀匹配。 以前，更新URL后缀配置时出现争用情况，并且配置的URL后缀与`url_rewrite`表不匹配。

<!-- ACP2E-1703 -->

* 现在，在创建类别URL重写时，Adobe Commerce会在所有级别呈现类别树。 以前，仅显示前三个级别的类别。 [GitHub-36973](https://github.com/magento/magento2/issues/36973)

<!-- ACP2E-1644 -->

* 现在，营销过滤器网格(**[!UICONTROL Marketing]** > **[!UICONTROL URL rewrites]**)中包含新创建的带有一个子节点的CMS页面。 以前，不会为这些CMS页面创建URL重写。

<!-- ACP2E-1737 -->

* 在导入新类别期间，CSV文件中现在存在类别URL重写。

<!-- ACP2E-1668 -->

* 现在，会按预期转发不带URL重写的多存储CMS页面。 以前，请求的多存储CMS页面若没有URL重写，则会被重定向到存储主页，但原始CMS页面不会被定向。

### Visual Merchandiser

<!-- ACP2E-1363 -->

* 您现在可以将`Categories`属性用于可视化促销规则。 以前，Adobe Commerce引发此异常： `Something went wrong while saving the category`。

### Web API框架

<!-- AC-6980 -->

* 当`Integration not secure`和&#x200B;**[!UICONTROL System]**&#x200B;字段为空时，Commerce在管理员&#x200B;**[!UICONTROL Extensions]** > **[!UICONTROL Integrations]** > **[!UICONTROL Callback URL]**&#x200B;中不再显示&#x200B;**[!UICONTROL Identity link URL]**&#x200B;警告。 [GitHub-36407](https://github.com/magento/magento2/issues/36407)

<!-- ACP2E-2483 -->

* 已将`taxes`、`itemized_taxes`和`additional_itemized_taxes`扩展属性添加到  `Magento\Sales\Api\Data\OrderInterface`。 这些属性允许您通过Order REST调用保存已应用的税。

<!-- ACP2E-2610 -->

* 层价格REST API现在支持小数数量。 以前，即使启用了&#x200B;**[!UICONTROL Use Decimal Quantity]**&#x200B;设置，此API也不允许小数数量。

<!-- AC-8998 -->

* 尝试向挂起的订单状态添加评论时，REST `V1/orders/{id}/comments`端点不再更改订单状态。 它现在会给出信息性错误。 以前，此端点会在添加评论时更改订单状态。

<!-- ACP2E-2275 -->

* REST API `GET`和`POST V1/products/attributes`终结点不再为`is_filterable`选项的`Filterable(with results)`和`Filterable(no results)`选项的&#x200B;**[!UICONTROL Use in Layered Navigation]**&#x200B;属性返回相同的值。 以前，此端点返回相同的值，因为`is_filterable`属性属性是`Boolean`类型，不允许将此属性设置为`Filterable(no results)`。 [GitHub-37979](https://github.com/magento/magento2/issues/37979)

<!-- AC-9117 -->

* 缺少的`media_gallery_entries`字段已添加到REST `V1/configurable-products/sku/children`终结点。 以前，此函数缺少存储和显示`media_gallery_entries`所需的代码。 [GitHub-37607](https://github.com/magento/magento2/issues/37607)

<!-- ACP2E-1986 -->

* REST `V1/carts/mine/estimate-shipping-methods`方法现在将验证所有级别的有效负载字段数据，并为无效数据返回400 HTTP代码。 以前，仅验证第一级API有效负载，如果在有效负载的非验证级别中返回了无效数据，则Commerce会返回500状态代码。

<!-- ACP2E-2053 -->

* 现在，用于更新具有层价格和不同属性集的产品的异步批量REST API操作已成功完成。 以前，无法以这种方式更新具有不同属性集的产品，Commerce显示此错误： `The product was unable to be saved. Please try again`。

<!-- AC-7002 -->

* 现在，当在层价格创建过程中使用无效的客户组名称时，`POST /V1/products/tier-prices`端点会返回一条信息更丰富的错误消息。 以前，Adobe Commerce返回类似以下内容的错误： `Notice: Undefined index: XXXXX in ~/public_html/vendor/magento/module-catalog/Model/Product/Price/Validation/TierPriceValidator.php on line 474"`。 [GitHub-36431](https://github.com/magento/magento2/issues/36431)

<!-- ACP2E-1776 -->

* 您现在可以执行授权的异步批量API请求，以创建具有非默认组ID的客户。 以前，这些请求会将组ID重置为默认值。

<!-- ACP2E-1543 -->

* 现在，使用批量API创建的客户将收到在其分配的网站中配置的语言版本的客户注册电子邮件。 以前，所有电子邮件都会发送到默认区域设置，而不是客户所分配到网站的区域设置。

<!-- ACP2E-1339 AC-7577-->

* 禁用`POST V1/guest-carts`后，**[!UICONTROL Allow Guest Checkout]**&#x200B;调用不再提交来宾订单。

<!-- ACP2E-1336 -->

* 当`Received`未启用时，您现在可以从管理员打开状态为`AsyncOrder`的订单。 以前，当订单状态由`POST V1/orders`更改时，无法从管理员打开订单详细信息页面。

<!-- ACP2E-1526 -->

* Adobe Commerce现在在`content`产品媒体API响应中成功返回`GET V1/products/sku/media`属性（base64图像代码）。 `content`特性以前未出现在响应中。

### 愿望清单

<!-- ACP2E-1784 -->

* 当购物者多次尝试将同一项目添加到愿望清单时，Commerce现在会显示一条消息，指示该项目已添加到愿望清单。 以前，在这些条件下，Commerce会增加愿望清单中的产品数量。

<!-- AC-8610 -->

* Adobe Commerce现在已成功将具有所需上传的可自定义选项文件的产品添加到愿望清单。 以前，Commerce向愿望清单中添加了两个产品，而不是一个。 [GitHub-37437](https://github.com/magento/magento2/issues/37437)


## 系统要求

我们的技术栈栈是基于PHP和MySQL构建的。 有关详细信息，请参阅[系统要求](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/system-requirements.html?lang=zh-Hans)。

## 安装和升级说明

您可以使用[编辑器](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/composer.html?lang=zh-Hans)安装Adobe Commerce 2.4.7。
