---
title: Adobe Commerce 2.4.7-beta1发行说明
description: 了解2.4.7-beta1 Adobe Commerce版本中的新增功能、增强功能、错误修复和已知问题。
badgeCoreBeta: label="2.4.7-beta1" type="informative"
exl-id: c0f92086-85fd-4b77-ac31-bb2980c42d38
source-git-commit: f085c0a77fe59ff3b2d76abbd6965b6bc8ee69db
workflow-type: tm+mt
source-wordcount: '8275'
ht-degree: 0%

---

# Adobe Commerce 2.4.7-beta1发行说明


>[!IMPORTANT]
>
>Beta版可能包含缺陷，并“按原样”提供，不提供任何形式的担保。 Adobe没有义务维护、更正、更新、更改、修改或以其他方式支持(通过Adobe支持服务或其他方式)测试版。 建议客户谨慎使用，并且不要以任何方式依赖测试版和/或任何随附的文档或材料的正确功能或性能。 因此，使用测试版完全由客户自行承担风险。


Adobe Commerce 2.4.7-beta1包含200多项质量修复和增强功能。 核心编辑器依赖项和第三方库已升级到最新可用版本。 添加了对Composer 2.5的支持，但仍支持Composer 2.2.x。

此版本增强了GraphQL的自定义属性覆盖范围和GraphQL缓存功能。

{{bics}}

## 其他发行信息

虽然这些功能的代码与Adobe Commerce核心代码的发行版本捆绑在一起，但其中几个项目(例如B2B、Page Builder和Progressive Web Application(PWA)Studio)也单独发行。 每个项目的文档中都提供了特定于项目的单独发行信息，其中记录了这些项目的错误修复。

## Adobe Commerce 2.4.7-beta1

Adobe Commerce 2.4.7-beta1已针对以下组件版本进行了测试：

* Composer 2.5
* Elasticsearch8.5
* MariaDB 10.6
* MySQL 8.0
* OpenSearch 2.5
* PHP 8.2和8.1
* RabbitMQ 3.11
* Redis 7.0
* 清漆7.3

我们的技术栈栈是基于PHP和MySQL构建的。 请参阅 [系统要求](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/system-requirements.html).

## Adobe Commerce 2.4.7亮点

在此版本中查找以下要点。

### 安全性增强

此版本包括13项安全修复和平台安全改进。

到目前为止，尚未发生与这些问题相关的已确认攻击。 但是，可能会利用某些漏洞访问客户信息或接管管理员会话。 这些问题中的大多数要求攻击者首先获得对管理员的访问权限。 因此，我们提醒您采取一切必要步骤保护您的管理员，包括但不限于以下工作：

* IP 列入允许列表
* [双重身份验证](https://developer.adobe.com/commerce/testing/functional-testing-framework/two-factor-authentication/)
* 使用VPN
* 使用唯一位置，而不是 `/admin`
* 良好的密码卫生

请参阅 [Adobe安全公告](https://helpx.adobe.com/security/products/magento/apsb23-35.html) 以获取有关这些已修复问题的最新讨论。

#### 其他安全增强功能

此版本的安全改进改进了与最新安全最佳实践的符合性，包括此更改，它引入了现有REST端点的默认行为的更改：

**通过REST和GraphQL API传输的支付信息的本机速率限制**. 商家现在可以为使用REST和GraphQL传输的支付信息配置速率限制。 此新增的保护层支持对分拣攻击的防范，并可能会减少一次测试多个信用卡号码的分拣攻击的数量。 请参阅 [限速](https://developer.adobe.com/commerce/webapi/get-started/rate-limiting/). <!-- AC-1271 -->

的默认行为 [`isEmailAvailable`](https://developer.adobe.com/commerce/webapi/graphql/schema/customer/queries/is-email-available/) GraphQL查询和([`V1/customers/isEmailAvailable`](https://adobe-commerce.redoc.ly/2.4.6-admin/tag/customersisEmailAvailable/#operation/PostV1CustomersIsEmailAvailable)) REST端点已更改。 默认情况下，API现在始终返回 `true`. 商人们可以启用原始行为，即 `true` 如果电子邮件在数据库中不存在，并且 `false` 如果它存在。 <!-- AC-6695 -->

### 平台增强功能

此版本的平台升级可改善对最新安全最佳实践的合规性。 Adobe Commerce 2.4.7-beta1引入了：

* Composer 2.5.x.与Composer 2.2.x的兼容性得以保留。  <!-- AC-8129 -->

* **支持Varnish缓存7.3**. 此版本与最新版本的Varnish Cache 7.3兼容。与6.0.x和7.2.x版本的兼容性保持不变，但我们建议仅将Adobe Commerce 2.4.7-beta1与Varnish Cache版本7.3或版本6.0 LTS一起使用。

* **RabbitMQ 3.11支持**. 此版本与最新版本的RabbitMQ 3.11兼容。兼容性保持与RabbitMQ 3.9的兼容，该版本在2023年8月之前受支持，但我们建议仅将Adobe Commerce 2.4.7-beta1与RabbitMQ 3.11一起使用。

#### 其他升级和更换

过时的JavaScript库已升级到其最新版本，包括：

* `moment.js` 库(v2.29.4) <!-- AC-7389 -->
* `jQuery UI` 库(v1.13.2)  <!-- AC-7775 -->
* `jQuery` 验证插件库(v1.19.5) <!-- AC-8077 -->

### 性能和可扩展性增强

此版本显着提高了大型部署配置的保存操作的处理速度。

* **针对具有许多商店的部署，加快存储级配置的保存操作**. 在具有500个以上存储的部署中保存配置设置可能非常耗时。 新 [`Async Config`](../../../performance/configuration.md#asynchronous-configuration-save-badge-247-beta1typeinformative-urlhelpreleaserelease-notescommerce2-4-7md-tooltipavailable-in-247-beta1-only) 模块通过运行 `cron` 使用使用者处理消息队列中保存操作的作业。 `AsyncConfig` 是 **已禁用** 默认情况下。  <!-- ACPT-831 -->

* **更快地为大型配置生成配置缓存**. 此 `bin/magento cache:clean config` 现在，命令会在启用配置缓存时对配置缓存进行预热。 这减少了为大型配置生成配置缓存所需的停机时间。 配置保存操作不再清理 `config_scopes` 在将数据写入缓存之前进行缓存，这还可以减少在写入配置数据时锁定其他请求的时间。
<!-- ACPT-992 -->

### 适用于GraphQL API的应用程序服务器

此发行版本引入了一个新的PHP应用程序服务器，该服务器在Swoole PHP扩展上实现。 此应用程序服务器使Adobe Commerce能够维护Commerce GraphQL API请求之间的状态，并且无需引导。 通过在进程之间共享应用程序状态，API请求变得明显更高效，并且API响应时间可能会减少50 - 60毫秒。

此 `ApplicationServer` 模块实施PHP应用程序服务器，该服务器仅适用于内部部署。 要实施此服务器的开发人员还必须安装和配置Swoole和Nginx。

此应用程序服务器的此Beta版本仅适用于内部部署；它不支持基于云的部署。 它尚不支持B2B GraphQL功能。 当配置此版本的PHP应用程序服务器时，GraphQL请求在内部部署中可能无法按预期工作。 请参阅 [适用于GraphQL API的应用程序服务器](https://experienceleague.adobe.com/docs/commerce-operations/performance-best-practices/performance-best-practices/application-server.html). <!-- ACPT-27 -->

### Adobe Commerce扩展中继包

此版本引入了Adobe Commerce扩展metapackage v2.0.0-beta1，它自动将所选Adobe Commerce扩展与此核心版本捆绑在一起。 在以下情况下安装此中继包中包含的这些扩展的版本： `composer update` 运行，从而简化在升级到最新核心版本时升级这些扩展的过程。 这些扩展维护独立的发放计划。

适用于Adobe Commerce 2.4.7-beta1的Adobe Commerce扩展元包包含三个扩展：

* [Bolt快速签出](https://experienceleague.adobe.com/docs/commerce-merchant-services/quick-checkout/overview.html)
* [Adobe Commerce的Adobe I/O事件](https://developer.adobe.com/commerce/events/get-started/)
* [支付服务](https://experienceleague.adobe.com/docs/commerce-merchant-services/payment-services/guide-overview.html)

此扩展metapackage的未来版本将包含其他扩展。

### B2B

此版本包括针对B2B可转让报价、REST API更新以及多个错误修复的新功能和增强功能。

* **卖方发起的报价**. B2B销售代表现在可以直接从Admin中的Quote和Customer网格启动报价。 请参阅 [创建报价](https://experienceleague.adobe.com/docs/commerce-admin/b2b/quotes/quote-request.html)

* **行项目折扣**. 折扣现在可以应用为报价中特定行项目的折扣百分比、固定值或扩展定价。

* **报价上的备注交换**. 在洽谈过程中，B2B买方和卖方现在可以直接在报价中添加附注。 注释创建和更新包括在行项目和报价历史记录中，以便透明。 请参阅 [协商报价](https://experienceleague.adobe.com/docs/commerce-admin/b2b/quotes/quote-price-negotiation.html)

* **改进了“报价详细信息”视图**. 在查看报价详细信息页面时，卖方和买方现在可以按SKU或从产品目录添加项目，添加或编辑附注，应用行项目折扣，以及直接从报价详细信息页面访问产品配置。

* REST API的更新

   * 添加了端点，以便为本版本中引入的卖方启动的报价功能提供Web API覆盖范围。 请参阅 [管理可转让报价](https://developer.adobe.com/commerce/webapi/rest/b2b/negotiable-manage/).

     `POST /V1/negotiableQuote/draft`

   * 共享目录的店面功能的增强Web API覆盖范围包括用于分配和重置自定义价格操作的新端点：

     `POST /V1/sharedCatalog/:sharedCatalogId/assignCustomPrices`
     `POST /V1/sharedCatalog/:sharedCatalogId/resetCustomPrices`

  新 `quickorder_active` 字段 `storeConfig` 和 `availableStores` 查询。 此字段指示是否启用快速订购功能。

有关Commerce B2B的REST和GraphQL API覆盖范围的详细信息，请参阅 [Commerce Web API](https://developer.adobe.com/commerce/webapi/) 开发人员文档。 请参阅 [B2B发行说明](https://experienceleague.adobe.com/docs/commerce-admin/b2b/release-notes.html) 以获取有关错误修复的说明。

### GraphQL

此版本增强了自定义属性的GraphQL缓存功能，并向GraphQL架构提供了支持，包括：

* **增强了对自定义属性的支持**. GraphQL通过丰富API数据而增强了自定义属性支持，因此现在它支持所有属性类型。 GraphQL EAV属性架构现在支持在管理员中扩展客户属性和客户地址对象，以及使用GraphQL检索它们。 具体的增强功能包括： <!-- LYNX-61 110-->

   * 扩展/添加了针对特定领域（如客户和客户地址）的自定义属性支持
   * 添加了自定义属性的缓存
   * 增强了对产品的现有自定义属性支持

* **增强的GraphQL缓存功能可提高页面加载速度**. 已为这些查询添加了缓存功能，提高了大多数PWA页面的页面加载时间速度：

   * [`storeConfig`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/) <!-- B2B-2487 2258 -->
   * [`currency`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/currency/) <!-- B2B-2255 -->
   * [`countries`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/countries/) 和 [`country`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/country/) <!-- B2B-2256 -->
   * [`availableStores`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/available-stores/) <!-- B2B-2257 -->
   * [`customAttributeMetadata`](https://developer.adobe.com/commerce/webapi/graphql-api/index.html#query-customAttributeMetadata) <!-- B2B-2259 -->


* 添加了 `quickorder_active` 字段至 [`storeConfig`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/store-config/) 和 [`availableStores`](https://developer.adobe.com/commerce/webapi/graphql/schema/store/queries/available-stores/) 查询。 此字段指示是否启用快速订购功能。 <!-- LYNX-58 -->

* GraphQL通过减少 `parse` 每个请求调用方法。 现在只调用一次。 以前，解析器至少被调用三次。 <!-- B2B-2606 -->

#### 新建查询

[`customAttributeMetadataV2`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/custom-attribute-metadata-v2/) <!-- LYNX-152 160-->

#### 已弃用的查询

* [`attributesMetadata`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/attributes-metadata/) <!-- LYNX-77-->
* [`customAttributeMetadata`](https://developer.adobe.com/commerce/webapi/graphql/schema/attributes/queries/custom-attribute-metadata/)

### 页面生成器

Page Builder v.1.7.4与Adobe Commerce 2.4.7-beta1兼容。

### PWA Studio

PWA Studio v.13.2.x与Adobe Commerce 2.4.7-beta1兼容。 它包括多项增强功能，可改善辅助功能。 有关错误修复的信息，请参见 [PWA Studio版本](https://github.com/magento/pwa-studio/releases). 请参阅 [版本兼容性](https://developer.adobe.com/commerce/pwa-studio/integrations/adobe-commerce/version-compatibility/) 有关PWA Studio版本及其兼容的Adobe Commerce核心版本的列表。

## 修复的问题

我们已在Adobe Commerce 2.4.7-beta1核心代码中修复了数百个问题。 此版本中包含的已修复问题的子集如下所述。

### 安装、升级、部署

<!-- ACP2E-1505 -->

* 此 `bin/magento setup:upgrade` 命令不再失败，出现此类型的MySQL内存限制相关错误： `PHP Fatal error:  Allowed memory size of 4294967296 bytes exhausted (tried to allocate 20480 bytes)`. 多选属性迁移已经过优化，以在 `setup:upgrade`.

<!-- ACP2E-1751 -->

* 现在，从管理员和命令行均可按预期生成数据库备份。 以前，Adobe Commerce引发此错误： `Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'delimiter' at line 1, query was: delimiter ;;`.

<!-- ACP2E-1604 -->

* 正在运行 `setup:config:set` 而不指定 `--lock-db-prefix` 参数不再拭除当前值 `env.php` 文件。

<!-- ACP2E-1498 -->

* 清漆配置已更新，以防止来宾用户访问与其他客户组相关的缓存内容。

<!-- AC-7113 -->

* 在以下情况下，购物者现在可以在实施拆分数据库的部署中下订单 **[!UICONTROL Checkout Async]** 已启用。 以前，Adobe Commerce引发此错误： `An error occurred on the server. Please try to place the order again`.

<!-- https://github.com/magento/magento2/pull/33092 -->

* `bin/magento setup:upgrade` 现在，在安装同时安装表和关联的新模块时成功完成 `mview` 索引器。

<!-- ENGCOM-9243 -->

* `bin/magento setup:upgrade` 现在，当消息队列主题不包含主题名称时，会显示信息更丰富的错误消息。 [GitHub-34246](https://github.com/magento/magento2/issues/34246)

<!-- https://github.com/magento/magento2/pull/36239 -->

* `bin/magento setup:upgrade` 现在，当合并的XML文件无效时，会显示信息更丰富的错误消息。 错误消息现在包含文件名。

### 捆绑产品

<!-- ACP2E-1478 -->

* 现在，无需在产品选项中复制SKU，即可成功导入捆绑包产品。 以前，当您导入包含重复条目的捆绑产品时，Adobe Commerce会在产品选项中创建多个重复的SKU。

<!-- ACP2E-1388 -->

* 现在，当捆绑包中的某个产品缺货时，可以正确计算捆绑包产品价格。 以前，如果属于捆绑销售的产品缺货，则会将其从价格计算中删除。

<!-- ACP2E-1503 -->

* 现在，在购买捆绑产品的最后一个所需子产品时，捆绑产品会显示为缺货。 以前，当简单的产品缺货时，店面中捆绑销售的产品会显示为现货。

<!-- ACP2E-1443 -->

* 使用将包含非必需选项的捆绑产品添加到购物车时出现性能问题 `addBundleProductsToCart` 变异已被解决。

<!-- ACP2E-1264 -->

* 此 `categoryList` 现在，当满足以下条件时，查询会按预期返回所有捆绑选项： **[!UICONTROL Show out-of-stock products]** 已启用配置设置。 以前，缺货的选项不包含在查询响应中。

<!-- ACP2E-1345 -->

* 捆绑产品创建方式 `POST V1/products` 现在，当目录价格范围设置为时，成功 `website`. 以前，出现完整性约束冲突。 [GitHub-35595](https://github.com/magento/magento2/issues/35595)

### 缓存

<!-- ACP2E-1524 -->

* 现在，当父产品的某个子产品已从管理员中保存时，其页面缓存会按预期清除。 引入了一项插件检查，以便像其他产品类型一样，使可配置变体的缓存失效，而不管索引器状态（计划或实时）如何。 以前，在管理员更新可配置变量后，店面上的价格不会正确更新。

<!-- ACP2E-1454 -->

* 为AWS凭据添加了缓存机制。 凭据提供程序现在使用Magento缓存来缓存从AWS检索到的凭据以进行EC2配置。

<!-- AC-7639 -->

* 现在，插件可按预期工作，该插件的目的是在保存与可配置产品关联的简单产品时添加可配置缓存标记。 在通过更新简单产品时，会按预期删除所有相关的可配置缓存标记 `POST V1/products`. 以前，并非所有价格都会在店面更新，缓存必须手动清空。 [GitHub-36726](https://github.com/magento/magento2/issues/36726)

### 购物车和结账

<!-- ACP2E-1614 -->

* 刷新缓存后，购物车中的产品不再从相关和追加销售产品列表中排除。

<!-- ACP2E-1580 -->

* 购物车税和配送估算器现在可以准确地反映默认目标配置。 以前，当您配置默认纳税目标计算设置并指定州/地区和ZIP时，购物车中只显示ZIP值，它位于 **[!UICONTROL Estimate Tax and Shipping]**. 这是由于Adobe Commerce在调用条件语句（用于从管理员设置默认区域ID）之前将区域ID设置为undefined所致。

<!-- ACP2E-1547 -->

* 启用永久购物车后，Adobe Commerce在签出期间不再引发此错误： `Invalid state change requested`. 以前，引发此错误时，多个订单具有相同的 `quote_id` 偶尔会出现。

<!-- ACP2E-1456 -->

* 迷你购物车现在显示反映购物车税务配置设置的捆绑产品价格。 以前，迷你购物车始终在捆绑产品的价格中包含税费。

<!-- ACP2E-1414 -->

* 提高了依赖活动购物车的客户区段规则的性能，这减少了将产品添加到购物车所需的时间。

<!-- AC-7503 -->

* 从购物车页面提供的配送估计值现在准确。 `collectShippingRates` 现在仅设置一次。 以前，运费估计数是重复的。 [GitHub-36648](https://github.com/magento/magento2/issues/36648)

<!-- ACP2E-1417 -->

* 此 `cart` 指定购物车中的产品缺货时，查询不再返回错误。 以前，使用此查询进行购买的购物者无法在商品缺货且结账页面为空白时完成购买。

<!-- ACP2E-1459 -->

* 来宾API请求到 `POST V1/default/V1/guest-carts/<cartId>/shipping-information` 不再返回 `cancel` 在登录移动环境期间重新加载页面时的状态。 以前，Adobe Commerce引发500错误并记录此异常： `TypeError: Argument 2 passed to Magento\CustomerCustomAttributes\Model\Plugin\ProcessCustomerShippingAddressCustomAttributes::beforeSaveAddressInformation() must be of the type string, null given`.

<!-- AC-7886 -->

* 免费配送资格现在按预期计算，当 **[!UICONTROL Subtotal (Excl. Tax)]** 应用购物车规则的条件。 [GitHub-36760](https://github.com/magento/magento2/issues/36760)

<!-- AC-6672 -->

* 此 `cart` 现在，查询返回产品的正确层定价。 [GitHub-29655](https://github.com/magento/magento2/issues/29655)

<!-- ACP2E-1162 -->

* 已将信息性错误消息添加到结账页面，以指导购物者在配送页面上应用优惠券与所选配送方式冲突时进行购物。 以前，有一条信息告诉购物者返回上一页。

<!-- ENGCOM-8387 -->

* 现在，仅当需要身份验证弹出窗口时，才会将其初始化，而不是在启用了来宾签出时。 现在，当访客购物者尝试继续结帐，且访客结帐被禁用时，它会进行初始化。 [GitHub-30672](https://github.com/magento/magento2/issues/30672)

### 购物车价格规则

<!-- ACP2E-1516 -->

* 现在，当为商店配置了与一种配送方式相关的购物车价格规则，并且在结帐期间此配送方式更改为另一种配送方式时，购物车价格规则可按预期应用。 以前， `applied_rule_ids` 值从未在 `sales_order_item` 表，并且购物车价格规则未应用于订单。

### 目录

<!-- ACP2E-1479 -->

* 当您保存使用自定义选项创建的产品时，Adobe Commerce在删除其图像后不再显示警告消息。

<!-- ACP2E-1419 -->

* 现在，产品缩略图图像会按预期显示在产品重新上架时发送的产品库存警报电子邮件中。 以前，此图像不显示在警报电子邮件中

<!-- AC-3003 -->

* 类别树中的产品计数（管理员） **[!UICONTROL Catalog]** > **[!UICONTROL Category]**)现在准确。 以前，无法从 `catalog_category_product_index` 表格。 已修复触发此错误的拼写错误。 [GitHub-35417](https://github.com/magento/magento2/issues/35417)

<!-- ACP2E-1239 -->

* 在下列情况下，产品详细信息页面上的主要产品图像在页面加载期间不再明显下移 `product_image_white_borders` 主题 `view.xml` 已禁用。 以前，由于Fotorama JS中的高度设置不正确，导致产品图像在页面加载期间明显向下偏移。

<!-- ACP2E-1361 -->

* 现在，当客户订阅了价格下降警报时，将会向客户发送有关产品价格下降的通知。 以前，由于应用程序级别的缓存，不能始终发送降价通知。

<!-- ACP2E-1422 -->

* 在通过Web API创建产品属性的过程中添加了服务器端验证。 您无法启用 **[!UICONTROL Use in Layered Navigation Catalog]** 字段，当 **[!UICONTROL Catalog Input Type for Store Owner]** 字段值为 `Text Field`，  `Text Area`，  `Text Editor`， `Date`，或 `Date and Time`. 以前，类别和搜索结果中会忽略产品。

<!-- ACP2E-1413 -->

* 现在，购物者打开页面、更改分页、导航到产品页面，然后返回到类别页面后，类别页面以正确的分页重新加载。  [GitHub-36563](https://github.com/magento/magento2/issues/36563)

<!-- ACP2E-1334 -->

* 作为可配置产品的选项的缺货简单产品现在在店面中显示为禁用，当 **[!UICONTROL Display Out of Stock Products]** 设置为 **是**. 以前，所有选项都显示为可用，无论其状态和实际可用性如何。

<!-- ACP2E-1384 -->

* 更新特定商店视图中的网站范围属性不再覆盖全局范围中该属性的值。 以前，当同一SKU和多行可用时导入产品价格，并且 `store_view_code` 导致默认和“所有存储”视图范围的价格不准确。

<!-- ACP2E-1632 -->

* 商家现在可以从管理员将GIF图像添加到产品的图像库。 以前，Adobe Commerce会显示此错误：  `imagecolorsforindex(): Argument #2 ($color) is out of range`.

<!-- ACP2E-1709 -->

* 已添加检查以处理未定义数组键导致的错误。 以前，在生成声明性架构白名单期间出错。

<!-- ACP2E-1749 -->

* Adobe Commerce现在返回自定义日期的有效结果 `01/01/1970`. 以前，自定义属性返回此错误： `Invalid input datetime format of value '1/01/1970`. [GitHub-37274](https://github.com/magento/magento2/issues/37274)

<!-- AC-6507 -->

* `routes` 使用片段的查询现在会按预期返回类别信息。 以前，类别页面上发生内部服务器错误。 [GitHub-35906](https://github.com/magento/magento2/issues/35906)

<!-- ACP2E-1772 -->

* 的问题 `cataloginventory_stock` 部分重新索引过程已得到解决，索引器性能已得到改进。 以前，库存和产品类别无法准确更新。

<!-- AC-8226 -->

* 现在，当产品所属的类别已移至新父级时，Adobe Commerce会为产品生成301重定向。 [GitHub-37039](https://github.com/magento/magento2/issues/37039)

### 目录规则

<!-- ACP2E-1579 -->

* 现在，目录规则可按预期方式在多网站环境中应用。

### 优惠券

<!-- ACP2E-1551 -->

* 购物者现在可以使用由同一购物车价格规则生成的两个单独的自动生成优惠券代码。 此 `Uses per Coupon` 字段现已启用，前提是优惠券类型已选择 `Auto` (与优惠券类型类似=`Specific Coupon`) 。 如果代码不同，这又使购物者可以将多个优惠券代码应用于相同的购物车价格。

<!-- ACP2E-1496 -->

* 现在，当购物者的一次性优惠券应用于的订单被取消时，该优惠券值会按预期恢复。

<!-- ACP2E-1195 -->

* 此 `GET V1/coupons/<couponId>` 现在，端点会像对自动生成的优惠券一样，返回手动创建的优惠券的完整预期响应。  以前，某些字段被忽略(例如， `usage_limit`， `usage_per_customer`、和 `created_at`)。

### cron

<!-- AC-7987 -->

* 管理员用户现在可以查看 `bin/magento cron:run` 当前正在执行进程。 当前正在运行的进程的标题现在列出了组和作业名称。 [GitHub-34321](https://github.com/magento/magento2/issues/34321)

### 客户

<!-- AC-6748 -->

* Adobe Commerce现在显示 **[!UICONTROL Date of Birth]**， **[!UICONTROL Tax/VAT Number]**， **[!UICONTROL Gender]**， **[!UICONTROL Telephone]**， **[!UICONTROL Company]**、和 **[!UICONTROL Fax]** “编辑客户”页面上的字段。 [GitHub-36196](https://github.com/magento/magento2/issues/36196)

### 电子邮件

<!-- ACP2E-1529 -->

* 现在，当“分配公司管理员”电子邮件中包含 `CMS Block URL` 变量。

<!-- AC-2903 -->

* 客户电子邮件地址现在可以包含变音符号。 以前，前端验证禁止创建电子邮件地址中包含变音符号的用户。 [GitHub-12075](https://github.com/magento/magento2/issues/12075)

<!-- ACP2E-1682 -->

* 库存和价格警报电子邮件现在会根据为网站默认商店视图配置的语言进行翻译。 以前，不翻译这些电子邮件。

<!-- ACP2E-1571 -->

* `POST V1/order/notify-orders-are-ready-for-pickup` 现在会发送一封电子邮件，提醒客户只有在订单就绪后才能提货。 现在，仅当无一例外履行了请求时，才会触发电子邮件。

### 框架

<!-- ACP2E-1492 -->

* 已对订单实施互斥，以防止在并发请求更新期间出现争用情况。 以前，订单取消的并发请求（争用条件）会在 `inventory_reservation` 表格。

<!-- ACP2E-1381 -->

* 此 `populateWithArray` 函数现在将对象属性正确转换为Snake大小写，使其与 `AbstractModel` Getter和Setter。 以前，当数据属性名称一行包含多个大写字母时，Snake大小写格式不正确。

<!-- ACP2E-1522 -->

* 中的自动增量值 `catalog_product_entity_varchar` 现在，表格会在保存产品后正确递增。 以前，此值会增加十。

<!-- ACP2E-1701 -->

* 当您尝试刷新JavaScript/CSS缓存时，Adobe Commerce不再引发此文件系统异常：  `No such file or directory`.

<!-- ACP2E-1358 -->

* 的值 `value_id` 在 `customer_entity_int` 现已正确递增。 执行更新查询，而不是 `insert on duplicate key update` 更新包含这些属性的实体时。 因此，在EAV模型中使用的自动增量列现在以线性方式增长。 以前，对列的自动递增过程由于插入查询失败而跳过值。 [GitHub-28387](https://github.com/magento/magento2/issues/28387)

<!-- AC-8462 -->

* 删除不必要的空格 `id` 不需要它的属性。 (此错误是由Adobe Commerce 2.4.6代码更改引入的。)

<!-- AC-7923 -->

* 当存储处于单存储模式时，存储代码不再出现在存储URL中。 [GitHub-36831](https://github.com/magento/magento2/issues/36831)

<!-- AC-7988 -->

* 已对以下内容进行了细微更新 `around` 插件。 [GitHub-31443](https://github.com/magento/magento2/issues/31443)

<!-- AC-7989 -->

* 色板 `Helper` 已进行重构，以删除误导性的导入别名。 [GitHub-31373](https://github.com/magento/magento2/issues/31373)

<!-- AC-8708 -->

* 管理员用户现在可以删除或重命名 `sitemap.xml` 文件按预期显示。 以前，管理员用户可以从管理员中删除文件，但该文件仍保留在文件系统中。  [GitHub-37468](https://github.com/magento/magento2/issues/37468)

<!-- ACP2E-1747 -->

* 当已应用优惠券的订单的付款失败时，不再将优惠券标记为使用。 现在，队列消息会按照使用者启动时发布消息的顺序进行处理。 以前，从队列中提取第一条消息只是为了检查消息是否已排队，之后被拒绝，这导致了最后处理第一条消息。

<!-- ACP2E-1627 -->

* 当用户尝试打印传送标签时，Adobe Commerce不再在日志文件中引发异常。 以前，如果扩展修改包含附件的响应标头，则系统在日志文件中引发异常。

<!-- AC-7986 -->

* 添加了对于更多HTML类的支持 `elements.xsd`. [GitHub-36891](https://github.com/magento/magento2/issues/36891)


### 常规修复

<!-- ACP2E-1508 -->

* 在以下情况下请求类别的RSS馈送期间不再发生错误： **[!UICONTROL RSS Feed Top Level Category]** 已启用。 以前，浏览RSS新闻源类别页面会导致Elasticsearch `CRITICAL` 当出现以下情况时，日志文件出现错误 **[!UICONTROL RSS Feed Top Level Category]** 已启用。

<!-- ACP2E-1490 -->

* 现在已为保存正确的值 `gws_store_groups` 在用户角色创建期间更改角色范围时。 以前，当角色范围被选定为 `All`， `gws_store_groups` 值在用户创建期间保存为null，但在角色编辑期间保存为null。 此外，如果将角色范围选为 `Custom`，然后 `gws_store_groups` 值始终保存为null。

<!-- ACP2E-1446 -->

* 现在，通过单击“管理员登录”页面上的“管理员重置密码”链接，可以在以下情况下访问重置密码页面： **[!UICONTROL Add Store Code to Urls]** 设置已启用。 管理员重置密码链接以前打开了登录页面或404页面。

<!-- ACP2E-1274 -->

* 现在，管理员统计信息仪表板中的日期范围是根据在配置设置中设置的时区来计算的，然后转换为UTC以从数据库中提取数据。

<!-- ACP2E-1665 -->

* 当您过滤存储视图，然后单击 **[!UICONTROL Save]** 在管理员上 **[!UICONTROL Content]** > **[!UICONTROL Hierarchy]**. 以前，单击 **[!UICONTROL Save]** 已刷新页面，但上下文已丢失，并且选定的商店视图不再显示。

<!-- ACP2E-1631 -->

* 单击 **[!UICONTROL Send invitation]** 按钮（管理员） **[!UICONTROL Marketing]** > **[!UICONTROL Private sales]**  > **[!UICONTROL Invitation]**)现在会连同表单密钥一起提交POST请求，并成功发送邀请。 以前，当您单击此按钮时，HTTPPOST方法和表单键都不存在。

<!-- ACP2E-1608 -->

* 现在可以使用AWS S3将零字节文件成功复制到远程存储。

<!-- AC-7402 -->

* 现在，在为商店ID与网站ID不匹配的其他网站创建客户时，管理员用户可以从管理员中添加新的客户地址。 以前，Adobe Commerce会显示以下弹出消息： `Something went wrong`. [GitHub-36582](https://github.com/magento/magento2/issues/36582)

<!-- AC-8247 -->

* CMS块编辑器页面现在显示正确的构件 `block_id` 值。  [GitHub-29644](https://github.com/magento/magento2/issues/29644)

### 礼品卡和包装

<!-- ACP2E-1586 -->

* 现在，可以正确计算自定义礼品卡金额的小计。

<!-- ACP2E-1350 -->

* 现在，使用多个地址结账时可正确应用礼品卡。 以前，多地址装运的礼品卡金额应用不正确，导致礼品卡金额无效。

<!-- ACP2E-1341 -->

* 现在，模拟将在以下期间启动： `send()` 在以下期间完成模拟后调用： `getInfoBlockHtml()` 调用，且不会记录任何错误。 以前， `system.log` 文件被此错误淹没： `main.ERROR: Environment emulation nesting is not allowed`. [GitHub-35603](https://github.com/magento/magento2/issues/35603)

<!-- ACP2E-1612 -->

* 您现在可以使用 `updateCartItems` 变异以更新购物车中的礼品卡。 以前，仅购物车中的卡数量可以通过此突变进行更新。

<!-- ACP2E-1669 -->

* 礼品包装现已按预期包含在基于合并购物车的报价中。 以前，已成功合并礼品消息，但无法封装选定内容。

<!-- AC-7530 -->

* 此 `addProductsToCart` 查询现在已成功将礼品卡添加到购物车。 以前，此查询需要礼品卡收件人姓名，但会返回发件人姓名。 Adobe Commerce引发此错误： `Please specify a recipient name`. [GitHub-36665](https://github.com/magento/magento2/issues/36665)

### Google ReCAPTCHA

<!-- ACP2E-1539 -->

* 现在，结账工作流中的Google reCAPTCHA可按预期用于支票、汇票和自定义支付方法。

<!-- ACP2E-1311 -->

* 在加载Adobe Commerce ReCAPTCHA复选框之前，无法再提交Google表单。

<!-- ACP2E-1338 -->

* reCAPTCHA构件现在位于 **[!UICONTROL Place Order]** 按钮。 以前，小组件显示在页面顶部。

### Google Tag Manager

<!-- ACP2E-1520 -->

* Google Tag模块现在可将正确的数据推送到Data Layer。 以前，页面展示数据不会推送到数据层。

### GraphQL

<!-- ACP2E-1584 -->

* 类型的产品属性 `DateTime` 现在映射到 `FilterRangeTypeInput` 在产品查询中筛选。 以前，这些属性映射到 `FilterMatchTypeInput`. 作为此更改的结果，查询将过滤 `DateTime` 属性需要 `from` 和 `to` 值而不是匹配值。

<!-- ACP2E-1552 -->

* 此 `customer` 现在，当按商店ID进行筛选时，突变仅会按预期返回与特定商店视图相关的客户评论。

<!-- AC-7544 -->

* 此 `categories` 当满足以下条件时，查询不再返回错误 `items.redirect_code` 响应值包含null值。 [GitHub-36675](https://github.com/magento/magento2/issues/36675)

<!-- ACP2E-1465 -->

* 现在，在完全缓存清理后，基于规则的相关产品会按预期在GraphQL响应中加载。 以前，没有为请求的实体加载负责基于规则的匹配的product EAV属性，尽管在重新加载店面产品页面后加载了这些属性。

<!-- ACP2E-1486 -->

* 此 `changeCustomerPassword` 在成功重置密码后，突变现在会按预期触发电子邮件。

<!-- ACP2E-1494 -->

* `urlResolver` 和 `route` 现在，当满足以下条件时，查询将返回结果： `Target Path` 的URL重写是一个绝对URL。 以前， `urlResolver` 使用查询检索重定向数据时返回了NULL。

<!-- AC-7979 -->

* 此 `products` 查询现在返回正确的标签。 [GitHub-29635](https://github.com/magento/magento2/issues/29635)


<!-- ACP2E-1315 -->

* 此 `categoryList` 查询现在返回填充的 `product` 的部分 `options` 块以按预期捆绑产品的子产品。  以前，不会返回有关捆绑产品子产品的信息。

<!-- AC-7114 -->

* 此 `route` 现在，查询可按预期返回类别和产品的路由，而不会出现内部服务器错误。 [GitHub-36544](https://github.com/magento/magento2/issues/36544)

<!-- ACP2E-1652 -->

* 此 `products` 现在可获取查询 `url_key` 选择多个类别时的值。

<!-- LYNX-17  16-->

* `product` 现在，查询仅返回分配给指定共享目录之产品的聚合。 以前，未分配给共享目录的产品聚合数据会显示在分层导航中。

<!-- AC-7974 -->

* 交易名称已添加到New Relic GraphQL交易。 [GitHub-36874](https://github.com/magento/magento2/issues/36874)

<!-- AC-6680 -->

* 此 `OptionValueProvider` 类 `get()` 方法现在会根据给定的返回一个属性选项值 `option_id` 如预期。 以前，它会返回错误。 [GitHub-35910](https://github.com/magento/magento2/issues/35910)

<!-- AC-6745 -->

* 此 `searchProducts` 查询现在返回所有可用的聚合（过滤器）及其正确翻译的标签。 以前，价格和类别聚合标签无法按预期进行转换。 [GitHub-36140](https://github.com/magento/magento2/issues/36140)

<!-- AC-6666 -->

* 您现在可以使用片段 `ProductCard` 查询时 `related_products`， `upsell_products`、和  `crosssell_products` 日期 `ProductInterface`. [GitHub-29769](https://github.com/magento/magento2/issues/29769)

<!-- AC-7014 -->

* 此 `products` query现在会按保存顺序返回相关、追加销售和交叉销售产品。 [GitHub-36461](https://github.com/magento/magento2/issues/36461)

<!-- AC-8573 -->

* GraphQL查询现在会返回按位置排序的相关产品数据。 [GitHub-33010](https://github.com/magento/magento2/issues/33010)

<!-- AC-8542 -->

* `category_url_path` 已添加至 `ProductAttributeFilterInput`，支持在单个查询中请求某个类别的所有产品。 [GitHub-32460](https://github.com/magento/magento2/issues/32460)

<!-- AC-821 -->

* 更正了以下错误：设置当前存储在GraphQL中的方法是在处理验证的方法之前执行的。 [GitHub-31336](https://github.com/magento/magento2/issues/31336)

### 图像

<!-- ACP2E-1353 -->

* 管理员收藏夹图标上传表单现在支持 `.ico` 文件类型。 [GitHub-34858](https://github.com/magento/magento2/issues/34858)

### 导入/导出

<!-- ACP2E-1565 -->

* 当缺少产品映像时，产品导入过程不再中断。 以前，在使用CSV文件导入第三方服务期间缺少产品图像时，Adobe Commerce会显示此错误： `Maximum error count has been reached or a system error is occurred!`.

<!-- ACP2E-1476 -->

* 在启用了B2B的部署中，客户从客户网格导出的性能已得到改进。

<!-- ACP2E-1391 -->

* 当中的属性值为时，产品导入过程不再引发验证错误 `configurable_variations` 列中包含逗号。

<!-- ACP2E-1377 -->

* 已从导出过程中排除解码。 导入后，CSV导出文件文本保持不变。 因此，重新导入后，描述不会更改。 以前，在导出和导入产品后，页面生成器编辑器中会删除HTML标记。

<!-- ACP2E-1451 -->

* 作为环境变量添加的非默认配置（网站或商店范围）不再中断 `app:config:import` 包含递归错误的进程。

<!-- ACP2E-1569 -->

* 导入后，处于保存时更新模式的目录搜索和价格索引符将不再失效。 以前，在导入新产品和现有产品时，Elasticsearch索引器文档版本会更改版本。

<!-- ACP2E-1482 -->

* 产品报告现已导出到 `var` 目录。  以前，这些报告导出到文档根目录，在云实例中为只读目录。

<!-- ACP2E-1736 -->

* 清空的多选客户地址字段不再中断或停止导出过程。

### 索引

<!-- ACP2E-1697 -->

* 在未将规则分配给所有网站的部署中，目录规则产品索引器的性能已得到改进。

<!-- ACP2E-1401 -->

* 在索引器设置为时创建自定义产品类型 **[!UICONTROL Update on schedule]** 不再导致索引更新 `cron` 任务失败。 [GitHub-36471](https://github.com/magento/magento2/issues/36471)

<!-- ACP2E-1574 -->

* 由于目录权限索引而导致的店面产品详细信息页面上的显示问题已得到解决。 以前，Adobe Commerce先清除索引表，然后在完全索引期间重新编入索引 `catalogpermissions_product` 或 `catalogpermissions_category` 索引过程。 在完成重新索引之前，目录权限在店面中无法按预期工作。

<!-- AC-6816 -->

* `bin/magento indexer:reindex customer_grid` 当客户网格包含新创建的自定义客户属性时，不再因MySQL错误而失败。 [GitHub-36233](https://github.com/magento/magento2/issues/36233)

<!-- AC-8076 -->

* 更改多个索引器的索引器模式（即质量操作索引器模式更改）现在仅在当前模式与正在应用的模式不同时更改索引器的模式。 这通过防止不必要地访问数据库而提高了性能。 [GitHub-36823](https://github.com/magento/magento2/issues/36823)

<!-- AC-6934 -->

* 改进了使用许多属性选项索引产品。 [GitHub-36386](https://github.com/magento/magento2/issues/36386)

### 基础架构

<!-- ACP2E-1462 -->

* 当格式错误的HTTP请求发送到服务器时，Adobe Commerce在显示的错误消息中不再包含指向服务器根目录的完整路径。 现在，只有字符串才会传递到 `explode` 方法作为第二个参数。

<!-- AC-8384 -->

* `restricted_classes.php` 已替换 `Zend_Validate_File_Upload`. 以前，在上传导入文件的过程中，验证器崩溃，该文件的值大于中配置的值 `php.ini `. [GitHub-37281](https://github.com/magento/magento2/issues/37281)

<!-- ACP2E-1146 -->

* 现在，由数据源模型提供并使用设置数据修补程序（通常来自第三方模块）安装的属性选项可用于客户区段规则。 以前，此组合不会返回与配置的区段匹配的客户列表。

<!-- AC-7093 -->

* 电子邮件模板引擎现在可以正确处理某些嵌套指令(例如， `{{if}}{{depend}}...{{/depend}}{{/if}}`)。 [GitHub-36438](https://github.com/magento/magento2/issues/36438)

<!-- AC-7920 -->

* `product` 现在，具有聚合数据的查询会返回布尔类型产品属性的正确标签值。 [GitHub-29123](https://github.com/magento/magento2/issues/29123)

<!-- AC-2618 -->

* 已将乌克兰区域添加到 `directory_country_region` 表格。 [GitHub-35187](https://github.com/magento/magento2/issues/35187)

<!-- https://github.com/magento/magento2/pull/29173 -->

* 合并时，CSS文件不再损坏 `var/tmp` 和 `pub/static` 位于不同的文件系统上，并且 **[!UICONTROL CSS Merging Enabled]** 已启用。 临时文件是在与目标文件相同的静态目录中创建的，以确保两个文件位于同一文件系统上。 因此，对其重命名的调用是原子调用。 [GitHub-29172](https://github.com/magento/magento2/issues/29172)

<!-- https://github.com/magento/magento2/pull/36769 -->

* 调用成员函数 `getId()` 不再触发异常。

<!-- https://github.com/magento/magento2/pull/34092 -->

* 现在在设计主题配置处理器中对阵列类型强制进行类型检查。  [GitHub-34440](https://github.com/magento/magento2/issues/34440)

### 记录

<!-- ACP2E-1385 -->

* 管理员用户现在可以在管理员的批量操作日志部分中查看由集成创建的批量操作的日志。

### 登录

<!-- ACP2E-1521 -->

* 在一个浏览器中重置密码并随后通过其他浏览器登录不会再导致异常。 [GitHub-36447](https://github.com/magento/magento2/issues/36447)

<!-- ACP2E-1332 -->

* 现在，在按预期激活帐户后，客户会被重定向到登录页面。 以前，客户会自动登录。

### 订购

<!-- ACP2E-1514 -->

* 首次从管理员使用一次性自定义价格生成订单时，购物者无法再使用自定义价格订购产品。 以前，如果订单包含具有自定义价格的项目，则此自定义价格适用于通过再订购功能下达的其他订单。

<!-- ACP2E-1421 -->

* 购物者不能再在订单页面上保存不正确的订单状态。 发运项目时，订单状态不再从“完成”更改为“处理”。 以前，Adobe Commerce在购物者输入评论后保存订单状态之前不会检查当前订单状态。 [GitHub-36562](https://github.com/magento/magento2/issues/36562)

<!-- ACP2E-1387 -->

* 当正在返回的可配置产品被删除时，Adobe Commerce不再在storefront订单返回页面上引发错误。 Adobe Commerce以前记录此错误： `report.CRITICAL: Error: Call to a member function getShipmentType() on null in magento2ee/app/code/Magento/Rma/view/frontend/templates/return/create.phtml:52`.

<!-- ACP2E-1367 -->

* 销售订单网格现在会按预期与所有订单异步同步。 [GitHub-36562](https://github.com/magento/magento2/issues/36562)

<!-- ACP2E-1197 -->

* 现在，订单页面的客户订单部分中的按购买日期过滤功能可按预期工作。 以前，当向方法提供相同时区时，时区转换逻辑引发错误，从而导致JavaScript错误。

<!-- ACP2E-1294 -->

* Adobe Commerce功能板现在在首次加载时显示正确的订单统计数据。 以前，仪表板显示不正确的订单信息，但一旦更新了时间段，则会显示正确的信息。

<!-- ACP2E-1762 -->

* 现在，管理员用户在从管理员创建新订单期间选择商店视图后，会按预期重定向到订单页面。

<!-- ACP2E-1418 -->

* 现在，订单REST API按顺序返回有关可配置和简单产品的信息，而不管简单产品的库存状态如何。 仅当所选项目（产品）有库存或可供销售时，管理员用户现在才可以下订单。 以前，此API仅返回有关已有产品的信息。

<!-- AC-7901 -->

* 在启用了免运费且发运价格含税且计税是在折扣后应用时，贷项通知单页面不再崩溃。 此前，Adobe Commerce抛出 `Division by zero` 例外。 [GitHub-36800](https://github.com/magento/magento2/issues/36800)

<!-- AC-1342 -->

* 使用 `rest/V1/orders/{id}/comments` 端点在不提供订单状态的情况下发布有关订单的注释不再影响订单的显示。 以前，订单状态在报表中记录为NULL。 `sales_order` 和 `sales_order_grid` 表，并且“我的订单”页或“管理员订单”网格均不显示订单。 [GitHub-34180](https://github.com/magento/magento2/issues/34180)

<!-- ACP2E-1597 -->

* 现在，如果发票、发运和贷项通知单包含的ID与订单ID不同，则可以成功地将它们及其相关订单一起从存档中移回。 以前，如果将订单移至存档并恢复，则当ID号不匹配时，该订单中会缺少发票、发运、贷项通知单记录。 [GitHub-36847](https://github.com/magento/magento2/issues/36847)

### 页面生成器

<!-- ACP2E-1564 -->

* 从页面生成器轮播向购物车添加产品时，不再重复页面中的项目数量，因为页面中有两个不同的小组件显示相同的产品。

<!-- ACP2E-1542 -->

* Page Builder不再添加 `tabindex` 超链接标记的HTML属性 `a` 当您编辑超链接时，请保存模板。

<!-- ACP2E-1444 -->

* 产品小部件和页面生成器预览现在可正确处理HTML特殊字符。 以前，产品小组件无法正确显示包含 `&` 字符。

<!-- ACP2E-1441 -->

* 现在，当您在预览模式下选择并更新完整内容块时，Page Builder文本元素内容会按预期更新。

<!-- ACP2E-1362 -->

* 现在，可以将文本从一个页面生成器文本编辑器复制并粘贴到另一个页面生成器文本编辑器，操作方式符合预期。 以前，您尝试粘贴文本的页面无法保存，Adobe Commerce显示此控制台错误： `[ERROR] Page Builder was rendering for 5 seconds without releasing locks.`.

<!-- ACP2E-1568 -->

* 页面生成器 `column-block` 在旧版Page Builder中创建的内容类型现在可以正确显示。

<!-- ACP2E-1234 -->

* 在从管理员创建产品期间，对产品元数据说明的过滤功能已得到改进。 以前，如果启用了Page Builder，则会根据默认设置生成产品元数据描述` {{name}} {{description}}` 面具。 默认的产品元描述蒙版现在由以下内容组成 `{{name}}`. [GitHub-36107](https://github.com/magento/magento2/issues/36107)

<!-- ACP2E-1758 -->

* 添加不含内容的动态块不再触发错误。

<!-- AC-6645 -->

* 解决了在页面生成器内容中显示列时出现的问题。 以前， `column-line` 内容类型内容未呈现。 [GitHub-3949](https://github.com/magento/pwa-studio/issues/3949)

### 付款

<!-- ACP2E-1215 -->

* 当购物者没有保管库令牌时，管理签出工作流中不再显示保管库付款方法选项。 [GitHub-36273](https://github.com/magento/magento2/issues/36273)

<!-- ACP2E-1303 -->

* 此 **[!UICONTROL Venmo]** 启用PayPal按钮后，按钮现在可以隐藏。 以前， **[!UICONTROL Venmo]** 无法从购物车、迷你购物车、产品详细信息或结帐页面中删除按钮。

<!-- AC-7105 -->

* 成功完成Paypal Payflow链接支付后，购物者现在会被重定向到成功页面。 [GitHub-36520](https://github.com/magento/magento2/issues/36520)

#### Braintree

<!-- ACP2E-1229 -->

* 当购物者更新其帐单地址时，不再在结账工作流中自动取消选择“Braintree保管库付款方式”选项。 以前，当购物者取消选择 **[!UICONTROL My billing and shipping address are the same]** 按钮。


<!-- BUNDLE-3248 -->

* 解决了从Adobe Commerce 2.4.5-p2升级后通过Braintree签出PayPal时出现的问题。 [GitHub-37242](https://github.com/magento/magento2/issues/37242)

<!-- BUNDLE-3257 -->

* 现在，Google支付模式弹出运送地址字段中的地址可按预期呈现电话号码。 以前，电话号码缺失。

<!-- BUNDLE-3228 -->

* 现在，当Braintree响应包含的空值时，订单成功地Braintree `threeDSecureInfo/eciFlag`. 以前，当此值为空时，在签出期间发生PHP错误。

<!-- BUNDLE-3243 -->

* 当购物者在迷你购物车中使用Adobe Commerce Pay结帐时在订单审核页面上应用优惠券时，Google不再引发错误。 以前，购物者被重定向到404页。

<!-- BUNDLE-3245 -->

* 购物者现在可以使用Braintree支付和Adobe Commerce 2.4.6（具有不可见的ReCAPTCHA v2或v3）完成结账。 [GitHub-37241](https://github.com/magento/magento2/issues/37241)

<!-- BUNDLE-3241 -->

* 购物者不能再点击 **[!UICONTROL PayPal]** 按钮购买可配置产品，而无需先选择所需的选项。 以前，购物者可以点击 **[!UICONTROL PayPal]** 按钮，随后重定向回产品页面，并出现错误：

<!-- BUNDLE-3148 -->

* 此 **[!UICONTROL PayPal]** 按钮现在按预期显示在购物车和迷你购物车页面上。 以前，此按钮不显示在购物车页面上，并且会在迷你购物车页面上重复。

<!-- BUNDLE-3244 -->

* 现在，在部署中，商家在其Braintree帐户中为同一货币拥有两个不同的商家帐户ID，则可以在正确的帐户中按预期捕获部分开票的订单。

<!-- BUNDLE-3250 -->

* 在以下情况下，Adobe Commerce不再为由Braintree支付的订单创建第二张部分发票时引发错误 **[!UICONTROL Enable Vault for Card Payments]** 已启用。 以前，当商家尝试创建第二张发票时，Adobe Commerce会引发以下错误： `Your payment could not be taken. Please try again or use a different payment method. Payment method token is invalid`.

### 促销活动

<!-- ACP2E-1290 -->

* 的影响 **[!UICONTROL Fixed amount discount for whole cart]** 价格规则，当与 **[!UICONTROL Apply to shipping amount]** 规则，现在按预期在产品和运费之间按比例分配。 以前，折扣计算不正确。

<!-- ACP2E-1300 -->

* 此 **[!UICONTROL Discard Subsequent Rules]** 设置现在可按预期应用。 启用此设置后，其他低优先级的规则只能应用于其他产品。 [GitHub-35707](https://github.com/magento/magento2/issues/35707)

### 报表

<!-- ACP2E-1541 -->

* 订单报表(**[!UICONTROL REPORTS]** > **[!UICONTROL Sales]** > **[!UICONTROL Orders]**)现在，当使用非默认货币的商店生成订单时，包含正确的订单值。 以前，此报表包含不正确的值。 [GitHub-36742](https://github.com/magento/magento2/issues/36742)

<!-- ACP2E-1477 -->

* 为了清楚起见，修订了销售订单报告表中的误导性信息。

<!-- ACP2E-1435 -->

* 管理员用户现在可以搜索电子邮件中包含的记录  `+` （加）弃用购物车报表页面中的符号。 [GitHub-36560](https://github.com/magento/magento2/issues/36560)

<!-- AC-7394 -->

* 现在，从Commerce管理员中禁用GraphQL后，New Relic交易名称可正确显示。 [GitHub-36112](https://github.com/magento/magento2/issues/36112)

### 奖励

<!-- ACP2E-1473 -->

* 奖励积分余额更新电子邮件通知现在会考虑当前商店上下文。 以前，奖励积分余额更新电子邮件使用默认存储区的配置设置。

<!-- ACP2E-1329 -->

* 现在，创建贷项通知单后，奖励积分可以退款。 以前，商家在创建贷项通知单后无法退款奖励积分，并且订单状态保持不变 `Completed`，不是 `Closed`.

### RMA

<!-- ACP2E-1230 -->

* 此 **[!UICONTROL Enable RMA]** 现在，单个产品级别的属性会遵循商店RMA设置配置。 以前，无论应用商店配置设置是什么，在添加产品时，此设置都会默认处于关闭状态。

### Search {#search-heading}

<!-- ACP2E-1499 -->

* 搜索结果现在会按预期显示基于属性搜索权重的相关结果。

<!-- AC-7505 -->

* 下的信息性文本 `Search Weight` 属性的 `Storefront Properties` 管理员输入字段 **[!UICONTROL Stores]** > **[!UICONTROL Attributes]** > **[!UICONTROL Product]** 现在描述可能的值。 [GitHub-36646](https://github.com/magento/magento2/issues/36675)

### 配送

<!-- AC-7003 -->

* 此 **[!UICONTROL Shipping Policy]** 在以下情况下，文本框现在显示在管理员商店视图范围内  **[!UICONTROL Apply custom Shipping Policy]** 已启用并且自定义配送策略可用。 [GitHub-36425](https://github.com/magento/magento2/issues/36425)

<!-- AC-7550 -->

* 此 `cart` 查询现在返回 `selected_shipping_method` 与以下值之一匹配的值： `available_shipping_methods` 载波和方法代码。 以前，当其中一个选定的配送方式包含下划线时，这些承运人/方式代码不匹配。 [GitHub-36606](https://github.com/magento/magento2/issues/36606)

<!-- AC-2556 -->

* 此 `setShippingAddressesOnCart` 当street数组中的第二个值为null时，突变不再引发错误。 以前，会引发以下异常： `The address failed to save. Verify the address and try again`. [GitHub-35160](https://github.com/magento/magento2/issues/35160)

### 暂存

<!-- ACP2E-1501 -->

* 在启用了Google Analytics内容实验的情况下，添加或编辑类别的计划更新时，不再发生JavaScript错误。

<!-- ACP2E-1344 -->

* 商家现在可以在查看或编辑类别现有计划更新后成功保存该更新。 以前，Adobe Commerce在中引发错误 `system.log`.

<!-- ACP2E-1596 -->

* 现在，在应用计划更新且购物车中包含之前添加的产品时，可下载链接会按预期保留。 以前，可下载的链接从客户的“我的帐户（我的可下载产品）”页面和“管理员订单”视图页面中消失。

<!-- ACP2E-1458 -->

* 现在，在应用支持产品的暂存更新后，产品可按预期显示在店面上。 以前，产品在管理员中启用，但在目录清单的索引器模式设置为“按计划更新”时，产品在店面类别中不可见。 完全重新索引修复了问题。

<!-- ACP2E-1647 -->

* 此 `staging.synchronize_entity_period` 中的使用者队列 `magento_bulk` 当没有要处理的暂存更新时，表不再增加。 以前，当 `cron` 配置为每分钟运行一次，即有一条与 `staging.synchronize_entity_period` 每分钟都将使用者添加到此表。

<!-- ACP2E-1415 -->

* 在保存其他产品时，为产品创建计划更改时，Adobe Commerce不再引发SQL错误。  以前，Adobe Commerce会显示此错误：  `The product with the SKU "%1" couldn't be added to the current update`.

### Target规则

<!-- ACP2E-1438 -->

* 现在，Target规则可正确用于不同的存储视图。 以前，由于相关产品规则缓存存在问题，导致在多商店部署中无法显示推荐的产品。

### 税金

<!-- ACP2E-1527 -->

* 您现在可以按预期在“税则”编辑页中编辑税率国家（地区）的值。 以前，不会保存从该页面所做的编辑。

<!-- ACP2E-1143 -->

* 现在，在更新配送方式时，购物车估算区域中的税额会按预期刷新。 以前，购物者在结帐期间更改国家/地区后，不会更新税率。

<!-- AC-8227 -->

* 此 `tax class` 现在，在商店视图范围内为现有可配置产品创建新变体时，新创建的简单产品的值设置为父产品的值。 以前，此值设置为none。 因此，这些产品在购物车中没有添加任何税款，而且客户缺税。 [GitHub-37180](https://github.com/magento/magento2/issues/37180)

### 测试

<!-- AC-7098 -->

* 中的大型阵列存在性能问题 `TableNameSniff` 已解决。

<!-- ACP2E-1690 -->

* 编辑礼品注册表功能的集成测试不再依赖现有的实体ID。 所有必需的数据现在都通过夹具获得。 以前， `\Magento\GiftRegistry\Controller\Index\EditPostTest` 失败。

<!-- ACP2E-1748 -->

* `CollectionTest::testGetDateRangeFirstPart()` 现在计入夏令时。

### UI

<!-- ACP2E-171 -->

* 现在，当客户注册表单包含多选客户属性时，该表单会按预期加载。 以前，Adobe Commerce引发此异常： `[2023-03-05T05:57:40.032602+00:00] report.CRITICAL: Exception: Deprecated Functionality: explode(): Passing null to parameter #2 ($string) of type string is deprecated in /magento2ee/app/code/Magento/CustomAttributeManagement/Block/Form/Renderer/Multiselect.php on line 53 in /lib/internal/Magento/Framework/App/ErrorHandler.php:62`. [GitHub-37189](https://github.com/magento/magento2/issues/37189)

<!-- ACP2E-1602 -->

* 现在，包含单引号的欢迎消息在店面中正确呈现，并且没有控制台错误。 以前，如果欢迎消息包含单引号，则在店面呈现期间不会加载欢迎消息。 Adobe Commerce还显示控制台错误。

<!-- ACP2E-1369 -->

* 当您尝试在“管理员顺序”页面中的评论历史记录和返回之间快速更改视图时，Adobe Commerce不再引发错误。 以前，Adobe Commerce会显示以下一般错误： `A technical problem with the server created an error`.

<!-- ACP2E-1374 -->

* 如果管理员用户拥有的权限仅限于一个网站，则他们现在可以将特定于网站的产品属性集更新为 `all stores view` 范围。

<!-- ACP2E-1648 -->

* 现在，放大镜小组件会按预期在产品页面上加载。

<!-- ACP2E-1216 -->

* 多行可自定义选项现在可以在发票、发运和贷项通知单PDF文档中正确呈现。 以前，多行文本前面会出现意外的分页符，如果文本超出页面，则文本会被截断。

<!-- AC-7402 -->

* 现在，在为商店ID与网站ID不匹配的其他网站创建客户时，管理员用户可以从管理员中添加新的客户地址。 以前，Adobe Commerce会显示以下弹出消息： `Something went wrong`. [GitHub-36582](https://github.com/magento/magento2/issues/36582)

<!-- ACP2E-1529 -->

* 现在，当“分配公司管理员”电子邮件中包含 `CMS Block URL` 变量。

<!-- ACP2E-1775 -->

* 与在订单详情页面上提交评论相关的错误消息，现在可提供更多信息。 以前，当购物者单击 **[!UICONTROL Submit comment]** 在不更改订单状态或在注释区域输入文本的情况下，Adobe Commerce会显示以下消息： `The comment is missing. Enter and try again`.

<!-- ACP2E-1659 -->

* 现在，日历图标按预期显示在管理员的日期范围字段中 **[!UICONTROL Marketing]** > **[!UICONTROL Cart Price Rules]** 为一个字段选择日期后。 以前，为一个字段选择日期后，日历图标不再显示在其他字段中，并且Adobe Commerce会显示占位符文本。 [GitHub-36499](https://github.com/magento/magento2/issues/36499)

<!-- ACP2E-1717 -->

* 现在已成功加载包含多选字段的客户注册表单。 以前，此表单包含多选字段时未加载，并触发了以下错误：  `report.CRITICAL: Exception: Deprecated Functionality: explode(): Passing null to parameter #2 ($string) of type string is deprecated in /magento2ee/app/code/Magento/CustomAttributeManagement/Block/Form/Renderer/Multiselect.php on line 53 in /lib/internal/Magento/Framework/App/ErrorHandler.php:62`. [GitHub-37189](https://github.com/magento/magento2/issues/37189)

<!-- AC-7092 -->

* 在产品库全屏模式下单击视频缩略图时，现在会按预期显示视频。 以前，不显示视频，并且浏览器控制台显示JavaScript错误。 [GitHub-36456](https://github.com/magento/magento2/issues/36456)

<!-- AC-7806 -->

* 在版权行中添加了一个变量，该变量每年自动更新。 [GitHub-36776](https://github.com/magento/magento2/issues/36776)

<!-- AC-8441 -->

* 现在，产品页面上的图像滑块在移动设备视图中可按预期工作。 以前，仅成功显示第一个图像。 [GitHub-37232](https://github.com/magento/magento2/issues/37232)

### URL重写

<!-- ACP2E-1737 -->

* 现在，当从CSV文件导入新类别时，将为所有存储视图生成类别URL重写。

<!-- ACP2E-1700 -->

* 产品URL后缀和类别URL后缀配置现在与 `url_rewrite` 表格。 以前，更新URL后缀配置时出现争用情况，并且配置的URL后缀和 `url_rewrite` 表不匹配。

<!-- ACP2E-1703 -->

* 现在，在创建类别URL重写时，Adobe Commerce会在所有级别呈现类别树。 以前，仅显示前三个级别的类别。 [GitHub-36973](https://github.com/magento/magento2/issues/36973)

<!-- ACP2E-1644 -->

* 现在，新创建的带有一个子节点的CMS页面包含在营销过滤器网格(**[!UICONTROL Marketing]** > **[!UICONTROL URL rewrites]**)。 以前，不会为这些CMS页面创建URL重写。

<!-- ACP2E-1737 -->

* 在导入新类别期间，CSV文件中现在存在类别URL重写。

<!-- ACP2E-1668 -->

* 现在，无URL重写的多存储CMS页面按预期转发。 以前，请求的多存储CMS页面若没有URL重写，则会被重定向到存储主页，但原始CMS页面不会被定向。

### Visual Merchandiser

<!-- ACP2E-1363 -->

* 您现在可以使用 `Categories` 可视化促销器规则的属性。 以前，Adobe Commerce引发此异常：  `Something went wrong while saving the category`.

### Web API框架

<!-- ACP2E-1543 -->

* 现在，使用批量API创建的客户将收到在其分配的网站中配置的语言版本的客户注册电子邮件。  以前，所有电子邮件都会发送到默认区域设置，而不是客户所分配到网站的区域设置。

<!-- ACP2E-1339 AC-7577-->

* 此 `POST V1/guest-carts` 在以下情况下，呼叫不再提交访客订单： **[!UICONTROL Allow Guest Checkout]** 已禁用。

<!-- ACP2E-1336 -->

* 您现在可以从管理员处打开状态为的订单 `Received` 时间 `AsyncOrder` 未启用。 以前，当订单状态被更改时，无法从管理员中打开订单详细信息页面 `POST V1/orders`.

<!-- ACP2E-1526 -->

* Adobe Commerce现在已成功返回 `content` 中的属性（base64图像代码） `GET V1/products/sku/media` 产品媒体API响应。 此 `content` 属性之前未显示在响应中。

## 已知问题

Adobe Commerce 2.4.7-beta2中将修复以下已知问题：

**问题**：UPS已于2023年6月5日弃用UPS XML API，这会对商家造成以下影响：

* 当前客户（即已生成UPS访问密钥的商家）在2024年6月之前不会受到影响。

* 希望生成新访问密钥以使用Adobe Commerce现成UPS集成的商家当前无法生成新密钥。

**问题**：单击 **[!UICONTROL Show password]** storefront登录页面上的按钮未按预期显示密码。  <!-- AC-8823 -->

**问题**：当一个或多个子产品通过计划更新被禁用时，可配置产品在店面中被错误地列为缺货。 <!-- ACP2E-2003 -->

**问题**：从产品中删除分配给迷你购物车的共享目录后，不会按预期从迷你购物车中删除产品。 <!-- AC-8935 -->

**问题**：固定捆绑产品的价格不包括预期指定的特殊价格。 <!-- ACP2E-2034 -->

## 系统要求

我们的技术栈栈是基于PHP和MySQL构建的。 有关更多信息，请参阅 [系统要求](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/system-requirements.html).

## 安装和升级说明

您可以使用安装Adobe Commerce 2.4.7-beta1 [Composer](https://experienceleague.adobe.com/docs/commerce-operations/installation-guide/composer.html).
