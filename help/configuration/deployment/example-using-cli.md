---
title: 使用CLI命令的示例
description: 请参阅有关如何使用命令行在开发系统中设置共享、系统特定的敏感值的示例。
exl-id: d0058e9f-a5a9-48a6-9c66-c61515666335
source-git-commit: 95ffff39d82cc9027fa633dffedf15193040802d
workflow-type: tm+mt
source-wordcount: '1019'
ht-degree: 0%

---

# 使用CLI命令的示例

此示例说明如何在开发系统中设置共享的、特定于系统的敏感值，然后将这些值部署到生产系统。
这是通过使用共享配置、 `config.php` 文件和Commerce CLI命令。

此示例使用以下配置设置：

- **增值税号** 和 **存储名称** 用于共享配置设置。

  这些规则位于 **商店** >设置> **配置** >常规> **常规**.

- **发送电子邮件至** 以获取敏感配置值。

  该函数位于 **商店** >设置> **配置** >常规> **联系人**.

- **默认电子邮件域** 用于系统特定的配置值。

  该函数位于 **商店** >设置> **配置** >客户> **客户配置** > **创建新帐户选项**.

您可以使用本示例中显示的相同过程来配置以下引用中的任何设置：

- [敏感且特定于系统的配置路径参考](../reference/config-reference-sens.md)
- [支付配置路径参考](../reference/config-reference-payment.md)
- [其他配置路径参考](../reference/config-reference-general.md)
- [Commerce Enterprise B2B扩展配置路径参考](../reference/config-reference-b2b.md)

## 开始之前

在开始之前，请按照中所述设置文件系统权限和所有权 [开发、构建和生产系统的先决条件](../deployment/prerequisites.md).

## 假设

本主题提供了修改生产系统配置的示例。 您可以根据需要选择不同的配置选项。

在本例中，我们假定：

- 您使用Git源代码控制
- 开发系统可在名为的Git远程存储库中使用 `mconfig`
- 您的Git工作分支已命名 `m2.2_deploy`

## 步骤1：在开发系统中设置配置

要在开发系统中设置默认区域设置和权重单位，请执行以下操作：

1. 登录到管理员。
1. 单击 **商店** >设置> **配置** >常规> **常规**.
1. 如果您有多个可用网站，请使用 **商店视图** 列表以切换到不同的网站，如下图所示。

   ![切换网站](../../assets/configuration/split-deploy-switch-website.png)

1. 在右窗格中，展开 **存储信息**.
1. 如有必要，请清除 **使用默认值** 旁边的复选框 **增值税号** 和 **存储名称** 字段。
1. 在字段中输入数字(例如， `12345`)。
1. 在 **存储名称** 字段，输入值(如 `My Store`)。
1. 单击 **保存配置**.
1. 在左侧导航中的“常规”下，单击 **联系人**.
1. 在右窗格中，展开 **电子邮件选项**.
1. 如有必要，请清除 **使用默认值** 旁边的复选框 **发送电子邮件至** 字段。
1. 在字段中输入电子邮件地址。
1. 单击 **保存配置**.
1. 使用 **商店视图** 列表以选择 **默认配置** 如下图所示。

   ![切换到默认配置](../../assets/configuration/split-deploy-default-config.png)

1. 在左窗格中，单击客户> **客户配置**.
1. 在右窗格中，展开 **创建新帐户选项**.
1. 如有必要，请清除 **使用系统值** 旁边的复选框 **默认电子邮件域** 字段。
1. 在字段中输入域名。
1. 单击 **保存配置**.
1. 如果出现提示，请刷新缓存。

## 步骤2：更新配置

现在，您已在Admin中更改配置，请使用以下步骤将共享配置写入文件：

{{$include /help/_includes/config-save-config.md}}

即使 `app/etc/env.php` （系统特定的配置）已更新，请勿将其签入到源代码管理。
稍后将在此过程中在生产系统上创建相同的配置设置。

## 步骤3：更新构建系统并生成文件

现在，您已经将共享配置的更改提交到源代码管理，您可以将这些更改提取到构建系统中，编译代码并生成静态文件。

{{$include /help/_includes/config-update-build-system.md}}

## 步骤4：更新生产系统

该流程的最后一步是更新生产系统。 您必须分两部分完成此操作：

- 更新敏感和特定于系统的设置
- 更新共享设置

### 更新敏感和特定于系统的设置

要使用环境变量设置敏感和特定于系统的设置，您必须了解以下信息：

- 每个设置的范围

  如果您按照步骤1中的说明进行操作，则要映射的 **发送电子邮件至** 是网站和范围 **默认电子邮件域** 是全局的（即默认配置范围）。

  您需要网站代码来设置 **发送电子邮件至** 配置值。

  有关查找此值的详细信息，请参阅： [使用环境变量覆盖配置设置](../reference/override-config-settings.md#environment-variables).

- 此示例中使用的设置的配置路径：

  | 设置名称 | 配置路径 |
  | -------------------- | -------------------------------------- |
  | 发送电子邮件至 | `contact/email/recipient_email` |
  | 默认电子邮件域 | `customer/create_account/email_domain` |

  有关所有敏感和特定于系统的配置路径，请参阅： [敏感且特定于系统的配置路径参考](../reference/config-reference-sens.md).

### 使用CLI命令设置变量

使用以下CLI命令设置特定于系统的敏感配置设置：

- `magento config:set` 用于系统特定的设置
- `magento config:sensitive:set` 用于敏感设置

设置系统特定的设置 **默认电子邮件域**，位于默认范围内，请使用以下命令：

```bash
bin/magento config:set customer/create_account/email_domain <email domain>
```

您不需要在命令中使用范围，因为它是默认范围。

要设置值 **发送电子邮件至**&#x200B;但是，您必须知道范围类型(`website`)和范围代码，每个网站上的范围代码可能都不相同。

示例：

```unix
bin/magento config:sensitive:set contact/email/recipient_email --scope=website --scope-code=<website code> <email address>
```

### 更新共享设置

本节将讨论如何在开发及构建系统时执行所有更改，以及如何将更改提取到生产环境中，这会更新共享配置设置（商店名称和VAT编号）。

{{$include /help/_includes/config-update-prod-system.md}}

### 在“管理员”中验证配置设置

要验证配置设置：

1. 登录到生产系统的管理员。
1. 单击 **商店** >设置> **配置** >常规> **常规**.
1. 使用 **商店视图** 列表以切换到其他网站。

   在开发系统中设置的共享配置选项显示如下。

   ![检查生产系统中的设置](../../assets/configuration/split-deploy-verify-storeinfo.png)

   >[!INFO]
   >
   >此 **存储名称** 字段在网站范围中可编辑，但如果您切换到默认配置范围，则无法编辑该字段。 这是您在开发系统中设置选项的结果。 的值 **增值税号** 在网站范围内不可编辑。

1. 如果您尚未这样做，请切换到默认配置范围。
1. 在左侧导航中的“常规”下，单击 **联系人**.

   此 **发送电子邮件至** 字段不可编辑，如下图所示。 这是一个敏感设置。

   ![检查生产系统中的设置](../../assets/configuration/split-deploy-verify-contacts.png)

1. 在左窗格中，单击客户> **客户配置**.
1. 在右窗格中，展开 **创建新帐户选项**.

   的值 **默认电子邮件域** 字段如下所示。 这是系统特定的设置。

   ![检查生产系统中的设置](../../assets/configuration/split-default-domain.png)
