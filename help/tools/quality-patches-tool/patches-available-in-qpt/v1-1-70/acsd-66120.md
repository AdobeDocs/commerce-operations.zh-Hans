---
title: ACSD-66120： [!DNL GraphQL] 在目录价格含税时显示不正确的折扣百分比和基本价格
description: 应用ACSD-66120修补程序以修复Adobe Commerce问题，该问题导致在目录价格配置为含税时， [!DNL GraphQL] 错误地显示折扣百分比和基本价格。 此问题导致舍入误差，例如显示19.99%的折扣，而不是预期的20%。
feature: GraphQL
role: Admin, Developer
type: Troubleshooting
source-git-commit: 237ec3fb5834b4130eee1ce121dfcd2655c851de
workflow-type: tm+mt
source-wordcount: '500'
ht-degree: 0%

---


# ACSD-66120：当目录价格包含税时，[!DNL GraphQL]显示不正确的折扣百分比和基本价格

ACSD-66120修补程序修复了在将目录价格配置为含税时，[!DNL GraphQL]错误地显示折扣百分比和基本价格的问题。 此问题导致舍入误差，例如显示19.99%的折扣，而不是预期的20%。 安装[[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70时，此修补程序可用。 修补程序ID为ACSD-66120。 请注意，此问题计划在Adobe Commerce 2.4.9中修复。

## 受影响的产品和版本

**为Adobe Commerce版本创建了修补程序：**

* Adobe Commerce（所有部署方法） 2.4.6-p9

**与Adobe Commerce版本兼容：**

* Adobe Commerce（所有部署方法） 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>该修补程序可能适用于具有新[!DNL Quality Patches Tool]发行版本的其他版本。 要检查修补程序是否与您的Adobe Commerce版本兼容，请将`magento/quality-patches`包更新到最新版本，并在[[!DNL Quality Patches Tool]：搜索修补程序页面](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html?lang=zh-Hans)上检查兼容性。 使用修补程序ID作为搜索关键字来查找修补程序。

## 问题

将目录价格配置为包含税时，GraphQL错误地显示折扣百分比和基本价格。 由于舍入错误，折扣百分比显示为19.99%，而不是配置的20%。

<u>重现步骤</u>：

1. 转到&#x200B;**[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Catalog]** > **[!UICONTROL Catalog]** > **[!UICONTROL Price]**。
1. 将&#x200B;**[!UICONTROL Catalog Price Scope]**&#x200B;设置为&#x200B;*网站*。
1. 转到&#x200B;**[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Calculation Settings]**。
   1. 将&#x200B;**[!UICONTROL Tax Calculation Method Based On]**&#x200B;设置为&#x200B;*单价*。
   1. 将&#x200B;**[!UICONTROL Catalog Prices]**&#x200B;设置为&#x200B;*含税*。
   1. 将&#x200B;**[!UICONTROL Apply Discount On Prices]**&#x200B;设置为&#x200B;*含税*。
1. 转到&#x200B;**[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Default Tax Destination Calculation]**。
   1. 将&#x200B;**[!UICONTROL Default Country]**&#x200B;设置为&#x200B;*法国*。
1. 转到&#x200B;**[!UICONTROL Stores]** > **[!UICONTROL Tax Zones and Rates]** > **[!UICONTROL Add new Tax Rate]**。
   1. 在&#x200B;**[!UICONTROL Tax Identifier]**&#x200B;字段中输入任意名称。
   1. 在&#x200B;**[!UICONTROL Zip/Post Code]**&#x200B;字段中输入星号(*)。
   1. 将&#x200B;**[!UICONTROL Country]**&#x200B;设置为&#x200B;*法国*。
   1. 在&#x200B;*字段中输入* 20.000000 **[!UICONTROL Rate Percent]**。
   1. 单击&#x200B;**[!UICONTROL Save]**。
1. 转到&#x200B;**[!UICONTROL Stores]** > **[!UICONTROL Tax Rules]** > **[!UICONTROL Add New Tax Rule]**。
   1. 在&#x200B;**[!UICONTROL Name]**&#x200B;字段中输入任意名称。
   1. 将&#x200B;**[!UICONTROL Tax Rate]**&#x200B;设置为在上一步中添加的速率。
1. 转到&#x200B;**[!UICONTROL Catalog]** > **[!UICONTROL Products]** > **[!UICONTROL Add Product]**。
   1. 在&#x200B;*字段中输入* test **[!UICONTROL Product Name]**。
   1. 在&#x200B;*字段中输入* test **[!UICONTROL SKU]**。
   1. 在&#x200B;**字段中输入** 82.65 **[!UICONTROL Price]**。
   1. 将&#x200B;**[!UICONTROL Tax Class]**&#x200B;设置为&#x200B;*应纳税商品*。
   1. 在&#x200B;*字段中输入* 100 **[!UICONTROL Quantity]**。
   1. 单击&#x200B;**[!UICONTROL Save]**。
1. 将范围更改为&#x200B;*默认存储视图*。
   1. 取消设置&#x200B;**[!UICONTROL Use Default Value]**&#x200B;价格。
   1. 将&#x200B;**[!UICONTROL Price]**&#x200B;设置为&#x200B;*68.87*。
   1. 在税类上取消设置&#x200B;**[!UICONTROL Use Default Value]**。
   1. 将&#x200B;**[!UICONTROL Tax Class]**&#x200B;设置为&#x200B;*应纳税商品*。 
   1. 单击&#x200B;**[!UICONTROL Save]**。
1. 转到&#x200B;**[!UICONTROL Marketing]** > *[!UICONTROL Promotions]* > **[!UICONTROL Catalog Price Rule]** > **[!UICONTROL Add New Rule]**。
   1. 在&#x200B;**[!UICONTROL Rule Name]**&#x200B;字段中输入任意名称。
   1. 将&#x200B;**[!UICONTROL Active]**&#x200B;设置为&#x200B;*是*。
   1. 将&#x200B;**[!UICONTROL Website]**&#x200B;设置为&#x200B;*主网站*。
   1. 将&#x200B;**[!UICONTROL Customer Groups]**&#x200B;设置为&#x200B;*所有*
   1. 在&#x200B;**[!UICONTROL Actions]**&#x200B;下，将&#x200B;**[!UICONTROL Apply]**&#x200B;设置为&#x200B;*应用为原始*&#x200B;的百分比。
   1. 在&#x200B;*字段中输入* 20.000000 **[!UICONTROL Discount Amount]**。
   1. 单击&#x200B;**[!UICONTROL Save]**。
1. 执行完全重新索引：

```
$ bin/magento index:reindex
```

1. 使用标头中设置的[!DNL GraphQL]执行以下&#x200B;**[!UICONTROL Store]**&#x200B;查询： *default*：

```
query{
products(filter: {sku: {eq: "test"}}, sort: {name: ASC}) {
    items {
      name
      sku
      price_range {
        minimum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
        maximum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
      }
    }
  }
}
  
```

<u>预期的结果</u>：

折扣百分比应符合目录规则：20%。

<u>实际结果</u>：

折扣百分比显示为19.99%有误。

## 应用修补程序

要应用单独的修补程序，请根据您的部署方法使用以下链接：

* Adobe Commerce或Magento Open Source内部部署： [[!DNL Quality Patches Tool] 指南中的](/help/tools/quality-patches-tool/usage.md)>使用情况[!DNL Quality Patches Tool]。
* 云基础架构上的Adobe Commerce：云基础架构上的Commerce指南中的[升级和修补程序>应用修补程序](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html?lang=zh-Hans)。

## 相关阅读

要了解有关[!DNL Quality Patches Tool]的更多信息，请参阅：

* [[!DNL Quality Patches Tool]： “工具”指南中用于高质量修补程序的](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md)的自助服务工具。
