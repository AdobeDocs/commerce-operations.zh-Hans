---
title: ACSD-68064：在具有深度嵌套类别的环境中进行计划更新期间创建的重复条目
description: 应用ACSD-68064修补程序以修复Adobe Commerce问题，该问题导致在具有大量嵌套类别的环境中创建计划更新会导致重复条目并阻止类别保存。
feature: Catalog Management
role: Admin, Developer
type: Troubleshooting
source-git-commit: c7a955e6f9131255420ad0a163e457bd27cfc253
workflow-type: tm+mt
source-wordcount: '393'
ht-degree: 0%

---


# ACSD-68064：在具有深度嵌套类别的环境中进行计划更新期间创建的重复条目

ACSD-68064修补程序修复了在具有大量嵌套类别的环境中创建计划更新会导致重复条目并阻止类别保存的问题。 安装[[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.72时，此修补程序可用。 修补程序ID为ACSD-68064。 请注意，此问题计划在Adobe Commerce 2.4.9中修复。

## 受影响的产品和版本

**为Adobe Commerce版本创建了修补程序：**

* Adobe Commerce（所有部署方法） 2.4.7-p6

**与Adobe Commerce版本兼容：**

* Adobe Commerce（所有部署方法） 2.4.7 - 2.4.7-p7

>[!NOTE]
>
>该修补程序可能适用于具有新[!DNL Quality Patches Tool]发行版本的其他版本。 要检查修补程序是否与您的Adobe Commerce版本兼容，请将`magento/quality-patches`包更新到最新版本，并在[[!DNL Quality Patches Tool]：搜索修补程序页面](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html?lang=zh-Hans)上检查兼容性。 使用修补程序ID作为搜索关键字来查找修补程序。

## 问题

如果在具有大量嵌套类别的环境中创建计划更新，会导致重复条目，从而导致错误和无法保存类别。

<u>重现步骤</u>：

1. 安装干净的实例。
1. 修改性能夹具文件(small.xml)以包括：
   1. **[!UICONTROL Categories]**： *2500*
   1. **[!UICONTROL Products]**： *250,000*
1. 使用命令生成数据：

   ```
   bin/magento setup:performance:generate-fixtures var/performance-toolkit/profiles/ce/small.xml
   ```

1. 创建产品和类别后，请通过运行以下查询确保所有类别均设置为锚点：

   ```
   UPDATE catalog_category_entity_int set value = 1 where attribute_id = (select attribute_id from eav_attribute where attribute_code = 'is_anchor'); 
   ```

1. 重新索引数据。
1. 登录到“管理员”面板，然后导航到&#x200B;**[!UICONTROL Catalog]** > **[!UICONTROL Categories]**。
1. 将&#x200B;**类别2**&#x200B;移动到&#x200B;**类别1**&#x200B;下以创建更嵌套的结构。
1. 转到深度嵌套的类别，例如&#x200B;**类别2.1.1**。
1. 创建一个&#x200B;**[!UICONTROL Scheduled Update]**。
1. 单击&#x200B;**[!UICONTROL Save]**。

<u>预期的结果</u>：

已成功保存类别。

<u>实际结果</u>：

出现错误，无法保存类别。 `var/log/exception.log`包含错误，类似于：

```
Exception #0 (Magento\Framework\DB\Adapter\DuplicateException): SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '229-255' for key 'temp_category_descendants_619aaaaaaaaaa.PRIMARY', query was: INSERT INTO `temp_category_descendants_619aaaaaaaaaa` (`category_id`, `descendant_id`) SELECT `ce`.`entity_id` AS `category_id`, `ce2`.`entity_id` AS `descendant_id` FROM `catalog_category_entity` AS `ce`
 INNER JOIN `catalog_category_entity` AS `ce2` ON ce2.path LIKE CONCAT(ce.path, '/%') OR ce2.entity_id = ce.entity_id AND (ce2.created_in <= '1750287600' AND ce2.updated_in > '1750287600') WHERE ((ce.entity_id IN (4, 6, 7, 8, 10, 24, 25, 27, 30, 33, 34, 35, 36, 37, 40, 41, 42, 43, 44, 48, 51, 54, 56, 57, 59, 60, 63, 64, 65, 66, 67 .......
```

## 应用修补程序

要应用单独的修补程序，请根据您的部署方法使用以下链接：

* Adobe Commerce或Magento Open Source内部部署： [[!DNL Quality Patches Tool] 指南中的](/help/tools/quality-patches-tool/usage.md)>使用情况[!DNL Quality Patches Tool]。
* 云基础架构上的Adobe Commerce：云基础架构上的Commerce指南中的[升级和修补程序>应用修补程序](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html?lang=zh-Hans)。

## 相关阅读

要了解有关[!DNL Quality Patches Tool]的更多信息，请参阅：

* [[!DNL Quality Patches Tool]： “工具”指南中用于高质量修补程序的](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md)的自助服务工具。
