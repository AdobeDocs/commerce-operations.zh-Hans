---
title: ' [!DNL Cloud Automation Patching Service (CAPS)] 工作流程的工作方式'
description: 了解 [!DNL Cloud Automation Patching Service (CAPS)] 工作流过程，包括术语、工作流阶段以及自动化修补程序管理的操作。
hide: true
hidefromtoc: true
source-git-commit: eff8c0ae9e1d9db6b46ba7cfbb915685ab5b194d
workflow-type: tm+mt
source-wordcount: '831'
ht-degree: 0%

---

# [!DNL Cloud Automation Patching Service (CAPS)]工作流的工作方式

本主题提供了有关如何使用[!DNL CAPS (Cloud Automation Patching Service)]执行修补程序操作的高级概述。

## 术语

* **操作** - [!DNL CAPS]执行的主要操作：
   * 应用
   * 还原
* **阶段** — 工作流的三个阶段：
   * 初步检查
   * 修补
   * 验证
* **环境** — 应用修补程序的Adobe Commerce云环境。

## 操作

[!DNL CAPS]支持两个主要的&#x200B;*操作*，用于管理Adobe Commerce云环境中的修补程序：

* **应用操作** — 通过安全、经过验证的进程将修补程序更改添加到代码库。 通过将修补程序文件放入“m2-hotfixes”文件夹来应用修补程序。

* **还原操作** — 通过从“m2-hotfixes”文件夹中删除修补程序文件，从代码库中移除先前应用的修补程序。

>[!IMPORTANT]
>
>还原操作仅适用于最初通过[!DNL CAPS]应用的修补程序。 使用此服务无法还原手动或通过其他方法应用的修补程序。

## 阶段

[!DNL CAPS]工作流使用始终按此顺序执行的三个&#x200B;*阶段*，以确保安全可靠地应用修补程序：

* **初步检查** — 验证修补程序兼容性和环境就绪性。
* **修补** — 在集成环境中应用或还原修补程序。
* **验证** — 验证修补程序应用程序并执行运行状况检查。

## 阶段详细信息

### 第1阶段：初步检查

初步检查阶段将验证修补程序是否可以安全地应用到您的环境。

**发生的情况：**

* **生产环境保护** （仅限生产环境）：
   * 检查存储是否处于维护模式
   * 验证cron作业是否已禁用
   * 在不满足条件时阻止修补
   * 满足条件时显示确认对话框
* **修补程序验证** — 验证修补程序文件有效且兼容
* **环境评估** — 检查环境准备情况和资源
* **冲突检测** — 标识与现有代码的潜在冲突
* **依赖关系检查** — 验证Adobe Commerce版本兼容性

### 阶段2：修补

修补阶段在临时集成环境中应用或还原修补程序以进行测试。 在此阶段，[!DNL CAPS]会创建一个临时测试环境，以便在对实际环境进行更改之前安全地应用和测试修补程序。

此方法提供：

* **安全** — 在验证修补程序之前，保持目标环境不变
* **正在测试** — 在影响生产之前，正在实际环境中测试
* **回滚功能** — 如果检测到问题
* **隔离** — 用于每个修补程序操作

#### 阶段2a：集成环境创建

**分支创建** - [!DNL CAPS]将创建一个名为`{target-environment}-CAPS-{patch-id}`的临时集成环境分支

**环境设置** — 集成环境是作为目标环境的子项创建的

**代码同步** — 集成环境继承目标环境的确切状态

**资源要求** - [!DNL CAPS]使用目标环境中的代码库创建临时环境。 根据Adobe Commerce Cloud文档，每个环境（包括集成环境）均根据您合同的存储计划进行单独的存储分配。 您合同的存储量表示每个环境的总存储量。 在大多数情况下，您不会遇到任何资源限制问题。 如果您遇到任何资源限制错误，请检查您的应用程序大小和计划中的约定存储空间。

#### 暂存2b：集成环境中的修补程序应用程序

**安全测试** — 该修补程序应用于集成环境，而不是直接应用于您的目标环境

**文件管理** — 修补程序文件放置在`m2-hotfixes/`目录中

**Git操作** — 已提交更改并将其推送到集成环境分支

**环境激活** — 激活集成环境以部署修补的代码

#### 阶段2c：合并回目标环境

**环境签出** - [!DNL CAPS]在本地签出您的目标环境

**合并操作** — 集成环境分支已合并到目标环境中

**冲突解决** — 如果发生任何冲突，则尽可能自动解决冲突

**部署** — 将合并的更改部署到目标环境

**验证** - [!DNL CAPS]验证合并是否成功以及环境是否同步

**环境清理** — 删除临时集成环境以释放资源

## 集成环境生命周期

在修补阶段，集成环境具有特定的生命周期：

* **创建** — 在修补阶段开始时创建
* **活动时段** — 在修补程序应用和测试期间保持活动状态
* **清理** — 在成功合并后或操作失败，自动删除

### 阶段3：验证

验证阶段可确保修补的应用程序正常运行并执行运行状况检查。

**发生的情况：**

* **应用程序运行状况检查** — 验证应用程序是否启动并正常运行
* **清理** — 删除临时环境，更新日志，通知完成

## 成功指标

**应用操作：**

* “作业已成功完成” — 应用了修补程序，并且未出现问题
* “修补程序已应用” — 修补程序已存在（无需操作）
* 修补程序文件已成功放置到“m2-hotfixes”文件夹中
* 所有验证检查都通过
* 应用程序运行状况检查成功

**还原操作：**

* “作业已成功完成” — 修补程序已还原且没有问题
* “修补程序已还原” — 修补程序已还原（无需操作）
* 已成功从“m2-hotfixes”文件夹中删除修补程序文件
* 所有验证检查都通过
* 应用程序运行状况检查成功

## 生产环境保障

[!DNL CAPS]包含用于生产环境的特定安全保护措施，以防止意外中断并确保修补程序在之前得到安全验证。

### 生产修补的前提条件

在将修补程序应用到生产环境之前，[!DNL CAPS]会检查两个关键条件：

* **维护模式** — 存储必须处于维护模式
* **已禁用Cron作业** — 必须禁用Cron作业

如果不满足上述任一条件，则会阻止修补程序应用程序并通知用户。

## 相关主题

* [CAPS介绍](intro.md)
* [如何访问](access.md)
* [最佳实践](best-practices.md)
* [故障排除](troubleshooting.md)
