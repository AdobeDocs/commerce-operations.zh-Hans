---
title: 优化Adobe商务性能
description: 通过更改某些默认设置，准备Adobe商务项目以将Adobe Experience Manager用作CMS。
source-git-commit: 6ad72d5110ae3e3a7cf341282f2af9b700874f09
workflow-type: tm+mt
source-wordcount: '1143'
ht-degree: 0%

---


# 优化Adobe商务性能

## AEM和Adobe商务基础架构的地理位置

为了减少在构建页面时AEM发布者与Adobe商务GraphQL之间的延迟，应在同一AWS（或Azure）区域内托管两个单独的基础架构的初始配置。 为这两个云选择的地理位置也应最接近大多数客户群，以便客户端GraphQL请求从地理位置上的较近位置提供给大多数客户。

## Adobe商务中的GraphQL缓存

当用户的浏览器或AEM发布者调用Adobe商务的GraphQL时，某些调用将被缓存
快。 缓存的查询通常是包含非个人数据且不太可能经常更改的查询。 例如：类别、类别列表和产品。 明确未缓存的是那些定期更改的，如果已缓存，则可能会对个人数据和网站操作（例如cart和customerPaymentTokens等查询）造成风险。

GraphQL允许您在一次调用中进行多个查询。 请务必注意，如果您甚至指定了一个查询，即Adobe商务没有缓存许多其他不可缓存的查询，则Adobe商务将绕过调用中所有查询的缓存。 在合并多个查询时，开发人员应考虑这一点，以确保可能可缓存的查询不会无意中绕过‡。

>[!NOTE]
>
> 有关可缓存和不可缓存查询的更多信息，请参阅Adobe商务[开发人员文档](https://devdocs.magento.com/guides/v2.4/graphql/caching.html)。

## 目录平桌

不建议将平面表格用于产品和类别。 使用此已弃用的功能可能会导致性能下降和索引问题，因此平面目录应通过Adobe商务管理员在storefront部分中禁用。 某些第三方模块和自定义确实需要平面表才能正常运行 — 建议进行评估，以了解在选择使用这些扩展或自定义时必须使用平面表所产生的影响和风险。

## 快源屏蔽

默认情况下，未启用Fastlyorigin屏蔽。 Fastly起源屏蔽的目的是直接减少对Adobe商业起源的流量：收到请求后，Fastlyedge位置（或“存在点”/POP）会检查是否存在缓存的内容并提供该内容。 如果未缓存，则会继续Shield POP检查其是否已缓存（如果先前已从其他全局POP请求内容，则会缓存）。 最后，如果未缓存在Shield POP上，则只会继续到源服务器。

可以在Adobe商务管理员Fastly配置后端设置中启用Fastlyorigin屏蔽。 您应选择与Adobe商务源数据中心最接近的屏蔽位置，以获得最佳性能。

## 快速图像优化

启用Fastlyorigin屏蔽后，您还可以激活Fastly Image Optimizer。 当产品目录图像存储在Adobe商务中时，此服务允许将所有资源密集型产品目录图像转换处理从Adobe商务源“快速”和“关闭”卸载到产品目录图像。 最终用户响应时间也因页面加载时间而缩短，因为图像在边缘位置被变换，通过减少返回Adobe商务源的请求数来消除延迟。

尽管只有在您的原始防护板被激活之后，才能在管理员的Fastly配置中通过“启用深层图像优化”来启用Fastly图像优化。 有关Fastly Image优化配置的更多详细信息，请参阅Adobe商务[开发人员文档](https://devdocs.magento.com/cloud/cdn/fastly-image-optimization.html)。

![Adobe商务管理员中“快速”图像优化设置的屏幕截图](../assets/commerce-at-scale/image-optimization.svg)

## 禁用未使用的模块

如果运行Adobe商务无头，则仅通过GraphQL端点提供请求，而不直接从Adobe商务中提供前端商店页面，则许多模块会变得冗余且不使用。 通过禁用未使用的模块，您的Adobe商务代码库会变得更小、更简单，因此可以提高性能。 可以使用编辑器管理Adobe商务中禁用模块。 可禁用的模块取决于您网站的要求，因此无法提供推荐的列表，因为它将特定于每位Adobe商务的实施。

## MySQL和Redis连接激活

默认情况下，云上的Adobe商务中不会激活MySQL和Redis从连接。 这是因为这些设置仅适用于期望负载非常高的客户。 从连接激活后，跨可用区（跨可用区）延迟会更高，因此，如果实例仅接收常规负载级别，则此设置实际上会降低云实例上Adobe商务的性能。

如果Adobe商务实例需要极端负载，则激活MySQL和Redis的主控从程序将负载分散到不同节点上，从而有助于提高性能。

作为指南，在负载正常的环境中，启用从连接会使性能降低10-15%。 但是，在负载和流量较大的群集上，性能提升约10-15%。 因此，务必使用预期流量级别来加载测试环境，以评估此设置对加载下的性能时间是否有益。

要启用/禁用mysql和redis的从连接，您应编辑`.magento.env.yaml`文件以包含以下内容：

```
stage:
  deploy:
    MYSQL_USE_SLAVE_CONNECTION: true
    REDIS_USE_SLAVE_CONNECTION: true
```

对于缩放式架构（拆分式架构 — 请参阅下文），不应启用Redis从连接，因为这将导致显示错误。 对于拆分架构，建议为Redis实施L2缓存。

## 在云缩放（拆分）架构上迁移到Adobe商务

如果在完成上述所有配置后，加载测试结果或对实时基础架构性能的分析仍表明Adobe商务的加载级别始终达到最大CPU和其他系统资源的级别，则应考虑迁移到缩放（拆分）架构。

使用标准Pro架构时，有3个节点，每个节点都包含完整的技术堆栈。 通过转换为分层架构，这最少更改为6个节点：其中包括Elasticsearch、MariaDB、Redis等核心服务；用于处理Web流量的其他3个包含phpfpm和NGINX。 分层存在更大的扩展可能性：包含数据库的核心节点可以垂直缩放；Web节点可以水平和垂直缩放，因此可以根据需要在设定的高负载活动期间和需要额外资源的节点上扩展基础架构，从而具有很大的灵活性。

如果由于对网站的负载期望过高而决定切换到分层架构，则应与客户成功经理讨论启用此功能的步骤。