---
title: 自托管Adobe Commerce灾难恢复
description: 了解自托管灾难恢复的想法和概念以及需要考虑的最佳实践。
landing-page-description: 了解在您自己托管Adobe Commerce时要考虑的灾难恢复概念和事项。
short-description: 了解自行托管Adobe Commerce的策略和灾难恢复概念。
kt: 11420
doc-type: tutorial
audience: all
last-substantial-update: 2023-04-13T00:00:00Z
source-git-commit: 6e361169889c8fe1c176d3a3283d52699dfa3b85
workflow-type: tm+mt
source-wordcount: '1771'
ht-degree: 0%

---


# 自托管Adobe Commerce灾难恢复思想

本文的灾难恢复包含失败的部署。 尽管整个过程可能不同，但同样的原则也适用。 灾难可能是由于生产部署失败、服务器变得无响应、发现漏洞和许多其他情况所致。 如果失败部署的恢复过程可能只需要两个简单的步骤，那么从利用漏洞进行恢复可能会更具挑战性。 由于环境的复杂性、托管变体和其他复杂性，本文提供了一些想法和概念，但您需要自己继续调查。 这样，您就可以确保设计出符合业务需求的策略。

## 通常的恢复过程

练习，练习，练习。 在灾难恢复列表中首先显示实践是有原因的。 制定一个恢复计划，但永远不执行它，这远非易事。 如果您的实践不够，则容易出现错误、错过步骤，并且实际恢复可能需要更长的时间。 恢复实践的频率取决于您和您的业务合作伙伴。 将恢复过程作为年度活动可能已足够好，但与公司中的这些决策者进行深入的对话应该包括几个关键主题。 这些主题有助于他们了解为什么练习很重要，应该期待。 以下是一些有助于开始对话的主题：

* 练习可减少实际发生事件时的实际停机时间。 如果练习练习使您的网站每年停机一小时，则实际事件的实际停机时间可能会减少数小时。 恢复网站需要8小时或更长时间并不罕见。 通过实践此事件，您通常可以减少每个阶段所花费的时间，并且您能够更快地恢复。
* 这些实践运行的计划停机时间可以与服务器补丁程序、库存调整或其他任何应按常规计划执行的操作一致。
* 应该采用不同的方案，而不是同一个方案。 偶尔花点时间，从前一个日期开始进行完全恢复。 这包括查找和使用数据库的存档副本，回滚代码以匹配日期等内容。 一个更简单的方法是从失败的部署中恢复，在该部署中，您只需回退到上一个提交即可。
* 验证恢复过程是否确实有效，有时存档的数据库会损坏。 这样做可确保所有内容都能够恢复并正常运行。 查找和恢复旧数据库需要时间，应该知道此过程的这一部分可能需要多长时间。
* 验证配置中的所有更改是否均已记录在案。 这可确保从旧数据库进行的任何恢复都能够获得任何新配置更改，这些更改必须能够正常工作。 例如，如果API密钥在过去几天内更改为付款处理器。 通过拥有一个良好的变更管理流程，找到这些关键更新后，该流程将按计划运行。

## 数据库备份

数据库备份应相当定期。 每小时、每日、每周和每月都有快照的情况并不罕见。 备份最终应移至长期存储。 只要业务或技术团队决定已经过了足够的时间，以至于可能不再需要从他们那里快速恢复，就会发生这种长期存储。 从长期存储进行恢复会为恢复过程增加时间，因此应当谨慎决定何时应发生此情况。 数据库备份应该是自动的，而不是依靠人为交互。 这可确保您有足够的数据，以提供安全且可预测的恢复过程。 这也有助于在任何法证活动中，如有必要，这种活动是可行和可靠的。 在检测到利用漏洞后，或在尝试诊断何时发生信用卡欺诈活动，甚至当某人加入您的网站时，您可能会发现需要进行法证研究。 这些备份的使用方式没有限制，但备份的频度很好，在您实际需要时，这是您的节约优势。

以下是数据保留策略的示例：

* 每八小时。 备份应该易于访问。
* 最近七天的每日备份，应该可以随时访问。 其副本可能是被移到异地的候选项。
* 过去四周的每周备份都可以考虑转移到异地。
* 过去三个月的每月备份都转移到异地。
* 旧备份将移至异地长期存储。

## 作为代码的基础架构

此方法意味着您拥有相应的工具和代码来为项目重建部件或整个基础架构。 当服务器体验出现问题且必须停用时，可能需要此操作。 能够快速将新服务器联机、部署代码、进行任何PHP、Nginx或Apache配置等，自动意味着减少停机时间。 即使是在运行手册中记录有详细记录的步骤也更容易设置，执行这些步骤所花费的时间也要长得多。 此外，请考虑在压力下可能发生的人为错误，以使无响应网站重新上线。

## 辅助数据库

使用辅助数据库可能有一些用处，原因如下：

* 主驱动器出现故障时，热备用
* 允许从应用程序发出已准备就绪的请求
* 允许发生mysqldump，并允许正常事务发生，而不锁定数据库
* 允许从外部数据源访问数据，而不会降低网站处理客户请求信息的能力。

次数据库可用作 `warm standby`. 当您考虑如何从主数据库故障中恢复时，可能会发生这种情况。 将辅助数据库提升到主数据库比重建数据库并将其恢复到新创建的Mysql实例的复杂性低。 这减少了恢复操作期间的实际停机时间。

有机会将一些请求转移到辅助数据库。 如果使用此方法，则建议将辅助数据库设为只读。 允许Adobe Commerce应用程序使用此辅助数据库进行读取操作，有助于获取一些读取请求并允许辅助数据库做出响应。 但是，此更改仅占所有请求的30-50%，但您从主数据库中提取的任何负载都是一次胜利。

## 创建包含回滚的部署计划

每个部署都应包含回滚计划。 是的，每个部署。 如果你打算这么做，你永远不会感到惊讶，也会为糟糕的事件做好准备。 有时，最简单的代码更新可能会因任何原因而灾难性地失败。

假设一个团队提交了一个简单的小拉取请求，以在数据库中执行模式更改，请考虑这个真实情况。 随着部署从1分钟、5分钟、10分钟，团队变得更加担心。 到目前为止，他们未能验证和考虑的是与暂存数据库相比，生产数据库与暂存数据库之间存在任何差异。 他们通常会在使用生产副本刷新暂存环境时删除所有客户数据。 这意味着，在完成部署之前，他们的所有测试和QA都需要几分钟时间才能完成。 实际上，他们拥有2000多万客户，而完成这一小规模模式更改需要非常长的时间。 由于他们不知道实际需要多长时间，他们不得不终止mysql过程并回滚部署。

为部署准备回滚过程只需几分钟，因为整个过程将是相似的。 但是，您应该花时间确切地记录要将git存储库的HEAD重置回的提交内容。 如果当前数据库快照始终位于同一位置，则应准确记录要使用的数据库快照或查找当前数据库快照的位置。 定义了必须讨论部署状态以及事件自动生效的时间。 例如，如果任何部署需要超过15分钟，请咨询项目经理和其他利益相关者，以确定是否应继续部署。 但是，如果回滚过程需要45分钟，而不管项目经理和项目架构师是否犹豫，都会自动执行回滚过程并通知所有利益相关方。

确保有多人参与整个过程和每个阶段。 让中级开发人员审核文件的部署过程、回滚过程和位置是让他们参与的绝佳方式。 他们最终将执行这些步骤，以便让他们了解整个过程是长期成功的关键。 确保每个人都有权取消部署。 给你的团队这么多发言权，是授权和回报。 如果初级开发者真的觉得有东西不见了，他们就会觉得有必要大声说话，听听他们的谨慎。 让架构师和项目经理确认或减轻他们的恐惧。 有一支强大的团队来关注项目并保持其完美部署的记录，这一点非常重要。

## 验证对域名管理、DMS、SSL、WAF的访问权限

由于域名过期，DNS记录可能会被意外修改，SSL证书可能会过期，等等；确保您能够登录并验证是否应经常发生连接。 每季度进行一次简单的检查，您就会确信自己确切知道产品的位置，特别是在紧急情况下。 请勿假定您的DNS是在您的注册机构中管理的，只是为了确定您是否在Amazon中管理了DNS。 这些记录不常被使用，因此，忘记这些记录的位置很有可能。 请勿仅信任用户名和密码的书面文档。 登录到每个配置，并验证您要查找的配置是否实际在其中进行管理。 在管理层更替或公司收购期间，事情往往会发生变化，只有一个人知道发生了什么，因为是他们进行了更新。 他们不知道您依赖的是共享的Word文档，其位置、用户名和密码。 查找对您和贵组织有意义的检查流程，但每三到六个月执行一次检查是一个很好的起点。

{{$include /help/_includes/hosting-related-links.md}}
